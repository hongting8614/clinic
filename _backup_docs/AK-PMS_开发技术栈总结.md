# ğŸ”§ AK-PMS å¼€å‘æŠ€æœ¯æ ˆæ€»ç»“

<div align="center">

**AK-PMS (AiKang Pharmacy Management System)**  
**Version**: 3.3  
**æ›´æ–°æ—¥æœŸ**: 2025-11-01  
**æ–‡æ¡£ç±»å‹**: æŠ€æœ¯æ ˆé€ŸæŸ¥æ‰‹å†Œ

</div>

---

## ğŸ“Š æŠ€æœ¯æ ˆä¸€è§ˆè¡¨

### å‰ç«¯æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯/å·¥å…· | ç‰ˆæœ¬ | å®˜æ–¹æ–‡æ¡£ | ç”¨é€” |
|------|----------|------|---------|------|
| **ğŸ¨ æ¡†æ¶** | uni-app | 3.x | [uniapp.dcloud.io](https://uniapp.dcloud.io/) | è·¨å¹³å°å¼€å‘æ¡†æ¶ |
| **âš›ï¸ JSæ¡†æ¶** | Vue.js | 3.x | [vuejs.org](https://vuejs.org/) | å“åº”å¼UIå¼€å‘ |
| **ğŸ­ UIç»„ä»¶** | Vant Weapp | 1.11+ | [vant-contrib.gitee.io/vant-weapp](https://vant-contrib.gitee.io/vant-weapp) | ç§»åŠ¨ç«¯UIç»„ä»¶åº“ |
| | uView Plus | 3.x | [uiadmin.net/uview-plus](https://www.uiadmin.net/uview-plus/) | uni-appä¸“ç”¨UIåº“ |
| **ğŸ“ˆ å›¾è¡¨åº“** | ECharts | 5.4+ | [echarts.apache.org](https://echarts.apache.org/) | æ•°æ®å¯è§†åŒ– |
| **ğŸ—„ï¸ çŠ¶æ€ç®¡ç†** | Vuex / Pinia | 4.x / 2.x | [vuex.vuejs.org](https://vuex.vuejs.org/) | å…¨å±€çŠ¶æ€ç®¡ç† |
| **ğŸ¨ æ ·å¼** | Sass/SCSS | - | [sass-lang.com](https://sass-lang.com/) | CSSé¢„å¤„ç†å™¨ |

### åç«¯æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯/å·¥å…· | ç‰ˆæœ¬ | å®˜æ–¹æ–‡æ¡£ | ç”¨é€” |
|------|----------|------|---------|------|
| **ğŸš€ è¿è¡Œæ—¶** | Node.js | 18 LTS | [nodejs.org](https://nodejs.org/) | äº‘å‡½æ•°è¿è¡Œç¯å¢ƒ |
| **â˜ï¸ äº‘å¹³å°** | è…¾è®¯äº‘å¼€å‘ | CloudBase | [cloud.tencent.com](https://cloud.tencent.com/document/product/876) | Serverlesså¹³å° |
| **ğŸ’¾ æ•°æ®åº“** | MongoDB | 4.4+ | [mongodb.com](https://www.mongodb.com/) | æ–‡æ¡£å‹æ•°æ®åº“ |
| **ğŸ“¦ äº‘å­˜å‚¨** | COS | - | [cloud.tencent.com/product/cos](https://cloud.tencent.com/product/cos) | å¯¹è±¡å­˜å‚¨æœåŠ¡ |
| **â° å®šæ—¶ä»»åŠ¡** | äº‘å‡½æ•°è§¦å‘å™¨ | - | - | å®šæ—¶æ‰§è¡Œä»»åŠ¡ |
| **ğŸ“ æ—¥å¿—** | äº‘æ—¥å¿— | - | - | æ—¥å¿—æ”¶é›†ä¸åˆ†æ |

### å¼€å‘å·¥å…·

| ç±»åˆ« | å·¥å…· | ç‰ˆæœ¬ | ä¸‹è½½åœ°å€ | ç”¨é€” |
|------|------|------|---------|------|
| **ğŸ’» IDE** | HBuilderX | æœ€æ–°ç‰ˆ | [dcloud.io](https://www.dcloud.io/hbuilderx.html) | uni-appå¼€å‘å·¥å…· |
| | å¾®ä¿¡å¼€å‘è€…å·¥å…· | æœ€æ–°ç‰ˆ | [developers.weixin.qq.com](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html) | å°ç¨‹åºè°ƒè¯•å·¥å…· |
| **ğŸ“¦ åŒ…ç®¡ç†** | npm | 9.6+ | [npmjs.com](https://www.npmjs.com/) | ä¾èµ–ç®¡ç† |
| **ğŸ”§ CLIå·¥å…·** | @cloudbase/cli | æœ€æ–°ç‰ˆ | - | äº‘å¼€å‘å‘½ä»¤è¡Œå·¥å…· |
| **ğŸ“ ä»£ç è§„èŒƒ** | ESLint | 8.x | [eslint.org](https://eslint.org/) | ä»£ç æ£€æŸ¥ |
| | Prettier | 2.x | [prettier.io](https://prettier.io/) | ä»£ç æ ¼å¼åŒ– |
| **ğŸ”„ ç‰ˆæœ¬æ§åˆ¶** | Git | 2.x | [git-scm.com](https://git-scm.com/) | ç‰ˆæœ¬ç®¡ç† |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸ“± ç”¨æˆ·å±‚                                 â”‚
â”‚                   (å¾®ä¿¡å°ç¨‹åºå®¢æˆ·ç«¯)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  å‰ç«¯æ¡†æ¶: uni-app + Vue3                                      â”‚
â”‚  UIç»„ä»¶: Vant Weapp + uView Plus                              â”‚
â”‚  å›¾è¡¨åº“: ECharts                                              â”‚
â”‚  çŠ¶æ€ç®¡ç†: Vuex / Pinia                                       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ HTTPS / WebSocket
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    âš™ï¸ åº”ç”¨å±‚                                  â”‚
â”‚                (è…¾è®¯äº‘å¼€å‘ CloudBase)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  äº‘å‡½æ•° (Node.js 18):                                         â”‚
â”‚  â”œâ”€ drugManage        (è¯å“ç®¡ç†)                              â”‚
â”‚  â”œâ”€ stockManage       (åº“å­˜ç®¡ç†)                              â”‚
â”‚  â”œâ”€ inRecords         (å…¥åº“è®°å½•)                              â”‚
â”‚  â”œâ”€ outRecords        (å‡ºåº“è®°å½•)                              â”‚
â”‚  â”œâ”€ clinicRecords     (é—¨è¯Šç™»è®°)      ğŸ”¥ v3.2æ ¸å¿ƒ             â”‚
â”‚  â”œâ”€ consumeRecords    (æ¶ˆè€—ç»Ÿè®¡)                              â”‚
â”‚  â”œâ”€ requisitionRecords (è¯·é¢†ç®¡ç†)                             â”‚
â”‚  â”œâ”€ reportService     (æŠ¥è¡¨æœåŠ¡)      ğŸ”¥ v3.3æ–°å¢             â”‚
â”‚  â”œâ”€ queryService      (æŸ¥è¯¢æœåŠ¡)      ğŸ”¥ v3.3æ–°å¢             â”‚
â”‚  â”œâ”€ dailySummary      (æ¯æ—¥ç»Ÿè®¡)      â° å®šæ—¶ä»»åŠ¡             â”‚
â”‚  â””â”€ expiryMonitor     (æ•ˆæœŸé¢„è­¦)      â° å®šæ—¶ä»»åŠ¡             â”‚
â”‚                                                               â”‚
â”‚  APIç½‘å…³: è‡ªåŠ¨ç”ŸæˆRESTfulæ¥å£                                  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ’¾ æ•°æ®å±‚                                  â”‚
â”‚              (äº‘æ•°æ®åº“ + äº‘å­˜å‚¨)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  æ•°æ®åº“é›†åˆ (MongoDB):                                         â”‚
â”‚  â”œâ”€ drugs              (è¯å“æ¡£æ¡ˆ)                             â”‚
â”‚  â”œâ”€ stock              (åº“å­˜è¡¨)         ğŸ”¥ æ ¸å¿ƒè¡¨              â”‚
â”‚  â”œâ”€ in_records         (å…¥åº“è®°å½•)                             â”‚
â”‚  â”œâ”€ out_records        (å‡ºåº“è®°å½•)                             â”‚
â”‚  â”œâ”€ clinic_usage       (é—¨è¯Šç™»è®°)       ğŸ”¥ v3.2æ–°å¢           â”‚
â”‚  â”œâ”€ consume_records    (æ¶ˆè€—è®°å½•)                             â”‚
â”‚  â”œâ”€ requisition_records (è¯·é¢†è®°å½•)                            â”‚
â”‚  â”œâ”€ statistics         (ç»Ÿè®¡æ•°æ®)       ğŸ”¥ v3.3æ–°å¢           â”‚
â”‚  â”œâ”€ alerts             (é¢„è­¦è®°å½•)       ğŸ”¥ v3.3æ–°å¢           â”‚
â”‚  â”œâ”€ users              (ç”¨æˆ·è¡¨)                               â”‚
â”‚  â””â”€ operation_logs     (æ“ä½œæ—¥å¿—)                             â”‚
â”‚                                                               â”‚
â”‚  äº‘å­˜å‚¨:                                                       â”‚
â”‚  â”œâ”€ ç”µå­ç­¾åå›¾ç‰‡                                               â”‚
â”‚  â”œâ”€ æŠ¥è¡¨å¯¼å‡ºæ–‡ä»¶ (Excel/PDF)                                  â”‚
â”‚  â””â”€ æ•°æ®åº“å¤‡ä»½æ–‡ä»¶                                             â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒä¾èµ–åŒ…

### package.json (å‰ç«¯)

```json
{
  "name": "ak-pms-miniprogram",
  "version": "3.3.0",
  "description": "AK-PMS è¯æç®¡ç†ç³»ç»Ÿ",
  "main": "main.js",
  "dependencies": {
    "@dcloudio/uni-app": "^3.0.0",
    "vue": "^3.2.0",
    "vuex": "^4.0.0",
    "pinia": "^2.0.0",
    "echarts": "^5.4.0",
    "vant-weapp": "^1.11.0",
    "uview-plus": "^3.0.0"
  },
  "devDependencies": {
    "@vue/cli-service": "^5.0.0",
    "sass": "^1.50.0",
    "sass-loader": "^10.0.0",
    "eslint": "^8.0.0",
    "prettier": "^2.0.0"
  }
}
```

### package.json (äº‘å‡½æ•°)

```json
{
  "name": "ak-pms-cloudfunctions",
  "version": "3.3.0",
  "description": "AK-PMS äº‘å‡½æ•°",
  "dependencies": {
    "wx-server-sdk": "^3.0.0"
  }
}
```

---

## ğŸ”‘ æ ¸å¿ƒæŠ€æœ¯ç‰¹æ€§

### 1. åˆ†å›­åŒºç®¡ç†æ¶æ„ ğŸ”¥

```javascript
// location å­—æ®µè´¯ç©¿å…¨ç³»ç»Ÿ
const LOCATIONS = {
  LAND_PARK: 'land_park',         // é™†å›­
  WATER_PARK: 'water_park',       // æ°´å›­
  CLINIC_STORAGE: 'clinic_storage' // åŒ»åŠ¡å®¤ä»“åº“
};

// åº“å­˜å”¯ä¸€é”®: drugId + batch + location
const stockKey = {
  drugId: 'DR001',
  batch: 'BATCH001',
  location: 'land_park'
};

// é—¨è¯Šç™»è®°å¿…é¡»æŒ‡å®šå›­åŒº
const clinicRecord = {
  drugId: 'DR001',
  location: 'land_park',  // ğŸ”¥ æ ¸å¿ƒå­—æ®µ
  quantityMin: 6,
  patient: 'å¼ ä¸‰'
};
```

### 2. FIFOæ‰¹æ¬¡ç®¡ç† ğŸ”¥

```javascript
// è‡ªåŠ¨æŒ‰æœ‰æ•ˆæœŸæ’åºï¼Œå…ˆè¿›å…ˆå‡º
const batches = await db.collection('stock')
  .where({
    drugId: drugId,
    location: location,
    quantity: _.gt(0)
  })
  .orderBy('expiryDate', 'asc')  // ğŸ”¥ FIFO: å…ˆè¿›å…ˆå‡º
  .get();

// å‡ºåº“æ—¶è‡ªåŠ¨é€‰æ‹©æœ€æ—©æ‰¹æ¬¡
const selectedBatch = batches.data[0];
```

### 3. å•ä½æ¢ç®—ç³»ç»Ÿ ğŸ”¥

```javascript
// è¯å“å®šä¹‰
const drug = {
  name: 'é˜¿è«è¥¿æ—èƒ¶å›Š',
  specification: '0.25gÃ—24ç²’',
  packUnit: 'ç›’',           // åŒ…è£…å•ä½(å…¥åº“/å‡ºåº“)
  minUnit: 'ç²’',            // æœ€å°å•ä½(é—¨è¯Š/æ¶ˆè€—)
  conversionRate: 24        // æ¢ç®—å› å­: 1ç›’=24ç²’
};

// é—¨è¯Šç™»è®°: æœ€å°å•ä½ â†’ åŒ…è£…å•ä½
const quantityMin = 6;      // åŒ»ç”Ÿè¾“å…¥: 6ç²’
const quantityPack = quantityMin / drug.conversionRate;  // 0.25ç›’
// æ‰£åº“å­˜: -0.25ç›’
```

### 4. æœ‰æ•ˆæœŸé¢„è­¦ç³»ç»Ÿ ğŸ”¥

```javascript
// é¢„è­¦è§„åˆ™ (ç¬¦åˆGSPæ ‡å‡†)
function expiryStatus(daysToExpiry) {
  if (daysToExpiry <= 0) return 'è¿‡æœŸ';     // ğŸ”´
  if (daysToExpiry <= 60) return 'ä¸´æœŸ';    // ğŸŸ  60å¤©æ ‡å‡†
  return 'æ­£å¸¸';                            // ğŸŸ¢
}

// æ¯æ—¥è‡ªåŠ¨æ‰«æ
// è§¦å‘æ—¶é—´: æ¯æ—¥ 00:10
// æ‰§è¡Œå†…å®¹:
// 1. è®¡ç®—æ‰€æœ‰åº“å­˜çš„è·æœ‰æ•ˆæœŸå¤©æ•°
// 2. æ›´æ–°é¢„è­¦çŠ¶æ€
// 3. ç”Ÿæˆé¢„è­¦è®°å½•
// 4. æ¨é€å¾®ä¿¡é€šçŸ¥
```

### 5. ç†è®ºåº“å­˜è®¡ç®— ğŸ”¥

```javascript
// v3.2 ä¿®è®¢ç‰ˆï¼ˆæ–°å¢é—¨è¯Šç”¨è¯ï¼‰
theoreticalStock(drugId, batch, location) = 
    Î£ å…¥åº“æ•°é‡(è¯¥è¯å“, è¯¥æ‰¹æ¬¡, è¯¥å›­åŒº)
  - Î£ å‡ºåº“æ•°é‡(è¯¥è¯å“, è¯¥æ‰¹æ¬¡, è¯¥å›­åŒº)
  - Î£ é—¨è¯Šç”¨è¯æ•°é‡(è¯¥è¯å“, è¯¥æ‰¹æ¬¡, è¯¥å›­åŒº)  // ğŸ”¥ v3.2æ–°å¢
  + Î£ ç›˜ç‚¹è°ƒæ•´æ•°é‡(è¯¥è¯å“, è¯¥æ‰¹æ¬¡, è¯¥å›­åŒº)
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡è¦ç‚¹

### æ ¸å¿ƒè¡¨ç»“æ„

#### 1. stock (åº“å­˜è¡¨) - æœ€æ ¸å¿ƒ

```javascript
{
  _id: 'STK001',
  drugId: 'DR001',
  drugName: 'é˜¿è«è¥¿æ—èƒ¶å›Š',
  specification: '0.25gÃ—24ç²’',     // ğŸ”¥ v3.3å¿…é¡»
  batch: 'BATCH20251101',
  location: 'land_park',           // ğŸ”¥ æ ¸å¿ƒç»´åº¦
  quantity: 32,                    // å½“å‰åº“å­˜
  unit: 'ç›’',
  expiryDate: '2026-01-15',        // ğŸ”¥ v3.3å¿…é¡»
  daysToExpiry: 76,                // ğŸ”¥ è‡ªåŠ¨è®¡ç®—
  expiryStatus: 'æ­£å¸¸',            // ğŸ”¥ æ­£å¸¸/ä¸´æœŸ/è¿‡æœŸ
  price: 15.5,
  updateTime: ISODate()
}

// ğŸ”¥ å¤åˆå”¯ä¸€ç´¢å¼•
db.stock.createIndex(
  { drugId: 1, batch: 1, location: 1 },
  { unique: true }
);
```

#### 2. clinic_usage (é—¨è¯Šç™»è®°) - v3.2æ ¸å¿ƒæ–°å¢

```javascript
{
  _id: 'CU20251101001',
  drugId: 'DR001',
  drugName: 'é˜¿è«è¥¿æ—èƒ¶å›Š',
  specification: '0.25gÃ—24ç²’',     // ğŸ”¥ v3.3å¿…é¡»
  batchId: 'BATCH20251101',
  location: 'land_park',           // ğŸ”¥ å¿…å¡«ï¼Œæ ¸å¿ƒå­—æ®µ
  quantityMin: 6,                  // æœ€å°å•ä½
  quantityPack: 0.25,              // åŒ…è£…å•ä½ï¼ˆè‡ªåŠ¨æ¢ç®—ï¼‰
  unit: 'ç²’',
  packUnit: 'ç›’',
  operatorId: 'openid_doctor',
  operatorName: 'æåŒ»ç”Ÿ',
  patient: 'å¼ ä¸‰',
  createTime: ISODate()
}

// ğŸ”¥ ç´¢å¼•
db.clinic_usage.createIndex(
  { location: 1, drugId: 1, createTime: -1 }
);
```

#### 3. statistics (ç»Ÿè®¡æ•°æ®) - v3.3æ–°å¢

```javascript
{
  _id: 'STAT20251101_land_park',
  date: '2025-11-01',
  location: 'land_park',
  type: 'daily',
  
  inbound: {
    count: 5,
    totalQuantity: 100,
    totalAmount: 1550
  },
  
  outbound: {
    count: 3,
    totalQuantity: 30
  },
  
  clinic: {                        // ğŸ”¥ v3.2æ–°å¢
    count: 12,
    totalQuantity: 40,
    patientCount: 8
  },
  
  stock: {
    totalValue: 50000,
    drugCount: 150,
    lowStockCount: 5,
    expiryWarningCount: 3
  },
  
  createTime: ISODate()
}
```

### ç´¢å¼•ç­–ç•¥

```javascript
// é«˜é¢‘æŸ¥è¯¢ç´¢å¼•
db.drugs.createIndex({ name: 1 });
db.drugs.createIndex({ barcode: 1 }, { unique: true });
db.drugs.createIndex({ pinyin: 1 });

db.stock.createIndex({ drugId: 1, batch: 1, location: 1 }, { unique: true });
db.stock.createIndex({ location: 1, drugId: 1 });
db.stock.createIndex({ expiryDate: 1 });
db.stock.createIndex({ daysToExpiry: 1 });

db.clinic_usage.createIndex({ location: 1, drugId: 1, createTime: -1 });
db.clinic_usage.createIndex({ patient: 1 });

db.statistics.createIndex({ date: -1, location: 1 });

// TTLç´¢å¼•ï¼ˆè‡ªåŠ¨æ¸…ç†90å¤©å‰çš„æ—¥å¿—ï¼‰
db.operation_logs.createIndex(
  { createTime: 1 },
  { expireAfterSeconds: 7776000 }
);
```

---

## ğŸš€ éƒ¨ç½²æµç¨‹

### ç¯å¢ƒå‡†å¤‡

```bash
# 1. å®‰è£…Node.js (18 LTS)
node -v  # v18.17.0

# 2. å®‰è£…äº‘å¼€å‘CLI
npm install -g @cloudbase/cli

# 3. ç™»å½•äº‘å¼€å‘
tcb login

# 4. åˆ›å»ºäº‘ç¯å¢ƒ
tcb env:create akpms-prod --alias "AK-PMSç”Ÿäº§ç¯å¢ƒ"
```

### éƒ¨ç½²äº‘å‡½æ•°

```bash
# è¿›å…¥äº‘å‡½æ•°ç›®å½•
cd cloudfunctions

# æ‰¹é‡éƒ¨ç½²
for dir in */; do
  cd "$dir"
  npm install
  tcb fn:deploy --name "${dir%/}" --force
  cd ..
done
```

### åˆå§‹åŒ–æ•°æ®åº“

```bash
# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
node scripts/initDatabase.js

# å†…å®¹åŒ…æ‹¬:
# 1. åˆ›å»º11ä¸ªæ•°æ®åº“é›†åˆ
# 2. åˆ›å»ºç´¢å¼•
# 3. æ’å…¥åˆå§‹æ•°æ®ï¼ˆç”¨æˆ·ã€é…ç½®ç­‰ï¼‰
```

### é…ç½®å®šæ—¶ä»»åŠ¡

```bash
# æ¯æ—¥ç»Ÿè®¡ä»»åŠ¡ (æ¯å¤©23:59)
tcb fn:trigger:create dailySummary \
  --name daily-summary-trigger \
  --type timer \
  --config '{"cron":"59 23 * * *"}'

# æ•ˆæœŸé¢„è­¦ä»»åŠ¡ (æ¯å¤©00:10)
tcb fn:trigger:create expiryMonitor \
  --name expiry-monitor-trigger \
  --type timer \
  --config '{"cron":"10 0 * * *"}'
```

### éƒ¨ç½²å°ç¨‹åº

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. é…ç½®ç¯å¢ƒID (åœ¨App.vueä¸­)
wx.cloud.init({
  env: 'akpms-prod-xxxxx',
  traceUser: true
});

# 3. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ä¸Šä¼ ä»£ç 
# 4. åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°æäº¤å®¡æ ¸
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### æ•°æ®åº“ä¼˜åŒ–

```javascript
// 1. ä½¿ç”¨æŠ•å½±å‡å°‘æ•°æ®ä¼ è¾“
const drugs = await db.collection('drugs')
  .field({
    name: true,
    specification: true,
    unit: true,
    price: true
  })
  .get();

// 2. ä½¿ç”¨èšåˆç®¡é“æé«˜æ€§èƒ½
const summary = await db.collection('stock')
  .aggregate()
  .match({ location: 'land_park' })
  .group({
    _id: '$drugId',
    totalQuantity: _.sum('$quantity')
  })
  .end();

// 3. åˆ†é¡µæŸ¥è¯¢
const list = await db.collection('drugs')
  .skip((page - 1) * pageSize)
  .limit(pageSize)
  .get();
```

### å‰ç«¯ä¼˜åŒ–

```javascript
// 1. æ•°æ®ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
state.drugCache[drugId] = data;
state.cacheExpiry[`drug_${drugId}`] = Date.now() + 300000;

// 2. å›¾ç‰‡æ‡’åŠ è½½
<image lazy-load :src="imageUrl" />

// 3. åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨
<recycle-list :list="longList" />
```

---

## ğŸ”’ å®‰å…¨æœºåˆ¶

### æƒé™æ§åˆ¶

```javascript
// è§’è‰²æƒé™çŸ©é˜µ
const ROLE_PERMISSIONS = {
  admin: ['drug.*', 'stock.*', 'inbound.*', 'outbound.*', ...],
  pharmacist: ['drug.view', 'drug.add', 'stock.view', ...],
  doctor: ['clinic.*', 'query.clinic'],
  clerk: ['stock.view', 'outbound.create']
};

// äº‘å‡½æ•°æƒé™éªŒè¯
async function checkPermission(openid, action) {
  const user = await db.collection('users')
    .where({ _openid: openid })
    .get();
    
  if (!hasPermission(user.role, action)) {
    throw new Error('æƒé™ä¸è¶³');
  }
}
```

### æ•°æ®å®‰å…¨

```javascript
// 1. æ“ä½œæ—¥å¿—è®°å½•
await db.collection('operation_logs').add({
  data: {
    action,
    userId: user._openid,
    ip: context.ip,
    createTime: new Date()
  }
});

// 2. æ•æ„Ÿä¿¡æ¯è„±æ•
function maskString(str) {
  return str.slice(0, 2) + '****' + str.slice(-2);
}

// 3. æ•°æ®åº“æƒé™ï¼ˆåœ¨æ§åˆ¶å°é…ç½®ï¼‰
{
  "read": "auth != null",
  "write": "auth != null && auth.role in ['admin', 'pharmacist']"
}
```

---

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£

| æŠ€æœ¯ | æ–‡æ¡£åœ°å€ | è¯´æ˜ |
|------|---------|------|
| uni-app | https://uniapp.dcloud.io/ | æ¡†æ¶æ–‡æ¡£ |
| Vue 3 | https://vuejs.org/ | Vue3æ–‡æ¡£ |
| å¾®ä¿¡å°ç¨‹åº | https://developers.weixin.qq.com/miniprogram/dev/framework/ | å°ç¨‹åºæ–‡æ¡£ |
| è…¾è®¯äº‘å¼€å‘ | https://cloud.tencent.com/document/product/876 | äº‘å¼€å‘æ–‡æ¡£ |
| MongoDB | https://www.mongodb.com/docs/ | æ•°æ®åº“æ–‡æ¡£ |
| ECharts | https://echarts.apache.org/handbook/zh/get-started/ | å›¾è¡¨æ–‡æ¡£ |

### æ¨èæ•™ç¨‹

```
å‰ç«¯:
- uni-appå®˜æ–¹è§†é¢‘æ•™ç¨‹
- Vue3ç»„åˆå¼APIæ•™ç¨‹
- å¾®ä¿¡å°ç¨‹åºäº‘å¼€å‘å®æˆ˜

åç«¯:
- Node.jså¼‚æ­¥ç¼–ç¨‹
- MongoDBèšåˆæŸ¥è¯¢
- Serverlessæ¶æ„å®è·µ

ç»¼åˆ:
- è¯å“ç®¡ç†ç³»ç»Ÿæœ€ä½³å®è·µ
- GSPè¯å“è´¨é‡ç®¡ç†è§„èŒƒ
```

---

## ğŸ› ï¸ å¼€å‘è§„èŒƒ

### ä»£ç è§„èŒƒ

```javascript
// å‘½åè§„èŒƒ
const drugName = 'xxx';          // å˜é‡: camelCase
const MAX_QUANTITY = 100;        // å¸¸é‡: UPPER_SNAKE_CASE
function getDrugInfo() {}        // å‡½æ•°: camelCase
class DrugManager {}             // ç±»: PascalCase

// æ–‡ä»¶å‘½å
drug-selector.vue                // ç»„ä»¶: kebab-case
drugManage/index.js              // äº‘å‡½æ•°: camelCase/index.js
```

### Gitæäº¤è§„èŒƒ

```bash
feat: æ–°å¢é—¨è¯Šç”¨è¯ç™»è®°åŠŸèƒ½
fix: ä¿®å¤åº“å­˜æ‰£å‡bug
docs: æ›´æ–°æŠ€æœ¯æ–‡æ¡£
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: é‡æ„æŠ¥è¡¨æŸ¥è¯¢æ¨¡å—
test: æ·»åŠ å•å…ƒæµ‹è¯•
chore: æ›´æ–°ä¾èµ–ç‰ˆæœ¬
```

### æ³¨é‡Šè§„èŒƒ

```javascript
/**
 * è·å–è¯å“åº“å­˜ä¿¡æ¯
 * @param {string} drugId - è¯å“ID
 * @param {string} location - å›­åŒºæ ‡è¯†
 * @returns {Promise<Object>} åº“å­˜ä¿¡æ¯
 * @throws {AppError} å½“è¯å“ä¸å­˜åœ¨æ—¶æŠ›å‡ºé”™è¯¯
 */
async function getStockInfo(drugId, location) {
  // å®ç°ä»£ç 
}
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### é—®é¢˜æ’æŸ¥

| é—®é¢˜ç±»å‹ | æ’æŸ¥æ–¹å‘ | å¸¸ç”¨å·¥å…· |
|---------|---------|---------|
| äº‘å‡½æ•°æŠ¥é”™ | æŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿— | äº‘å¼€å‘æ§åˆ¶å° |
| æ•°æ®åº“æŸ¥è¯¢æ…¢ | æ£€æŸ¥ç´¢å¼•ã€æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ | MongoDB Explain |
| å°ç¨‹åºç™½å± | æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ã€ç½‘ç»œè¯·æ±‚ | å¼€å‘è€…å·¥å…· |
| æƒé™é—®é¢˜ | æ£€æŸ¥ç”¨æˆ·è§’è‰²ã€æ•°æ®åº“æƒé™ | ç”¨æˆ·ç®¡ç†ã€æƒé™é…ç½® |

### è”ç³»æ–¹å¼

- **æŠ€æœ¯æ–‡æ¡£**: æœ¬é¡¹ç›® `/docs` ç›®å½•
- **æŠ€æœ¯æ”¯æŒ**: ak-pms-tech@example.com
- **é¡¹ç›®åœ°å€**: D:\medicine_manager\AK-PMS
- **æ›´æ–°æ—¥å¿—**: CHANGELOG.md

---

## ğŸ“ˆ ç‰ˆæœ¬æ›´æ–°è®°å½•

### v3.3 (2025-11-01) ğŸ”¥ æœ€æ–°ç‰ˆ

**æ–°å¢åŠŸèƒ½**:
- âœ… 5å¤§æ ¸å¿ƒæŠ¥è¡¨ï¼ˆR1-R5ï¼‰
- âœ… 6é¡¹å¸¸ç”¨æŸ¥è¯¢ï¼ˆQ1-Q6ï¼‰
- âœ… æ‰€æœ‰æŠ¥è¡¨æ˜¾ç¤ºè¯å“è§„æ ¼
- âœ… æœ‰æ•ˆæœŸé¢„è­¦ç³»ç»Ÿï¼ˆâ‰¤60å¤©ä¸´æœŸï¼‰
- âœ… ç›˜ç‚¹æŠ¥è¡¨æ˜¾ç¤ºè·æœ‰æ•ˆæœŸå¤©æ•°
- âœ… EChartså¯è§†åŒ–å›¾è¡¨
- âœ… Excel/PDFæŠ¥è¡¨å¯¼å‡º
- âœ… å®šæ—¶ä»»åŠ¡è‡ªåŠ¨ç»Ÿè®¡

**æŠ€æœ¯æ”¹è¿›**:
- âœ… æ–°å¢ `reportService` äº‘å‡½æ•°
- âœ… æ–°å¢ `queryService` äº‘å‡½æ•°
- âœ… æ–°å¢ `dailySummary` å®šæ—¶ä»»åŠ¡
- âœ… æ–°å¢ `expiryMonitor` å®šæ—¶ä»»åŠ¡
- âœ… æ–°å¢ `statistics` æ•°æ®è¡¨
- âœ… æ–°å¢ `alerts` é¢„è­¦è¡¨
- âœ… ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•

### v3.2 (2025-10-30)

**æ ¸å¿ƒæ›´æ–°**:
- âœ… é—¨è¯Šç”¨è¯ç™»è®°åˆ†å›­åŒºï¼ˆlocationå­—æ®µï¼‰
- âœ… ç†è®ºåº“å­˜è®¡ç®—å…¬å¼ä¿®è®¢ï¼ˆæ–°å¢é—¨è¯Šç”¨è¯é¡¹ï¼‰
- âœ… æ–°å¢ `clinicRecords` äº‘å‡½æ•°
- âœ… æ–°å¢ `clinic_usage` æ•°æ®è¡¨
- âœ… æ•°æ®è¿ç§»å…¼å®¹æ–¹æ¡ˆ

### v3.1 (2025-10-15)

**åŠŸèƒ½å®Œå–„**:
- âœ… åŒäººå¤æ ¸ç”µå­ç­¾å
- âœ… FIFOæ‰¹æ¬¡ç®¡ç†
- âœ… å•ä½æ¢ç®—ç³»ç»Ÿ
- âœ… åˆ†å›­åŒºåº“å­˜ç®¡ç†

---

<div align="center">

**ğŸ”§ AK-PMS å¼€å‘æŠ€æœ¯æ ˆæ€»ç»“**  
**Version**: 3.3  
**æœ€åæ›´æ–°**: 2025-11-01

---

### æŠ€æœ¯æ ˆé€ŸæŸ¥å®Œæˆ âœ…

**å…³é”®æŠ€æœ¯**:
- å‰ç«¯: uni-app + Vue3 + Vant + ECharts
- åç«¯: è…¾è®¯äº‘å¼€å‘ + Node.js 18 + MongoDB
- æ ¸å¿ƒ: åˆ†å›­åŒºç®¡ç† + FIFOæ‰¹æ¬¡ + å•ä½æ¢ç®— + æ•ˆæœŸé¢„è­¦

**æ–‡æ¡£ç³»åˆ—**:
- ğŸ“˜ åŠŸèƒ½ä¸ç®¡ç†æ–‡æ¡£ (`AK-PMS_v3.3_åŠŸèƒ½ä¸ç®¡ç†æ–‡æ¡£.md`)
- âš™ï¸ æŠ€æœ¯æ ˆä¸å®ç°è¯´æ˜ (`AK-PMS_v3.3_æŠ€æœ¯æ ˆä¸å®ç°è¯´æ˜.md`)
- ğŸ”§ å¼€å‘æŠ€æœ¯æ ˆæ€»ç»“ (æœ¬æ–‡æ¡£)

---

**æ„Ÿè°¢ä½¿ç”¨ AK-PMSï¼**

</div>


