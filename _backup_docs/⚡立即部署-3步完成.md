# ⚡ 立即部署 - 3步完成

**目标：** 让所有功能立即可用  
**时间：** 约6分钟

---

## 第1步：上传3个云函数（3分钟）

### 1.1 上传 stock Manage

```
1. 打开微信开发者工具
2. 左侧目录 → cloudfunctions → stockManage
3. 右键点击 stockManage
4. 选择：上传并部署：云端安装依赖
5. 等待上传完成（看到"上传成功"提示）
```

### 1.2 上传 requisitionRecords

```
1. 右键点击 requisitionRecords
2. 选择：上传并部署：云端安装依赖
3. 等待上传完成
```

### 1.3 上传 drugManage（如未部署）

```
1. 右键点击 drugManage
2. 选择：上传并部署：云端安装依赖
3. 等待上传完成
```

### ✅ 验证云函数

```
云开发控制台 → 云函数
应该看到：
- ✅ drugManage（状态：部署成功）
- ✅ stockManage（状态：部署成功）
- ✅ requisitionRecords（状态：部署成功）
- ✅ inRecords（状态：部署成功）
- ✅ outRecords（状态：部署成功）
- ✅ consumeRecords（状态：部署成功）
```

---

## 第2步：创建2个数据库集合（2分钟）

### 2.1 创建 requisition_records

```
1. 云开发控制台 → 数据库
2. 点击"添加集合"
3. 集合名称：requisition_records
4. 点击"确定"
5. 点击新建的 requisition_records 集合
6. 权限设置 → 所有用户可读写
7. 保存
```

### 2.2 创建 stock（如未创建）

```
1. 点击"添加集合"
2. 集合名称：stock
3. 点击"确定"
4. 权限设置 → 所有用户可读写
5. 保存
```

### ✅ 验证数据库

```
云开发控制台 → 数据库
应该看到以下集合：
- ✅ drugs
- ✅ in_records
- ✅ out_records
- ✅ requisition_records（新建）
- ✅ stock（新建或已有）
- ✅ consume_records
- ✅ users
```

---

## 第3步：编译测试（1分钟）

### 3.1 编译项目

```
方法1：HBuilderX
- 点击顶部：运行 → 运行到小程序模拟器 → 微信开发者工具
- 等待编译完成

方法2：命令行
cd D:\medicine_manager\AK-PMS
npm run dev:mp-weixin
```

### 3.2 快速测试

```
1. 测试药品选择器
   - 进入入库单或出库单页面
   - 点击"手动添加"按钮
   - 输入"阿莫"搜索
   - 查看是否显示药品列表

2. 测试出库功能
   - 进入出库单页面
   - 选择园区（陆园/水园）
   - 添加药品
   - 点击"选择批次"（如有库存数据）
   - 填写数量
   - 签名
   - 点击"提交复核"
   - 查看是否成功

3. 测试请领功能
   - 我的 → 下拉查找请领入口（或直接访问请领页面）
   - 选择部门
   - 填写用途
   - 添加药品
   - 输入数量
   - 签名
   - 点击"提交审批"
   - 查看是否成功
```

---

## ✅ 部署完成！

### 现在可以使用的功能：

- ✅ 扫码添加药品
- ✅ **手动选择药品**（新功能）
- ✅ **批次选择**（新功能，需要库存数据）
- ✅ **陆园/水园出库**（完整功能）
- ✅ **请领管理**（全新功能）
- ✅ 入库管理
- ✅ 库存查询
- ✅ 数据统计

---

## ⚠️ 可能的问题

### 问题1：药品选择器打开后没有数据

**原因：** drugs 集合为空

**解决：**
```
1. 云开发控制台 → 数据库 → drugs
2. 点击"导入"
3. 选择文件：测试数据-药品清单-导入格式.jsonl
4. 确认导入
```

---

### 问题2：批次选择器显示"暂无库存"

**原因：** stock 集合为空

**临时解决：**
```
先测试其他功能（药品选择、请领等）
需要时手动添加库存测试数据：

{
  "drugId": "从drugs集合复制药品ID",
  "drugName": "阿莫西林胶囊",
  "batch": "202410001",
  "productionDate": "2024-10-01",
  "expireDate": "2026-10-01",
  "quantity": 100,
  "location": "land_park",
  "price": 25.5
}
```

---

### 问题3：提交时提示"云函数不存在"

**原因：** 对应云函数未部署

**解决：**
```
1. 检查云开发控制台 → 云函数列表
2. 确认对应云函数状态为"部署成功"
3. 如未部署，重新上传
```

---

## 📊 功能测试清单

### ✅ 核心功能测试

- [ ] 药品选择器 - 搜索功能
- [ ] 药品选择器 - 选择功能
- [ ] 批次选择器 - 批次列表
- [ ] 批次选择器 - FIFO排序
- [ ] 出库 - 园区选择
- [ ] 出库 - 保存草稿
- [ ] 出库 - 提交复核
- [ ] 请领 - 部门选择
- [ ] 请领 - 用途填写
- [ ] 请领 - 提交审批

---

## 🎯 下一步

### 完善数据（可选）

```
1. 导入更多药品数据
   - drugs 集合

2. 添加库存测试数据
   - stock 集合
   - 每个药品添加1-2个批次

3. 测试完整流程
   - 入库 → 出库 → 请领
```

---

## 📞 相关文档

- [✅功能修复完成-最终版.md](./✅功能修复完成-最终版.md) - 详细修复说明
- [🔍功能问题诊断-完整版.md](./🔍功能问题诊断-完整版.md) - 问题分析
- [📱扫码功能使用指南.md](./📱扫码功能使用指南.md) - 扫码功能
- [📝数据导入说明.md](./📝数据导入说明.md) - 数据导入

---

**部署时间：** 约6分钟  
**难度：** ⭐⭐☆☆☆（简单）  
**状态：** 准备就绪

**🎊 现在就开始部署吧！6分钟后所有功能就能用了！🎊**

