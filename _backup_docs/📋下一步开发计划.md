# ğŸ“‹ AK-PMS v3.3 ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

**å½“å‰ç‰ˆæœ¬**: v3.3 (æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ)  
**è§„åˆ’ç‰ˆæœ¬**: v3.3.1 (å®Œå–„ç‰ˆ) â†’ v3.4 (å¢å¼ºç‰ˆ)  
**è¯„ä¼°æ—¥æœŸ**: 2025-11-01  

---

## ğŸ“Š å½“å‰å®Œæˆåº¦åˆ†æ

### âœ… å·²å®Œæˆ (80%)

#### åç«¯äº‘å‡½æ•°
- âœ… clinicRecords - é—¨è¯Šç™»è®° (100%)
- âœ… reportService - 5å¤§æŠ¥è¡¨æœåŠ¡ (100%)
- âœ… queryService - 6é¡¹æŸ¥è¯¢åŠŸèƒ½ (100%)
- âœ… dailySummary - æ¯æ—¥ç»Ÿè®¡ (100%)
- âœ… expiryMonitor - æ•ˆæœŸé¢„è­¦ (100%)

#### å‰ç«¯é¡µé¢
- âœ… clinic/add.vue - é—¨è¯Šç™»è®°é¡µ (100%)
- âœ… clinic/list.vue - é—¨è¯Šåˆ—è¡¨é¡µ (100%)
- âœ… report/query.vue - æ•°æ®æŸ¥è¯¢é¡µ (100%)
- âœ… index/index.vue - é¦–é¡µå¿«æ·å…¥å£ (100%)

#### æ•°æ®åº“
- âœ… clinic_usage é›†åˆè®¾è®¡
- âœ… statistics é›†åˆè®¾è®¡
- âœ… alerts é›†åˆè®¾è®¡
- âœ… æ•°æ®è¿ç§»è„šæœ¬

### â³ æœªå®Œæˆ (20%)

#### æŠ¥è¡¨å±•ç¤ºé¡µé¢ (0%)
- âŒ report/index.vue - æŠ¥è¡¨ä¸»é¡µï¼ˆå¡ç‰‡å¼å¯¼èˆªï¼‰
- âŒ report/detail.vue - æŠ¥è¡¨è¯¦æƒ…é¡µï¼ˆ5ä¸ªæŠ¥è¡¨é€šç”¨ï¼‰
- âŒ report/chart.vue - å›¾è¡¨å±•ç¤ºç»„ä»¶

#### EChartsé›†æˆ (0%)
- âŒ æŠ˜çº¿å›¾ç»„ä»¶ï¼ˆé—¨è¯Šè¶‹åŠ¿ï¼‰
- âŒ é¥¼å›¾ç»„ä»¶ï¼ˆå›­åŒºåˆ†å¸ƒï¼‰
- âŒ æŸ±çŠ¶å›¾ç»„ä»¶ï¼ˆç›˜ç‚¹å·®å¼‚ï¼‰

#### æ•°æ®å¯¼å‡º (0%)
- âŒ Excelå¯¼å‡ºåŠŸèƒ½
- âŒ PDFå¯¼å‡ºåŠŸèƒ½

#### å¾®ä¿¡è®¢é˜…æ¶ˆæ¯ (0%)
- âŒ è®¢é˜…æ¶ˆæ¯æ¨¡æ¿é…ç½®
- âŒ é¢„è­¦æ¨é€é›†æˆ

---

## ğŸ¯ v3.3.1 å¼€å‘è®¡åˆ’ (å®Œå–„ç‰ˆ)

**ç›®æ ‡**: å®Œå–„æŠ¥è¡¨å±•ç¤ºå’Œæ•°æ®å¯è§†åŒ–  
**æ—¶é—´**: çº¦2-3å¤©  
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

### Task 1: æŠ¥è¡¨ä¸»é¡µå¼€å‘ (4å°æ—¶)

#### 1.1 åˆ›å»º report/index.vue
**åŠŸèƒ½éœ€æ±‚**:
```
1. å¡ç‰‡å¼å¸ƒå±€å±•ç¤º5å¤§æŠ¥è¡¨
   - ğŸ“¦ R1: å…¥åº“æ˜ç»†æŠ¥è¡¨
   - ğŸšš R2: å‡ºåº“ä¸è¯·é¢†æ±‡æ€»
   - ğŸ¥ R3: é—¨è¯Šç”¨è¯ç»Ÿè®¡
   - ğŸ“Š R4: åº“å­˜é¢„è­¦æŠ¥è¡¨
   - ğŸ“‹ R5: ç›˜ç‚¹å·®å¼‚åˆ†æ

2. æ¯ä¸ªå¡ç‰‡æ˜¾ç¤ºï¼š
   - å›¾æ ‡ + æŠ¥è¡¨åç§°
   - ç®€è¦è¯´æ˜
   - æœ€è¿‘æ›´æ–°æ—¶é—´
   - å¿«æ·ç­›é€‰æŒ‰é’®

3. å¿«æ·ç»Ÿè®¡é¢æ¿
   - ä»Šæ—¥å…¥åº“æ•°é‡
   - ä»Šæ—¥å‡ºåº“æ•°é‡
   - ä»Šæ—¥é—¨è¯Šç™»è®°
   - ä¸´æœŸé¢„è­¦æ•°é‡
```

**æŠ€æœ¯è¦ç‚¹**:
```vue
<template>
  <view class="report-home">
    <!-- ç»Ÿè®¡é¢æ¿ -->
    <view class="stats-panel">
      <view class="stat-card" v-for="stat in stats" :key="stat.key">
        <text class="icon">{{ stat.icon }}</text>
        <text class="value">{{ stat.value }}</text>
        <text class="label">{{ stat.label }}</text>
      </view>
    </view>

    <!-- æŠ¥è¡¨å¡ç‰‡ç½‘æ ¼ -->
    <view class="report-grid">
      <view 
        class="report-card" 
        v-for="report in reports" 
        :key="report.code"
        @click="goToReport(report.code)"
      >
        <view class="card-header">
          <text class="card-icon">{{ report.icon }}</text>
          <text class="card-badge">{{ report.badge }}</text>
        </view>
        <view class="card-body">
          <text class="card-title">{{ report.name }}</text>
          <text class="card-desc">{{ report.desc }}</text>
        </view>
        <view class="card-footer">
          <text class="update-time">{{ report.updateTime }}</text>
          <text class="arrow">â†’</text>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æŸ¥è¯¢å…¥å£ -->
    <view class="quick-query">
      <button @click="goToQuery">
        <text class="icon">ğŸ”</text>
        <text>æ•°æ®æŸ¥è¯¢</text>
      </button>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      stats: [
        { key: 'inbound', icon: 'ğŸ“¦', value: 0, label: 'ä»Šæ—¥å…¥åº“' },
        { key: 'outbound', icon: 'ğŸšš', value: 0, label: 'ä»Šæ—¥å‡ºåº“' },
        { key: 'clinic', icon: 'ğŸ¥', value: 0, label: 'é—¨è¯Šç™»è®°' },
        { key: 'warning', icon: 'âš ï¸', value: 0, label: 'ä¸´æœŸé¢„è­¦' }
      ],
      reports: [
        { 
          code: 'R1', 
          icon: 'ğŸ“¦', 
          badge: 'å…¥åº“',
          name: 'å…¥åº“æ˜ç»†æŠ¥è¡¨', 
          desc: 'æŸ¥çœ‹å…¥åº“è®°å½•ã€ä¾›åº”å•†ã€é‡‘é¢ç»Ÿè®¡',
          updateTime: '2å°æ—¶å‰'
        },
        { 
          code: 'R2', 
          icon: 'ğŸšš', 
          badge: 'å‡ºåº“',
          name: 'å‡ºåº“ä¸è¯·é¢†æ±‡æ€»', 
          desc: 'æŒ‰å›­åŒºç»Ÿè®¡å‡ºåº“æµå‘',
          updateTime: '2å°æ—¶å‰'
        },
        { 
          code: 'R3', 
          icon: 'ğŸ¥', 
          badge: 'é—¨è¯Š',
          name: 'é—¨è¯Šç”¨è¯ç»Ÿè®¡', 
          desc: 'åˆ†å›­åŒºé—¨è¯Šæ¶ˆè€—è¶‹åŠ¿',
          updateTime: '1å°æ—¶å‰'
        },
        { 
          code: 'R4', 
          icon: 'ğŸ“Š', 
          badge: 'åº“å­˜',
          name: 'åº“å­˜é¢„è­¦æŠ¥è¡¨', 
          desc: 'åº“å­˜çŠ¶æ€ä¸æ•ˆæœŸé¢„è­¦',
          updateTime: '30åˆ†é’Ÿå‰'
        },
        { 
          code: 'R5', 
          icon: 'ğŸ“‹', 
          badge: 'ç›˜ç‚¹',
          name: 'ç›˜ç‚¹å·®å¼‚åˆ†æ', 
          desc: 'ç›˜ç‚¹ç»“æœä¸å·®å¼‚ç»Ÿè®¡',
          updateTime: 'æ˜¨å¤©'
        }
      ]
    };
  },
  
  onLoad() {
    this.loadTodayStats();
  },
  
  methods: {
    async loadTodayStats() {
      // åŠ è½½ä»Šæ—¥ç»Ÿè®¡æ•°æ®
      try {
        const res = await wx.cloud.callFunction({
          name: 'reportService',
          data: {
            reportType: 'today_stats',
            params: {}
          }
        });
        
        if (res.result.success) {
          const data = res.result.data;
          this.stats[0].value = data.inboundCount || 0;
          this.stats[1].value = data.outboundCount || 0;
          this.stats[2].value = data.clinicCount || 0;
          this.stats[3].value = data.warningCount || 0;
        }
      } catch (err) {
        console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥', err);
      }
    },
    
    goToReport(code) {
      uni.navigateTo({
        url: `/pages-sub/report/detail?type=${code}`
      });
    },
    
    goToQuery() {
      uni.navigateTo({
        url: '/pages-sub/report/query'
      });
    }
  }
};
</script>

<style lang="scss" scoped>
// æ ·å¼è®¾è®¡ï¼šæ¸å˜å¡ç‰‡ + å›¾æ ‡å±…ä¸­
</style>
```

**é¢„è®¡æ—¶é—´**: 4å°æ—¶

---

### Task 2: æŠ¥è¡¨è¯¦æƒ…é¡µå¼€å‘ (8å°æ—¶)

#### 2.1 åˆ›å»º report/detail.vue
**åŠŸèƒ½éœ€æ±‚**:
```
1. é€šç”¨æŠ¥è¡¨è¯¦æƒ…é¡µï¼ˆæ”¯æŒ5ç§æŠ¥è¡¨ï¼‰
2. é¡¶éƒ¨ç­›é€‰æ 
   - æ—¥æœŸèŒƒå›´é€‰æ‹©
   - å›­åŒºé€‰æ‹©
   - è¯å“åç§°æœç´¢
   - ç­›é€‰æŒ‰é’® + é‡ç½®æŒ‰é’®

3. æ•°æ®å±•ç¤ºåŒº
   - è¡¨æ ¼å±•ç¤ºï¼ˆåˆ†é¡µåŠ è½½ï¼‰
   - å…³é”®æŒ‡æ ‡å¡ç‰‡
   - å›¾è¡¨å¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰

4. åº•éƒ¨æ“ä½œæ 
   - å¯¼å‡ºExcelæŒ‰é’®
   - å¯¼å‡ºPDFæŒ‰é’®
   - æ‰“å°æŒ‰é’®
```

**æŠ€æœ¯è¦ç‚¹**:
```vue
<template>
  <view class="report-detail">
    <!-- æŠ¥è¡¨æ ‡é¢˜ -->
    <view class="report-header">
      <text class="report-title">{{ reportConfig.name }}</text>
      <text class="report-desc">{{ reportConfig.desc }}</text>
    </view>

    <!-- ç­›é€‰æ  -->
    <view class="filter-bar">
      <view class="filter-row">
        <!-- æ—¥æœŸèŒƒå›´ -->
        <view v-if="reportConfig.showDateRange" class="filter-item">
          <text class="label">æ—¥æœŸ</text>
          <view class="date-range">
            <picker mode="date" :value="filters.startDate" @change="onStartDateChange">
              <view class="date-picker">{{ filters.startDate || 'å¼€å§‹' }}</view>
            </picker>
            <text>è‡³</text>
            <picker mode="date" :value="filters.endDate" @change="onEndDateChange">
              <view class="date-picker">{{ filters.endDate || 'ç»“æŸ' }}</view>
            </picker>
          </view>
        </view>

        <!-- å›­åŒºé€‰æ‹© -->
        <view v-if="reportConfig.showLocation" class="filter-item">
          <text class="label">å›­åŒº</text>
          <picker :range="locations" range-key="label" @change="onLocationChange">
            <view class="picker">{{ currentLocation.label }}</view>
          </picker>
        </view>

        <!-- è¯å“æœç´¢ -->
        <view v-if="reportConfig.showDrugSearch" class="filter-item">
          <text class="label">è¯å“</text>
          <input v-model="filters.drugName" placeholder="è¾“å…¥è¯å“åç§°" />
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="filter-actions">
        <button class="btn-reset" @click="resetFilters">é‡ç½®</button>
        <button class="btn-search" @click="loadReportData">æŸ¥è¯¢</button>
      </view>
    </view>

    <!-- å…³é”®æŒ‡æ ‡ -->
    <view class="metrics-panel">
      <view class="metric-card" v-for="metric in metrics" :key="metric.key">
        <text class="metric-value">{{ metric.value }}</text>
        <text class="metric-label">{{ metric.label }}</text>
        <text class="metric-unit">{{ metric.unit }}</text>
      </view>
    </view>

    <!-- å›¾è¡¨åŒºåŸŸ -->
    <view v-if="reportConfig.showChart" class="chart-section">
      <view class="section-title">
        <text class="icon">ğŸ“Š</text>
        <text>æ•°æ®è¶‹åŠ¿</text>
      </view>
      <chart-component 
        :type="reportConfig.chartType" 
        :data="chartData"
        :options="chartOptions"
      />
    </view>

    <!-- æ•°æ®è¡¨æ ¼ -->
    <view class="table-section">
      <view class="section-title">
        <text class="icon">ğŸ“‹</text>
        <text>æ˜ç»†æ•°æ®</text>
        <text class="count">({{ tableData.length }}æ¡)</text>
      </view>

      <scroll-view scroll-x class="table-scroll">
        <view class="data-table">
          <!-- è¡¨å¤´ -->
          <view class="table-header">
            <view 
              class="th" 
              v-for="col in reportConfig.columns" 
              :key="col.key"
              :style="{ width: col.width }"
            >
              {{ col.label }}
            </view>
          </view>

          <!-- è¡¨ä½“ -->
          <view class="table-body">
            <view class="tr" v-for="(row, index) in tableData" :key="index">
              <view 
                class="td" 
                v-for="col in reportConfig.columns" 
                :key="col.key"
                :style="{ width: col.width }"
              >
                <!-- ç‰¹æ®Šå­—æ®µæ¸²æŸ“ -->
                <template v-if="col.key === 'expiryStatus'">
                  <view class="status-badge" :class="getStatusClass(row[col.key])">
                    {{ row[col.key] }}
                  </view>
                </template>
                <template v-else-if="col.key === 'daysToExpiry'">
                  <text :class="getExpiryClass(row[col.key])">
                    {{ row[col.key] }} å¤©
                  </text>
                </template>
                <template v-else>
                  {{ row[col.key] || '-' }}
                </template>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="action-bar">
      <button class="btn-export" @click="exportExcel">
        <text class="icon">ğŸ“¤</text>
        <text>å¯¼å‡ºExcel</text>
      </button>
      <button class="btn-export" @click="exportPDF">
        <text class="icon">ğŸ“„</text>
        <text>å¯¼å‡ºPDF</text>
      </button>
    </view>
  </view>
</template>

<script>
const REPORT_CONFIGS = {
  R1: {
    name: 'å…¥åº“æ˜ç»†æŠ¥è¡¨',
    desc: 'æŸ¥çœ‹è¯å“å…¥åº“è¯¦æƒ…ã€ä¾›åº”å•†ã€é‡‘é¢ç»Ÿè®¡',
    showDateRange: true,
    showLocation: true,
    showDrugSearch: true,
    showChart: false,
    columns: [
      { key: 'createTime', label: 'æ—¥æœŸ', width: '180rpx' },
      { key: 'drugName', label: 'è¯å“åç§°', width: '200rpx' },
      { key: 'specification', label: 'è§„æ ¼', width: '180rpx' },
      { key: 'batch', label: 'æ‰¹æ¬¡', width: '150rpx' },
      { key: 'quantity', label: 'æ•°é‡', width: '120rpx' },
      { key: 'unit', label: 'å•ä½', width: '100rpx' },
      { key: 'manufacturer', label: 'å‚å®¶', width: '200rpx' },
      { key: 'expiryDate', label: 'æœ‰æ•ˆæœŸ', width: '180rpx' },
      { key: 'daysToExpiry', label: 'è·æœ‰æ•ˆæœŸ', width: '150rpx' },
      { key: 'expiryStatus', label: 'çŠ¶æ€', width: '120rpx' }
    ]
  },
  R2: {
    name: 'å‡ºåº“ä¸è¯·é¢†æ±‡æ€»',
    desc: 'æŒ‰å›­åŒºç»Ÿè®¡è¯å“å‡ºåº“æµå‘',
    showDateRange: true,
    showLocation: true,
    showDrugSearch: true,
    showChart: true,
    chartType: 'pie',
    columns: [
      { key: 'createTime', label: 'æ—¥æœŸ', width: '180rpx' },
      { key: 'drugName', label: 'è¯å“åç§°', width: '200rpx' },
      { key: 'specification', label: 'è§„æ ¼', width: '180rpx' },
      { key: 'location', label: 'å›­åŒº', width: '150rpx' },
      { key: 'quantity', label: 'æ•°é‡', width: '120rpx' },
      { key: 'department', label: 'éƒ¨é—¨', width: '150rpx' },
      { key: 'expiryDate', label: 'æœ‰æ•ˆæœŸ', width: '180rpx' },
      { key: 'daysToExpiry', label: 'è·æœ‰æ•ˆæœŸ', width: '150rpx' }
    ]
  },
  R3: {
    name: 'é—¨è¯Šç”¨è¯ç»Ÿè®¡',
    desc: 'åˆ†å›­åŒºé—¨è¯Šæ¶ˆè€—è¶‹åŠ¿åˆ†æ',
    showDateRange: true,
    showLocation: true,
    showDrugSearch: true,
    showChart: true,
    chartType: 'line',
    columns: [
      { key: 'createTime', label: 'æ—¥æœŸ', width: '180rpx' },
      { key: 'drugName', label: 'è¯å“åç§°', width: '200rpx' },
      { key: 'specification', label: 'è§„æ ¼', width: '180rpx' },
      { key: 'quantityMin', label: 'ç”¨é‡', width: '120rpx' },
      { key: 'minUnit', label: 'å•ä½', width: '100rpx' },
      { key: 'location', label: 'å›­åŒº', width: '150rpx' },
      { key: 'patient', label: 'æ‚£è€…', width: '150rpx' }
    ]
  },
  R4: {
    name: 'åº“å­˜é¢„è­¦æŠ¥è¡¨',
    desc: 'å®æ—¶åº“å­˜çŠ¶æ€ä¸æ•ˆæœŸé¢„è­¦',
    showDateRange: false,
    showLocation: true,
    showDrugSearch: true,
    showChart: false,
    columns: [
      { key: 'drugName', label: 'è¯å“åç§°', width: '200rpx' },
      { key: 'specification', label: 'è§„æ ¼', width: '180rpx' },
      { key: 'batch', label: 'æ‰¹æ¬¡', width: '150rpx' },
      { key: 'quantity', label: 'åº“å­˜', width: '120rpx' },
      { key: 'unit', label: 'å•ä½', width: '100rpx' },
      { key: 'location', label: 'å›­åŒº', width: '150rpx' },
      { key: 'expiryDate', label: 'æœ‰æ•ˆæœŸ', width: '180rpx' },
      { key: 'daysToExpiry', label: 'è·æœ‰æ•ˆæœŸ', width: '150rpx' },
      { key: 'expiryStatus', label: 'çŠ¶æ€', width: '120rpx' }
    ]
  },
  R5: {
    name: 'ç›˜ç‚¹å·®å¼‚åˆ†æ',
    desc: 'ç›˜ç‚¹ç»“æœä¸è´¦å®å·®å¼‚ç»Ÿè®¡',
    showDateRange: false,
    showLocation: true,
    showDrugSearch: true,
    showChart: true,
    chartType: 'bar',
    columns: [
      { key: 'checkTime', label: 'ç›˜ç‚¹æ—¥æœŸ', width: '180rpx' },
      { key: 'drugName', label: 'è¯å“åç§°', width: '200rpx' },
      { key: 'specification', label: 'è§„æ ¼', width: '180rpx' },
      { key: 'batch', label: 'æ‰¹æ¬¡', width: '150rpx' },
      { key: 'theoreticalStock', label: 'ç†è®ºåº“å­˜', width: '150rpx' },
      { key: 'actualStock', label: 'å®é™…åº“å­˜', width: '150rpx' },
      { key: 'diffQty', label: 'å·®å¼‚', width: '120rpx' },
      { key: 'diffRate', label: 'å·®å¼‚ç‡', width: '120rpx' },
      { key: 'location', label: 'å›­åŒº', width: '150rpx' },
      { key: 'expiryDate', label: 'æœ‰æ•ˆæœŸ', width: '180rpx' },
      { key: 'daysToExpiry', label: 'è·æœ‰æ•ˆæœŸ', width: '150rpx' }
    ]
  }
};

export default {
  data() {
    return {
      reportType: '',
      reportConfig: {},
      locations: [
        { label: 'å…¨éƒ¨å›­åŒº', value: 'all' },
        { label: 'é™†å›­', value: 'land_park' },
        { label: 'æ°´å›­', value: 'water_park' },
        { label: 'åŒ»åŠ¡å®¤', value: 'clinic_storage' }
      ],
      currentLocation: { label: 'å…¨éƒ¨å›­åŒº', value: 'all' },
      filters: {
        startDate: '',
        endDate: '',
        drugName: ''
      },
      metrics: [],
      chartData: {},
      chartOptions: {},
      tableData: [],
      loading: false
    };
  },

  onLoad(options) {
    this.reportType = options.type || 'R1';
    this.reportConfig = REPORT_CONFIGS[this.reportType];
    this.initFilters();
    this.loadReportData();
  },

  methods: {
    initFilters() {
      const today = new Date();
      const lastMonth = new Date(today);
      lastMonth.setMonth(lastMonth.getMonth() - 1);
      
      this.filters.startDate = this.formatDate(lastMonth);
      this.filters.endDate = this.formatDate(today);
    },

    async loadReportData() {
      this.loading = true;
      try {
        const res = await wx.cloud.callFunction({
          name: 'reportService',
          data: {
            reportType: this.reportType,
            params: {
              ...this.filters,
              location: this.currentLocation.value
            }
          }
        });

        if (res.result.success) {
          this.tableData = res.result.data.list || [];
          this.metrics = this.calculateMetrics(res.result.data);
          if (this.reportConfig.showChart) {
            this.chartData = res.result.data.chartData || {};
          }
        }
      } catch (err) {
        uni.showToast({
          title: 'åŠ è½½å¤±è´¥',
          icon: 'none'
        });
      } finally {
        this.loading = false;
      }
    },

    calculateMetrics(data) {
      // æ ¹æ®ä¸åŒæŠ¥è¡¨ç±»å‹è®¡ç®—å…³é”®æŒ‡æ ‡
      // å®ç°ç•¥...
      return [];
    },

    exportExcel() {
      // Excelå¯¼å‡ºåŠŸèƒ½
      uni.showToast({
        title: 'Excelå¯¼å‡ºå¼€å‘ä¸­',
        icon: 'none'
      });
    },

    exportPDF() {
      // PDFå¯¼å‡ºåŠŸèƒ½
      uni.showToast({
        title: 'PDFå¯¼å‡ºå¼€å‘ä¸­',
        icon: 'none'
      });
    },

    getStatusClass(status) {
      const classMap = {
        'è¿‡æœŸ': 'status-danger',
        'ä¸´æœŸ': 'status-warning',
        'æ­£å¸¸': 'status-normal'
      };
      return classMap[status] || '';
    },

    getExpiryClass(days) {
      if (days <= 0) return 'text-danger';
      if (days <= 60) return 'text-warning';
      return 'text-normal';
    },

    formatDate(date) {
      const d = new Date(date);
      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
    },

    resetFilters() {
      this.initFilters();
      this.currentLocation = this.locations[0];
      this.filters.drugName = '';
    },

    onStartDateChange(e) {
      this.filters.startDate = e.detail.value;
    },

    onEndDateChange(e) {
      this.filters.endDate = e.detail.value;
    },

    onLocationChange(e) {
      this.currentLocation = this.locations[e.detail.value];
    }
  }
};
</script>
```

**é¢„è®¡æ—¶é—´**: 8å°æ—¶

---

### Task 3: EChartsé›†æˆ (6å°æ—¶)

#### 3.1 å®‰è£…EChartsç»„ä»¶
```bash
npm install echarts-for-weixin
```

#### 3.2 åˆ›å»ºå›¾è¡¨ç»„ä»¶
**æ–‡ä»¶**: `components/chart/index.vue`

```vue
<template>
  <view class="chart-container">
    <ec-canvas 
      id="mychart" 
      canvas-id="mychart" 
      :ec="ec"
      :force-use-old-canvas="true"
    ></ec-canvas>
  </view>
</template>

<script>
import * as echarts from 'echarts-for-weixin';

export default {
  props: {
    type: {
      type: String,
      default: 'line' // line | pie | bar
    },
    data: {
      type: Object,
      default: () => ({})
    },
    options: {
      type: Object,
      default: () => ({})
    }
  },

  data() {
    return {
      ec: {
        onInit: this.initChart
      },
      chart: null
    };
  },

  watch: {
    data: {
      handler() {
        this.updateChart();
      },
      deep: true
    }
  },

  methods: {
    initChart(canvas, width, height, dpr) {
      const chart = echarts.init(canvas, null, {
        width: width,
        height: height,
        devicePixelRatio: dpr
      });
      canvas.setChart(chart);
      this.chart = chart;
      this.updateChart();
      return chart;
    },

    updateChart() {
      if (!this.chart) return;

      let option = {};
      switch (this.type) {
        case 'line':
          option = this.getLineOption();
          break;
        case 'pie':
          option = this.getPieOption();
          break;
        case 'bar':
          option = this.getBarOption();
          break;
      }

      this.chart.setOption(option);
    },

    getLineOption() {
      // æŠ˜çº¿å›¾é…ç½®ï¼ˆé—¨è¯Šè¶‹åŠ¿ï¼‰
      return {
        title: {
          text: 'é—¨è¯Šç”¨è¯è¶‹åŠ¿',
          left: 'center'
        },
        tooltip: {
          trigger: 'axis'
        },
        legend: {
          data: ['é™†å›­', 'æ°´å›­', 'åŒ»åŠ¡å®¤'],
          top: '10%'
        },
        xAxis: {
          type: 'category',
          data: this.data.dates || []
        },
        yAxis: {
          type: 'value',
          name: 'ç”¨é‡'
        },
        series: [
          {
            name: 'é™†å›­',
            type: 'line',
            data: this.data.land_park || [],
            smooth: true,
            itemStyle: { color: '#1890ff' }
          },
          {
            name: 'æ°´å›­',
            type: 'line',
            data: this.data.water_park || [],
            smooth: true,
            itemStyle: { color: '#52c41a' }
          },
          {
            name: 'åŒ»åŠ¡å®¤',
            type: 'line',
            data: this.data.clinic_storage || [],
            smooth: true,
            itemStyle: { color: '#faad14' }
          }
        ]
      };
    },

    getPieOption() {
      // é¥¼å›¾é…ç½®ï¼ˆå›­åŒºåˆ†å¸ƒï¼‰
      return {
        title: {
          text: 'å›­åŒºå‡ºåº“åˆ†å¸ƒ',
          left: 'center'
        },
        tooltip: {
          trigger: 'item',
          formatter: '{a} <br/>{b}: {c} ({d}%)'
        },
        legend: {
          orient: 'vertical',
          left: 'left'
        },
        series: [
          {
            name: 'å‡ºåº“é‡',
            type: 'pie',
            radius: '50%',
            data: this.data.pieData || [],
            emphasis: {
              itemStyle: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
              }
            }
          }
        ]
      };
    },

    getBarOption() {
      // æŸ±çŠ¶å›¾é…ç½®ï¼ˆç›˜ç‚¹å·®å¼‚ï¼‰
      return {
        title: {
          text: 'ç›˜ç‚¹å·®å¼‚å¯¹æ¯”',
          left: 'center'
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'shadow'
          }
        },
        legend: {
          data: ['ç†è®ºåº“å­˜', 'å®é™…åº“å­˜'],
          top: '10%'
        },
        xAxis: {
          type: 'category',
          data: this.data.drugNames || []
        },
        yAxis: {
          type: 'value',
          name: 'æ•°é‡'
        },
        series: [
          {
            name: 'ç†è®ºåº“å­˜',
            type: 'bar',
            data: this.data.theoretical || [],
            itemStyle: { color: '#1890ff' }
          },
          {
            name: 'å®é™…åº“å­˜',
            type: 'bar',
            data: this.data.actual || [],
            itemStyle: { color: '#52c41a' }
          }
        ]
      };
    }
  }
};
</script>

<style lang="scss" scoped>
.chart-container {
  width: 100%;
  height: 500rpx;
}

ec-canvas {
  width: 100%;
  height: 100%;
}
</style>
```

**é¢„è®¡æ—¶é—´**: 6å°æ—¶

---

### Task 4: æ•°æ®å¯¼å‡ºåŠŸèƒ½ (6å°æ—¶)

#### 4.1 äº‘å‡½æ•°æ·»åŠ å¯¼å‡ºæ–¹æ³•
**æ–‡ä»¶**: `cloudfunctions/reportService/index.js`

```javascript
// æ·»åŠ å¯¼å‡ºæ–¹æ³•
async function exportToExcel(data) {
  const { reportType, tableData, fileName } = data;
  
  // ä½¿ç”¨ xlsx åº“ç”ŸæˆExcel
  const XLSX = require('xlsx');
  
  // åˆ›å»ºå·¥ä½œç°¿
  const wb = XLSX.utils.book_new();
  
  // è½¬æ¢æ•°æ®
  const ws = XLSX.utils.json_to_sheet(tableData);
  
  // æ·»åŠ å·¥ä½œè¡¨
  XLSX.utils.book_append_sheet(wb, ws, reportType);
  
  // ç”Ÿæˆbuffer
  const buffer = XLSX.write(wb, { type: 'buffer', bookType: 'xlsx' });
  
  // ä¸Šä¼ åˆ°äº‘å­˜å‚¨
  const fileID = await cloud.uploadFile({
    cloudPath: `exports/${fileName}.xlsx`,
    fileContent: buffer
  });
  
  // è·å–ä¸´æ—¶é“¾æ¥
  const tempURL = await cloud.getTempFileURL({
    fileList: [fileID.fileID]
  });
  
  return {
    success: true,
    data: {
      fileID: fileID.fileID,
      tempURL: tempURL.fileList[0].tempFileURL
    }
  };
}
```

#### 4.2 å‰ç«¯è°ƒç”¨
```javascript
async exportExcel() {
  uni.showLoading({ title: 'ç”Ÿæˆä¸­...' });
  
  try {
    const res = await wx.cloud.callFunction({
      name: 'reportService',
      data: {
        action: 'exportExcel',
        data: {
          reportType: this.reportType,
          tableData: this.tableData,
          fileName: `${this.reportConfig.name}_${Date.now()}`
        }
      }
    });
    
    if (res.result.success) {
      // ä¸‹è½½æ–‡ä»¶
      uni.downloadFile({
        url: res.result.data.tempURL,
        success: (downloadRes) => {
          uni.showToast({
            title: 'å¯¼å‡ºæˆåŠŸ',
            icon: 'success'
          });
          
          // æ‰“å¼€æ–‡ä»¶
          uni.openDocument({
            filePath: downloadRes.tempFilePath,
            fileType: 'xlsx'
          });
        }
      });
    }
  } catch (err) {
    uni.showToast({
      title: 'å¯¼å‡ºå¤±è´¥',
      icon: 'none'
    });
  } finally {
    uni.hideLoading();
  }
}
```

**é¢„è®¡æ—¶é—´**: 6å°æ—¶

---

### Task 5: é…ç½®è·¯ç”±å’Œæµ‹è¯• (2å°æ—¶)

#### 5.1 æ›´æ–° pages.json
```json
{
  "root": "pages-sub/report",
  "pages": [
    {
      "path": "index",
      "style": {
        "navigationBarTitleText": "æŠ¥è¡¨ä¸­å¿ƒ",
        "enablePullDownRefresh": true
      }
    },
    {
      "path": "detail",
      "style": {
        "navigationBarTitleText": "æŠ¥è¡¨è¯¦æƒ…"
      }
    },
    {
      "path": "query",
      "style": {
        "navigationBarTitleText": "æ•°æ®æŸ¥è¯¢"
      }
    }
  ]
}
```

#### 5.2 é¦–é¡µæŒ‰é’®è°ƒæ•´
```javascript
// pages/index/index.vue
goToReport() {
  uni.navigateTo({
    url: '/pages-sub/report/index'  // è·³è½¬åˆ°æŠ¥è¡¨ä¸»é¡µ
  });
}
```

**é¢„è®¡æ—¶é—´**: 2å°æ—¶

---

## ğŸ¯ v3.4 å¢å¼ºè®¡åˆ’ (å¯é€‰)

**æ—¶é—´**: çº¦3-5å¤©  
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

### Feature 1: å¾®ä¿¡è®¢é˜…æ¶ˆæ¯é›†æˆ
- é…ç½®è®¢é˜…æ¶ˆæ¯æ¨¡æ¿
- å®ç°é¢„è­¦æ¨é€
- ç”¨æˆ·è®¢é˜…ç®¡ç†

### Feature 2: é«˜çº§æ•°æ®åˆ†æ
- æˆæœ¬è¶‹åŠ¿åˆ†æ
- æ¶ˆè€—é¢„æµ‹æ¨¡å‹
- AIç”¨è¯å»ºè®®

### Feature 3: ç§»åŠ¨ç«¯ä¼˜åŒ–
- å“åº”å¼å¸ƒå±€ä¼˜åŒ–
- è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒ
- ç¦»çº¿æ•°æ®ç¼“å­˜

### Feature 4: æƒé™ç³»ç»Ÿå®Œå–„
- ç»†ç²’åº¦æƒé™æ§åˆ¶
- æ“ä½œå®¡è®¡æ—¥å¿—
- æ•°æ®å®‰å…¨åŠ å›º

---

## ğŸ“Š å¼€å‘èµ„æºéœ€æ±‚

### äººåŠ›èµ„æº
- å‰ç«¯å¼€å‘: 1äºº Ã— 3å¤©
- åç«¯å¼€å‘: 0.5äºº Ã— 1å¤©ï¼ˆå°å¹…è°ƒæ•´ï¼‰
- UIè®¾è®¡: 0.5äºº Ã— 1å¤©ï¼ˆå›¾è¡¨ç¾åŒ–ï¼‰
- æµ‹è¯•: 0.5äºº Ã— 1å¤©

### æŠ€æœ¯ä¾èµ–
```json
{
  "echarts-for-weixin": "^1.0.0",
  "xlsx": "^0.18.0",
  "moment": "^2.29.0"
}
```

### è®¾å¤‡è¦æ±‚
- å¼€å‘: å¾®ä¿¡å¼€å‘è€…å·¥å…· + VSCode
- æµ‹è¯•: çœŸæœºæµ‹è¯•ï¼ˆiOS + Androidå„1å°ï¼‰

---

## âœ… éªŒæ”¶æ ‡å‡†

### v3.3.1 å®Œæˆæ ‡å‡†
- [ ] æŠ¥è¡¨ä¸»é¡µæ˜¾ç¤º5ä¸ªæŠ¥è¡¨å¡ç‰‡
- [ ] æŠ¥è¡¨è¯¦æƒ…é¡µå¯æŸ¥çœ‹æ•°æ®è¡¨æ ¼
- [ ] æŠ˜çº¿å›¾ã€é¥¼å›¾ã€æŸ±çŠ¶å›¾æ­£å¸¸æ˜¾ç¤º
- [ ] Excelå¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- [ ] æ‰€æœ‰æŠ¥è¡¨æ˜¾ç¤ºè§„æ ¼å’Œæœ‰æ•ˆæœŸ
- [ ] ä¸´æœŸ/è¿‡æœŸè¯å“æ ‡çº¢é¢„è­¦
- [ ] è·æœ‰æ•ˆæœŸå¤©æ•°æ­£ç¡®è®¡ç®—
- [ ] ç§»åŠ¨ç«¯é€‚é…è‰¯å¥½

### æ€§èƒ½æŒ‡æ ‡
- æŠ¥è¡¨åŠ è½½æ—¶é—´ < 2ç§’
- å›¾è¡¨æ¸²æŸ“æµç•… (60fps)
- Excelå¯¼å‡º < 5ç§’
- æ•°æ®åˆ†é¡µåŠ è½½

---

## ğŸ“… æ—¶é—´è§„åˆ’

### Week 1 (3å¤©)
- Day 1: æŠ¥è¡¨ä¸»é¡µ + è¯¦æƒ…é¡µæ¡†æ¶
- Day 2: æŠ¥è¡¨è¯¦æƒ…é¡µå®Œå–„ + æ•°æ®è”è°ƒ
- Day 3: EChartsé›†æˆ + å›¾è¡¨è°ƒè¯•

### Week 2 (2å¤©)
- Day 4: Excelå¯¼å‡ºåŠŸèƒ½
- Day 5: æ•´ä½“æµ‹è¯• + Bugä¿®å¤

### ç¼“å†²æ—¶é—´: 1å¤©

**æ€»è®¡**: çº¦6ä¸ªå·¥ä½œæ—¥

---

## ğŸ¯ æœ€ç»ˆäº¤ä»˜ç‰©

### ä»£ç æ–‡ä»¶
1. `pages-sub/report/index.vue` - æŠ¥è¡¨ä¸»é¡µ
2. `pages-sub/report/detail.vue` - æŠ¥è¡¨è¯¦æƒ…é¡µ
3. `components/chart/index.vue` - å›¾è¡¨ç»„ä»¶
4. `cloudfunctions/reportService/index.js` - æ›´æ–°ï¼ˆå¯¼å‡ºæ–¹æ³•ï¼‰

### æ–‡æ¡£
1. æŠ¥è¡¨åŠŸèƒ½ä½¿ç”¨æ‰‹å†Œ
2. EChartsé…ç½®è¯´æ˜
3. å¯¼å‡ºåŠŸèƒ½è¯´æ˜

### æµ‹è¯•æŠ¥å‘Š
1. åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š
2. æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
3. å…¼å®¹æ€§æµ‹è¯•æŠ¥å‘Š

---

## ğŸš€ éƒ¨ç½²è®¡åˆ’

### éƒ¨ç½²æ­¥éª¤
1. ä¸Šä¼ æ–°é¡µé¢åˆ°å°ç¨‹åº
2. æ›´æ–°äº‘å‡½æ•°ï¼ˆreportServiceï¼‰
3. å®‰è£…npmä¾èµ–ï¼ˆECharts + XLSXï¼‰
4. é…ç½®äº‘å­˜å‚¨æƒé™
5. çœŸæœºæµ‹è¯•éªŒè¯
6. æäº¤å®¡æ ¸å‘å¸ƒ

### å›æ»šæ–¹æ¡ˆ
- ä¿ç•™v3.3ç‰ˆæœ¬ä»£ç 
- äº‘å‡½æ•°ç‰ˆæœ¬ç®¡ç†
- æ•°æ®åº“æ— å˜æ›´ï¼ˆæ— éœ€å›æ»šï¼‰

---

## ğŸ’¡ å»ºè®®

1. **ä¼˜å…ˆå®ç°æŠ¥è¡¨ä¸»é¡µå’Œè¯¦æƒ…é¡µ**ï¼Œå›¾è¡¨å’Œå¯¼å‡ºå¯ä»¥åç»­è¿­ä»£
2. **EChartsé¦–æ¬¡åŠ è½½è¾ƒæ…¢**ï¼Œå»ºè®®æ·»åŠ éª¨æ¶å±æˆ–loadingåŠ¨ç”»
3. **Excelå¯¼å‡ºæ•°æ®é‡å¤§æ—¶**ï¼Œå»ºè®®ä½¿ç”¨äº‘å‡½æ•°å¼‚æ­¥å¤„ç†
4. **å›¾è¡¨æ•°æ®å¤æ‚æ—¶**ï¼Œå»ºè®®äº‘å‡½æ•°é¢„å¤„ç†å¥½å†è¿”å›å‰ç«¯
5. **è€ƒè™‘æ·»åŠ æŠ¥è¡¨ç¼“å­˜æœºåˆ¶**ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢

---

**ä¸‹ä¸€æ­¥æ“ä½œ**: 
1. ç¡®è®¤å¼€å‘è®¡åˆ’
2. å®‰æ’å¼€å‘èµ„æº
3. å¼€å§‹Task 1å®æ–½

éœ€è¦æˆ‘ç«‹å³å¼€å§‹åˆ›å»ºæŠ¥è¡¨ä¸»é¡µä»£ç å—ï¼Ÿ


