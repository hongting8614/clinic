# 📖 创建数据库集合 - 超详细步骤

**目标**: 创建12个数据库集合  
**预计时间**: 8-10分钟  
**难度**: ⭐⭐☆☆☆ 简单

---

## 🎯 需要创建的集合清单

### 核心业务集合（7个）
1. `drugs` - 药品档案
2. `stock` - 库存信息
3. `in_records` - 入库记录
4. `out_records` - 出库记录
5. `clinic_usage` - 门诊用药记录
6. `consume_records` - 消耗记录
7. `requisition_records` - 请领记录

### 系统功能集合（5个）
8. `users` - 用户信息
9. `statistics` - 统计数据
10. `alerts` - 预警记录
11. `operation_logs` - 操作日志
12. `stock_check` - 盘点记录

---

## 📋 第一步：访问数据库管理页面

### 方法1：通过微信开发者工具（推荐）⭐⭐⭐

#### 1.1 打开微信开发者工具
- 确保项目已正确打开
- 项目路径：`D:\medicine_manager\AK-PMS\unpackage\dist\dev\mp-weixin`

#### 1.2 点击云开发按钮
```
顶部菜单栏：
┌─────────────────────────────────────┐
│ [文件] [编辑] [工具] [云开发] ← 点这里 │
└─────────────────────────────────────┘
```

#### 1.3 切换到数据库标签
```
云开发窗口：
┌─────────────────────────────────────┐
│ [云函数] [数据库] [云存储] [统计]    │
│           ↑↑↑↑                      │
│       点击这里                       │
└─────────────────────────────────────┘
```

### 方法2：通过浏览器

#### 2.1 打开浏览器
访问：`https://console.cloud.tencent.com/tcb`

#### 2.2 选择环境
选择：`cloud1-3gv7spppf7d2d0f4`

#### 2.3 点击左侧菜单 - 数据库
```
┌─────────────┐
│ ≡ 菜单      │
├─────────────┤
│ 📊 概览     │
│ 🗄️ 数据库   │ ← 点击这里
│ ⚡ 云函数   │
│ 📦 云存储   │
└─────────────┘
```

---

## 📋 第二步：创建第一个集合 (drugs)

### 2.1 点击"添加集合"按钮

在数据库页面：
```
┌─────────────────────────────────────────┐
│ 数据库                    [+ 添加集合]  │ ← 点击这里
├─────────────────────────────────────────┤
│                                         │
│ 集合列表：                              │
│ (暂无集合)                              │
│                                         │
└─────────────────────────────────────────┘
```

### 2.2 填写集合名称

弹出对话框：
```
┌─────────────────────────────────┐
│ 添加集合                        │
├─────────────────────────────────┤
│                                 │
│ 集合名称 *                      │
│ ┌─────────────────────────────┐ │
│ │ drugs                       │ │ ← 输入这个
│ └─────────────────────────────┘ │
│                                 │
│ ⚠️ 注意：                       │
│ • 只能包含字母、数字、下划线    │
│ • 不能以数字开头                │
│ • 长度不超过64个字符            │
│                                 │
├─────────────────────────────────┤
│         [取消]      [确定]      │ ← 点击确定
└─────────────────────────────────┘
```

**输入**: `drugs`

点击：**[确定]** 按钮

### 2.3 配置集合权限

集合创建成功后，会自动进入集合详情页：

```
┌─────────────────────────────────────────┐
│ drugs                                   │
├─────────────────────────────────────────┤
│ [数据] [权限设置] [索引] [统计]        │
│         ↑↑↑↑↑                          │
│     点击这里                            │
└─────────────────────────────────────────┘
```

#### 2.3.1 点击"权限设置"标签

#### 2.3.2 选择权限模式

在权限设置页面：
```
┌─────────────────────────────────────────┐
│ 权限设置                                │
├─────────────────────────────────────────┤
│                                         │
│ 选择权限模式：                          │
│                                         │
│ ○ 仅创建者可读写                        │
│   只有数据创建者可以读写                │
│                                         │
│ ○ 仅管理端可读写                        │
│   只有云函数等管理端可以读写            │
│                                         │
│ ● 所有用户可读写 ← 选择这个             │
│   任何用户都可以读写（开发阶段）        │
│                                         │
│ ○ 自定义安全规则                        │
│   自己编写权限规则                      │
│                                         │
└─────────────────────────────────────────┘
```

**选择**: `所有用户可读写`

**⚠️ 重要说明**：
- 开发阶段选择"所有用户可读写"方便测试
- 生产环境建议修改为更严格的权限

#### 2.3.3 保存权限设置

```
┌─────────────────────────────────────────┐
│                                         │
│              [保存]                     │ ← 点击保存
│                                         │
└─────────────────────────────────────────┘
```

点击：**[保存]** 按钮

#### 2.3.4 确认保存成功

看到提示：
```
┌─────────────────────────┐
│ ✅ 权限设置已保存        │
└─────────────────────────┘
```

### 2.4 返回数据库列表

点击左上角：**← 数据库** 或 **返回**

---

## 📋 第三步：创建剩余11个集合

重复"第二步"的操作，依次创建以下集合：

### 3.1 创建 stock（库存信息）

1. 点击：[+ 添加集合]
2. 集合名称输入：`stock`
3. 点击：[确定]
4. 切换到：[权限设置]
5. 选择：`所有用户可读写`
6. 点击：[保存]
7. 返回数据库列表

### 3.2 创建 in_records（入库记录）

1. 点击：[+ 添加集合]
2. 集合名称输入：`in_records`
3. 点击：[确定]
4. 权限设置：`所有用户可读写`
5. 保存并返回

### 3.3 创建 out_records（出库记录）

1. 添加集合：`out_records`
2. 权限设置：`所有用户可读写`
3. 保存

### 3.4 创建 clinic_usage（门诊用药记录）

1. 添加集合：`clinic_usage`
2. 权限设置：`所有用户可读写`
3. 保存

### 3.5 创建 consume_records（消耗记录）

1. 添加集合：`consume_records`
2. 权限设置：`所有用户可读写`
3. 保存

### 3.6 创建 requisition_records（请领记录）

1. 添加集合：`requisition_records`
2. 权限设置：`所有用户可读写`
3. 保存

### 3.7 创建 users（用户信息）

1. 添加集合：`users`
2. 权限设置：`所有用户可读写`
3. 保存

### 3.8 创建 statistics（统计数据）

1. 添加集合：`statistics`
2. 权限设置：`所有用户可读写`
3. 保存

### 3.9 创建 alerts（预警记录）

1. 添加集合：`alerts`
2. 权限设置：`所有用户可读写`
3. 保存

### 3.10 创建 operation_logs（操作日志）

1. 添加集合：`operation_logs`
2. 权限设置：`所有用户可读写`
3. 保存

### 3.11 创建 stock_check（盘点记录）

1. 添加集合：`stock_check`
2. 权限设置：`所有用户可读写`
3. 保存

---

## 📋 第四步：验证所有集合已创建

### 4.1 查看集合列表

返回数据库首页，应该看到12个集合：

```
┌─────────────────────────────────────────────────┐
│ 数据库                        [+ 添加集合]      │
├────────────┬────────┬──────────┬────────────────┤
│ 集合名称    │ 记录数 │ 大小     │ 操作           │
├────────────┼────────┼──────────┼────────────────┤
│ drugs      │ 0      │ 0B       │ [查看][删除]   │
│ stock      │ 0      │ 0B       │ [查看][删除]   │
│ in_records │ 0      │ 0B       │ [查看][删除]   │
│ out_records│ 0      │ 0B       │ [查看][删除]   │
│ clinic_usage│0      │ 0B       │ [查看][删除]   │
│ consume_records│0   │ 0B       │ [查看][删除]   │
│ requisition_records│0│0B       │ [查看][删除]   │
│ users      │ 0      │ 0B       │ [查看][删除]   │
│ statistics │ 0      │ 0B       │ [查看][删除]   │
│ alerts     │ 0      │ 0B       │ [查看][删除]   │
│ operation_logs│0    │ 0B       │ [查看][删除]   │
│ stock_check│ 0      │ 0B       │ [查看][删除]   │
└────────────┴────────┴──────────┴────────────────┘
```

### 4.2 检查清单

- [ ] drugs ✅
- [ ] stock ✅
- [ ] in_records ✅
- [ ] out_records ✅
- [ ] clinic_usage ✅
- [ ] consume_records ✅
- [ ] requisition_records ✅
- [ ] users ✅
- [ ] statistics ✅
- [ ] alerts ✅
- [ ] operation_logs ✅
- [ ] stock_check ✅

**总计**: 12/12 ✅

---

## 📋 第五步：配置索引（可选，提升性能）

### 为什么需要索引？
- 提升查询速度
- 优化排序性能
- 减少数据库负载

### 5.1 为 drugs 集合创建索引

#### 5.1.1 进入 drugs 集合
点击集合名称：`drugs`

#### 5.1.2 切换到索引管理
点击：**[索引]** 标签

#### 5.1.3 添加索引
点击：**[添加索引]** 按钮

#### 5.1.4 配置索引
```
┌─────────────────────────────────┐
│ 添加索引                        │
├─────────────────────────────────┤
│                                 │
│ 索引字段 *                      │
│ ┌─────────────────────────────┐ │
│ │ barcode                     │ │ ← 选择字段
│ └─────────────────────────────┘ │
│                                 │
│ 索引类型 *                      │
│ ○ 升序                          │
│ ○ 降序                          │
│ ● 唯一索引 ← 选择这个           │
│                                 │
├─────────────────────────────────┤
│         [取消]      [确定]      │
└─────────────────────────────────┘
```

**字段**: `barcode`  
**类型**: `唯一索引`

点击：**[确定]**

#### 5.1.5 继续添加其他索引

为 `drugName` 添加普通索引：
- 字段：drugName
- 类型：升序

### 5.2 其他集合的推荐索引

| 集合 | 字段 | 类型 | 说明 |
|------|------|------|------|
| stock | drugId | 升序 | 加速按药品查询 |
| stock | location | 升序 | 加速按园区查询 |
| stock | expireDate | 升序 | 加速效期查询 |
| in_records | recordNo | 唯一索引 | 入库单号 |
| in_records | createTime | 降序 | 按时间排序 |
| out_records | recordNo | 唯一索引 | 出库单号 |
| out_records | createTime | 降序 | 按时间排序 |
| clinic_usage | createTime | 降序 | 按时间排序 |

**注意**: 索引可以稍后添加，不影响系统使用

---

## 📋 第六步：导入测试数据（可选）

### 6.1 准备测试数据文件

如果有测试数据文件（如：药品清单.json），可以导入

### 6.2 导入步骤

#### 6.2.1 进入目标集合
例如进入：`drugs` 集合

#### 6.2.2 点击导入按钮
```
┌─────────────────────────────────────────┐
│ drugs                [导入] [导出]      │
│                       ↑↑↑              │
│                   点击这里              │
└─────────────────────────────────────────┘
```

#### 6.2.3 选择文件
1. 点击：[选择文件]
2. 选择 JSON 或 JSONL 格式的文件
3. 选择导入模式：
   - **插入**：只添加新记录
   - **更新**：更新已有记录
4. 点击：[确定]

#### 6.2.4 等待导入完成
```
导入进度: ████████████ 100%
成功导入: 50 条记录
失败: 0 条
```

---

## ⚠️ 常见问题

### Q1: 集合名称输入错误怎么办？
**答**：
- 可以删除集合重新创建
- 进入集合 → 设置 → 删除集合
- ⚠️ 注意：删除后数据无法恢复

### Q2: 权限设置选错了？
**答**：
- 进入集合 → 权限设置
- 重新选择权限模式
- 点击保存即可

### Q3: 如何检查权限是否生效？
**答**：
- 在小程序中尝试查询数据
- 如果能查到说明权限正确
- 如果提示"权限不足"需要调整权限

### Q4: 可以批量创建集合吗？
**答**：
- 微信云开发暂不支持批量创建
- 需要逐个创建
- 但可以通过API批量创建（需要编写代码）

### Q5: 删除了集合能恢复吗？
**答**：
- 删除后无法恢复
- 建议定期导出数据备份
- 或开启自动备份功能（付费功能）

---

## 📊 创建进度跟踪表

```
核心业务集合 (7个):
☑ drugs                [████████████] 100%
☑ stock                [████████████] 100%
☑ in_records           [████████████] 100%
☑ out_records          [████████████] 100%
☑ clinic_usage         [████████████] 100%
☑ consume_records      [████████████] 100%
☑ requisition_records  [████████████] 100%

系统功能集合 (5个):
☑ users                [████████████] 100%
☑ statistics           [████████████] 100%
☑ alerts               [████████████] 100%
☑ operation_logs       [████████████] 100%
☑ stock_check          [████████████] 100%

总进度: 12/12 (100%) ✅
```

---

## ✅ 完成检查清单

- [ ] 所有12个集合已创建
- [ ] 每个集合权限已设置为"所有用户可读写"
- [ ] 权限设置已保存
- [ ] 集合列表显示12个集合
- [ ] 记录数都是0（刚创建时）
- [ ] 可以在小程序中查询数据（即使是空数据）

---

## 🎉 创建完成！

### ✅ 已完成
- 12个数据库集合已全部创建
- 权限已配置
- 可以开始使用

### 📊 数据库统计
```
集合总数: 12个
总存储: 0B（暂无数据）
权限模式: 所有用户可读写
状态: 正常运行 ✅
```

### 下一步
1. 开始使用小程序功能
2. 添加测试数据
3. 或导入正式数据

---

**创建日期**: ___________  
**创建人员**: ___________  
**验证结果**: □ 成功(12/12)  □ 部分成功(_/12)

**备注**:
_______________________________________
_______________________________________



