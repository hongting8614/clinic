# 📖 配置定时触发器 - 超详细步骤

**前提条件**: dailySummary 和 expiryMonitor 云函数已部署成功  
**预计时间**: 5-10分钟  
**难度**: ⭐⭐☆☆☆ 简单

---

## 🎯 目标

为2个云函数配置定时触发器：
1. **dailySummary** - 每天23:59自动统计当日数据
2. **expiryMonitor** - 每天00:10自动扫描临期药品

---

## 📋 第一步：访问腾讯云控制台

### 1.1 打开浏览器
- 推荐使用：Chrome、Edge、Firefox
- 不推荐：IE浏览器

### 1.2 访问腾讯云微信小程序云开发控制台

**方法1：直接访问链接**
```
https://console.cloud.tencent.com/tcb
```

**方法2：通过微信开发者工具跳转**
1. 在微信开发者工具中
2. 点击顶部菜单：云开发
3. 点击：云开发控制台（会自动打开浏览器）

### 1.3 登录账号

如果未登录，需要登录：
1. 使用微信扫码登录
2. 或使用QQ账号登录
3. 确保是与小程序AppID绑定的账号

**验证登录成功**：
- 看到控制台首页
- 能看到环境列表

---

## 📋 第二步：选择云开发环境

### 2.1 进入控制台首页

登录成功后，你会看到：
```
┌─────────────────────────────────────────┐
│ 腾讯云 - 微信小程序云开发                │
├─────────────────────────────────────────┤
│                                         │
│  我的环境：                             │
│                                         │
│  ┌───────────────────────────────┐    │
│  │ cloud1-3gv7spppf7d2d0f4       │    │
│  │ 状态：正常运行                 │    │
│  │ [进入] [管理]                  │    │
│  └───────────────────────────────┘    │
│                                         │
└─────────────────────────────────────────┘
```

### 2.2 点击进入环境

1. 找到环境名称：`cloud1-3gv7spppf7d2d0f4`
2. 点击：**[进入]** 按钮
3. 或直接点击环境卡片

**验证进入成功**：
- 左侧菜单显示：概览、数据库、云函数、云存储等
- 顶部显示当前环境ID

---

## 📋 第三步：进入云函数管理页面

### 3.1 点击左侧菜单 - 云函数

在左侧菜单栏找到并点击：
```
┌─────────────┐
│ ≡ 菜单      │
├─────────────┤
│ 📊 概览     │
│ 🗄️ 数据库   │
│ ⚡ 云函数   │ ← 点击这里
│ 📦 云存储   │
│ ⚙️ 设置     │
└─────────────┘
```

### 3.2 查看云函数列表

进入云函数页面后，你会看到：
```
┌─────────────────────────────────────────────────┐
│ 云函数列表                          [+ 新建]    │
├──────────┬─────────┬──────────┬────────────────┤
│ 函数名称  │ 状态    │ 触发器   │ 操作           │
├──────────┼─────────┼──────────┼────────────────┤
│ stockManage│ 已部署 │ 0个     │ [查看][删除]   │
│ drugManage │ 已部署 │ 0个     │ [查看][删除]   │
│ inRecords  │ 已部署 │ 0个     │ [查看][删除]   │
│ dailySummary│已部署│ 0个     │ [查看][删除]   │← 找到这个
│ expiryMonitor│已部署│0个     │ [查看][删除]   │← 和这个
│ ...        │        │         │                │
└──────────┴─────────┴──────────┴────────────────┘
```

**注意**：
- 确认 `dailySummary` 和 `expiryMonitor` 状态都是"已部署"
- 如果没有，需要先部署这两个云函数

---

## 📋 第四步：配置 dailySummary 触发器

### 4.1 进入 dailySummary 详情页

1. 在云函数列表中找到：`dailySummary`
2. 点击：**[查看]** 按钮
3. 或直接点击函数名称

### 4.2 切换到触发器标签

进入函数详情后，顶部有几个标签：
```
┌─────────────────────────────────────────┐
│ [函数配置] [函数代码] [触发器] [日志]  │ ← 点击"触发器"
└─────────────────────────────────────────┘
```

点击：**[触发器]** 标签

### 4.3 点击添加触发器

在触发器页面：
```
┌─────────────────────────────────────────┐
│ 触发器                    [+ 添加触发器]│ ← 点击这里
├─────────────────────────────────────────┤
│                                         │
│ 暂无触发器                               │
│                                         │
└─────────────────────────────────────────┘
```

点击：**[+ 添加触发器]** 按钮

### 4.4 填写触发器配置

弹出配置窗口：

**字段1: 触发器名称**
```
┌─────────────────────────────────┐
│ 触发器名称 *                    │
│ ┌─────────────────────────────┐ │
│ │ dailySummary                │ │ ← 输入这个
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```
**填写**: `dailySummary`

**字段2: 触发方式**
```
┌─────────────────────────────────┐
│ 触发方式 *                      │
│ ┌─────────────────────────────┐ │
│ │ 定时触发 ▼                  │ │ ← 选择这个
│ └─────────────────────────────┘ │
│                                 │
│ 其他选项：                      │
│ ○ HTTP触发                      │
│ ● 定时触发 ← 选择这个           │
└─────────────────────────────────┘
```
**选择**: `定时触发`

**字段3: 触发周期**
```
┌─────────────────────────────────┐
│ 触发周期 *                      │
│ ┌─────────────────────────────┐ │
│ │ ○ 每1分钟                   │ │
│ │ ○ 每1小时                   │ │
│ │ ○ 每1天                     │ │
│ │ ● 自定义                    │ │ ← 选择这个
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```
**选择**: `自定义`

**字段4: Cron表达式**

选择"自定义"后，会出现Cron表达式输入框：
```
┌─────────────────────────────────┐
│ Cron表达式 *                    │
│ ┌─────────────────────────────┐ │
│ │ 0 59 23 * * * *             │ │ ← 输入这个
│ └─────────────────────────────┘ │
│                                 │
│ 格式：秒 分 时 日 月 星期 年    │
│ 示例：每天23:59:00执行          │
└─────────────────────────────────┘
```
**填写**: `0 59 23 * * * *`

**Cron表达式解释**：
```
0      59     23    *     *     *     *
│      │      │     │     │     │     │
│      │      │     │     │     │     └─ 年（任意年）
│      │      │     │     │     └─────── 星期（任意星期）
│      │      │     │     └───────────── 月（任意月）
│      │      │     └─────────────────── 日（任意日）
│      │      └───────────────────────── 时（23点）
│      └──────────────────────────────── 分（59分）
└─────────────────────────────────────── 秒（0秒）

结果：每天23:59:00执行
```

**字段5: 备注（可选）**
```
┌─────────────────────────────────┐
│ 备注                            │
│ ┌─────────────────────────────┐ │
│ │ 每天23:59统计当日数据        │ │ ← 可以输入说明
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```
**填写**: `每天23:59统计当日数据`

### 4.5 确认配置

**完整配置预览**：
```
┌─────────────────────────────────────┐
│ 添加触发器                          │
├─────────────────────────────────────┤
│                                     │
│ 触发器名称: dailySummary            │
│ 触发方式:   定时触发                │
│ 触发周期:   自定义                  │
│ Cron表达式: 0 59 23 * * * *         │
│ 备注:       每天23:59统计当日数据   │
│                                     │
├─────────────────────────────────────┤
│         [取消]          [确定]      │ ← 点击确定
└─────────────────────────────────────┘
```

检查无误后，点击：**[确定]** 按钮

### 4.6 验证创建成功

创建成功后，在触发器列表中会看到：
```
┌─────────────────────────────────────────────┐
│ 触发器                      [+ 添加触发器]  │
├──────────┬────────┬──────────┬──────────────┤
│ 名称     │ 类型   │ Cron     │ 操作         │
├──────────┼────────┼──────────┼──────────────┤
│dailySummary│定时触发│0 59 23..│ [编辑][删除]│
└──────────┴────────┴──────────┴──────────────┘

下次触发时间：今天 23:59:00
```

**成功标志**：
- ✅ 触发器列表显示 dailySummary
- ✅ 显示 Cron 表达式
- ✅ 显示下次触发时间

---

## 📋 第五步：配置 expiryMonitor 触发器

### 5.1 返回云函数列表

1. 点击左上角：**← 返回** 或 **云函数**
2. 回到云函数列表页面

### 5.2 进入 expiryMonitor 详情页

1. 在云函数列表中找到：`expiryMonitor`
2. 点击：**[查看]** 按钮

### 5.3 切换到触发器标签

点击顶部：**[触发器]** 标签

### 5.4 点击添加触发器

点击：**[+ 添加触发器]** 按钮

### 5.5 填写触发器配置

**字段1: 触发器名称**
```
填写: expiryMonitor
```

**字段2: 触发方式**
```
选择: 定时触发
```

**字段3: 触发周期**
```
选择: 自定义
```

**字段4: Cron表达式**
```
填写: 0 10 0 * * * *
```

**Cron表达式解释**：
```
0      10     0     *     *     *     *
│      │      │     │     │     │     │
│      │      │     │     │     │     └─ 年（任意年）
│      │      │     │     │     └─────── 星期（任意星期）
│      │      │     │     └───────────── 月（任意月）
│      │      │     └─────────────────── 日（任意日）
│      │      └───────────────────────── 时（0点，即凌晨）
│      └──────────────────────────────── 分（10分）
└─────────────────────────────────────── 秒（0秒）

结果：每天00:10:00（凌晨0点10分）执行
```

**字段5: 备注（可选）**
```
填写: 每天00:10扫描临期药品
```

### 5.6 确认配置

**完整配置预览**：
```
┌─────────────────────────────────────┐
│ 添加触发器                          │
├─────────────────────────────────────┤
│                                     │
│ 触发器名称: expiryMonitor           │
│ 触发方式:   定时触发                │
│ 触发周期:   自定义                  │
│ Cron表达式: 0 10 0 * * * *          │
│ 备注:       每天00:10扫描临期药品   │
│                                     │
├─────────────────────────────────────┤
│         [取消]          [确定]      │
└─────────────────────────────────────┘
```

点击：**[确定]** 按钮

### 5.7 验证创建成功

```
┌─────────────────────────────────────────────┐
│ 触发器                      [+ 添加触发器]  │
├──────────┬────────┬──────────┬──────────────┤
│ 名称     │ 类型   │ Cron     │ 操作         │
├──────────┼────────┼──────────┼──────────────┤
│expiryMonitor│定时触发│0 10 0..│ [编辑][删除]│
└──────────┴────────┴──────────┴──────────────┘

下次触发时间：明天 00:10:00
```

---

## 📋 第六步：验证配置完成

### 6.1 返回云函数列表

回到云函数列表页面，现在应该看到：

```
┌─────────────────────────────────────────────────┐
│ 云函数列表                          [+ 新建]    │
├──────────┬─────────┬──────────┬────────────────┤
│ 函数名称  │ 状态    │ 触发器   │ 操作           │
├──────────┼─────────┼──────────┼────────────────┤
│ dailySummary│已部署│ 1个 ✅  │ [查看][删除]   │
│ expiryMonitor│已部署│1个 ✅ │ [查看][删除]   │
│ ...        │        │         │                │
└──────────┴─────────┴──────────┴────────────────┘
```

**成功标志**：
- ✅ dailySummary 触发器显示 "1个"
- ✅ expiryMonitor 触发器显示 "1个"

### 6.2 测试手动触发（可选）

可以手动触发一次测试：

1. 进入云函数详情
2. 点击"触发器"标签
3. 点击触发器右侧的：**[立即触发]** 按钮
4. 查看日志，确认执行成功

---

## 📋 第七步：查看执行日志

### 7.1 进入日志页面

在云函数详情页：
1. 点击：**[日志]** 标签
2. 查看触发器执行记录

### 7.2 日志内容示例

成功执行的日志：
```
[2025-11-03 23:59:00] 开始执行 dailySummary
[2025-11-03 23:59:01] 统计今日入库: 5笔
[2025-11-03 23:59:01] 统计今日出库: 3笔
[2025-11-03 23:59:01] 统计门诊用药: 12笔
[2025-11-03 23:59:02] 保存统计结果
[2025-11-03 23:59:02] 执行成功 ✅
```

---

## 🎯 配置总结

### ✅ 已完成的配置

| 云函数 | 触发器名称 | Cron表达式 | 执行时间 | 功能 |
|--------|-----------|------------|---------|------|
| dailySummary | dailySummary | 0 59 23 * * * * | 每天23:59 | 统计当日数据 |
| expiryMonitor | expiryMonitor | 0 10 0 * * * * | 每天00:10 | 扫描临期药品 |

### 📅 触发时间表

```
00:00 ─────────────────────────── 00:00 凌晨
       |
00:10 ─┼─ expiryMonitor 执行 ⏰
       |
       |
23:00 ─────────────────────────── 23:00 晚上
       |
23:59 ─┼─ dailySummary 执行 ⏰
       |
24:00 ─────────────────────────── 第二天00:00
```

---

## ⚠️ 常见问题

### Q1: 找不到"添加触发器"按钮？
**答**：
1. 确认已切换到"触发器"标签
2. 确认云函数已部署成功
3. 刷新页面重试

### Q2: Cron表达式填错了？
**答**：
- dailySummary: `0 59 23 * * * *`（每天23:59）
- expiryMonitor: `0 10 0 * * * *`（每天00:10）
- 注意：共7个字段，用空格分隔

### Q3: 如何修改触发时间？
**答**：
1. 进入云函数详情
2. 点击"触发器"标签
3. 点击触发器右侧的：[编辑] 按钮
4. 修改Cron表达式
5. 点击"确定"

### Q4: 如何确认触发器生效？
**答**：
1. 查看"下次触发时间"
2. 等待到指定时间
3. 查看"日志"标签，确认有执行记录
4. 或者点击"立即触发"手动测试

### Q5: 可以临时停用触发器吗？
**答**：
1. 进入触发器列表
2. 找到对应的触发器
3. 点击：[删除] 按钮
4. 需要时再重新创建

---

## 📚 Cron表达式参考

### 常用时间表达式

| 说明 | Cron表达式 |
|------|-----------|
| 每分钟 | `0 * * * * * *` |
| 每小时 | `0 0 * * * * *` |
| 每天凌晨0点 | `0 0 0 * * * *` |
| 每天中午12点 | `0 0 12 * * * *` |
| 每天晚上23:59 | `0 59 23 * * * *` |
| 每周一上午9点 | `0 0 9 * * 1 *` |
| 每月1号凌晨0点 | `0 0 0 1 * * *` |

### 字段说明

```
┌─────────── 秒 (0-59)
│ ┌───────── 分 (0-59)
│ │ ┌─────── 时 (0-23)
│ │ │ ┌───── 日 (1-31)
│ │ │ │ ┌─── 月 (1-12)
│ │ │ │ │ ┌─ 星期 (0-7, 0和7都代表周日)
│ │ │ │ │ │ ┌ 年 (可选)
│ │ │ │ │ │ │
* * * * * * *
```

### 特殊字符

- `*` - 任意值
- `,` - 枚举值，如 `1,3,5` 表示1、3、5
- `-` - 范围，如 `1-5` 表示1到5
- `/` - 间隔，如 `*/5` 表示每5个单位

---

## ✅ 完成检查清单

配置完成后，请检查：

- [ ] dailySummary 触发器已创建
- [ ] dailySummary Cron表达式正确: `0 59 23 * * * *`
- [ ] expiryMonitor 触发器已创建
- [ ] expiryMonitor Cron表达式正确: `0 10 0 * * * *`
- [ ] 云函数列表显示触发器数量为 "1个"
- [ ] 触发器列表显示"下次触发时间"
- [ ] 可以手动触发测试成功

---

## 🎉 配置完成！

恭喜！定时触发器已配置完成！

### 自动化任务
- ✅ 每天23:59自动统计当日数据
- ✅ 每天00:10自动扫描临期药品

### 下一步
- 等待到指定时间，系统会自动执行
- 可以在日志中查看执行记录
- 定期检查统计数据和预警信息

---

**配置日期**: ___________  
**配置人员**: ___________  
**验证结果**: □ 成功  □ 失败

**备注**:
_______________________________________
_______________________________________



