# 🔧 解决 app.json 错误 - 微信开发者工具配置

## 🚨 当前问题

```
错误: [app.json 文件内容错误] app.json: 在项目根目录未找到 app.json
原因: 微信开发者工具打开了错误的目录
```

---

## ✅ 解决方案

### 问题原因

您的项目是 **Uni-app** 项目，源码需要编译后才能运行。

```
项目结构:
D:\medicine_manager\AK-PMS\          ← 源码目录（不能直接打开）
  ├── pages/
  ├── components/
  ├── cloudfunctions/
  └── unpackage/
      └── dist/
          └── dev/
              └── mp-weixin/          ← 编译后的小程序目录（应该打开这个）
                  ├── app.json       ← 微信小程序需要的文件
                  ├── pages/
                  └── cloudfunctions/
```

---

## 🎯 立即解决（2种方法）

### 方法1：重新导入正确的目录（推荐）⭐⭐⭐

#### 步骤1: 关闭当前项目
```
微信开发者工具 → 顶部菜单 → 项目 → 关闭项目
```

#### 步骤2: 重新导入
```
1. 点击微信开发者工具左上角 "+"
2. 选择 "导入项目"
3. 项目目录选择：
   D:\medicine_manager\AK-PMS\unpackage\dist\dev\mp-weixin
   ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑
   注意是这个目录，不是项目根目录！

4. AppID: 选择已有的 wx1ff987aa25e5c181
5. 项目名称: AK-PMS（可以修改）
6. 点击 "导入"
```

#### 步骤3: 验证成功
```
✅ 看到首页界面
✅ 左侧文件树有 pages, components, cloudfunctions
✅ 可以看到 app.json 文件
✅ 顶部没有错误提示
```

---

### 方法2：修改当前项目路径

#### 步骤1: 打开项目配置
```
微信开发者工具 → 顶部菜单 → 项目 → 详情
```

#### 步骤2: 查看本地设置
```
在"本地设置"标签页，查看当前项目路径
```

#### 步骤3: 重新指向正确目录
```
由于微信开发者工具不支持直接修改路径，
建议使用方法1重新导入
```

---

## 📁 正确的目录结构

### 应该打开的目录：
```
D:\medicine_manager\AK-PMS\unpackage\dist\dev\mp-weixin\
├── app.js                  ← 微信小程序入口
├── app.json               ← 微信小程序配置
├── app.wxss               ← 全局样式
├── pages/                 ← 页面目录
├── components/            ← 组件目录
├── cloudfunctions/        ← 云函数目录（重要）
├── static/                ← 静态资源
├── project.config.json    ← 项目配置
└── project.private.config.json
```

### ⚠️ 不要打开的目录：
```
❌ D:\medicine_manager\AK-PMS\           （源码目录）
❌ D:\medicine_manager\AK-PMS\pages\     （源码子目录）
```

---

## 🔍 如何找到正确的目录

### Windows 资源管理器中：
```
1. 打开: D:\medicine_manager\AK-PMS
2. 进入: unpackage 文件夹
3. 进入: dist 文件夹
4. 进入: dev 文件夹
5. 进入: mp-weixin 文件夹
6. 看到 app.json 文件 ✅
7. 复制这个路径：
   D:\medicine_manager\AK-PMS\unpackage\dist\dev\mp-weixin
```

---

## 🎯 部署云函数的正确方式

### 重要说明

打开正确的目录后，云函数路径会自动识别：

```
编译后的目录结构:
mp-weixin/
└── cloudfunctions/      ← 这里是云函数的符号链接
    ├── stockManage/
    ├── drugManage/
    └── ...

实际指向:
D:\medicine_manager\AK-PMS\cloudfunctions\
```

### 部署步骤

```
1. 在微信开发者工具中
2. 点击顶部：云开发
3. 左侧文件树找到：cloudfunctions/stockManage
4. 右键 → 上传并部署：云端安装依赖
5. 等待完成
```

---

## ✅ 完整操作流程

### 第1步：重新导入项目（3分钟）

```
1. 关闭当前项目
2. 点击 "+" → 导入项目
3. 目录选择：
   D:\medicine_manager\AK-PMS\unpackage\dist\dev\mp-weixin
4. AppID: wx1ff987aa25e5c181
5. 点击"导入"
```

### 第2步：验证项目正常（1分钟）

```
✅ 检查清单：
□ 可以看到首页界面
□ 左侧有 pages, components, cloudfunctions
□ 没有 app.json 错误
□ 可以点击"编译"
```

### 第3步：部署 stockManage（2分钟）

```
1. 点击顶部：云开发
2. 找到：cloudfunctions/stockManage
3. 右键 → 上传并部署：云端安装依赖
4. 等待完成
5. 点击"编译"
6. 验证首页数据正常
```

### 第4步：继续部署其他云函数（20分钟）

```
参考文档：📋云函数批量部署清单.txt
逐个上传其他20个云函数
```

---

## ⚠️ 常见问题

### Q1: 为什么不能直接打开项目根目录？

**答**：因为这是 Uni-app 项目，需要编译：
```
源码 (pages/*.vue) 
  ↓ 编译
小程序代码 (pages/*.js, *.json, *.wxml, *.wxss)
```

微信开发者工具只能识别编译后的小程序代码。

---

### Q2: 编译后的文件在哪里？

**答**：在 `unpackage/dist/dev/mp-weixin` 目录：
```
项目根目录/
└── unpackage/
    └── dist/
        └── dev/
            └── mp-weixin/  ← 这里
```

---

### Q3: 如何重新编译？

**方法1**: HBuilderX
```
1. 打开 HBuilderX
2. 打开项目 D:\medicine_manager\AK-PMS
3. 运行 → 运行到小程序模拟器 → 微信开发者工具
```

**方法2**: 命令行
```bash
cd D:\medicine_manager\AK-PMS
npm run dev:mp-weixin
```

**方法3**: 微信开发者工具（编译后的项目）
```
打开正确的目录后，点击"编译"即可
```

---

### Q4: cloudfunctions 在哪里？

**答**：编译后的目录中有软链接：
```
mp-weixin/cloudfunctions/ → 实际指向项目根目录的 cloudfunctions/

所以可以在微信开发者工具中直接看到和部署
```

---

### Q5: 项目配置文件在哪里？

**答**：
```
源码目录: manifest.json (Uni-app配置)
编译后: project.config.json (微信小程序配置)

修改源码的 manifest.json，重新编译后会生成新的 project.config.json
```

---

## 📊 验证检查清单

### 导入成功的标志：

```
✅ 微信开发者工具左侧文件树显示：
   ├── pages/
   ├── pages-sub/
   ├── components/
   ├── cloudfunctions/
   ├── static/
   ├── common/
   ├── app.js
   ├── app.json
   └── app.wxss

✅ 顶部没有红色错误提示

✅ 可以看到首页界面（医务室logo、快捷操作等）

✅ 控制台显示：
   - App Launch
   - 云开发初始化成功
   - 首页 onLoad
```

---

## 🎯 下一步操作

项目导入成功后，按照部署计划继续：

### 1. 立即部署 stockManage
```
📄 参考: 🎯【第一步】立即上传stockManage.txt
⏱️ 时间: 2分钟
🎯 目标: 修复首页错误
```

### 2. 批量部署云函数
```
📄 参考: 📋云函数批量部署清单.txt
⏱️ 时间: 20分钟
🎯 目标: 部署21个云函数
```

### 3. 创建数据库
```
📄 参考: 🗄️数据库创建指南.txt
⏱️ 时间: 8分钟
🎯 目标: 创建12个集合
```

---

## 📝 快速命令

### 复制以下路径到微信开发者工具：
```
D:\medicine_manager\AK-PMS\unpackage\dist\dev\mp-weixin
```

### 或者用命令行打开：
```bash
# 打开目录
explorer D:\medicine_manager\AK-PMS\unpackage\dist\dev\mp-weixin

# 重新编译（如果需要）
cd D:\medicine_manager\AK-PMS
npm run dev:mp-weixin
```

---

## 🎊 总结

### 问题原因
```
打开了源码目录，而不是编译后的小程序目录
```

### 解决方案
```
重新导入正确的目录：
D:\medicine_manager\AK-PMS\unpackage\dist\dev\mp-weixin
```

### 验证成功
```
✅ 没有 app.json 错误
✅ 可以看到首页
✅ 可以部署云函数
```

---

**现在请按照上述步骤重新导入项目，然后继续部署云函数！** 🚀

有任何问题随时告诉我！

