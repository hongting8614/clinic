# ğŸ”§ åˆ†å›­åŒºå•ä½è½¬æ¢ä¸æ•°æ®åº“ä¼˜åŒ–æ–¹æ¡ˆ v3.11

**éœ€æ±‚åˆ†ææ—¶é—´**: 2025-11-06  
**ç‰ˆæœ¬**: v3.11  
**æ ¸å¿ƒé—®é¢˜**: å…¥åº“/å‡ºåº“å•ä½è½¬æ¢ + åˆ†å›­åŒºç®¡ç† + å°å‹æ•°æ®åº“ä¼˜åŒ–

---

## ğŸ“‹ éœ€æ±‚åˆ†æ

### é—®é¢˜1ï¼šå…¥åº“/å‡ºåº“å•ä½ä¸ä¸€è‡´
```
å½“å‰é—®é¢˜ï¼š
- å…¥åº“å•ä½: ç›’ã€ç“¶ã€è¢‹ï¼ˆåŒ…è£…å•ä½ï¼‰
- å‡ºåº“å•ä½: ç‰‡ã€ç²’ã€mlï¼ˆæœ€å°å•ä½ï¼‰
- ç¼ºå°‘è‡ªåŠ¨è½¬æ¢æœºåˆ¶

ç¤ºä¾‹ï¼š
å…¥åº“: é˜¿è«è¥¿æ—èƒ¶å›Š 0.25gÃ—24ç²’/ç›’  å…¥åº“ 10ç›’
      â†“ éœ€è¦è½¬æ¢
åº“å­˜: 240ç²’ï¼ˆæœ€å°å•ä½ï¼‰
      â†“ éœ€è¦è½¬æ¢
å‡ºåº“: é™†å›­é¢†ç”¨ 30ç²’
```

### é—®é¢˜2ï¼šåˆ†å›­åŒºç®¡ç†
```
å›­åŒºåˆ’åˆ†ï¼š
- é™†å›­ (land_park)
- æ°´å›­ (water_park)
- åŒ»åŠ¡å®¤ä¸­å¤®åº“ (central_storage)

ç®¡ç†éœ€æ±‚ï¼š
- ç‹¬ç«‹åº“å­˜ç»Ÿè®¡
- ç‹¬ç«‹å‡ºåº“è®°å½•
- è·¨å›­åŒºè°ƒæ‹¨
- åˆ†å›­åŒºæŠ¥è¡¨
```

### é—®é¢˜3ï¼šæ•°æ®åº“ä¼˜åŒ–
```
è§„æ¨¡ç‰¹ç‚¹ï¼š
- è¯å“ç§ç±»: <100ç§
- æœˆäº¤æ˜“é‡: <500ç¬”
- ç”¨æˆ·æ•°é‡: <20äºº
- æ•°æ®æ€»é‡: <10ä¸‡æ¡

ä¼˜åŒ–æ–¹å‘ï¼š
- å­—æ®µè®¾è®¡ä¼˜åŒ–
- ç´¢å¼•ç­–ç•¥
- æŸ¥è¯¢æ€§èƒ½
- å­˜å‚¨æ•ˆç‡
```

---

## ğŸ—ï¸ å½“å‰æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯æ ˆ
```javascript
æ¡†æ¶: uni-app (Vue 2.x)
  â”œâ”€ UIæ¡†æ¶: uView 2.x
  â”œâ”€ çŠ¶æ€ç®¡ç†: Vue data + computed
  â”œâ”€ è·¯ç”±: pages.json é…ç½®å¼è·¯ç”±
  â”œâ”€ å·¥å…·åº“: 
  â”‚   â”œâ”€ utils/common.js (é€šç”¨å·¥å…·)
  â”‚   â”œâ”€ utils/request.js (è¯·æ±‚å°è£…)
  â”‚   â””â”€ utils/validator.js (æ•°æ®éªŒè¯)
  â””â”€ ç»„ä»¶:
      â”œâ”€ signature (ç”µå­ç­¾å)
      â”œâ”€ scanner (æ‰«ç )
      â”œâ”€ batch-selector (æ‰¹æ¬¡é€‰æ‹©)
      â””â”€ drug-selector (è¯å“é€‰æ‹©)
```

### åç«¯æŠ€æœ¯æ ˆ
```javascript
äº‘å¹³å°: è…¾è®¯äº‘å¼€å‘ (CloudBase)
  â”œâ”€ äº‘å‡½æ•°: Node.js 16.x
  â”‚   â”œâ”€ drugManage (è¯å“ç®¡ç†)
  â”‚   â”œâ”€ stockManage (åº“å­˜ç®¡ç†)
  â”‚   â”œâ”€ inRecords (å…¥åº“ç®¡ç†)
  â”‚   â”œâ”€ outRecords (å‡ºåº“ç®¡ç†)
  â”‚   â””â”€ ... (å…±16ä¸ªäº‘å‡½æ•°)
  â”œâ”€ äº‘æ•°æ®åº“: MongoDB 4.0
  â”‚   â”œâ”€ drugs (è¯å“æ¡£æ¡ˆ)
  â”‚   â”œâ”€ stock (åº“å­˜æ‰¹æ¬¡)
  â”‚   â”œâ”€ in_records (å…¥åº“è®°å½•)
  â”‚   â”œâ”€ out_records (å‡ºåº“è®°å½•)
  â”‚   â””â”€ ... (å…±12ä¸ªé›†åˆ)
  â””â”€ äº‘å­˜å‚¨: æ–‡ä»¶å­˜å‚¨ï¼ˆç­¾åã€å¯¼å‡ºæ–‡ä»¶ï¼‰
```

### æ•°æ®åº“ç‰¹ç‚¹
```
ç±»å‹: MongoDBï¼ˆæ–‡æ¡£å‹æ•°æ®åº“ï¼‰
  ä¼˜åŠ¿:
  âœ… çµæ´»çš„æ–‡æ¡£ç»“æ„
  âœ… å¼ºå¤§çš„èšåˆæŸ¥è¯¢
  âœ… äº‘åŸç”Ÿé›†æˆ
  âœ… æ— éœ€ç»´æŠ¤æœåŠ¡å™¨
  
  é€‚ç”¨æ€§:
  âœ… å®Œç¾é€‚åˆ<100ç§è¯å“çš„å°è§„æ¨¡åœºæ™¯
  âœ… æ”¯æŒå¤æ‚åµŒå¥—æ•°æ®ï¼ˆæ‰¹æ¬¡ã€æ˜ç»†ï¼‰
  âœ… å¤©ç„¶æ”¯æŒJSONç»“æ„
```

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆè®¾è®¡

## æ–¹æ¡ˆ1ï¼šè§„æ ¼è§£æä¸å•ä½è½¬æ¢

### 1.1 è§„æ ¼å­—æ®µæ ‡å‡†åŒ–

#### å½“å‰è§„æ ¼æ ¼å¼åˆ†æ
```
å¸¸è§æ ¼å¼:
1. ç‰‡å‰‚: "0.25gÃ—24ç²’/ç›’"
2. èƒ¶å›Š: "0.5gÃ—12ç²’/ç›’"
3. æ³¨å°„å‰‚: "5mlÃ—10æ”¯/ç›’"
4. å£æœæ¶²: "10mlÃ—6ç“¶/ç›’"
5. é¢—ç²’: "3gÃ—10è¢‹/ç›’"
6. è½¯è†: "20g/æ”¯"

è§£æç›®æ ‡:
- å•ä½å‰‚é‡: 0.25g
- æœ€å°å•ä½: ç²’
- åŒ…è£…æ•°é‡: 24
- åŒ…è£…å•ä½: ç›’
```

#### æ­£åˆ™è¡¨è¾¾å¼è®¾è®¡
```javascript
/**
 * è§„æ ¼è§£ææ­£åˆ™è¡¨è¾¾å¼
 * æ”¯æŒæ ¼å¼: "å‰‚é‡Ã—æ•°é‡å•ä½/åŒ…è£…å•ä½"
 */
const SPEC_PATTERNS = {
  // æ ‡å‡†æ ¼å¼: 0.25gÃ—24ç²’/ç›’
  standard: /^(\d+\.?\d*)(mg|g|ml|Î¼g)Ã—(\d+)(ç‰‡|ç²’|æ”¯|ç“¶|è¢‹)\/?(ç›’|ç“¶|è¢‹)?$/,
  
  // ç®€åŒ–æ ¼å¼: 24ç²’/ç›’
  simple: /^(\d+)(ç‰‡|ç²’|æ”¯|ç“¶|è¢‹|g|ml)\/?(ç›’|ç“¶|è¢‹)?$/,
  
  // å•ä¸€æ ¼å¼: 20g/æ”¯
  single: /^(\d+\.?\d*)(g|ml)\/?(æ”¯|ç“¶|è¢‹)$/
}

/**
 * è§£æè¯å“è§„æ ¼
 * @param {String} spec - è§„æ ¼å­—ç¬¦ä¸²
 * @returns {Object} è§£æç»“æœ
 */
function parseSpecification(spec) {
  if (!spec) return null
  
  // æ¸…ç†ç©ºæ ¼
  spec = spec.trim()
  
  // å°è¯•æ ‡å‡†æ ¼å¼
  let match = spec.match(SPEC_PATTERNS.standard)
  if (match) {
    return {
      dosage: parseFloat(match[1]),        // 0.25
      dosageUnit: match[2],                // g
      minCount: parseInt(match[3]),        // 24
      minUnit: match[4],                   // ç²’
      packUnit: match[5] || match[4],      // ç›’
      conversionRate: parseInt(match[3]),  // è½¬æ¢ç‡: 24
      fullSpec: spec
    }
  }
  
  // å°è¯•ç®€åŒ–æ ¼å¼
  match = spec.match(SPEC_PATTERNS.simple)
  if (match) {
    return {
      dosage: null,
      dosageUnit: null,
      minCount: parseInt(match[1]),        // 24
      minUnit: match[2],                   // ç²’
      packUnit: match[3] || match[2],      // ç›’
      conversionRate: parseInt(match[1]),  // è½¬æ¢ç‡: 24
      fullSpec: spec
    }
  }
  
  // å°è¯•å•ä¸€æ ¼å¼
  match = spec.match(SPEC_PATTERNS.single)
  if (match) {
    return {
      dosage: parseFloat(match[1]),        // 20
      dosageUnit: match[2],                // g
      minUnit: match[3],                   // æ”¯
      packUnit: match[3],                  // æ”¯
      minCount: 1,
      conversionRate: 1,                   // è½¬æ¢ç‡: 1
      fullSpec: spec
    }
  }
  
  // æ— æ³•è§£æï¼Œè¿”å›null
  return null
}

/**
 * å•ä½è½¬æ¢
 * @param {Number} quantity - æ•°é‡
 * @param {String} fromUnit - æºå•ä½
 * @param {String} toUnit - ç›®æ ‡å•ä½
 * @param {Object} specInfo - è§„æ ¼ä¿¡æ¯
 * @returns {Number} è½¬æ¢åæ•°é‡
 */
function convertUnit(quantity, fromUnit, toUnit, specInfo) {
  if (!specInfo) {
    throw new Error('ç¼ºå°‘è§„æ ¼ä¿¡æ¯ï¼Œæ— æ³•è½¬æ¢å•ä½')
  }
  
  // åŒå•ä½ä¸è½¬æ¢
  if (fromUnit === toUnit) {
    return quantity
  }
  
  const { minUnit, packUnit, conversionRate } = specInfo
  
  // åŒ…è£…å•ä½ â†’ æœ€å°å•ä½
  if (fromUnit === packUnit && toUnit === minUnit) {
    return quantity * conversionRate
  }
  
  // æœ€å°å•ä½ â†’ åŒ…è£…å•ä½
  if (fromUnit === minUnit && toUnit === packUnit) {
    return quantity / conversionRate
  }
  
  throw new Error(`ä¸æ”¯æŒçš„å•ä½è½¬æ¢: ${fromUnit} â†’ ${toUnit}`)
}
```

#### ä½¿ç”¨ç¤ºä¾‹
```javascript
// ç¤ºä¾‹1: æ ‡å‡†æ ¼å¼è§£æ
const spec1 = "0.25gÃ—24ç²’/ç›’"
const parsed1 = parseSpecification(spec1)
console.log(parsed1)
// {
//   dosage: 0.25,
//   dosageUnit: "g",
//   minCount: 24,
//   minUnit: "ç²’",
//   packUnit: "ç›’",
//   conversionRate: 24,
//   fullSpec: "0.25gÃ—24ç²’/ç›’"
// }

// ç¤ºä¾‹2: å•ä½è½¬æ¢
// å…¥åº“: 10ç›’ â†’ åº“å­˜: 240ç²’
const inStock = convertUnit(10, "ç›’", "ç²’", parsed1)
console.log(inStock) // 240

// ç¤ºä¾‹3: å‡ºåº“: 30ç²’ â†’ æ¢ç®—: 1.25ç›’
const outStock = convertUnit(30, "ç²’", "ç›’", parsed1)
console.log(outStock) // 1.25
```

---

### 1.2 æ•°æ®åº“å­—æ®µè®¾è®¡ä¼˜åŒ–

#### drugs é›†åˆï¼ˆè¯å“æ¡£æ¡ˆï¼‰
```javascript
{
  _id: "drug_001",
  name: "é˜¿è«è¥¿æ—èƒ¶å›Š",                    // è¯å“åç§°
  genericName: "é˜¿è«è¥¿æ—",                 // é€šç”¨å
  specification: "0.25gÃ—24ç²’/ç›’",         // åŸå§‹è§„æ ¼å­—ç¬¦ä¸²
  
  // ===== æ–°å¢ï¼šç»“æ„åŒ–è§„æ ¼ä¿¡æ¯ =====
  specInfo: {
    dosage: 0.25,                         // å•ä½å‰‚é‡
    dosageUnit: "g",                      // å‰‚é‡å•ä½
    minCount: 24,                         // æœ€å°å•ä½æ•°é‡
    minUnit: "ç²’",                        // æœ€å°å•ä½ï¼ˆå‡ºåº“å•ä½ï¼‰
    packUnit: "ç›’",                       // åŒ…è£…å•ä½ï¼ˆå…¥åº“å•ä½ï¼‰
    conversionRate: 24                    // è½¬æ¢ç‡ï¼ˆ1ç›’=24ç²’ï¼‰
  },
  
  manufacturer: "ååŒ—åˆ¶è¯",                // å‚å®¶
  category: "æŠ—ç”Ÿç´ ",                     // åˆ†ç±»
  barcode: "6901234567890",               // æ¡å½¢ç 
  
  // åº“å­˜é¢„è­¦
  lowStockThreshold: 100,                 // é¢„è­¦é˜ˆå€¼ï¼ˆæœ€å°å•ä½ï¼‰
  lowStockThresholdPack: 5,               // é¢„è­¦é˜ˆå€¼ï¼ˆåŒ…è£…å•ä½ï¼Œå†—ä½™ä¾¿äºæ˜¾ç¤ºï¼‰
  
  isHighValue: false,                     // æ˜¯å¦é«˜å€¼è¯å“
  isEmergency: false,                     // æ˜¯å¦æ€¥æ•‘è¯å“
  isPrescription: false,                  // æ˜¯å¦å¤„æ–¹è¯
  
  createTime: ISODate("2025-01-01"),
  updateTime: ISODate("2025-01-01")
}

// ç´¢å¼•è®¾è®¡
db.drugs.createIndex({ "name": 1 })                    // è¯å“åç§°
db.drugs.createIndex({ "barcode": 1 })                 // æ¡å½¢ç ï¼ˆå”¯ä¸€ï¼‰
db.drugs.createIndex({ "category": 1 })                // åˆ†ç±»ç­›é€‰
db.drugs.createIndex({ "specInfo.minUnit": 1 })        // æœ€å°å•ä½ç­›é€‰
```

#### stock é›†åˆï¼ˆåº“å­˜æ‰¹æ¬¡ï¼‰
```javascript
{
  _id: "stock_001",
  drugId: "drug_001",                     // è¯å“ID
  drugName: "é˜¿è«è¥¿æ—èƒ¶å›Š",               // å†—ä½™ï¼šè¯å“åç§°
  specification: "0.25gÃ—24ç²’/ç›’",         // å†—ä½™ï¼šè§„æ ¼
  
  // ===== æ–°å¢ï¼šå•ä½ä¿¡æ¯ =====
  minUnit: "ç²’",                          // æœ€å°å•ä½
  packUnit: "ç›’",                         // åŒ…è£…å•ä½
  conversionRate: 24,                     // è½¬æ¢ç‡
  
  batch: "20250101",                      // æ‰¹å·
  productionDate: ISODate("2025-01-01"),  // ç”Ÿäº§æ—¥æœŸ
  expireDate: ISODate("2027-01-01"),      // æœ‰æ•ˆæœŸ
  
  // ===== æ ¸å¿ƒï¼šåº“å­˜æ•°é‡ï¼ˆæœ€å°å•ä½ï¼‰ =====
  quantity: 240,                          // åº“å­˜æ•°é‡ï¼ˆç²’ï¼‰
  quantityPack: 10,                       // åº“å­˜æ•°é‡ï¼ˆç›’ï¼Œå†—ä½™ä¾¿äºæ˜¾ç¤ºï¼‰
  
  // ===== æ–°å¢ï¼šåˆ†å›­åŒºåº“å­˜ =====
  location: "central_storage",            // æ‰€åœ¨ä½ç½®
  locationName: "åŒ»åŠ¡å®¤ä¸­å¤®åº“",           // ä½ç½®åç§°
  
  // å¯é€‰ï¼šåˆ†å›­åŒºæ˜ç»†ï¼ˆç”¨äºè·¨å›­åŒºè°ƒæ‹¨åçš„è¿½æº¯ï¼‰
  locationDetails: {
    central_storage: 100,                 // ä¸­å¤®åº“: 100ç²’
    land_park: 80,                        // é™†å›­: 80ç²’
    water_park: 60                        // æ°´å›­: 60ç²’
  },
  
  price: 12.5,                            // å•ä»·ï¼ˆæŒ‰åŒ…è£…å•ä½ï¼‰
  manufacturer: "ååŒ—åˆ¶è¯",               // å‚å®¶
  
  lockQuantity: 0,                        // é”å®šæ•°é‡ï¼ˆé¢„ç•™ï¼‰
  
  createTime: ISODate("2025-01-01"),
  updateTime: ISODate("2025-01-01")
}

// ç´¢å¼•è®¾è®¡
db.stock.createIndex({ "drugId": 1, "location": 1, "batch": 1 })  // å¤åˆç´¢å¼•ï¼šè¯å“+ä½ç½®+æ‰¹å·
db.stock.createIndex({ "location": 1, "quantity": 1 })             // å›­åŒºåº“å­˜ç»Ÿè®¡
db.stock.createIndex({ "expireDate": 1 })                          // æ•ˆæœŸé¢„è­¦
db.stock.createIndex({ "quantity": 1 })                            // ä½åº“å­˜é¢„è­¦
```

#### in_records é›†åˆï¼ˆå…¥åº“è®°å½•ï¼‰
```javascript
{
  _id: "in_001",
  recordNo: "RK20251106001",              // å…¥åº“å•å·
  status: "completed",                    // çŠ¶æ€: draft/pending_review/completed/rejected
  
  supplier: "å›½è¯æ§è‚¡",                   // ä¾›åº”å•†
  
  items: [                                // è¯å“æ˜ç»†
    {
      drugId: "drug_001",
      drugName: "é˜¿è«è¥¿æ—èƒ¶å›Š",
      specification: "0.25gÃ—24ç²’/ç›’",
      
      // ===== å…¥åº“å•ä½ï¼ˆåŒ…è£…å•ä½ï¼‰ =====
      unit: "ç›’",                         // å…¥åº“å•ä½
      quantity: 10,                       // å…¥åº“æ•°é‡ï¼ˆç›’ï¼‰
      
      // ===== æ–°å¢ï¼šè‡ªåŠ¨è®¡ç®—æœ€å°å•ä½ =====
      minUnit: "ç²’",                      // æœ€å°å•ä½
      minQuantity: 240,                   // æœ€å°å•ä½æ•°é‡ï¼ˆç²’ï¼‰
      conversionRate: 24,                 // è½¬æ¢ç‡
      
      batch: "20250101",                  // æ‰¹å·
      productionDate: ISODate("2025-01-01"),
      expireDate: ISODate("2027-01-01"),
      price: 12.5,                        // å•ä»·ï¼ˆæŒ‰ç›’ï¼‰
      amount: 125.0,                      // é‡‘é¢
      
      manufacturer: "ååŒ—åˆ¶è¯"
    }
  ],
  
  // ===== æ–°å¢ï¼šè‡ªåŠ¨å…¥åº“åˆ°ä¸­å¤®åº“ =====
  location: "central_storage",            // å…¥åº“ä½ç½®
  locationName: "åŒ»åŠ¡å®¤ä¸­å¤®åº“",
  
  operator: "å¼ ä¸‰",                       // æ“ä½œå‘˜
  operatorId: "user_001",
  operatorSign: "cloud://sign_001.png",
  
  reviewer: "æå››",                       // å¤æ ¸å‘˜
  reviewerId: "user_002",
  reviewerSign: "cloud://sign_002.png",
  
  createTime: ISODate("2025-01-06"),
  updateTime: ISODate("2025-01-06"),
  completeTime: ISODate("2025-01-06")
}

// ç´¢å¼•è®¾è®¡
db.in_records.createIndex({ "recordNo": 1 }, { unique: true })     // å•å·å”¯ä¸€
db.in_records.createIndex({ "status": 1, "createTime": -1 })       // çŠ¶æ€+æ—¶é—´
db.in_records.createIndex({ "location": 1, "createTime": -1 })     // å›­åŒº+æ—¶é—´
```

#### out_records é›†åˆï¼ˆå‡ºåº“è®°å½•ï¼‰
```javascript
{
  _id: "out_001",
  recordNo: "CK20251106001",              // å‡ºåº“å•å·
  status: "completed",                    // çŠ¶æ€
  
  // ===== æ ¸å¿ƒï¼šåˆ†å›­åŒºå‡ºåº“ =====
  location: "land_park",                  // å‡ºåº“å›­åŒº: land_park/water_park/central_storage
  locationName: "é™†å›­",                   // å›­åŒºåç§°
  
  items: [                                // è¯å“æ˜ç»†
    {
      drugId: "drug_001",
      drugName: "é˜¿è«è¥¿æ—èƒ¶å›Š",
      specification: "0.25gÃ—24ç²’/ç›’",
      
      // ===== å‡ºåº“å•ä½ï¼ˆæœ€å°å•ä½ï¼‰ =====
      unit: "ç²’",                         // å‡ºåº“å•ä½
      quantity: 30,                       // å‡ºåº“æ•°é‡ï¼ˆç²’ï¼‰
      
      // ===== æ–°å¢ï¼šæ˜¾ç¤ºåŒ…è£…å•ä½æ¢ç®— =====
      packUnit: "ç›’",                     // åŒ…è£…å•ä½
      packQuantity: 1.25,                 // åŒ…è£…æ•°é‡ï¼ˆç›’ï¼Œç”¨äºå‚è€ƒï¼‰
      conversionRate: 24,                 // è½¬æ¢ç‡
      
      batch: "20250101",                  // æ‰¹å·
      expireDate: ISODate("2027-01-01"),
      
      // ===== åº“å­˜æ‰£å‡ä¿¡æ¯ =====
      stockId: "stock_001",               // åº“å­˜æ‰¹æ¬¡ID
      beforeQuantity: 240,                // æ‰£å‡å‰åº“å­˜ï¼ˆç²’ï¼‰
      afterQuantity: 210                  // æ‰£å‡ååº“å­˜ï¼ˆç²’ï¼‰
    }
  ],
  
  remark: "é™†å›­åŒ»åŠ¡å®¤é¢†ç”¨",               // å¤‡æ³¨
  
  dispenser: "å¼ ä¸‰",                      // å‘è¯äºº
  dispenserId: "user_001",
  dispenserSign: "cloud://sign_001.png",
  
  receiver: "ç‹äº”",                       // é¢†è¯äºº
  receiverId: "user_003",
  receiverSign: "cloud://sign_003.png",
  
  createTime: ISODate("2025-01-06"),
  updateTime: ISODate("2025-01-06"),
  completeTime: ISODate("2025-01-06")
}

// ç´¢å¼•è®¾è®¡
db.out_records.createIndex({ "recordNo": 1 }, { unique: true })    // å•å·å”¯ä¸€
db.out_records.createIndex({ "status": 1, "createTime": -1 })      // çŠ¶æ€+æ—¶é—´
db.out_records.createIndex({ "location": 1, "createTime": -1 })    // å›­åŒº+æ—¶é—´ï¼ˆæ ¸å¿ƒï¼‰
db.out_records.createIndex({ "items.drugId": 1, "location": 1 })   // è¯å“+å›­åŒº
```

---

### 1.3 æ ¸å¿ƒå·¥å…·ç±»å®ç°

#### utils/unitConverter.jsï¼ˆå•ä½è½¬æ¢å·¥å…·ï¼‰
```javascript
/**
 * å•ä½è½¬æ¢å·¥å…·ç±»
 */
class UnitConverter {
  /**
   * è§„æ ¼è§£ææ­£åˆ™
   */
  static SPEC_PATTERNS = {
    standard: /^(\d+\.?\d*)(mg|g|ml|Î¼g)Ã—(\d+)(ç‰‡|ç²’|æ”¯|ç“¶|è¢‹)\/?(ç›’|ç“¶|è¢‹)?$/,
    simple: /^(\d+)(ç‰‡|ç²’|æ”¯|ç“¶|è¢‹|g|ml)\/?(ç›’|ç“¶|è¢‹)?$/,
    single: /^(\d+\.?\d*)(g|ml)\/?(æ”¯|ç“¶|è¢‹)$/
  }
  
  /**
   * è§£æè§„æ ¼å­—ç¬¦ä¸²
   * @param {String} spec - è§„æ ¼å­—ç¬¦ä¸²
   * @returns {Object|null} è§£æç»“æœ
   */
  static parseSpecification(spec) {
    if (!spec || typeof spec !== 'string') return null
    
    spec = spec.trim()
    
    // æ ‡å‡†æ ¼å¼
    let match = spec.match(this.SPEC_PATTERNS.standard)
    if (match) {
      return {
        dosage: parseFloat(match[1]),
        dosageUnit: match[2],
        minCount: parseInt(match[3]),
        minUnit: match[4],
        packUnit: match[5] || match[4],
        conversionRate: parseInt(match[3]),
        fullSpec: spec
      }
    }
    
    // ç®€åŒ–æ ¼å¼
    match = spec.match(this.SPEC_PATTERNS.simple)
    if (match) {
      return {
        dosage: null,
        dosageUnit: null,
        minCount: parseInt(match[1]),
        minUnit: match[2],
        packUnit: match[3] || match[2],
        conversionRate: parseInt(match[1]),
        fullSpec: spec
      }
    }
    
    // å•ä¸€æ ¼å¼
    match = spec.match(this.SPEC_PATTERNS.single)
    if (match) {
      return {
        dosage: parseFloat(match[1]),
        dosageUnit: match[2],
        minUnit: match[3],
        packUnit: match[3],
        minCount: 1,
        conversionRate: 1,
        fullSpec: spec
      }
    }
    
    return null
  }
  
  /**
   * å•ä½è½¬æ¢
   * @param {Number} quantity - æ•°é‡
   * @param {String} fromUnit - æºå•ä½
   * @param {String} toUnit - ç›®æ ‡å•ä½
   * @param {Object} specInfo - è§„æ ¼ä¿¡æ¯
   * @returns {Number} è½¬æ¢åæ•°é‡
   */
  static convert(quantity, fromUnit, toUnit, specInfo) {
    if (!specInfo || !specInfo.conversionRate) {
      console.warn('ç¼ºå°‘è§„æ ¼ä¿¡æ¯ï¼Œè¿”å›åŸæ•°é‡')
      return quantity
    }
    
    if (fromUnit === toUnit) {
      return quantity
    }
    
    const { minUnit, packUnit, conversionRate } = specInfo
    
    // åŒ…è£… â†’ æœ€å°
    if (fromUnit === packUnit && toUnit === minUnit) {
      return quantity * conversionRate
    }
    
    // æœ€å° â†’ åŒ…è£…
    if (fromUnit === minUnit && toUnit === packUnit) {
      return quantity / conversionRate
    }
    
    console.warn(`ä¸æ”¯æŒçš„å•ä½è½¬æ¢: ${fromUnit} â†’ ${toUnit}`)
    return quantity
  }
  
  /**
   * æ ¼å¼åŒ–æ˜¾ç¤ºï¼ˆå¸¦å•ä½æ¢ç®—ï¼‰
   * @param {Number} minQuantity - æœ€å°å•ä½æ•°é‡
   * @param {Object} specInfo - è§„æ ¼ä¿¡æ¯
   * @returns {String} æ ¼å¼åŒ–å­—ç¬¦ä¸²
   */
  static formatQuantity(minQuantity, specInfo) {
    if (!specInfo) return `${minQuantity}`
    
    const { minUnit, packUnit, conversionRate } = specInfo
    
    // åªæœ‰æœ€å°å•ä½
    if (!packUnit || packUnit === minUnit || conversionRate === 1) {
      return `${minQuantity}${minUnit}`
    }
    
    // è®¡ç®—åŒ…è£…æ•°é‡
    const packQuantity = minQuantity / conversionRate
    const fullPacks = Math.floor(packQuantity)
    const remainMin = minQuantity % conversionRate
    
    if (remainMin === 0) {
      // æ•´åŒ…
      return `${fullPacks}${packUnit} (${minQuantity}${minUnit})`
    } else if (fullPacks === 0) {
      // é›¶æ•£
      return `${minQuantity}${minUnit} (${packQuantity.toFixed(2)}${packUnit})`
    } else {
      // æ··åˆ
      return `${fullPacks}${packUnit}é›¶${remainMin}${minUnit} (${minQuantity}${minUnit})`
    }
  }
  
  /**
   * éªŒè¯è§„æ ¼æ ¼å¼
   * @param {String} spec - è§„æ ¼å­—ç¬¦ä¸²
   * @returns {Boolean} æ˜¯å¦æœ‰æ•ˆ
   */
  static isValidSpec(spec) {
    return this.parseSpecification(spec) !== null
  }
}

export default UnitConverter
```

---

### 1.4 äº‘å‡½æ•°æ”¹é€ 

#### cloudfunctions/drugManage/index.jsï¼ˆè¯å“ç®¡ç†ï¼‰
```javascript
// æ–°å¢ï¼šæ·»åŠ /æ›´æ–°è¯å“æ—¶è‡ªåŠ¨è§£æè§„æ ¼
const UnitConverter = require('./unitConverter') // å¤åˆ¶å·¥å…·ç±»åˆ°äº‘å‡½æ•°

async function addDrug(data) {
  const { name, specification, ... } = data
  
  // è§£æè§„æ ¼
  const specInfo = UnitConverter.parseSpecification(specification)
  
  if (!specInfo) {
    return {
      success: false,
      message: 'è§„æ ¼æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨æ ‡å‡†æ ¼å¼å¦‚: 0.25gÃ—24ç²’/ç›’'
    }
  }
  
  const drugData = {
    name,
    specification,
    specInfo,  // ä¿å­˜è§£æåçš„ç»“æ„åŒ–ä¿¡æ¯
    ...data,
    createTime: new Date(),
    updateTime: new Date()
  }
  
  const result = await db.collection('drugs').add({ data: drugData })
  
  return {
    success: true,
    message: 'æ·»åŠ æˆåŠŸ',
    data: { _id: result._id, ...drugData }
  }
}
```

#### cloudfunctions/inRecords/index.jsï¼ˆå…¥åº“ç®¡ç†ï¼‰
```javascript
// æ”¹é€ ï¼šå…¥åº“å®¡æ ¸é€šè¿‡åï¼Œè‡ªåŠ¨æ›´æ–°åº“å­˜ï¼ˆç»Ÿä¸€ç”¨æœ€å°å•ä½ï¼‰
async function approve(data, wxContext) {
  const { recordId, reviewerId, reviewerSign } = data
  
  // 1. è·å–å…¥åº“å•
  const record = await db.collection('in_records').doc(recordId).get()
  const inRecord = record.data
  
  if (inRecord.status !== 'pending_review') {
    throw new Error('è¯¥å…¥åº“å•ä¸æ˜¯å¾…å¤æ ¸çŠ¶æ€')
  }
  
  // 2. æ›´æ–°åº“å­˜ï¼ˆæ ¸å¿ƒæ”¹é€ ï¼‰
  for (const item of inRecord.items) {
    // è·å–è¯å“è§„æ ¼ä¿¡æ¯
    const drugResult = await db.collection('drugs').doc(item.drugId).get()
    const drug = drugResult.data
    const specInfo = drug.specInfo
    
    if (!specInfo) {
      throw new Error(`è¯å“ ${item.drugName} ç¼ºå°‘è§„æ ¼ä¿¡æ¯`)
    }
    
    // è½¬æ¢ä¸ºæœ€å°å•ä½
    const minQuantity = item.quantity * specInfo.conversionRate
    const packQuantity = item.quantity
    
    // æŸ¥æ‰¾æ˜¯å¦å·²æœ‰ç›¸åŒæ‰¹æ¬¡çš„åº“å­˜
    const existingStock = await db.collection('stock')
      .where({
        drugId: item.drugId,
        batch: item.batch,
        location: inRecord.location || 'central_storage'
      })
      .get()
    
    if (existingStock.data.length > 0) {
      // æ›´æ–°ç°æœ‰åº“å­˜ï¼ˆç´¯åŠ ï¼‰
      const stockId = existingStock.data[0]._id
      await db.collection('stock').doc(stockId).update({
        data: {
          quantity: _.inc(minQuantity),              // å¢åŠ æœ€å°å•ä½æ•°é‡
          quantityPack: _.inc(packQuantity),         // å¢åŠ åŒ…è£…å•ä½æ•°é‡
          updateTime: new Date()
        }
      })
    } else {
      // åˆ›å»ºæ–°åº“å­˜
      await db.collection('stock').add({
        data: {
          drugId: item.drugId,
          drugName: item.drugName,
          specification: item.specification,
          minUnit: specInfo.minUnit,
          packUnit: specInfo.packUnit,
          conversionRate: specInfo.conversionRate,
          batch: item.batch,
          productionDate: item.productionDate,
          expireDate: item.expireDate,
          quantity: minQuantity,                     // æœ€å°å•ä½æ•°é‡
          quantityPack: packQuantity,                // åŒ…è£…å•ä½æ•°é‡
          location: inRecord.location || 'central_storage',
          locationName: inRecord.locationName || 'åŒ»åŠ¡å®¤ä¸­å¤®åº“',
          price: item.price,
          manufacturer: item.manufacturer,
          lockQuantity: 0,
          createTime: new Date(),
          updateTime: new Date()
        }
      })
    }
  }
  
  // 3. æ›´æ–°å…¥åº“å•çŠ¶æ€
  await db.collection('in_records').doc(recordId).update({
    data: {
      status: 'completed',
      reviewer: wxContext.FROM_NICKNAME || reviewerId,
      reviewerId: reviewerId,
      reviewerSign: reviewerSign,
      reviewerSignTime: new Date(),
      completeTime: new Date(),
      updateTime: new Date()
    }
  })
  
  return {
    success: true,
    message: 'å¤æ ¸é€šè¿‡ï¼Œåº“å­˜å·²æ›´æ–°'
  }
}
```

#### cloudfunctions/outRecords/index.jsï¼ˆå‡ºåº“ç®¡ç†ï¼‰
```javascript
// æ”¹é€ ï¼šå‡ºåº“æ—¶è‡ªåŠ¨è½¬æ¢å•ä½å¹¶æ‰£å‡åº“å­˜
async function approve(data, wxContext) {
  const { recordId, receiverId, receiverSign } = data
  
  // 1. è·å–å‡ºåº“å•
  const record = await db.collection('out_records').doc(recordId).get()
  const outRecord = record.data
  
  if (outRecord.status !== 'pending_review') {
    throw new Error('è¯¥å‡ºåº“å•ä¸æ˜¯å¾…å¤æ ¸çŠ¶æ€')
  }
  
  // 2. æ‰£å‡åº“å­˜ï¼ˆæ ¸å¿ƒæ”¹é€ ï¼‰
  for (const item of outRecord.items) {
    // è·å–è¯å“è§„æ ¼ä¿¡æ¯
    const drugResult = await db.collection('drugs').doc(item.drugId).get()
    const drug = drugResult.data
    const specInfo = drug.specInfo
    
    if (!specInfo) {
      throw new Error(`è¯å“ ${item.drugName} ç¼ºå°‘è§„æ ¼ä¿¡æ¯`)
    }
    
    // å‡ºåº“æ•°é‡ï¼ˆå·²ç»æ˜¯æœ€å°å•ä½ï¼‰
    const outMinQuantity = item.quantity
    
    // æŸ¥æ‰¾åº“å­˜ï¼ˆæŒ‰æ‰¹æ¬¡FIFOï¼‰
    const stockResult = await db.collection('stock')
      .where({
        drugId: item.drugId,
        batch: item.batch,
        location: outRecord.location
      })
      .get()
    
    if (stockResult.data.length === 0) {
      throw new Error(`${item.drugName} æ‰¹æ¬¡ ${item.batch} åœ¨ ${outRecord.locationName} åº“å­˜ä¸è¶³`)
    }
    
    const stock = stockResult.data[0]
    
    // æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
    if (stock.quantity < outMinQuantity) {
      throw new Error(`${item.drugName} åº“å­˜ä¸è¶³ï¼Œå½“å‰åº“å­˜: ${stock.quantity}${specInfo.minUnit}ï¼Œéœ€è¦: ${outMinQuantity}${specInfo.minUnit}`)
    }
    
    // æ‰£å‡åº“å­˜
    const newQuantity = stock.quantity - outMinQuantity
    const newQuantityPack = newQuantity / specInfo.conversionRate
    
    await db.collection('stock').doc(stock._id).update({
      data: {
        quantity: newQuantity,                     // æ‰£å‡æœ€å°å•ä½
        quantityPack: newQuantityPack,             // æ›´æ–°åŒ…è£…å•ä½
        updateTime: new Date()
      }
    })
    
    // å¦‚æœåº“å­˜ä¸º0ï¼Œå¯é€‰æ‹©åˆ é™¤è®°å½•
    if (newQuantity === 0) {
      await db.collection('stock').doc(stock._id).remove()
    }
  }
  
  // 3. æ›´æ–°å‡ºåº“å•çŠ¶æ€
  await db.collection('out_records').doc(recordId).update({
    data: {
      status: 'completed',
      receiver: wxContext.FROM_NICKNAME || receiverId,
      receiverId: receiverId,
      receiverSign: receiverSign,
      receiverSignTime: new Date(),
      completeTime: new Date(),
      updateTime: new Date()
    }
  })
  
  return {
    success: true,
    message: 'é¢†è¯æˆåŠŸï¼Œåº“å­˜å·²æ‰£å‡'
  }
}
```

---

## æ–¹æ¡ˆ2ï¼šåˆ†å›­åŒºç®¡ç†

### 2.1 å›­åŒºé…ç½®

#### utils/parkConfig.jsï¼ˆå›­åŒºé…ç½®ï¼‰
```javascript
/**
 * å›­åŒºé…ç½®
 */
export const PARK_CONFIG = {
  central_storage: {
    code: 'central_storage',
    name: 'åŒ»åŠ¡å®¤ä¸­å¤®åº“',
    shortName: 'ä¸­å¤®åº“',
    type: 'storage',
    description: 'åŒ»åŠ¡å®¤è¯å“ä¸­å¤®å­˜å‚¨åº“',
    icon: 'ğŸ¥',
    color: '#409eff',
    allowIn: true,      // å…è®¸å…¥åº“
    allowOut: true,     // å…è®¸å‡ºåº“
    allowTransfer: true // å…è®¸è°ƒæ‹¨
  },
  land_park: {
    code: 'land_park',
    name: 'é™†å›­åŒ»åŠ¡å®¤',
    shortName: 'é™†å›­',
    type: 'clinic',
    description: 'é™†åœ°æ¸¸ä¹å›­åŒ»åŠ¡å®¤',
    icon: 'ğŸ¢',
    color: '#67c23a',
    allowIn: false,     // ä¸å…è®¸ç›´æ¥å…¥åº“
    allowOut: true,     // å…è®¸å‡ºåº“ï¼ˆå‘è¯ï¼‰
    allowTransfer: true // å…è®¸æ¥æ”¶è°ƒæ‹¨
  },
  water_park: {
    code: 'water_park',
    name: 'æ°´å›­åŒ»åŠ¡å®¤',
    shortName: 'æ°´å›­',
    type: 'clinic',
    description: 'æ°´ä¸Šæ¸¸ä¹å›­åŒ»åŠ¡å®¤',
    icon: 'ğŸŒŠ',
    color: '#e6a23c',
    allowIn: false,
    allowOut: true,
    allowTransfer: true
  }
}

/**
 * è·å–å›­åŒºåˆ—è¡¨
 */
export function getParkList() {
  return Object.values(PARK_CONFIG)
}

/**
 * è·å–å›­åŒºä¿¡æ¯
 */
export function getParkInfo(code) {
  return PARK_CONFIG[code] || null
}

/**
 * è·å–å…è®¸å…¥åº“çš„å›­åŒº
 */
export function getInboundParks() {
  return Object.values(PARK_CONFIG).filter(p => p.allowIn)
}

/**
 * è·å–å…è®¸å‡ºåº“çš„å›­åŒº
 */
export function getOutboundParks() {
  return Object.values(PARK_CONFIG).filter(p => p.allowOut)
}
```

### 2.2 åˆ†å›­åŒºåº“å­˜ç»Ÿè®¡

#### cloudfunctions/stockManage/index.jsï¼ˆæ–°å¢åˆ†å›­åŒºæŸ¥è¯¢ï¼‰
```javascript
/**
 * è·å–åˆ†å›­åŒºåº“å­˜æ±‡æ€»
 * @param {String} drugId - è¯å“IDï¼ˆå¯é€‰ï¼‰
 * @returns {Object} åˆ†å›­åŒºåº“å­˜
 */
async function getStockByLocation(data) {
  const { drugId } = data
  
  const $ = db.command.aggregate
  
  let aggregation = db.collection('stock').aggregate()
  
  // å¯é€‰ï¼šæŒ‰è¯å“ç­›é€‰
  if (drugId) {
    aggregation = aggregation.match({ drugId })
  }
  
  // æŒ‰å›­åŒºåˆ†ç»„ç»Ÿè®¡
  const result = await aggregation
    .group({
      _id: '$location',
      locationName: $.first('$locationName'),
      totalQuantity: $.sum('$quantity'),           // æ€»æ•°é‡ï¼ˆæœ€å°å•ä½ï¼‰
      totalQuantityPack: $.sum('$quantityPack'),   // æ€»æ•°é‡ï¼ˆåŒ…è£…å•ä½ï¼‰
      drugCount: $.sum(1),                         // æ‰¹æ¬¡æ•°
      drugs: $.addToSet('$drugName')               // è¯å“åˆ—è¡¨
    })
    .end()
  
  return {
    success: true,
    data: result.list || []
  }
}

/**
 * è·å–å•ä¸ªè¯å“çš„åˆ†å›­åŒºåº“å­˜
 * @param {String} drugId - è¯å“ID
 * @returns {Object} åˆ†å›­åŒºåº“å­˜æ˜ç»†
 */
async function getDrugStockByLocation(data) {
  const { drugId } = data
  
  if (!drugId) {
    throw new Error('è¯å“IDä¸èƒ½ä¸ºç©º')
  }
  
  const result = await db.collection('stock')
    .where({ drugId })
    .get()
  
  // æŒ‰å›­åŒºåˆ†ç»„
  const locationMap = {}
  
  result.data.forEach(batch => {
    const loc = batch.location
    if (!locationMap[loc]) {
      locationMap[loc] = {
        location: loc,
        locationName: batch.locationName,
        batches: [],
        totalQuantity: 0,
        totalQuantityPack: 0
      }
    }
    
    locationMap[loc].batches.push(batch)
    locationMap[loc].totalQuantity += batch.quantity
    locationMap[loc].totalQuantityPack += batch.quantityPack
  })
  
  return {
    success: true,
    data: Object.values(locationMap)
  }
}
```

### 2.3 åˆ†å›­åŒºæŠ¥è¡¨

#### cloudfunctions/reportService/index.jsï¼ˆæ–°å¢å›­åŒºç»´åº¦æŠ¥è¡¨ï¼‰
```javascript
/**
 * R6: åˆ†å›­åŒºå‡ºåº“ç»Ÿè®¡æŠ¥è¡¨ï¼ˆæ–°å¢ï¼‰
 * @param {Date} startDate - å¼€å§‹æ—¥æœŸ
 * @param {Date} endDate - ç»“æŸæ—¥æœŸ
 * @param {String} location - å›­åŒºï¼ˆå¯é€‰ï¼‰
 * @returns {Array} æŠ¥è¡¨æ•°æ®
 */
async function getLocationOutboundReport(data) {
  const { startDate, endDate, location } = data
  
  const $ = db.command.aggregate
  
  let aggregation = db.collection('out_records').aggregate()
  
  // æ—¶é—´èŒƒå›´ç­›é€‰
  aggregation = aggregation.match({
    status: 'completed',
    completeTime: _.gte(new Date(startDate)).lte(new Date(endDate))
  })
  
  // å¯é€‰ï¼šå›­åŒºç­›é€‰
  if (location) {
    aggregation = aggregation.match({ location })
  }
  
  // å±•å¼€è¯å“æ˜ç»†
  aggregation = aggregation.unwind('$items')
  
  // æŒ‰å›­åŒº+è¯å“åˆ†ç»„ç»Ÿè®¡
  const result = await aggregation
    .group({
      _id: {
        location: '$location',
        drugId: '$items.drugId'
      },
      locationName: $.first('$locationName'),
      drugName: $.first('$items.drugName'),
      specification: $.first('$items.specification'),
      minUnit: $.first('$items.unit'),
      totalQuantity: $.sum('$items.quantity'),     // æ€»å‡ºåº“æ•°é‡ï¼ˆæœ€å°å•ä½ï¼‰
      recordCount: $.sum(1),                       // å‡ºåº“æ¬¡æ•°
      avgQuantity: $.avg('$items.quantity')        // å¹³å‡å‡ºåº“æ•°é‡
    })
    .sort({ '_id.location': 1, totalQuantity: -1 })
    .end()
  
  // æ ¼å¼åŒ–ç»“æœ
  const formattedData = result.list.map(item => ({
    location: item._id.location,
    locationName: item.locationName,
    drugName: item.drugName,
    specification: item.specification,
    totalQuantity: item.totalQuantity,
    minUnit: item.minUnit,
    recordCount: item.recordCount,
    avgQuantity: Math.round(item.avgQuantity)
  }))
  
  return {
    success: true,
    data: formattedData
  }
}
```

---

## æ–¹æ¡ˆ3ï¼šæ•°æ®åº“ä¼˜åŒ–ï¼ˆå°è§„æ¨¡åœºæ™¯ï¼‰

### 3.1 ç´¢å¼•ç­–ç•¥

#### æ ¸å¿ƒç´¢å¼•ï¼ˆå¿…é¡»åˆ›å»ºï¼‰
```javascript
// drugs é›†åˆ
db.drugs.createIndex({ "name": 1 })                     // è¯å“åç§°ï¼ˆå¸¸ç”¨æŸ¥è¯¢ï¼‰
db.drugs.createIndex({ "barcode": 1 }, { unique: true }) // æ¡å½¢ç ï¼ˆå”¯ä¸€ï¼Œæ‰«ç æŸ¥è¯¢ï¼‰
db.drugs.createIndex({ "category": 1 })                 // åˆ†ç±»ç­›é€‰

// stock é›†åˆï¼ˆæ ¸å¿ƒï¼‰
db.stock.createIndex({ 
  "drugId": 1, 
  "location": 1, 
  "batch": 1 
}) // å¤åˆç´¢å¼•ï¼šè¯å“+å›­åŒº+æ‰¹æ¬¡ï¼ˆæœ€å¸¸ç”¨ï¼‰

db.stock.createIndex({ "location": 1, "quantity": 1 })  // å›­åŒºåº“å­˜ç»Ÿè®¡
db.stock.createIndex({ "expireDate": 1 })               // æ•ˆæœŸé¢„è­¦
db.stock.createIndex({ "quantity": 1 })                 // ä½åº“å­˜é¢„è­¦

// in_records é›†åˆ
db.in_records.createIndex({ "recordNo": 1 }, { unique: true })
db.in_records.createIndex({ "status": 1, "createTime": -1 })
db.in_records.createIndex({ "location": 1, "createTime": -1 })

// out_records é›†åˆ
db.out_records.createIndex({ "recordNo": 1 }, { unique: true })
db.out_records.createIndex({ "status": 1, "createTime": -1 })
db.out_records.createIndex({ "location": 1, "createTime": -1 }) // å›­åŒºæŸ¥è¯¢ï¼ˆæ ¸å¿ƒï¼‰
db.out_records.createIndex({ "items.drugId": 1, "location": 1 })
```

### 3.2 æ•°æ®å†—ä½™ç­–ç•¥

ç”±äºæ•°æ®é‡å°ï¼ˆ<100ç§è¯å“ï¼‰ï¼Œé€‚å½“å†—ä½™å¯æå‡æŸ¥è¯¢æ€§èƒ½ï¼š

```javascript
// å†—ä½™åŸåˆ™
1. å¸¸ç”¨å­—æ®µå†—ä½™ï¼ˆdrugName, locationNameï¼‰
2. è®¡ç®—å­—æ®µå†—ä½™ï¼ˆquantityPack, minUnitï¼‰
3. å…³è”å­—æ®µå†—ä½™ï¼ˆspecInfoï¼‰

// ç¤ºä¾‹ï¼šstock é›†åˆå†—ä½™è®¾è®¡
{
  drugId: "drug_001",
  drugName: "é˜¿è«è¥¿æ—èƒ¶å›Š",          // å†—ä½™ï¼šé¿å…å…³è”æŸ¥è¯¢
  specification: "0.25gÃ—24ç²’/ç›’",   // å†—ä½™ï¼šæ˜¾ç¤ºç”¨
  minUnit: "ç²’",                    // å†—ä½™ï¼šè®¡ç®—ç”¨
  packUnit: "ç›’",                   // å†—ä½™ï¼šæ˜¾ç¤ºç”¨
  conversionRate: 24,               // å†—ä½™ï¼šè½¬æ¢ç”¨
  quantity: 240,                    // æœ€å°å•ä½
  quantityPack: 10,                 // åŒ…è£…å•ä½ï¼ˆå†—ä½™ï¼Œä¾¿äºæ˜¾ç¤ºï¼‰
  locationName: "åŒ»åŠ¡å®¤ä¸­å¤®åº“"      // å†—ä½™ï¼šæ˜¾ç¤ºç”¨
}
```

### 3.3 æŸ¥è¯¢ä¼˜åŒ–

#### ç¤ºä¾‹1ï¼šåˆ†å›­åŒºåº“å­˜æŸ¥è¯¢ï¼ˆä¼˜åŒ–å‰ï¼‰
```javascript
// ä¼˜åŒ–å‰ï¼šå¤šæ¬¡æŸ¥è¯¢
async function getLocationStock() {
  // 1. æŸ¥è¯¢æ‰€æœ‰åº“å­˜
  const stocks = await db.collection('stock').get()
  
  // 2. éå†æŸ¥è¯¢è¯å“ä¿¡æ¯ï¼ˆN+1é—®é¢˜ï¼‰
  for (const stock of stocks.data) {
    const drug = await db.collection('drugs').doc(stock.drugId).get()
    stock.drugInfo = drug.data
  }
  
  // 3. æ‰‹åŠ¨åˆ†ç»„ç»Ÿè®¡
  // ...
}
```

#### ç¤ºä¾‹1ï¼šåˆ†å›­åŒºåº“å­˜æŸ¥è¯¢ï¼ˆä¼˜åŒ–åï¼‰
```javascript
// ä¼˜åŒ–åï¼šå•æ¬¡èšåˆæŸ¥è¯¢ + å†—ä½™å­—æ®µ
async function getLocationStock() {
  const $ = db.command.aggregate
  
  // ä¸€æ¬¡èšåˆæŸ¥è¯¢å®Œæˆæ‰€æœ‰ç»Ÿè®¡
  const result = await db.collection('stock')
    .aggregate()
    .group({
      _id: '$location',
      locationName: $.first('$locationName'),  // ä½¿ç”¨å†—ä½™å­—æ®µ
      totalQuantity: $.sum('$quantity'),
      totalQuantityPack: $.sum('$quantityPack'), // ä½¿ç”¨å†—ä½™å­—æ®µ
      drugCount: $.sum(1)
    })
    .end()
  
  return result.list
}

// æ€§èƒ½æå‡: 1æ¬¡æŸ¥è¯¢ vs N+1æ¬¡æŸ¥è¯¢
// å“åº”æ—¶é—´: <100ms vs >1000ms
```

---

## ğŸ“Š å®Œæ•´å®ç°æµç¨‹

### é˜¶æ®µ1ï¼šæ•°æ®åº“æ”¹é€ ï¼ˆ1å¤©ï¼‰

#### æ­¥éª¤1.1ï¼šå¤‡ä»½ç°æœ‰æ•°æ®
```bash
# å¯¼å‡ºç°æœ‰æ•°æ®
tcb db export --env your-env-id --collection drugs --output drugs_backup.json
tcb db export --env your-env-id --collection stock --output stock_backup.json
```

#### æ­¥éª¤1.2ï¼šæ·»åŠ æ–°å­—æ®µ
```javascript
// äº‘å‡½æ•°ï¼šæ•°æ®è¿ç§»è„šæœ¬
// cloudfunctions/dataMigration/index.js

exports.main = async (event, context) => {
  const db = cloud.database()
  const _ = db.command
  
  console.log('å¼€å§‹æ•°æ®è¿ç§»...')
  
  // 1. æ›´æ–° drugs é›†åˆï¼šæ·»åŠ  specInfo å­—æ®µ
  const drugs = await db.collection('drugs').get()
  
  for (const drug of drugs.data) {
    const specInfo = UnitConverter.parseSpecification(drug.specification)
    
    if (specInfo) {
      await db.collection('drugs').doc(drug._id).update({
        data: { specInfo }
      })
      console.log(`å·²æ›´æ–°è¯å“: ${drug.name}`)
    } else {
      console.warn(`è§„æ ¼è§£æå¤±è´¥: ${drug.name} - ${drug.specification}`)
    }
  }
  
  // 2. æ›´æ–° stock é›†åˆï¼šæ·»åŠ å•ä½ä¿¡æ¯å’Œåˆ†å›­åŒºå­—æ®µ
  const stocks = await db.collection('stock').get()
  
  for (const stock of stocks.data) {
    const drug = await db.collection('drugs').doc(stock.drugId).get()
    const specInfo = drug.data.specInfo
    
    if (specInfo) {
      // è®¡ç®—æœ€å°å•ä½æ•°é‡ï¼ˆå‡è®¾å½“å‰quantityæ˜¯åŒ…è£…å•ä½ï¼‰
      const minQuantity = stock.quantity * specInfo.conversionRate
      
      await db.collection('stock').doc(stock._id).update({
        data: {
          minUnit: specInfo.minUnit,
          packUnit: specInfo.packUnit,
          conversionRate: specInfo.conversionRate,
          quantity: minQuantity,              // è½¬æ¢ä¸ºæœ€å°å•ä½
          quantityPack: stock.quantity,       // ä¿å­˜åŸåŒ…è£…æ•°é‡
          location: 'central_storage',        // é»˜è®¤ä¸­å¤®åº“
          locationName: 'åŒ»åŠ¡å®¤ä¸­å¤®åº“'
        }
      })
      console.log(`å·²æ›´æ–°åº“å­˜: ${stock.drugName}`)
    }
  }
  
  console.log('æ•°æ®è¿ç§»å®Œæˆï¼')
  
  return { success: true }
}
```

#### æ­¥éª¤1.3ï¼šåˆ›å»ºç´¢å¼•
```javascript
// åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ ç´¢å¼•ç®¡ç† ä¸­åˆ›å»ºç´¢å¼•
// æˆ–ä½¿ç”¨äº‘å‡½æ•°æ‰¹é‡åˆ›å»º

exports.main = async (event, context) => {
  const db = cloud.database()
  
  // æ³¨æ„ï¼šäº‘å¼€å‘ä¸æ”¯æŒé€šè¿‡ä»£ç åˆ›å»ºç´¢å¼•ï¼Œéœ€è¦åœ¨æ§åˆ¶å°æ‰‹åŠ¨åˆ›å»º
  // è¿™é‡Œä»…ä½œä¸ºç´¢å¼•æ¸…å•è®°å½•
  
  console.log('è¯·åœ¨äº‘å¼€å‘æ§åˆ¶å°æ‰‹åŠ¨åˆ›å»ºä»¥ä¸‹ç´¢å¼•ï¼š')
  console.log('stock: drugId_1_location_1_batch_1')
  console.log('stock: location_1_quantity_1')
  console.log('out_records: location_1_createTime_-1')
  
  return { success: true }
}
```

---

### é˜¶æ®µ2ï¼šå·¥å…·ç±»å¼€å‘ï¼ˆ0.5å¤©ï¼‰

#### æ­¥éª¤2.1ï¼šåˆ›å»ºå·¥å…·ç±»
```bash
# å‰ç«¯
utils/unitConverter.js          # å•ä½è½¬æ¢å·¥å…·
utils/parkConfig.js             # å›­åŒºé…ç½®

# äº‘å‡½æ•°
cloudfunctions/common/unitConverter.js  # äº‘ç«¯å·¥å…·ç±»ï¼ˆå¤åˆ¶å‰ç«¯ä»£ç ï¼‰
```

#### æ­¥éª¤2.2ï¼šå•å…ƒæµ‹è¯•
```javascript
// test/unitConverter.test.js

const UnitConverter = require('../utils/unitConverter')

// æµ‹è¯•è§„æ ¼è§£æ
test('æ ‡å‡†æ ¼å¼è§£æ', () => {
  const result = UnitConverter.parseSpecification('0.25gÃ—24ç²’/ç›’')
  expect(result.conversionRate).toBe(24)
  expect(result.minUnit).toBe('ç²’')
  expect(result.packUnit).toBe('ç›’')
})

// æµ‹è¯•å•ä½è½¬æ¢
test('ç›’è½¬ç²’', () => {
  const specInfo = { conversionRate: 24, minUnit: 'ç²’', packUnit: 'ç›’' }
  const result = UnitConverter.convert(10, 'ç›’', 'ç²’', specInfo)
  expect(result).toBe(240)
})

// æµ‹è¯•æ ¼å¼åŒ–æ˜¾ç¤º
test('æ ¼å¼åŒ–æ•°é‡', () => {
  const specInfo = { conversionRate: 24, minUnit: 'ç²’', packUnit: 'ç›’' }
  const result = UnitConverter.formatQuantity(240, specInfo)
  expect(result).toBe('10ç›’ (240ç²’)')
})
```

---

### é˜¶æ®µ3ï¼šäº‘å‡½æ•°æ”¹é€ ï¼ˆ1å¤©ï¼‰

#### æ­¥éª¤3.1ï¼šæ”¹é€  inRecords äº‘å‡½æ•°
- ä¿®æ”¹ `approve` æ–¹æ³•ï¼šå…¥åº“æ—¶è‡ªåŠ¨è½¬æ¢å•ä½
- æ·»åŠ å•ä½è½¬æ¢é€»è¾‘
- æ›´æ–°åº“å­˜ï¼ˆç»Ÿä¸€ç”¨æœ€å°å•ä½ï¼‰

#### æ­¥éª¤3.2ï¼šæ”¹é€  outRecords äº‘å‡½æ•°
- ä¿®æ”¹ `approve` æ–¹æ³•ï¼šå‡ºåº“æ—¶è‡ªåŠ¨æ‰£å‡åº“å­˜
- æ·»åŠ åˆ†å›­åŒºåº“å­˜æŸ¥è¯¢
- æ·»åŠ åº“å­˜å……è¶³æ€§æ£€æŸ¥

#### æ­¥éª¤3.3ï¼šæ”¹é€  stockManage äº‘å‡½æ•°
- æ·»åŠ  `getStockByLocation` æ–¹æ³•
- æ·»åŠ  `getDrugStockByLocation` æ–¹æ³•
- ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

---

### é˜¶æ®µ4ï¼šå‰ç«¯ç•Œé¢æ”¹é€ ï¼ˆ1.5å¤©ï¼‰

#### æ­¥éª¤4.1ï¼šå…¥åº“é¡µé¢ï¼ˆpages-sub/in/add.vueï¼‰
```vue
<template>
  <view class="container">
    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="form-section">
      <view class="form-item">
        <text class="form-label">å…¥åº“å›­åŒº</text>
        <picker 
          :value="locationIndex" 
          :range="inboundParks" 
          range-key="name"
          @change="onLocationChange"
        >
          <view class="picker">
            {{ selectedLocation ? selectedLocation.name : 'è¯·é€‰æ‹©' }}
          </view>
        </picker>
      </view>
    </view>
    
    <!-- è¯å“æ˜ç»†è¡¨æ ¼ -->
    <view class="drug-table">
      <view class="thead">
        <text class="th">è¯å“åç§°</text>
        <text class="th">è§„æ ¼</text>
        <text class="th">æ‰¹å·</text>
        <text class="th">æ•°é‡</text>
        <text class="th">å•ä½</text>
        <text class="th">æœ€å°å•ä½</text>
      </view>
      <view class="tbody">
        <view class="tr" v-for="(item, index) in drugList" :key="index">
          <text class="td">{{ item.drugName }}</text>
          <text class="td">{{ item.specification }}</text>
          <input class="td input" v-model="item.batch" />
          <input class="td input" type="number" v-model="item.quantity" @blur="calcMinQuantity(item)" />
          <text class="td">{{ item.packUnit }}</text>
          <text class="td highlight">
            {{ item.minQuantity }} {{ item.minUnit }}
          </text>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
import UnitConverter from '@/utils/unitConverter'
import { getInboundParks } from '@/utils/parkConfig'

export default {
  data() {
    return {
      locationIndex: 0,
      selectedLocation: null,
      inboundParks: [],
      drugList: []
    }
  },
  onLoad() {
    this.inboundParks = getInboundParks()
    this.selectedLocation = this.inboundParks[0]
  },
  methods: {
    // è®¡ç®—æœ€å°å•ä½æ•°é‡
    calcMinQuantity(item) {
      if (!item.quantity || !item.specInfo) return
      
      item.minQuantity = UnitConverter.convert(
        Number(item.quantity),
        item.packUnit,
        item.minUnit,
        item.specInfo
      )
    },
    
    // é€‰æ‹©å›­åŒº
    onLocationChange(e) {
      this.locationIndex = e.detail.value
      this.selectedLocation = this.inboundParks[this.locationIndex]
    }
  }
}
</script>
```

#### æ­¥éª¤4.2ï¼šå‡ºåº“é¡µé¢ï¼ˆpages-sub/out/add.vueï¼‰
```vue
<template>
  <view class="container">
    <!-- å›­åŒºé€‰æ‹© -->
    <view class="form-section">
      <view class="form-item">
        <text class="form-label">å‡ºåº“å›­åŒº *</text>
        <picker 
          :value="locationIndex" 
          :range="outboundParks" 
          range-key="name"
          @change="onLocationChange"
        >
          <view class="picker" :class="{ placeholder: !selectedLocation }">
            <text>{{ selectedLocation ? selectedLocation.icon + ' ' + selectedLocation.name : 'è¯·é€‰æ‹©å›­åŒº' }}</text>
          </view>
        </picker>
      </view>
    </view>
    
    <!-- è¯å“æ˜ç»†ï¼ˆæœ€å°å•ä½å‡ºåº“ï¼‰ -->
    <view class="drug-table">
      <view class="thead">
        <text class="th">è¯å“åç§°</text>
        <text class="th">æ‰¹å·</text>
        <text class="th">åº“å­˜</text>
        <text class="th">å‡ºåº“æ•°é‡</text>
        <text class="th">å•ä½</text>
        <text class="th">æ¢ç®—</text>
      </view>
      <view class="tbody">
        <view class="tr" v-for="(item, index) in drugList" :key="index">
          <text class="td">{{ item.drugName }}</text>
          <text class="td">{{ item.batch }}</text>
          <text class="td">{{ item.stockQuantity }} {{ item.minUnit }}</text>
          <input 
            class="td input" 
            type="number" 
            v-model="item.quantity" 
            :placeholder="'æœ€å¤š' + item.stockQuantity"
            @blur="calcPackQuantity(item)"
          />
          <text class="td">{{ item.minUnit }}</text>
          <text class="td hint">{{ item.packQuantity }} {{ item.packUnit }}</text>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
import UnitConverter from '@/utils/unitConverter'
import { getOutboundParks } from '@/utils/parkConfig'

export default {
  data() {
    return {
      locationIndex: 0,
      selectedLocation: null,
      outboundParks: [],
      drugList: []
    }
  },
  onLoad() {
    this.outboundParks = getOutboundParks()
  },
  methods: {
    // è®¡ç®—åŒ…è£…æ•°é‡ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
    calcPackQuantity(item) {
      if (!item.quantity || !item.specInfo) return
      
      item.packQuantity = UnitConverter.convert(
        Number(item.quantity),
        item.minUnit,
        item.packUnit,
        item.specInfo
      ).toFixed(2)
    },
    
    // é€‰æ‹©å›­åŒºåé‡æ–°åŠ è½½åº“å­˜
    onLocationChange(e) {
      this.locationIndex = e.detail.value
      this.selectedLocation = this.outboundParks[this.locationIndex]
      this.loadStock()
    },
    
    // åŠ è½½æŒ‡å®šå›­åŒºçš„åº“å­˜
    async loadStock() {
      // è°ƒç”¨äº‘å‡½æ•°æŸ¥è¯¢æŒ‡å®šå›­åŒºçš„åº“å­˜
      const res = await this.$cloudFn('stockManage', {
        action: 'getBatchList',
        data: {
          location: this.selectedLocation.code
        }
      })
      // å¤„ç†åº“å­˜æ•°æ®...
    }
  }
}
</script>
```

#### æ­¥éª¤4.3ï¼šåº“å­˜é¡µé¢ï¼ˆpages-sub/stock/list.vueï¼‰
```vue
<template>
  <view class="container">
    <!-- å›­åŒºç­›é€‰ -->
    <view class="filter-bar">
      <u-tabs 
        :list="parkTabs" 
        :current="currentPark" 
        @change="onParkChange"
      ></u-tabs>
    </view>
    
    <!-- åº“å­˜åˆ—è¡¨ -->
    <view class="stock-list">
      <view class="stock-item" v-for="item in stockList" :key="item._id">
        <view class="item-header">
          <text class="drug-name">{{ item.drugName }}</text>
          <text class="location-tag">{{ item.locationName }}</text>
        </view>
        <view class="item-body">
          <text class="spec">{{ item.specification }}</text>
        </view>
        <view class="item-footer">
          <view class="quantity-display">
            <!-- æ˜¾ç¤ºåŒå•ä½ -->
            <text class="quantity-pack">{{ item.quantityPack }}{{ item.packUnit }}</text>
            <text class="quantity-min">({{ item.quantity }}{{ item.minUnit }})</text>
          </view>
          <view class="batch">æ‰¹å·: {{ item.batch }}</view>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
import { getParkList } from '@/utils/parkConfig'

export default {
  data() {
    return {
      currentPark: 0,
      parkTabs: [],
      stockList: []
    }
  },
  onLoad() {
    const parks = getParkList()
    this.parkTabs = [
      { name: 'å…¨éƒ¨', code: '' },
      ...parks.map(p => ({ name: p.shortName, code: p.code }))
    ]
    this.loadStock()
  },
  methods: {
    onParkChange(index) {
      this.currentPark = index
      this.loadStock()
    },
    
    async loadStock() {
      const location = this.parkTabs[this.currentPark].code
      
      const res = await this.$cloudFn('stockManage', {
        action: 'getBatchList',
        data: { location }
      })
      
      if (res.success) {
        this.stockList = res.data
      }
    }
  }
}
</script>
```

---

### é˜¶æ®µ5ï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ1å¤©ï¼‰

#### æµ‹è¯•æ¸…å•
```
åŠŸèƒ½æµ‹è¯•:
â–¡ å…¥åº“å•ä½è½¬æ¢æ­£ç¡®æ€§
â–¡ å‡ºåº“å•ä½è½¬æ¢æ­£ç¡®æ€§
â–¡ åˆ†å›­åŒºåº“å­˜ç‹¬ç«‹æ€§
â–¡ è·¨å›­åŒºè°ƒæ‹¨åŠŸèƒ½
â–¡ åº“å­˜ç»Ÿè®¡å‡†ç¡®æ€§

æ€§èƒ½æµ‹è¯•:
â–¡ åº“å­˜æŸ¥è¯¢å“åº”æ—¶é—´ <200ms
â–¡ å…¥åº“å®¡æ ¸å“åº”æ—¶é—´ <500ms
â–¡ å‡ºåº“å®¡æ ¸å“åº”æ—¶é—´ <500ms
â–¡ æŠ¥è¡¨æŸ¥è¯¢å“åº”æ—¶é—´ <1s

è¾¹ç•Œæµ‹è¯•:
â–¡ è§„æ ¼è§£æå¼‚å¸¸å¤„ç†
â–¡ åº“å­˜ä¸è¶³æç¤º
â–¡ å•ä½è½¬æ¢ç²¾åº¦
â–¡ 0åº“å­˜å¤„ç†

å‹åŠ›æµ‹è¯•:
â–¡ 100ç§è¯å“å¹¶å‘æŸ¥è¯¢
â–¡ 50ç¬”åŒæ—¶å‡ºåº“
â–¡ å¤§æ•°æ®é‡æŠ¥è¡¨å¯¼å‡º
```

---

## ğŸ“Š æŠ€æœ¯æ–¹æ¡ˆæ€»ç»“

### æ ¸å¿ƒæŠ€æœ¯ç‚¹

| æŠ€æœ¯ç‚¹ | å®ç°æ–¹å¼ | ä¼˜åŠ¿ |
|--------|----------|------|
| è§„æ ¼è§£æ | æ­£åˆ™è¡¨è¾¾å¼ | çµæ´»ã€é«˜æ•ˆã€æ— éœ€AI |
| å•ä½è½¬æ¢ | å·¥å…·ç±» | ç»Ÿä¸€ã€å¯å¤ç”¨ã€æ˜“ç»´æŠ¤ |
| åˆ†å›­åŒºç®¡ç† | locationå­—æ®µ + ç´¢å¼• | ç®€å•ã€é«˜æ•ˆã€æ˜“æ‰©å±• |
| æ•°æ®åº“è®¾è®¡ | ç»“æ„åŒ–+å†—ä½™ | æŸ¥è¯¢å¿«ã€ç»´æŠ¤ç®€å• |
| æŸ¥è¯¢ä¼˜åŒ– | èšåˆæŸ¥è¯¢+ç´¢å¼• | æ€§èƒ½å¥½ã€ä»£ç ç®€æ´ |

### æŠ€æœ¯æ ˆä¼˜åŠ¿

```
uni-app + äº‘å¼€å‘:
âœ… å¿«é€Ÿå¼€å‘ï¼ˆå‰åç«¯ä¸€ä½“ï¼‰
âœ… æ— éœ€è¿ç»´ï¼ˆäº‘å¹³å°æ‰˜ç®¡ï¼‰
âœ… æˆæœ¬ä½ï¼ˆå°ç¨‹åºå…è´¹é¢åº¦å……è¶³ï¼‰
âœ… æ‰©å±•æ€§å¥½ï¼ˆéšæ—¶å‡çº§ï¼‰

MongoDB:
âœ… çµæ´»çš„æ–‡æ¡£ç»“æ„ï¼ˆé€‚åˆåŒ»è¯æ•°æ®ï¼‰
âœ… å¼ºå¤§çš„èšåˆèƒ½åŠ›ï¼ˆé€‚åˆç»Ÿè®¡æŠ¥è¡¨ï¼‰
âœ… åŸç”Ÿæ”¯æŒJSONï¼ˆå‰åç«¯æ•°æ®ä¸€è‡´ï¼‰
âœ… å°æ•°æ®é‡æ€§èƒ½ä¼˜å¼‚ï¼ˆ<100ç§è¯å“å®Œç¾é€‚é…ï¼‰
```

### å®æ–½å»ºè®®

```
ä¼˜å…ˆçº§:
P0 (ç«‹å³å®æ–½):
  - è§„æ ¼è§£æå·¥å…·ç±»
  - å•ä½è½¬æ¢é€»è¾‘
  - æ•°æ®åº“å­—æ®µä¼˜åŒ–

P1 (ç¬¬äºŒé˜¶æ®µ):
  - åˆ†å›­åŒºç®¡ç†
  - å‰ç«¯ç•Œé¢æ”¹é€ 
  - åº“å­˜ç»Ÿè®¡ä¼˜åŒ–

P2 (ç¬¬ä¸‰é˜¶æ®µ):
  - è·¨å›­åŒºè°ƒæ‹¨
  - é«˜çº§æŠ¥è¡¨
  - æ€§èƒ½ä¼˜åŒ–

æ—¶é—´ä¼°ç®—:
- æ€»å·¥æœŸ: 5-7å¤©
- æ ¸å¿ƒåŠŸèƒ½: 3å¤©
- æµ‹è¯•ä¼˜åŒ–: 2å¤©
- æ–‡æ¡£ç¼–å†™: 1å¤©
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v3.11  
**è®¾è®¡å®Œæˆ**: 2025-11-06  
**æŠ€æœ¯æ ˆ**: uni-app + è…¾è®¯äº‘å¼€å‘ + MongoDB

ğŸ¯ æ–¹æ¡ˆè®¾è®¡å®Œæˆï¼å»ºè®®åˆ†é˜¶æ®µå®æ–½ï¼Œä¼˜å…ˆå®Œæˆå•ä½è½¬æ¢æ ¸å¿ƒåŠŸèƒ½ï¼








