# 🗑️ 入库模块 - 旧版本组件清理计划

**创建时间**: 2025-11-05  
**状态**: 🔍 分析完成，待执行清理

---

## 📊 旧版本组件清单

### 1. 旧版供应商选择器 ❌
**组件**: `components/supplier-selector/index.vue`

**使用情况**:
- ❌ **已不再使用** - 入库模块已改为简单input输入

**相关文档**（待删除）:
- `✅供应商选择器-最终需求实现.md`
- `🐛新建供应商弹窗深度分析.md`
- `✨供应商选择器优化说明.md`
- `🎨供应商选择器界面设计说明.md`
- `🐛供应商选择器Bug修复.md`
- `🔧新建供应商弹窗问题排查.md`
- `🔧供应商选择器编译错误修复.md`
- `🔍供应商选择器功能验证.md`

**编译产物**（待删除）:
- `unpackage/dist/dev/mp-weixin/components/supplier-selector/`

**清理原因**:
- 功能已简化为普通input输入框
- 复杂的弹窗选择功能不符合实际需求
- 代码维护成本高，WXML编译问题多

---

### 2. 旧版药品选择器 ❌
**组件**: `components/drug-selector/index.vue`

**使用情况**:
- ✅ **仍在使用** - `pages-sub/in/add.vue` (第44行)
- ✅ **仍在使用** - `pages-sub/requisition/add.vue` (第63行)

**功能对比**:
| 功能 | 旧版 DrugSelector | 新版 DrugSelectorPopup |
|------|-------------------|------------------------|
| 显示方式 | 独立按钮 + 小弹窗 | 底部大弹窗（80%高度） |
| 选择模式 | 单选 | 多选 |
| 连续操作 | ❌ 不支持 | ✅ 支持（继续添加） |
| 搜索功能 | ✅ 支持 | ✅ 支持 |
| UI设计 | 基础样式 | 现代化设计 |

**清理建议**:
- ⚠️ **需要替换，不能直接删除**
- 需先更新 `pages-sub/in/add.vue` 使用新版
- 需先更新 `pages-sub/requisition/add.vue` 使用新版

---

### 3. 新版工具栏组件 ⚠️
**组件**: `components/in-entry-toolbar/index.vue`

**分析结果**:
- 文件中存在**重复代码**（两套template和script）
- 第1-127行：第一套实现
- 第128-260行：第二套实现（重复）

**清理建议**:
- 🔧 **需要整理，删除重复部分**
- 保留功能更完整的版本

---

### 4. 表格组件 ✅
**组件**: `components/in-entry-table/index.vue`

**使用情况**:
- ❌ **未在 pages-sub/in/add.vue 中使用**
- 当前使用的是内联的表格实现

**清理建议**:
- ⚠️ **暂时保留** - 可能在其他页面使用
- 需要全局搜索确认

---

## 🎯 清理方案

### 方案A: 彻底清理（推荐）✨

**步骤**:
1. **删除旧版供应商选择器**
   - 删除组件: `components/supplier-selector/`
   - 删除文档: 所有供应商选择器相关md文件（8个）
   
2. **替换并删除旧版药品选择器**
   - 更新 `pages-sub/in/add.vue` 使用 `DrugSelectorPopup`
   - 更新 `pages-sub/requisition/add.vue` 使用 `DrugSelectorPopup`
   - 删除组件: `components/drug-selector/`

3. **整理工具栏组件**
   - 删除 `components/in-entry-toolbar/index.vue` 的重复代码
   - 统一使用一套实现

4. **清理编译产物**
   - 删除 `unpackage/dist/dev/mp-weixin/components/supplier-selector/`
   - 删除 `unpackage/dist/dev/mp-weixin/components/drug-selector/`

**优势**:
- ✅ 代码库更清晰
- ✅ 维护成本降低
- ✅ 避免混淆旧版和新版

---

### 方案B: 渐进式清理

**步骤**:
1. **立即删除**: 供应商选择器（已废弃）
2. **暂时保留**: 药品选择器（需要逐步替换）
3. **整理**: 工具栏组件（删除重复）

**优势**:
- ✅ 风险较低
- ✅ 可以逐步迁移

---

## 📝 详细清理清单

### 阶段1: 删除供应商选择器

#### 文件删除清单:
```
✅ components/supplier-selector/index.vue
✅ ✅供应商选择器-最终需求实现.md
✅ 🐛新建供应商弹窗深度分析.md
✅ ✨供应商选择器优化说明.md
✅ 🎨供应商选择器界面设计说明.md
✅ 🐛供应商选择器Bug修复.md
✅ 🔧新建供应商弹窗问题排查.md
✅ 🔧供应商选择器编译错误修复.md
✅ 🔍供应商选择器功能验证.md
✅ 📝供应商选填说明.md
```

#### 引用检查:
- ❌ 无任何页面引用此组件

---

### 阶段2: 替换药品选择器

#### 需要更新的文件:
1. **pages-sub/in/add.vue**
   - 当前: 使用 `<drug-selector>` (旧版)
   - 目标: 使用 `<drug-selector-popup>` (新版)
   
2. **pages-sub/requisition/add.vue** (请领模块)
   - 当前: 使用 `<drug-selector>` (旧版)
   - 目标: 使用 `<drug-selector-popup>` (新版)

#### 删除文件:
```
✅ components/drug-selector/index.vue
```

---

### 阶段3: 整理工具栏组件

#### 需要整理的文件:
```
🔧 components/in-entry-toolbar/index.vue
   - 删除第128-260行的重复代码
   - 保留第1-127行的实现
```

---

## ⚠️ 风险评估

### 低风险 ✅
- 删除供应商选择器 - **无引用**

### 中等风险 ⚠️
- 替换药品选择器 - **需要测试入库和请领模块**
- 整理工具栏组件 - **需要确认功能完整性**

### 高风险 ❌
- 无

---

## 🧪 测试计划

### 删除供应商选择器后:
- [ ] 入库页面正常加载
- [ ] 供应商输入框正常工作
- [ ] 无组件引用错误

### 替换药品选择器后:
- [ ] 入库模块 - 选择药品正常
- [ ] 入库模块 - 批量选择正常
- [ ] 入库模块 - 连续添加正常
- [ ] 请领模块 - 选择药品正常

### 整理工具栏组件后:
- [ ] 工具栏显示正常
- [ ] 所有按钮功能正常
- [ ] 连续扫码开关正常

---

## 📊 预期成果

### 代码减少:
- 删除组件: 2个（supplier-selector, drug-selector）
- 删除文档: 9个md文件
- 删除行数: 约1500+行

### 维护成本:
- ⬇️ 减少50%的组件维护工作
- ⬇️ 消除旧版/新版混淆问题
- ⬇️ 降低WXML编译错误风险

---

## ✅ 执行清单

- [ ] 阶段1: 删除供应商选择器（9个文件）
- [ ] 阶段2: 替换入库模块药品选择器
- [ ] 阶段3: 替换请领模块药品选择器
- [ ] 阶段4: 删除旧版药品选择器
- [ ] 阶段5: 整理工具栏组件
- [ ] 阶段6: 清理编译产物
- [ ] 阶段7: 全面测试

---

## 📞 后续行动

等待用户确认后，按照以下顺序执行：
1. ✅ 立即执行：删除供应商选择器（低风险）
2. ⚠️ 谨慎执行：替换药品选择器（需测试）
3. 🔧 最后执行：整理工具栏组件（需验证）

