# ğŸ†“ å…è´¹æ‰«ç æ–¹æ¡ˆï¼šæ¡å½¢ç æ˜ å°„ + NMPAçˆ¬è™«

## ğŸ“‹ æ–¹æ¡ˆè¯´æ˜

### **å››çº§æŸ¥è¯¢ç­–ç•¥**

```
æ‰«ææ¡å½¢ç ï¼ˆ6901028075862ï¼‰
    â†“
1ï¸âƒ£ æŸ¥è¯¢æœ¬åœ°è¯ææ¡£æ¡ˆ (drugs è¡¨)
    â†“ æœªæ‰¾åˆ°
2ï¸âƒ£ æŸ¥è¯¢ç¼“å­˜æ•°æ®åº“ (barcode_cache è¡¨)
    â†“ æœªæ‰¾åˆ°
3ï¸âƒ£ è°ƒç”¨ç¬¬ä¸‰æ–¹APIï¼ˆéœ€ä»˜è´¹ï¼Œå¯é€‰ï¼‰âš ï¸
    â†“ æœªé…ç½®/æœªæ‰¾åˆ°
4ï¸âƒ£ æ¡å½¢ç æ˜ å°„ + NMPAçˆ¬è™«ï¼ˆå…è´¹ï¼‰âœ…
    â”œâ”€ æŸ¥è¯¢æ˜ å°„è¡¨å¾—åˆ°è¯æåç§°
    â””â”€ ç”¨åç§°è°ƒç”¨NMPAå®˜æ–¹API
```

---

## ğŸ¯ æ ¸å¿ƒæ€è·¯

**é—®é¢˜ï¼š**
- æ¡å½¢ç  API éœ€è¦ä»˜è´¹
- NMPA åªèƒ½æŸ¥è¯æåç§°ï¼Œä¸èƒ½æŸ¥æ¡å½¢ç 

**è§£å†³æ–¹æ¡ˆï¼š**
1. å»ºç«‹ **æ¡å½¢ç  â†’ è¯æåç§°** çš„æ˜ å°„è¡¨
2. æ‰«ç åå…ˆæŸ¥æ˜ å°„è¡¨è·å–è¯æåç§°
3. å†ç”¨è¯æåç§°è°ƒç”¨ NMPA å…è´¹çˆ¬è™«

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### **æ­¥éª¤1ï¼šåˆ›å»ºæ¡å½¢ç æ˜ å°„è¡¨**

åœ¨äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºæ•°æ®åº“é›†åˆï¼š

**é›†åˆåç§°ï¼š** `barcode_mapping`

**æ•°æ®ç»“æ„ï¼š**
```json
{
  "barcode": "6901028075862",       // æ¡å½¢ç 
  "drugName": "é˜¿è«è¥¿æ—èƒ¶å›Š",       // è¯æåç§°ï¼ˆç”¨äºNMPAæŸ¥è¯¢ï¼‰
  "specification": "0.25g*24ç²’",   // è§„æ ¼ï¼ˆå¯é€‰ï¼‰
  "unit": "ç›’",                     // å•ä½ï¼ˆå¯é€‰ï¼‰
  "source": "manual",               // æ¥æº
  "createTime": "2025-11-23"
}
```

**ç´¢å¼•å»ºè®®ï¼š**
- `barcode` - å‡åºï¼Œå”¯ä¸€ç´¢å¼• âœ…

---

### **æ­¥éª¤2ï¼šæ·»åŠ å¸¸ç”¨è¯ææ˜ å°„**

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
const db = wx.cloud.database()

// æ‰¹é‡æ·»åŠ å¸¸ç”¨è¯æçš„æ¡å½¢ç æ˜ å°„
const mappings = [
  {
    barcode: "6901028075862",
    drugName: "é˜¿è«è¥¿æ—èƒ¶å›Š",
    specification: "0.25g*24ç²’",
    unit: "ç›’"
  },
  {
    barcode: "6902088888888",
    drugName: "å¸ƒæ´›èŠ¬ç¼“é‡Šèƒ¶å›Š",
    specification: "0.3g*20ç²’",
    unit: "ç›’"
  },
  {
    barcode: "6903777777777",
    drugName: "å¤´å­¢å…‹è‚Ÿåˆ†æ•£ç‰‡",
    specification: "0.1g*12ç‰‡",
    unit: "ç›’"
  }
  // ... æ·»åŠ æ›´å¤šå¸¸ç”¨è¯æ
]

// æ‰¹é‡æ’å…¥
mappings.forEach(async (mapping) => {
  await db.collection('barcode_mapping').add({
    data: {
      ...mapping,
      source: 'manual',
      createTime: new Date()
    }
  })
})

console.log('âœ… æ˜ å°„æ•°æ®æ·»åŠ å®Œæˆï¼')
```

---

### **æ­¥éª¤3ï¼šé‡æ–°éƒ¨ç½²äº‘å‡½æ•°**

1. å³é”®ç‚¹å‡» `cloudfunctions/drugBarcodeQuery`
2. é€‰æ‹© **ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šæ‰€æœ‰æ–‡ä»¶**
3. ç­‰å¾…éƒ¨ç½²å®Œæˆ

---

### **æ­¥éª¤4ï¼šæµ‹è¯•åŠŸèƒ½**

åœ¨æ§åˆ¶å°æµ‹è¯•ï¼š

```javascript
wx.cloud.callFunction({
  name: 'drugBarcodeQuery',
  data: {
    action: 'queryByBarcode',
    barcode: '6901028075862'  // ä½¿ç”¨æ˜ å°„è¡¨ä¸­çš„æ¡å½¢ç 
  }
}).then(res => {
  console.log('âœ… æµ‹è¯•æˆåŠŸï¼', res.result)
})
```

**æœŸæœ›è¾“å‡ºï¼š**
```javascript
{
  success: true,
  source: 'nmpa',  // â† æ¥è‡ªNMPAçˆ¬è™«
  message: 'ä»å›½å®¶è¯ç›‘å±€è·å–',
  data: {
    barcode: '6901028075862',
    name: 'é˜¿è«è¥¿æ—èƒ¶å›Š',
    specification: '0.25g*24ç²’',
    manufacturer: 'XXåˆ¶è¯æœ‰é™å…¬å¸',
    approvalNumber: 'å›½è¯å‡†å­—H...',
    unit: 'ç›’'
  }
}
```

---

## ğŸ“Š æ•°æ®æµç¨‹

### **å®Œæ•´æŸ¥è¯¢æµç¨‹ï¼š**

```
ç”¨æˆ·æ‰«ç : 6901028075862
    â†“
äº‘å‡½æ•°æ”¶åˆ°æ¡å½¢ç 
    â†“
[ç¬¬1çº§] æŸ¥ drugs è¡¨ âŒ æœªæ‰¾åˆ°
    â†“
[ç¬¬2çº§] æŸ¥ barcode_cache è¡¨ âŒ æœªæ‰¾åˆ°
    â†“
[ç¬¬3çº§] è°ƒç¬¬ä¸‰æ–¹API âŒ æœªé…ç½®
    â†“
[ç¬¬4çº§-æ­¥éª¤1] æŸ¥ barcode_mapping è¡¨
    â†“
âœ… æ‰¾åˆ°: drugName = "é˜¿è«è¥¿æ—èƒ¶å›Š"
    â†“
[ç¬¬4çº§-æ­¥éª¤2] è°ƒç”¨NMPAçˆ¬è™«
    â†“
è¯·æ±‚: http://app1.nmpa.gov.cn/...?keyword=é˜¿è«è¥¿æ—èƒ¶å›Š
    â†“
è§£æHTMLï¼Œæå–è¯æä¿¡æ¯
    â†“
âœ… è¿”å›ç»“æœ: æ‰¹å‡†æ–‡å·ã€ç”Ÿäº§ä¼ä¸šã€æ‰¹å‡†æ—¥æœŸ
    â†“
ğŸ’¾ ä¿å­˜åˆ° barcode_cacheï¼ˆä¸‹æ¬¡æ›´å¿«ï¼‰
    â†“
âœ… è¿”å›ç»™å‰ç«¯æ˜¾ç¤º
```

---

## ğŸ’¡ å¦‚ä½•è·å–è¯ææ¡å½¢ç æ˜ å°„ï¼Ÿ

### **æ–¹æ³•1ï¼šæ‰‹åŠ¨æ‰«ç æ”¶é›†** â­

1. æ‹¿åˆ°å®é™…è¯æ
2. æ‰«ææ¡å½¢ç 
3. è®°å½•è¯æåç§°
4. æ·»åŠ åˆ°æ˜ å°„è¡¨

```javascript
// æ·»åŠ å•ä¸ªæ˜ å°„
db.collection('barcode_mapping').add({
  data: {
    barcode: 'å®é™…æ‰«åˆ°çš„æ¡å½¢ç ',
    drugName: 'è¯æé€šç”¨åç§°',
    specification: 'åŒ…è£…è§„æ ¼',
    unit: 'ç›’',
    source: 'scanned',
    createTime: new Date()
  }
})
```

---

### **æ–¹æ³•2ï¼šå¯¼å…¥æ•°æ®åº“**

å¦‚æœæœ‰Excel/CSVæ ¼å¼çš„è¯ææ¡å½¢ç æ•°æ®ï¼š

```javascript
// ç¤ºä¾‹ï¼šä»æ•°ç»„æ‰¹é‡å¯¼å…¥
const drugList = [
  ["6901028075862", "é˜¿è«è¥¿æ—èƒ¶å›Š", "0.25g*24ç²’", "ç›’"],
  ["6902088888888", "å¸ƒæ´›èŠ¬ç¼“é‡Šèƒ¶å›Š", "0.3g*20ç²’", "ç›’"],
  // ... æ›´å¤šæ•°æ®
]

drugList.forEach(async ([barcode, name, spec, unit]) => {
  await db.collection('barcode_mapping').add({
    data: {
      barcode: barcode,
      drugName: name,
      specification: spec,
      unit: unit,
      source: 'imported',
      createTime: new Date()
    }
  })
})
```

---

### **æ–¹æ³•3ï¼šç”¨æˆ·è´¡çŒ®æ•°æ®** ğŸŒŸ

åœ¨å‰ç«¯å¢åŠ "è´¡çŒ®æ˜ å°„"åŠŸèƒ½ï¼š

```javascript
// å½“ç”¨æˆ·æ‰‹åŠ¨æ–°å»ºè¯ææ—¶ï¼Œè‡ªåŠ¨ä¿å­˜æ˜ å°„
async function saveBarcodeMapping(barcode, drugName) {
  await wx.cloud.callFunction({
    name: 'drugBarcodeQuery',
    data: {
      action: 'saveMapp',
      barcode: barcode,
      drugName: drugName
    }
  })
}
```

è¿™æ ·ç”¨æˆ·æ¯æ¬¡æ–°å»ºè¯æï¼Œç³»ç»Ÿå°±è‡ªåŠ¨ç§¯ç´¯æ¡å½¢ç æ˜ å°„æ•°æ®ï¼

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | å“åº”æ—¶é—´ | æˆæœ¬ |
|------|---------|------|
| **ç¬¬1çº§ï¼šæœ¬åœ°æ¡£æ¡ˆ** | < 100ms | å…è´¹ |
| **ç¬¬2çº§ï¼šç¼“å­˜** | < 200ms | å…è´¹ |
| **ç¬¬3çº§ï¼šä»˜è´¹API** | 1-3ç§’ | 0.01-0.02å…ƒ/æ¬¡ |
| **ç¬¬4çº§ï¼šæ˜ å°„+NMPA** | 10-15ç§’ | å…è´¹ âœ… |

**ç»“è®ºï¼š**
- ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼š10-15ç§’ï¼ˆNMPAçˆ¬è™«è¾ƒæ…¢ï¼‰
- ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼š< 200msï¼ˆå·²ç¼“å­˜ï¼‰âš¡
- **å®Œå…¨å…è´¹ï¼** ğŸ’°

---

## ğŸ¯ ä¼˜åŠ¿ä¸å±€é™

### **âœ… ä¼˜åŠ¿**

1. **å®Œå…¨å…è´¹**
   - æ— éœ€è´­ä¹°ç¬¬ä¸‰æ–¹API
   - NMPAå®˜æ–¹æ•°æ®ï¼Œæƒå¨å¯é 

2. **æ•°æ®è¶Šç”¨è¶Šå‡†**
   - ç”¨æˆ·è´¡çŒ®æ˜ å°„æ•°æ®
   - ç¼“å­˜æœºåˆ¶æå‡é€Ÿåº¦

3. **çµæ´»å¯æ§**
   - å¯ä»¥è‡ªå®šä¹‰æ˜ å°„è§„åˆ™
   - å¯ä»¥æ‰¹é‡å¯¼å…¥æ•°æ®

---

### **âš ï¸ å±€é™**

1. **éœ€è¦é¢„å…ˆå»ºç«‹æ˜ å°„**
   - æ–°è¯æç¬¬ä¸€æ¬¡éœ€è¦æ‰‹åŠ¨æ·»åŠ 
   - æ˜ å°„è¡¨éœ€è¦ç»´æŠ¤

2. **é¦–æ¬¡æŸ¥è¯¢è¾ƒæ…¢**
   - NMPAçˆ¬è™«éœ€è¦10-15ç§’
   - ä½†ä¼šè‡ªåŠ¨ç¼“å­˜ï¼Œä¸‹æ¬¡å¾ˆå¿«

3. **ä¾èµ–NMPAæœåŠ¡**
   - å¦‚æœNMPAç½‘ç«™å˜æ›´ï¼Œéœ€è¦æ›´æ–°çˆ¬è™«
   - ç½‘ç»œä¸ç¨³å®šæ—¶å¯èƒ½å¤±è´¥

---

## ğŸ”§ é«˜çº§ä¼˜åŒ–

### **1. è‡ªåŠ¨å­¦ä¹ æœºåˆ¶**

ç”¨æˆ·æ‰‹åŠ¨æ–°å»ºè¯ææ—¶ï¼Œè‡ªåŠ¨ä¿å­˜æ˜ å°„ï¼š

```javascript
// åœ¨ pages-sub/in/add.vue çš„ createNewDrug æ–¹æ³•ä¸­æ·»åŠ 
async createNewDrug() {
  // ... åˆ›å»ºè¯æé€»è¾‘
  
  // è‡ªåŠ¨ä¿å­˜æ¡å½¢ç æ˜ å°„
  if (this.newDrug.barcode) {
    await wx.cloud.callFunction({
      name: 'saveBarcodeMapping',
      data: {
        barcode: this.newDrug.barcode,
        drugName: this.newDrug.name
      }
    })
  }
}
```

---

### **2. æ‰¹é‡é¢„çƒ­**

åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œé¢„åŠ è½½å¸¸ç”¨è¯æï¼š

```javascript
// æå‰å°†çƒ­é—¨è¯æåŠ å…¥æ˜ å°„è¡¨
const popularDrugs = [
  'é˜¿è«è¥¿æ—', 'å¸ƒæ´›èŠ¬', 'å¤´å­¢', 'æ„Ÿå†’çµ',
  'æ¿è“æ ¹', 'ç»´ç”Ÿç´ C', 'é’™ç‰‡', 'é˜¿å¸åŒ¹æ—'
]

popularDrugs.forEach(drugName => {
  // è°ƒç”¨NMPAé¢„æŸ¥è¯¢ï¼Œå¡«å……ç¼“å­˜
})
```

---

### **3. å®šæ—¶åŒæ­¥**

å®šæœŸä»å…¶ä»–æ•°æ®æºåŒæ­¥æ¡å½¢ç æ˜ å°„ï¼š

```javascript
// äº‘å‡½æ•°å®šæ—¶è§¦å‘å™¨
exports.main = async (event, context) => {
  // ä»ç¬¬ä¸‰æ–¹æ•°æ®æºåŒæ­¥
  const newMappings = await fetchFromExternalSource()
  
  // æ‰¹é‡å¯¼å…¥
  newMappings.forEach(async (mapping) => {
    await db.collection('barcode_mapping').add({
      data: mapping
    })
  })
}
```

---

## ğŸ“ ä½¿ç”¨å»ºè®®

### **é€‚åˆåœºæ™¯ï¼š**

âœ… é¢„ç®—æœ‰é™çš„å°å‹åŒ»ç–—æœºæ„
âœ… å¸¸ç”¨è¯æç§ç±»å›ºå®šï¼ˆ< 200ç§ï¼‰
âœ… æ„¿æ„æŠ•å…¥æ—¶é—´å»ºç«‹æ˜ å°„è¡¨

### **ä¸é€‚åˆåœºæ™¯ï¼š**

âŒ è¯æç§ç±»ç¹å¤šï¼ˆ> 1000ç§ï¼‰
âŒ éœ€è¦å³æ‰«å³ç”¨ï¼Œä¸èƒ½ç­‰å¾…
âŒ æ²¡æœ‰æ—¶é—´ç»´æŠ¤æ˜ å°„è¡¨

---

## ğŸŠ æ€»ç»“

è¿™ä¸ªæ–¹æ¡ˆå®ç°äº†ï¼š
- âœ… **å®Œå…¨å…è´¹**çš„æ‰«ç æŸ¥è¯¢
- âœ… ä½¿ç”¨**å®˜æ–¹NMPAæ•°æ®**
- âœ… **è‡ªåŠ¨ç¼“å­˜**ï¼Œè¶Šç”¨è¶Šå¿«
- âœ… **ç”¨æˆ·è´¡çŒ®**æ•°æ®ï¼Œå…±åŒå®Œå–„

**ä»£ä»·æ˜¯ï¼š**
- âš ï¸ éœ€è¦é¢„å…ˆå»ºç«‹æ˜ å°„è¡¨
- âš ï¸ é¦–æ¬¡æŸ¥è¯¢è¾ƒæ…¢ï¼ˆ10-15ç§’ï¼‰

---

## ğŸš€ ç«‹å³å¼€å§‹

1. åˆ›å»º `barcode_mapping` é›†åˆ
2. æ·»åŠ å¸¸ç”¨è¯ææ˜ å°„
3. é‡æ–°éƒ¨ç½²äº‘å‡½æ•°
4. æ‰«ç æµ‹è¯•

**æœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶è”ç³»ï¼** ğŸ‰

---

**åˆ›å»ºæ—¶é—´**: 2025-11-23  
**ç‰ˆæœ¬**: v1.0  
**ä½œè€…**: Cascade AI
