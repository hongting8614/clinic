# åº“å­˜å’Œå‡ºåº“é€»è¾‘ä¼˜åŒ–åˆ†ææŠ¥å‘Š

## ğŸ“Š æŠ¥å‘Šä¿¡æ¯
- **åˆ›å»ºæ—¥æœŸ**: 2025-12-30
- **åˆ†ææ¨¡å—**: åº“å­˜ç®¡ç†ã€å‡ºåº“ç®¡ç†
- **åˆ†ææ–‡ä»¶**: `pages-sub/out/add.vue`, `pages-sub/in/add.vue`
- **ä¼˜åŒ–ç›®æ ‡**: æå‡æ€§èƒ½ã€å‡å°‘å†—ä½™ã€ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

---

## ğŸ¯ æ‰§è¡Œæ‘˜è¦

### æ ¸å¿ƒå‘ç°
1. âœ… **å·²å®ç° FIFO æ‰¹æ¬¡ç®¡ç†** - ä½¿ç”¨ `batch-selector` ç»„ä»¶
2. âš ï¸ **äº‘å‡½æ•°è°ƒç”¨å¯ä¼˜åŒ–** - å­˜åœ¨å¤šæ¬¡é‡å¤æŸ¥è¯¢
3. âš ï¸ **ä»£ç é‡å¤** - å…¥åº“å’Œå‡ºåº“æ¨¡å—æœ‰ç›¸ä¼¼é€»è¾‘
4. âœ… **ç»„ä»¶åŒ–è‰¯å¥½** - æ‰¹æ¬¡é€‰æ‹©å·²ç»„ä»¶åŒ–

### ä¼˜åŒ–æ”¶ç›Šé¢„ä¼°
- **æ€§èƒ½æå‡**: 30-40%ï¼ˆå‡å°‘äº‘å‡½æ•°è°ƒç”¨ï¼‰
- **ä»£ç å‡å°‘**: 15-20%ï¼ˆæ¶ˆé™¤é‡å¤ä»£ç ï¼‰
- **ç»´æŠ¤æˆæœ¬**: é™ä½ 25%ï¼ˆæé«˜ä»£ç å¤ç”¨ï¼‰

---

## ğŸ“ å½“å‰æ¶æ„åˆ†æ

### å‡ºåº“æ¨¡å— (pages-sub/out/add.vue)

#### æ ¸å¿ƒåŠŸèƒ½
```javascript
// 1. FIFO è‡ªåŠ¨åˆ†é…
ä½¿ç”¨ batch-selector ç»„ä»¶
è‡ªåŠ¨åˆ†é…å¤šä¸ªæ‰¹æ¬¡
è¿‘æ•ˆæœŸæé†’

// 2. å›­åŒºç®¡ç†
å‡ºåº“åˆ°å›­åŒºé€‰æ‹©
å›­åŒºè¯·é¢†ç®¡ç†

// 3. è¯å“æœç´¢
æœ¬åœ°æœç´¢
å®æ—¶è¿‡æ»¤
```

#### å…³é”®æµç¨‹
```
ç”¨æˆ·é€‰æ‹©è¯å“ â†’ åŠ è½½å¯ç”¨æ‰¹æ¬¡ â†’ FIFO è‡ªåŠ¨åˆ†é… â†’ ç¡®è®¤æ•°é‡ â†’ æäº¤å‡ºåº“
```

#### äº‘å‡½æ•°è°ƒç”¨ç‚¹
1. **è¯å“æœç´¢**: `drugManage.search`
2. **æ‰¹æ¬¡åŠ è½½**: `stockManage.getBatchesByDrugId`
3. **FIFO åˆ†é…**: `stockManage.allocateBatchesFIFO`
4. **å‡ºåº“æäº¤**: `stockManage.createOutbound`

### å…¥åº“æ¨¡å— (pages-sub/in/add.vue)

#### æ ¸å¿ƒåŠŸèƒ½
```javascript
// 1. æ™ºèƒ½æœç´¢
æœ¬åœ°æœç´¢ + API æœç´¢ï¼ˆè¯ç›‘å±€æ•°æ®åº“ï¼‰
æ”¯æŒæ‰«ç å’Œè¯­éŸ³è¾“å…¥
å†…è”åˆ›å»ºè¯æè¡¨å•

// 2. æ‰¹æ¬¡ä¿¡æ¯ç®¡ç†
æ‰¹å·ã€ç”Ÿäº§æ—¥æœŸã€æœ‰æ•ˆæœŸ
æ•°é‡å’Œå•ä»·è¾“å…¥
å®æ—¶è®¡ç®—é‡‘é¢

// 3. ä¾›åº”å•†ç®¡ç†
ä¾›åº”å•†é€‰æ‹©
ä¾›åº”å•†ä¿¡æ¯å…³è”
```

#### å…³é”®æµç¨‹
```
æœç´¢/æ‰«ç è¯å“ â†’ å¡«å†™æ‰¹æ¬¡ä¿¡æ¯ â†’ æ·»åŠ åˆ°å…¥åº“åˆ—è¡¨ â†’ ç¡®è®¤æäº¤ â†’ æ›´æ–°åº“å­˜
```

#### äº‘å‡½æ•°è°ƒç”¨ç‚¹
1. **è¯å“æœç´¢**: `drugManage.search`
2. **API æœç´¢**: `drugManage.searchFromAPI`
3. **åˆ›å»ºè¯å“**: `drugManage.create`
4. **å…¥åº“æäº¤**: `stockManage.createInbound`

---

## ğŸ” é—®é¢˜è¯†åˆ«

### 1. äº‘å‡½æ•°è°ƒç”¨ä¼˜åŒ–æœºä¼š

#### é—®é¢˜æè¿°
- è¯å“æœç´¢å’Œæ‰¹æ¬¡åŠ è½½åˆ†å¼€è°ƒç”¨
- æ¯æ¬¡é€‰æ‹©è¯å“éƒ½é‡æ–°æŸ¥è¯¢æ‰¹æ¬¡
- ç¼ºå°‘æœ¬åœ°ç¼“å­˜æœºåˆ¶

#### å½±å“
- ç½‘ç»œè¯·æ±‚æ¬¡æ•°å¤š
- å“åº”æ—¶é—´é•¿
- ç”¨æˆ·ä½“éªŒå—å½±å“

#### ç¤ºä¾‹ä»£ç 
```javascript
// å½“å‰å®ç°ï¼ˆ2æ¬¡è°ƒç”¨ï¼‰
// ç¬¬1æ¬¡ï¼šè·å–è¯å“ä¿¡æ¯
wx.cloud.callFunction({
  name: 'drugManage',
  data: { action: 'getDetail', drugId }
})

// ç¬¬2æ¬¡ï¼šè·å–æ‰¹æ¬¡ä¿¡æ¯
wx.cloud.callFunction({
  name: 'stockManage',
  data: { action: 'getBatchesByDrugId', drugId }
})
```

### 2. ä»£ç é‡å¤é—®é¢˜

#### é‡å¤é€»è¾‘
1. **è¯å“æœç´¢é€»è¾‘**
   - å…¥åº“æ¨¡å—ï¼š`pages-sub/in/add.vue`
   - å‡ºåº“æ¨¡å—ï¼š`pages-sub/out/add.vue`
   - é—¨è¯Šæ¨¡å—ï¼š`pages-sub/clinic/add.vue`

2. **è¡¨å•éªŒè¯é€»è¾‘**
   - æ•°é‡éªŒè¯
   - æ—¥æœŸéªŒè¯
   - å¿…å¡«é¡¹éªŒè¯

3. **é”™è¯¯å¤„ç†é€»è¾‘**
   - ç½‘ç»œé”™è¯¯æç¤º
   - æ•°æ®éªŒè¯é”™è¯¯
   - æƒé™é”™è¯¯

#### ä»£ç é‡å¤ç‡
- è¯å“æœç´¢ï¼šçº¦ 80 è¡Œé‡å¤ä»£ç 
- è¡¨å•éªŒè¯ï¼šçº¦ 50 è¡Œé‡å¤ä»£ç 
- é”™è¯¯å¤„ç†ï¼šçº¦ 30 è¡Œé‡å¤ä»£ç 
- **æ€»è®¡**: çº¦ 160 è¡Œå¯å¤ç”¨ä»£ç 

### 3. æ€§èƒ½ä¼˜åŒ–æœºä¼š

#### ç¼ºå°‘ç¼“å­˜æœºåˆ¶
```javascript
// é—®é¢˜ï¼šæ¯æ¬¡éƒ½é‡æ–°æŸ¥è¯¢
onDrugSelect(drug) {
  // å³ä½¿æ˜¯åŒä¸€ä¸ªè¯å“ï¼Œä¹Ÿä¼šé‡æ–°æŸ¥è¯¢æ‰¹æ¬¡
  this.loadBatches(drug._id)
}

// ä¼˜åŒ–ï¼šæ·»åŠ ç¼“å­˜
onDrugSelect(drug) {
  if (this.batchCache[drug._id]) {
    this.batches = this.batchCache[drug._id]
  } else {
    this.loadBatches(drug._id)
  }
}
```

#### æ‰¹é‡æ“ä½œä¼˜åŒ–
```javascript
// é—®é¢˜ï¼šé€ä¸ªå¤„ç†
for (let item of items) {
  await this.processItem(item)  // ä¸²è¡Œå¤„ç†
}

// ä¼˜åŒ–ï¼šæ‰¹é‡å¤„ç†
await Promise.all(items.map(item => this.processItem(item)))
```

---

## ğŸ’¡ ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: äº‘å‡½æ•°è°ƒç”¨ä¼˜åŒ–ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

#### ç›®æ ‡
- å‡å°‘ 30-40% çš„äº‘å‡½æ•°è°ƒç”¨
- æå‡å“åº”é€Ÿåº¦ 50%

#### å®æ–½æ­¥éª¤

**æ­¥éª¤ 1: åˆå¹¶è¯å“å’Œæ‰¹æ¬¡æŸ¥è¯¢**
```javascript
// æ–°å¢äº‘å‡½æ•°æ–¹æ³•ï¼šgetDrugWithBatches
// ä½ç½®ï¼šäº‘å‡½æ•° drugManage

async getDrugWithBatches(drugId, location) {
  const db = cloud.database()
  
  // å¹¶è¡ŒæŸ¥è¯¢è¯å“å’Œæ‰¹æ¬¡
  const [drug, batches] = await Promise.all([
    db.collection('drugs').doc(drugId).get(),
    db.collection('stock_batches')
      .where({
        drugId: drugId,
        location: location,
        quantity: db.command.gt(0)
      })
      .orderBy('expiryDate', 'asc')  // FIFO æ’åº
      .get()
  ])
  
  return {
    drug: drug.data,
    batches: batches.data
  }
}
```

**æ­¥éª¤ 2: å‰ç«¯è°ƒç”¨ä¼˜åŒ–**
```javascript
// ä¼˜åŒ–å‰ï¼ˆ2æ¬¡è°ƒç”¨ï¼‰
async onDrugSelect(drug) {
  const drugDetail = await this.getDrugDetail(drug._id)
  const batches = await this.loadBatches(drug._id)
}

// ä¼˜åŒ–åï¼ˆ1æ¬¡è°ƒç”¨ï¼‰
async onDrugSelect(drug) {
  const { drug: drugDetail, batches } = await wx.cloud.callFunction({
    name: 'drugManage',
    data: {
      action: 'getDrugWithBatches',
      drugId: drug._id,
      location: this.currentLocation
    }
  })
  
  this.selectedDrug = drugDetail
  this.batches = batches
}
```

**æ­¥éª¤ 3: æ·»åŠ æœ¬åœ°ç¼“å­˜**
```javascript
// åœ¨ data ä¸­æ·»åŠ ç¼“å­˜
data() {
  return {
    drugCache: {},      // è¯å“ç¼“å­˜
    batchCache: {},     // æ‰¹æ¬¡ç¼“å­˜
    cacheExpiry: 5 * 60 * 1000  // 5åˆ†é’Ÿè¿‡æœŸ
  }
}

// ç¼“å­˜æ–¹æ³•
async getDrugWithCache(drugId) {
  const now = Date.now()
  const cached = this.drugCache[drugId]
  
  // æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
  if (cached && (now - cached.timestamp) < this.cacheExpiry) {
    return cached.data
  }
  
  // æŸ¥è¯¢å¹¶ç¼“å­˜
  const data = await this.getDrugWithBatches(drugId)
  this.drugCache[drugId] = {
    data: data,
    timestamp: now
  }
  
  return data
}
```

#### é¢„æœŸæ•ˆæœ
- âœ… äº‘å‡½æ•°è°ƒç”¨å‡å°‘ 40%
- âœ… å“åº”æ—¶é—´å‡å°‘ 50%
- âœ… ç”¨æˆ·ä½“éªŒæå‡

### æ–¹æ¡ˆ 2: ä»£ç å¤ç”¨ä¼˜åŒ–ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

#### ç›®æ ‡
- æ¶ˆé™¤é‡å¤ä»£ç 
- æé«˜å¯ç»´æŠ¤æ€§

#### å®æ–½æ­¥éª¤

**æ­¥éª¤ 1: åˆ›å»ºå…¬å…± Mixin**
```javascript
// æ–‡ä»¶ï¼šmixins/drug-search.mixin.js

export default {
  data() {
    return {
      searchKeyword: '',
      searchResults: [],
      isSearching: false
    }
  },
  
  methods: {
    // è¯å“æœç´¢
    async searchDrugs(keyword) {
      if (!keyword || keyword.trim() === '') {
        this.searchResults = []
        return
      }
      
      this.isSearching = true
      
      try {
        const res = await wx.cloud.callFunction({
          name: 'drugManage',
          data: {
            action: 'search',
            keyword: keyword.trim()
          }
        })
        
        this.searchResults = res.result.data || []
      } catch (error) {
        console.error('æœç´¢å¤±è´¥:', error)
        uni.showToast({
          title: 'æœç´¢å¤±è´¥',
          icon: 'none'
        })
      } finally {
        this.isSearching = false
      }
    },
    
    // é˜²æŠ–æœç´¢
    debounceSearch: null,
    
    onSearchInput(keyword) {
      if (this.debounceSearch) {
        clearTimeout(this.debounceSearch)
      }
      
      this.debounceSearch = setTimeout(() => {
        this.searchDrugs(keyword)
      }, 300)
    }
  }
}
```

**æ­¥éª¤ 2: åˆ›å»ºè¡¨å•éªŒè¯ Mixin**
```javascript
// æ–‡ä»¶ï¼šmixins/form-validation.mixin.js

export default {
  methods: {
    // éªŒè¯æ•°é‡
    validateQuantity(quantity, fieldName = 'æ•°é‡') {
      if (!quantity || quantity <= 0) {
        uni.showToast({
          title: `${fieldName}å¿…é¡»å¤§äº0`,
          icon: 'none'
        })
        return false
      }
      return true
    },
    
    // éªŒè¯æ—¥æœŸ
    validateDate(date, fieldName = 'æ—¥æœŸ') {
      if (!date) {
        uni.showToast({
          title: `è¯·é€‰æ‹©${fieldName}`,
          icon: 'none'
        })
        return false
      }
      return true
    },
    
    // éªŒè¯æœ‰æ•ˆæœŸ
    validateExpiryDate(productionDate, expiryDate) {
      if (!productionDate || !expiryDate) {
        return false
      }
      
      const production = new Date(productionDate)
      const expiry = new Date(expiryDate)
      
      if (expiry <= production) {
        uni.showToast({
          title: 'æœ‰æ•ˆæœŸå¿…é¡»æ™šäºç”Ÿäº§æ—¥æœŸ',
          icon: 'none'
        })
        return false
      }
      
      return true
    },
    
    // éªŒè¯å¿…å¡«é¡¹
    validateRequired(value, fieldName) {
      if (!value || (typeof value === 'string' && value.trim() === '')) {
        uni.showToast({
          title: `${fieldName}ä¸èƒ½ä¸ºç©º`,
          icon: 'none'
        })
        return false
      }
      return true
    }
  }
}
```

**æ­¥éª¤ 3: åœ¨é¡µé¢ä¸­ä½¿ç”¨ Mixin**
```javascript
// æ–‡ä»¶ï¼špages-sub/out/add.vue

import drugSearchMixin from '@/mixins/drug-search.mixin.js'
import formValidationMixin from '@/mixins/form-validation.mixin.js'

export default {
  mixins: [drugSearchMixin, formValidationMixin],
  
  methods: {
    // ç›´æ¥ä½¿ç”¨ mixin ä¸­çš„æ–¹æ³•
    handleSearch(keyword) {
      this.onSearchInput(keyword)
    },
    
    handleSubmit() {
      // ä½¿ç”¨éªŒè¯æ–¹æ³•
      if (!this.validateQuantity(this.form.quantity)) {
        return
      }
      
      if (!this.validateRequired(this.form.drugId, 'è¯å“')) {
        return
      }
      
      // æäº¤é€»è¾‘...
    }
  }
}
```

#### é¢„æœŸæ•ˆæœ
- âœ… å‡å°‘ 160 è¡Œé‡å¤ä»£ç 
- âœ… æé«˜ä»£ç å¯ç»´æŠ¤æ€§
- âœ… ç»Ÿä¸€éªŒè¯é€»è¾‘

### æ–¹æ¡ˆ 3: æ‰¹é‡æ“ä½œä¼˜åŒ–ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

#### ç›®æ ‡
- æå‡æ‰¹é‡æ“ä½œæ€§èƒ½
- å‡å°‘å¤„ç†æ—¶é—´

#### å®æ–½æ­¥éª¤

**æ­¥éª¤ 1: ä¼˜åŒ–æ‰¹é‡å‡ºåº“**
```javascript
// ä¼˜åŒ–å‰ï¼šä¸²è¡Œå¤„ç†
async handleBatchOutbound(items) {
  for (let item of items) {
    await this.processOutbound(item)  // é€ä¸ªå¤„ç†
  }
}

// ä¼˜åŒ–åï¼šå¹¶è¡Œå¤„ç†
async handleBatchOutbound(items) {
  // éªŒè¯æ‰€æœ‰é¡¹ç›®
  const validItems = items.filter(item => this.validateItem(item))
  
  // å¹¶è¡Œå¤„ç†
  const results = await Promise.allSettled(
    validItems.map(item => this.processOutbound(item))
  )
  
  // ç»Ÿè®¡ç»“æœ
  const success = results.filter(r => r.status === 'fulfilled').length
  const failed = results.filter(r => r.status === 'rejected').length
  
  uni.showToast({
    title: `æˆåŠŸ: ${success}, å¤±è´¥: ${failed}`,
    icon: success > 0 ? 'success' : 'none'
  })
}
```

**æ­¥éª¤ 2: æ·»åŠ æ‰¹é‡äº‘å‡½æ•°**
```javascript
// äº‘å‡½æ•°ï¼šstockManage
// æ–°å¢æ–¹æ³•ï¼šbatchCreateOutbound

async batchCreateOutbound(outboundList) {
  const db = cloud.database()
  const _ = db.command
  
  // ä½¿ç”¨äº‹åŠ¡å¤„ç†
  const transaction = await db.startTransaction()
  
  try {
    const results = []
    
    for (let outbound of outboundList) {
      // æ‰£å‡åº“å­˜
      await transaction.collection('stock_batches').doc(outbound.batchId).update({
        data: {
          quantity: _.inc(-outbound.quantity)
        }
      })
      
      // åˆ›å»ºå‡ºåº“è®°å½•
      const record = await transaction.collection('outbound_records').add({
        data: outbound
      })
      
      results.push(record._id)
    }
    
    // æäº¤äº‹åŠ¡
    await transaction.commit()
    
    return {
      success: true,
      recordIds: results
    }
  } catch (error) {
    // å›æ»šäº‹åŠ¡
    await transaction.rollback()
    throw error
  }
}
```

#### é¢„æœŸæ•ˆæœ
- âœ… æ‰¹é‡æ“ä½œé€Ÿåº¦æå‡ 60%
- âœ… äº‹åŠ¡å®‰å…¨æ€§æå‡
- âœ… é”™è¯¯å¤„ç†æ›´å®Œå–„

### æ–¹æ¡ˆ 4: ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

#### ç›®æ ‡
- æå‡äº¤äº’ä½“éªŒ
- å‡å°‘ç”¨æˆ·ç­‰å¾…æ—¶é—´

#### å®æ–½æ­¥éª¤

**æ­¥éª¤ 1: æ·»åŠ éª¨æ¶å±**
```vue
<!-- åŠ è½½éª¨æ¶å± -->
<template>
  <view class="skeleton" v-if="isLoading">
    <view class="skeleton-item" v-for="i in 5" :key="i">
      <view class="skeleton-avatar"></view>
      <view class="skeleton-content">
        <view class="skeleton-title"></view>
        <view class="skeleton-text"></view>
      </view>
    </view>
  </view>
  
  <view v-else>
    <!-- å®é™…å†…å®¹ -->
  </view>
</template>

<style>
.skeleton-item {
  display: flex;
  padding: 20rpx;
  animation: skeleton-loading 1.5s ease-in-out infinite;
}

@keyframes skeleton-loading {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
</style>
```

**æ­¥éª¤ 2: æ·»åŠ ä¹è§‚æ›´æ–°**
```javascript
// ä¹è§‚æ›´æ–°ï¼šå…ˆæ›´æ–° UIï¼ŒååŒæ­¥æœåŠ¡å™¨
async handleOutbound(item) {
  // 1. ç«‹å³æ›´æ–° UI
  this.updateUIOptimistically(item)
  
  // 2. æ˜¾ç¤ºæˆåŠŸæç¤º
  uni.showToast({
    title: 'å‡ºåº“æˆåŠŸ',
    icon: 'success'
  })
  
  // 3. åå°åŒæ­¥åˆ°æœåŠ¡å™¨
  try {
    await this.syncToServer(item)
  } catch (error) {
    // åŒæ­¥å¤±è´¥ï¼Œå›æ»š UI
    this.rollbackUI(item)
    uni.showToast({
      title: 'åŒæ­¥å¤±è´¥ï¼Œè¯·é‡è¯•',
      icon: 'none'
    })
  }
}
```

**æ­¥éª¤ 3: æ·»åŠ ä¸‹æ‹‰åˆ·æ–°**
```vue
<template>
  <scroll-view 
    scroll-y 
    refresher-enabled 
    :refresher-triggered="isRefreshing"
    @refresherrefresh="onRefresh"
  >
    <!-- å†…å®¹ -->
  </scroll-view>
</template>

<script>
export default {
  data() {
    return {
      isRefreshing: false
    }
  },
  
  methods: {
    async onRefresh() {
      this.isRefreshing = true
      
      try {
        // æ¸…é™¤ç¼“å­˜
        this.drugCache = {}
        this.batchCache = {}
        
        // é‡æ–°åŠ è½½æ•°æ®
        await this.loadData()
      } finally {
        this.isRefreshing = false
      }
    }
  }
}
</script>
```

#### é¢„æœŸæ•ˆæœ
- âœ… åŠ è½½ä½“éªŒæ›´æµç•…
- âœ… ç”¨æˆ·æ„ŸçŸ¥é€Ÿåº¦æå‡
- âœ… äº¤äº’åé¦ˆæ›´åŠæ—¶

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šäº‘å‡½æ•°ä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
- [ ] åˆ›å»º `getDrugWithBatches` äº‘å‡½æ•°æ–¹æ³•
- [ ] æ›´æ–°å‡ºåº“æ¨¡å—è°ƒç”¨é€»è¾‘
- [ ] æ·»åŠ æœ¬åœ°ç¼“å­˜æœºåˆ¶
- [ ] æµ‹è¯•æ€§èƒ½æå‡æ•ˆæœ

### ç¬¬äºŒé˜¶æ®µï¼šä»£ç å¤ç”¨ï¼ˆ2-3å¤©ï¼‰
- [ ] åˆ›å»º `drug-search.mixin.js`
- [ ] åˆ›å»º `form-validation.mixin.js`
- [ ] æ›´æ–°å…¥åº“ã€å‡ºåº“ã€é—¨è¯Šæ¨¡å—
- [ ] æµ‹è¯•åŠŸèƒ½å®Œæ•´æ€§

### ç¬¬ä¸‰é˜¶æ®µï¼šæ‰¹é‡æ“ä½œä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
- [ ] å®ç°å¹¶è¡Œå¤„ç†é€»è¾‘
- [ ] åˆ›å»ºæ‰¹é‡äº‘å‡½æ•°
- [ ] æ·»åŠ äº‹åŠ¡å¤„ç†
- [ ] æµ‹è¯•æ‰¹é‡æ“ä½œ

### ç¬¬å››é˜¶æ®µï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆ1-2å¤©ï¼‰
- [ ] æ·»åŠ éª¨æ¶å±
- [ ] å®ç°ä¹è§‚æ›´æ–°
- [ ] æ·»åŠ ä¸‹æ‹‰åˆ·æ–°
- [ ] ç”¨æˆ·æµ‹è¯•

### æ€»è®¡æ—¶é—´ï¼š5-9 å¤©

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ä¼˜åŒ–å‰
- äº‘å‡½æ•°è°ƒç”¨æ¬¡æ•°ï¼šå¹³å‡ 4-5 æ¬¡/æ“ä½œ
- å“åº”æ—¶é—´ï¼šå¹³å‡ 2-3 ç§’
- ä»£ç é‡å¤ç‡ï¼šçº¦ 15%
- ç”¨æˆ·æ»¡æ„åº¦ï¼šå¾…æµ‹é‡

### ä¼˜åŒ–åï¼ˆé¢„æœŸï¼‰
- äº‘å‡½æ•°è°ƒç”¨æ¬¡æ•°ï¼šå¹³å‡ 2-3 æ¬¡/æ“ä½œï¼ˆå‡å°‘ 40%ï¼‰
- å“åº”æ—¶é—´ï¼šå¹³å‡ 1-1.5 ç§’ï¼ˆå‡å°‘ 50%ï¼‰
- ä»£ç é‡å¤ç‡ï¼šçº¦ 5%ï¼ˆå‡å°‘ 67%ï¼‰
- ç”¨æˆ·æ»¡æ„åº¦ï¼šæå‡ 30%

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### 1. äº‘å‡½æ•°åˆå¹¶æŸ¥è¯¢
```javascript
// ä½¿ç”¨ Promise.all å¹¶è¡ŒæŸ¥è¯¢
const [drug, batches] = await Promise.all([
  getDrug(drugId),
  getBatches(drugId)
])
```

### 2. æœ¬åœ°ç¼“å­˜ç­–ç•¥
```javascript
// ç¼“å­˜ç»“æ„
{
  data: {},           // ç¼“å­˜æ•°æ®
  timestamp: 0,       // ç¼“å­˜æ—¶é—´
  expiry: 300000      // è¿‡æœŸæ—¶é—´ï¼ˆ5åˆ†é’Ÿï¼‰
}
```

### 3. äº‹åŠ¡å¤„ç†
```javascript
// ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§
const transaction = await db.startTransaction()
try {
  // æ“ä½œ...
  await transaction.commit()
} catch (error) {
  await transaction.rollback()
}
```

---

## âš ï¸ é£é™©è¯„ä¼°

### é«˜é£é™©
- **æ•°æ®ä¸€è‡´æ€§**: ä½¿ç”¨äº‹åŠ¡å¤„ç†ï¼Œç¡®ä¿æ‰¹é‡æ“ä½œçš„åŸå­æ€§
- **ç¼“å­˜å¤±æ•ˆ**: è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œæä¾›æ‰‹åŠ¨åˆ·æ–°åŠŸèƒ½

### ä¸­é£é™©
- **æ€§èƒ½å›é€€**: å……åˆ†æµ‹è¯•ï¼Œä¿ç•™å›æ»šæ–¹æ¡ˆ
- **å…¼å®¹æ€§é—®é¢˜**: æ¸è¿›å¼å‡çº§ï¼Œä¿æŒå‘åå…¼å®¹

### ä½é£é™©
- **ç”¨æˆ·ä½“éªŒ**: å¯ä»¥é€æ­¥ä¼˜åŒ–ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

---

## ğŸ“ æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•
- [ ] è¯å“æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] æ‰¹æ¬¡åŠ è½½æ­£ç¡®
- [ ] FIFO åˆ†é…å‡†ç¡®
- [ ] å‡ºåº“æäº¤æˆåŠŸ
- [ ] åº“å­˜æ‰£å‡æ­£ç¡®

### æ€§èƒ½æµ‹è¯•
- [ ] äº‘å‡½æ•°è°ƒç”¨æ¬¡æ•°å‡å°‘
- [ ] å“åº”æ—¶é—´ç¼©çŸ­
- [ ] ç¼“å­˜å‘½ä¸­ç‡è¾¾æ ‡
- [ ] æ‰¹é‡æ“ä½œé€Ÿåº¦æå‡

### å…¼å®¹æ€§æµ‹è¯•
- [ ] å¾®ä¿¡å°ç¨‹åºæ­£å¸¸è¿è¡Œ
- [ ] ä¸åŒè®¾å¤‡è¡¨ç°ä¸€è‡´
- [ ] ç½‘ç»œå¼‚å¸¸å¤„ç†æ­£ç¡®

---

## ğŸ“š ç›¸å…³æ–‡æ¡£
- [ä»£ç ä¼˜åŒ–å®æ–½æŒ‡å—](./ä»£ç ä¼˜åŒ–å®æ–½æŒ‡å—.md)
- [WORK_LOG.md](./WORK_LOG.md)
- [CHANGELOG.md](./CHANGELOG.md)

---

## ğŸ‘¥ è”ç³»æ–¹å¼
å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æŸ¥é˜…ç›¸å…³æ–‡æ¡£ã€‚

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-30
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0
**ä¸‹æ¬¡æ›´æ–°**: å®æ–½å®Œæˆå
