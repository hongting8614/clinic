# 🏥 诊断系统完整说明

## 📋 目录

1. [系统概述](#系统概述)
2. [诊断输入的三种方式](#诊断输入的三种方式)
3. [扭伤诊断处理流程](#扭伤诊断处理流程)
4. [系统架构](#系统架构)
5. [常见场景示例](#常见场景示例)

---

## 系统概述

### 诊断系统的核心功能

```
┌─────────────────────────────────────────────────────────┐
│                    诊断系统核心功能                      │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  1. 智能搜索                                             │
│     • 基于主诉、疾病名称、诊断关键词搜索                 │
│     • 模糊匹配，实时更新                                 │
│     • 多条件联动搜索                                     │
│                                                          │
│  2. 自动填充                                             │
│     • 选择诊断后自动填充主诉、症状、处置                 │
│     • 智能保留用户已输入的内容                           │
│     • 只填充空白字段                                     │
│                                                          │
│  3. 模板匹配                                             │
│     • 52条结构化模板                                     │
│     • 覆盖常见疾病和诊断                                 │
│     • 支持用户自定义模板                                 │
│                                                          │
│  4. 推荐用药                                             │
│     • 根据诊断自动推荐用药                               │
│     • 显示库存信息                                       │
│     • 一键添加到处方                                     │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 诊断输入的三种方式

### 方式1：直接在诊断框输入

```
┌──────────────────────────────────────────────────────┐
│  诊断输入框                                           │
├──────────────────────────────────────────────────────┤
│  [扭伤_________________]  ← 输入关键词                │
│                                                       │
│  ↓ 自动显示下拉列表                                   │
│                                                       │
│  ┌────────────────────────────────────┐              │
│  │ 📋 匹配的诊断（8个）                │              │
│  ├────────────────────────────────────┤              │
│  │ ☑ 踝关节扭伤                        │ ← 点击选择  │
│  │ □ 腕关节扭伤                        │              │
│  │ □ 膝关节扭伤                        │              │
│  │ □ 肩关节扭伤                        │              │
│  │ □ 软组织扭伤                        │              │
│  │ □ 关节扭伤                          │              │
│  │ □ 颈部扭伤                          │              │
│  │ □ 腰部扭伤                          │              │
│  └────────────────────────────────────┘              │
│                                                       │
│  选择后自动填充：                                     │
│  ✓ 疾病名称：扭伤                                     │
│  ✓ 主诉：崴脚后脚踝疼痛肿胀                           │
│  ✓ 症状：脚踝肿胀；疼痛；活动受限                     │
│  ✓ 处置：冷敷；包扎固定；制动休息                     │
└──────────────────────────────────────────────────────┘
```

### 方式2：通过主诉联动（推荐）

```
┌──────────────────────────────────────────────────────┐
│  步骤1：输入主诉                                      │
├──────────────────────────────────────────────────────┤
│  主诉：[崴脚后脚踝疼痛肿胀___________]                │
│                                                       │
│  ↓                                                    │
│                                                       │
│  步骤2：点击诊断输入框                                │
├──────────────────────────────────────────────────────┤
│  诊断：[_________________________]  ← 点击这里        │
│                                                       │
│  ↓ 系统基于主诉智能推荐                               │
│                                                       │
│  ┌────────────────────────────────────┐              │
│  │ 🎯 推荐诊断（基于主诉）             │              │
│  ├────────────────────────────────────┤              │
│  │ ⭐ 踝关节扭伤 (最匹配)              │ ← 优先显示  │
│  │ □ 关节扭伤                          │              │
│  │ □ 软组织扭伤                        │              │
│  └────────────────────────────────────┘              │
│                                                       │
│  优势：                                               │
│  ✓ 诊断范围更精准                                     │
│  ✓ 减少选择时间                                       │
│  ✓ 主诉和诊断完全匹配                                 │
└──────────────────────────────────────────────────────┘
```

### 方式3：通过疾病名称联动

```
┌───────��──────────────────────────────────────────────┐
│  步骤1：选择疾病名称                                  │
├──────────────────────────────────────────────────────┤
│  疾病名称：[扭伤_________________]  ← 输入或选择      │
│                                                       │
│  ↓                                                    │
│                                                       │
│  步骤2：点击诊断输入框                                │
├──────────────────────────────────────────────────────┤
│  诊断：[_________________________]  ← 点击这里        │
│                                                       │
│  ↓ 显示该疾病的所有诊断选项                           │
│                                                       │
│  ┌────────────────────────────────────┐              │
│  │ 📚 扭伤类诊断（8个）                │              │
│  ├────────────────────────────────────┤              │
│  │ □ 踝关节扭伤                        │              │
│  │ □ 腕关节扭伤                        │              │
│  │ □ 膝关节扭伤                        │              │
│  │ □ 肩关节扭伤                        │              │
│  │ □ 软组织扭伤                        │              │
│  │ □ 关节扭伤                          │              │
│  │ □ 颈部扭伤                          │              │
│  │ □ 腰部扭伤                          │              │
│  └────────────────────────────────────┘              │
│                                                       │
│  特点：                                               │
│  ✓ 按疾病分类显示                                     │
│  ✓ 查看所有相关诊断                                   │
│  ✓ 便于对比选择                                       │
└──────────────────────────────────────────────────────┘
```

---

## 扭伤诊断处理流程

### 完整流程图

```
┌─────────────────────────────────────────────────────────┐
│                  患者就诊（扭伤）                        │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  步骤1：输入患者基本信息                                 │
│  • 姓名：张三                                            │
│  • 性别：男                                              │
│  • 年龄：25                                              │
│  • 身份：游客                                            │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  步骤2：输入主诉（患者自述）                             │
│  ┌───────────────────────────────────────────────┐      │
│  │ 主诉：崴脚后脚踝疼痛肿胀                       │      │
│  └───────────────────────────────────────────────┘      │
│                                                          │
│  💡 提示：详细描述患者症状，有助于系统推荐准确诊断       │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  步骤3：选择诊断                                         │
│  ┌───────────────────────────────────────────────┐      │
│  │ 诊断：[点击输入框]                             │      │
│  └───────────────┬───────────────────────────────┘      │
│                  │                                       │
│                  ▼                                       │
│  ┌───────────────────────────────────────────────┐      │
│  │ 下拉列表显示：                                 │      │
│  │ ⭐ 踝关节扭伤 (推荐) ← 点击这个                │      │
│  │ □ 关节扭伤                                     │      │
│  │ □ 软组织扭伤                                   │      │
│  └───────────────────────────────────────────────┘      │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  步骤4：系统自动填充                                     │
│  ┌───────────────────────────────────────────────┐      │
│  │ ✓ 疾病名称：扭伤                               │      │
│  │ ✓ 诊断：踝关节扭伤                             │      │
│  │ ✓ 症状：脚踝肿胀；疼痛；活动受限               │      │
│  │ ✓ 处置：冷敷；包扎固定；制动休息；抬高患肢     │      │
│  └───────────────────────────────────────────────┘      │
│                                                          │
│  💡 提示：所有自动填充的内容都可以修改                   │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  步骤5：检查并调整（如需要）                             │
│  ┌───────────────────────────────────────────────┐      │
│  │ □ 主诉是否准确？                               │      │
│  │ □ 诊断是否正确？                               │      │
│  │ □ 症状是否完整？                               │      │
│  │ □ 处置是否合适？                               │      │
│  └───────────────────────────────────────────────┘      │
│                                                          │
│  如有需要，可以手动修改任何字段                          │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  步骤6：选择用药（可选）                                 │
│  ┌───────────────────────────────────────────────┐      │
│  │ 推荐用药：                                     │      │
│  │ • 云南白药气雾剂                               │      │
│  │ • 红花油                                       │      │
│  │ • 活络油                                       │      │
│  └───────────────────────────────────────────────┘      │
│                                                          │
│  点击药品名称即可添加到处方                              │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│  步骤7：提交保存                                         │
│  ┌───────────────────────────────────────────────┐      │
│  │ [提交] 按钮                                    │      │
│  └───────────────────────────────────────────────┘      │
│                                                          │
│  ✓ 登记成功                                              │
│  ✓ 自动生成门诊记录                                      │
│  ✓ 自动更新统计数据                                      │
└─────────────────────────────────────────────────────────┘
```

---

## 系统架构

### 数据流程图

```
┌─────────────────────────────────────────────────────────┐
│                      用户输入                            │
│  • 主诉：崴脚后脚踝疼痛                                  │
│  • 疾病名称：扭伤                                        │
│  • 诊断：（待选择）                                      │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│              performGlobalSearch()                       │
│              全局搜索引擎                                │
├─────────────────────────────────────────────────────────┤
│  输入：                                                  │
│  • diseaseKw = "扭伤"                                    │
│  • complaintKw = "崴脚后脚踝疼痛"                        │
│  • diagnosisKw = ""                                      │
│                                                          │
│  处理：                                                  │
│  1. 在 templateIndex 中搜索（52条模板）                  │
│  2. 多条件匹配（AND逻辑）                                │
│  3. 按匹配度排序                                         │
│                                                          │
│  输出：                                                  │
│  • diseases: ["扭伤"]                                    │
│  • complaints: ["崴脚后脚踝疼痛肿胀", ...]               │
│  • diagnoses: ["踝关节扭伤", "腕关节扭伤", ...]          │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│                  显示下拉列表                            │
│  ┌────────────────────────────────────┐                 │
│  │ 📋 匹配的诊断（8个）                │                 │
│  ├────────────────────────────────────┤                 │
│  │ ⭐ 踝关节扭伤 (最匹配)              │                 │
│  │ □ 腕关节扭伤                        │                 │
│  │ □ 膝关节扭伤                        │                 │
│  │ □ 肩关节扭伤                        │                 │
│  │ □ 软组织扭伤                        │                 │
│  │ □ 关节扭伤                          │                 │
│  │ □ 颈部扭伤                          │                 │
│  │ □ 腰部扭伤                          │                 │
│  └────────────────────────────────────┘                 │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼ 用户点击"踝关节扭伤"
                  │
┌─────────────────────────────────────────────────────────┐
│              selectDiagnosis("踝关节扭伤")               │
│              诊断选择处理                                │
├─────────────────────────────────────────────────────────┤
│  步骤1：查找最匹配的模板记录                             │
│  • findBestMatchingRecord()                              │
│  • 基于诊断、主诉、疾病名称综合匹配                      │
│                                                          │
│  步骤2：智能填充字段                                     │
│  • smartFillFields()                                     │
│  • 只填充空白字段                                        │
│  • 保留用户已输入的内容                                  │
│                                                          │
│  步骤3：更新表单                                         │
│  • form.diagnosis = "踝关节扭伤"                         │
│  • form.diseaseName = "扭伤"                             │
│  • form.symptom = "脚踝肿胀；疼痛；活动受限"             │
│  • form.treatment = "冷敷；包扎固定；制动休息"           │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│                  表单更新完成                            │
│  ✓ 所有相关字段已自动填充                                │
│  ✓ 用户可以继续编辑或提交                                │
└─────────────────────────────────────────────────────────┘
```

### 模板索引结构

```javascript
templateIndex = [
  {
    disease: "扭伤",
    complaint: "崴脚后脚踝疼痛肿胀",
    symptoms: ["脚踝肿胀", "疼痛", "活动受限"],
    diagnoses: ["踝关节扭伤"],
    treatments: ["冷敷", "包扎固定", "制动休息", "抬高患肢"],
    suggestDrugs: ["云南白药气雾剂", "红花油"],
    source: "structured"
  },
  {
    disease: "扭伤",
    complaint: "手腕扭伤后疼痛",
    symptoms: ["手腕肿胀", "疼痛", "活动受限"],
    diagnoses: ["腕关节扭伤"],
    treatments: ["冷敷", "包扎固定", "制动休息"],
    suggestDrugs: ["云南白药气雾剂", "红花油"],
    source: "structured"
  },
  // ... 更多模板
]
```

---

## 常见场景示例

### 场景1：踝关节扭伤（最常见）

```
患者情况：
• 游客在游玩时崴脚
• 脚踝疼痛肿胀
• 活动受限

操作流程：
┌────────────────────────────────────────┐
│ 1. 主诉：崴脚后脚踝疼痛肿胀             │
│ 2. 点击诊断框                           │
│ 3. 选择：踝关节扭伤                     │
│ 4. 系统自动填充：                       │
│    • 疾病名称：扭伤                     │
│    • 症状：脚踝肿胀；疼痛；活动受限     │
│    • 处置：冷敷；包扎固定；制动休息     │
│ 5. 选择用药：云南白药气雾剂             │
│ 6. 提交保存                             │
└────────────────────────────────────────┘

结果：
✓ 登记完成
✓ 诊断准确
✓ 处置规范
```

### 场景2：腕关节扭伤

```
患者情况：
• 员工搬运物品时手腕扭伤
• 手腕疼痛
• 活动受限

操作流程：
┌────────────────────────────────────────┐
│ 1. 主诉：手腕扭伤后疼痛                 │
│ 2. 点击诊断框                           │
│ 3. 选择：腕关节扭伤                     │
│ 4. 系统自动填充：                       │
│    • 疾病名称：扭伤                     │
│    • 症状：手腕肿胀；疼痛；活动受限     │
│    • 处置：冷敷；包扎固定；制动休息     │
│ 5. 选择用药：云南白药气雾剂             │
│ 6. 提交保存                             │
└────────────────────────────────────────┘

结果：
✓ 登记完成
✓ 诊断准确
✓ 处置规范
```

### 场景3：不确定具体部位的扭伤

```
患者情况：
• 患者只说"扭伤了"
• 未明确具体部位
• 需要进一步询问

操作流程：
┌────────────────────────────────────────┐
│ 1. 询问患者：哪里扭伤了？               │
│    • 脚踝？→ 选择"踝关节扭伤"           │
│    • 手腕？→ 选择"腕关节扭伤"           │
│    • 膝盖？→ 选择"膝关节扭伤"           │
│    • 其他？→ 选择"关节扭伤"或"软组织扭伤"│
│                                         │
│ 2. 根据患者回答选择具体诊断             │
│ 3. 系统自动填充对应信息                 │
│ 4. 提交保存                             │
└────────────────────────────────────────┘

提示：
• 尽量选择具体的诊断
• 有利于后续统计分析
• 便于追踪治疗效果
```

### 场景4：多处扭伤

```
患者情况：
• 患者摔倒
• 同时扭伤了脚踝和手腕
• 需要记录多个诊断

操作流程：
┌────────────────────────────────────────┐
│ 1. 主诉：摔倒后脚踝和手腕疼痛           │
│ 2. 诊断：踝关节扭伤；腕关节扭伤         │
│    （用分号分隔多个诊断）               │
│ 3. 症状：脚踝肿胀；手腕肿胀；疼痛       │
│ 4. 处置：冷敷；包扎固定；制动休息       │
│ 5. 选择用药：云南白药气雾剂             │
│ 6. 提交保存                             │
└────────────────────────────────────────┘

提示：
• 多个诊断用分号（；）分隔
• 症状和处置也可以合并描述
• 系统会自动识别和统计
```

---

## 💡 使用技巧总结

### 技巧1：优先使用主诉联动

```
✓ 先输入主诉 → 再选择诊断
✗ 直接在诊断框搜索
```

**原因**：
- 主诉联动可以缩小诊断范围
- 系统会优先推荐最匹配的诊断
- 提高选择效率

### 技巧2：选择具体的诊断

```
✓ 踝关节扭伤（具体）
✗ 扭伤（笼统）
```

**原因**：
- 具体诊断更准确
- 有利于统计分析
- 便于追踪治疗效果

### 技巧3：检查自动填充的内容

```
选择诊断后：
□ 检查主诉是否准确
□ 检查症状是否完整
□ 检查处置是否合适
□ 根据实际情况调整
```

**原因**：
- 自动填充只是参考模板
- 每个患者情况不同
- 需要根据实际情况调整

### 技巧4：善用键盘快捷键

```
Tab      → 跳转到下一个输入框
↑ ↓      → 在下拉列表中选择
Enter    → 确认选择
Esc      → 关闭下拉列表
```

**原因**：
- 提高输入效率
- 减少鼠标操作
- 更快完成登记

---

## 🔧 故障排除

### 问题1：下拉列表不显示

**可能原因**：
- 输入框为空
- 没有匹配的诊断
- 系统正在加载

**解决方案**：
1. 确保已输入关键词
2. 尝试输入更通用的关键词（如"扭伤"）
3. 刷新页面重试

### 问题2：选择诊断后没有自动填充

**可能原因**：
- 该诊断没有对应的模板
- 系统正在处理
- 网络延迟

**解决方案**：
1. 等待几秒钟
2. 手动输入相关信息
3. 如果经常出现，联系技术支持

### 问题3：自动填充的内容不准确

**可能原因**：
- 模板内容需要更新
- 选择的诊断不够具体
- 患者情况特殊

**解决方案**：
1. 手动修改不准确的内容
2. 选择更具体的诊断
3. 反馈给管理员更新模板

### 问题4：找不到合适的诊断

**可能原因**：
- 该诊断不在模板库中
- 关键词不匹配
- 疾病类型特殊

**解决方案**：
1. 手动输入诊断
2. 选择最接近的诊断
3. 反馈给管理员添加新模板

---

## 📞 技术支持

如有任何问题，请参考以下文档：

1. **《扭伤诊断选择使用指南.md》**
   - 专门针对扭伤诊断的详细说明

2. **《选择诊断参考按钮逻辑说明.md》**
   - 诊断参考按钮的工作原理

3. **《辅助诊断功能优化方案.md》**
   - 诊断功能的优化方案

4. **《诊断字段关联逻辑优化方案.md》**
   - 字段关联的详细说明

---

**最后更新**：2024-12-24
**版本**：v3.15

