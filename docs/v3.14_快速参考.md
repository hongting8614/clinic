# ğŸš€ v3.14 åŒè½¨åˆ¶å­˜å‚¨ - å¿«é€Ÿå‚è€ƒå¡

## ğŸ“¦ æ ¸å¿ƒæ¦‚å¿µï¼ˆ30ç§’ç†è§£ï¼‰

```
ğŸ¯ åŒè½¨åˆ¶å­˜å‚¨ = è¯åº“ç”¨åŒ…è£… + å›­åŒºç”¨æœ€å° + å‡ºåº“è‡ªåŠ¨è½¬æ¢

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ¥ è¯åº“    â”‚   å‡ºåº“è‡ªåŠ¨è½¬æ¢    â”‚  ğŸ¢ å›­åŒº     â”‚
â”‚   104ç›’     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚   48ç²’      â”‚
â”‚  (åŒ…è£…å•ä½)  â”‚    2ç›’ Ã— 24      â”‚ (æœ€å°å•ä½)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘                                 â†“
   å…¥åº“100ç›’                        é—¨è¯Šæ¶ˆè€—6ç²’
                                   (ç›´æ¥æ‰£å‡)
```

---

## ğŸ”§ å·¥å…·ç±»ä½¿ç”¨ï¼ˆ1åˆ†é’Ÿä¸Šæ‰‹ï¼‰

### å¯¼å…¥
```javascript
import UnitConverter from '@/utils/unitConverter.js'
```

### 1. è§„æ ¼è§£æ
```javascript
const specInfo = UnitConverter.parseSpecification('0.25gÃ—24ç²’/ç›’')
// è¿”å›: { conversionRate: 24, minUnit: 'ç²’', packUnit: 'ç›’', ... }
```

### 2. å•ä½è½¬æ¢
```javascript
// åŒ…è£… â†’ æœ€å°
const min = UnitConverter.packToMin(2, 24)  // 2ç›’ Ã— 24 = 48ç²’

// æœ€å° â†’ åŒ…è£…
const pack = UnitConverter.minToPack(48, 24)  // 48ç²’ Ã· 24 = 2ç›’
```

### 3. æ™ºèƒ½æ˜¾ç¤º
```javascript
// åº“å­˜æ˜¾ç¤ºï¼ˆæ ¹æ®å›­åŒºè‡ªåŠ¨åˆ¤æ–­ï¼‰
const display = UnitConverter.formatStockDisplay(stock)
// è¯åº“: "104ç›’"
// å›­åŒº: "42ç²’ (1ç›’é›¶18ç²’)"
```

---

## ğŸ’Š ä¸šåŠ¡æµç¨‹ï¼ˆ3åˆ†é’ŸæŒæ¡ï¼‰

### æµç¨‹1: å…¥åº“ï¼ˆåŒ…è£…å•ä½ï¼‰
```javascript
// âœ… ç»Ÿä¸€å…¥åº“åˆ°è¯åº“ï¼Œä½¿ç”¨åŒ…è£…å•ä½
{
  location: 'drug_storage',
  quantity: 10,    // åŒ…è£…æ•°é‡
  unit: 'ç›’'       // åŒ…è£…å•ä½
}
```

### æµç¨‹2: å‡ºåº“ï¼ˆè‡ªåŠ¨è½¬æ¢ï¼‰â­
```javascript
// âœ… ç”¨æˆ·è¾“å…¥åŒ…è£…å•ä½ï¼Œç³»ç»Ÿè‡ªåŠ¨è½¬æ¢
è¾“å…¥: 2ç›’
ç³»ç»Ÿå¤„ç†:
  1. è§£æè§„æ ¼: 24ç²’/ç›’
  2. è½¬æ¢æ•°é‡: 2 Ã— 24 = 48ç²’
  3. è¯åº“æ‰£å‡: -2ç›’
  4. å›­åŒºå¢åŠ : +48ç²’ â­
```

### æµç¨‹3: é—¨è¯Šæ¶ˆè€—ï¼ˆç›´æ¥æ‰£å‡ï¼‰
```javascript
// âœ… ç›´æ¥æ‰£å‡æœ€å°å•ä½ï¼Œæ— éœ€è½¬æ¢
å›­åŒºåº“å­˜: 48ç²’
æ‚£è€…ç”¨è¯: 6ç²’
æ‰£å‡ç»“æœ: 48 - 6 = 42ç²’ â­
```

---

## ğŸ“ å…³é”®å­—æ®µï¼ˆå¿…é¡»çŸ¥é“ï¼‰

### stock è¡¨
```javascript
{
  location: "drug_storage" | "land_park" | "water_park",
  quantity: Number,        // åŠ¨æ€å•ä½ï¼ˆè¯åº“=åŒ…è£…ï¼Œå›­åŒº=æœ€å°ï¼‰
  unit: String,           // åŠ¨æ€å•ä½ï¼ˆè¯åº“=ç›’ï¼Œå›­åŒº=ç²’ï¼‰
  specInfo: {             // â­ è§„æ ¼ä¿¡æ¯ï¼ˆæ–°å¢ï¼‰
    conversionRate: 24,
    minUnit: "ç²’",
    packUnit: "ç›’"
  },
  pricePerMin: Number     // â­ æœ€å°å•ä½å•ä»·ï¼ˆæ–°å¢ï¼‰
}
```

### out_records è¡¨
```javascript
{
  fromLocation: "drug_storage",
  toLocation: "land_park",
  items: [{
    packQuantity: 2,      // è¯åº“æ‰£å‡ï¼ˆåŒ…è£…ï¼‰
    packUnit: "ç›’",
    minQuantity: 48,      // â­ å›­åŒºå¢åŠ ï¼ˆæœ€å°ï¼‰
    minUnit: "ç²’",
    specInfo: { ... },
    drugStorageBefore: 10,  // åº“å­˜å˜åŒ–è®°å½•
    drugStorageAfter: 8,
    parkBefore: 0,
    parkAfter: 48
  }]
}
```

---

## ğŸ¨ ç•Œé¢æ˜¾ç¤ºï¼ˆè®°ä½è¿™ä¸ªï¼‰

### è¯åº“æ˜¾ç¤ºï¼ˆç®€æ´ï¼‰
```
ğŸ’Š åº“å­˜: 104ç›’
```

### å›­åŒºæ˜¾ç¤ºï¼ˆè¯¦ç»†+æ¢ç®—ï¼‰
```
ğŸ’Š åº“å­˜: 42ç²’ (1ç›’é›¶18ç²’)
         â†‘           â†‘
      ä¸»æ˜¾ç¤º      æ¢ç®—æç¤º
```

---

## âš¡ å¸¸ç”¨ä»£ç ç‰‡æ®µ

### ç‰‡æ®µ1: è§£æå¹¶éªŒè¯è§„æ ¼
```javascript
const specInfo = UnitConverter.parseSpecification(specification)
if (!specInfo) {
  throw new Error('æ— æ³•è§£æè§„æ ¼ï¼Œè¯·æ£€æŸ¥æ ¼å¼')
}
console.log(`è½¬æ¢ç‡: 1${specInfo.packUnit} = ${specInfo.conversionRate}${specInfo.minUnit}`)
```

### ç‰‡æ®µ2: å‡ºåº“è½¬æ¢
```javascript
// ç”¨æˆ·è¾“å…¥å‡ºåº“æ•°é‡ï¼ˆåŒ…è£…å•ä½ï¼‰
const packQuantity = 2  // 2ç›’
const specInfo = UnitConverter.parseSpecification(drug.specification)
const minQuantity = UnitConverter.packToMin(packQuantity, specInfo.conversionRate)

console.log(`å‡ºåº“ ${packQuantity}${specInfo.packUnit} â†’ å›­åŒºå…¥åº“ ${minQuantity}${specInfo.minUnit}`)
// è¾“å‡º: "å‡ºåº“ 2ç›’ â†’ å›­åŒºå…¥åº“ 48ç²’"
```

### ç‰‡æ®µ3: åº“å­˜æŸ¥è¯¢æ˜¾ç¤º
```javascript
// æŸ¥è¯¢åº“å­˜
const stock = await db.collection('stock')
  .where({ drugId, location })
  .get()

// æ ¼å¼åŒ–æ˜¾ç¤º
const display = UnitConverter.formatStockDisplay(stock.data[0])
console.log(`å½“å‰åº“å­˜: ${display}`)
```

---

## ğŸ” å¿«é€Ÿæ•…éšœæ’æŸ¥

### é—®é¢˜1: è§„æ ¼è§£æå¤±è´¥
```javascript
âŒ ç—‡çŠ¶: parseSpecification è¿”å› null
âœ… æ£€æŸ¥: è§„æ ¼æ ¼å¼æ˜¯å¦ç¬¦åˆ4ç§æ¨¡å¼
âœ… è§£å†³: 
   - æ ‡å‡†æ ¼å¼: 0.25gÃ—24ç²’/ç›’
   - ç®€åŒ–æ ¼å¼: 0.1Ã—12ç²’/ç›’ æˆ– 24ç²’/ç›’
   - å•ä¸€åŒ…è£…: 20g/æ”¯
   - çº¯æ•°é‡: 100ç‰‡
```

### é—®é¢˜2: è½¬æ¢æ•°é‡é”™è¯¯
```javascript
âŒ ç—‡çŠ¶: å›­åŒºåº“å­˜æ•°é‡ä¸å¯¹
âœ… æ£€æŸ¥: 
   1. specInfo.conversionRate æ˜¯å¦æ­£ç¡®
   2. éªŒè¯: minQuantity = packQuantity Ã— conversionRate
   3. æŸ¥çœ‹å‡ºåº“è®°å½•çš„ items å­—æ®µ
```

### é—®é¢˜3: æ˜¾ç¤ºæ ¼å¼å¼‚å¸¸
```javascript
âŒ ç—‡çŠ¶: å›­åŒºåº“å­˜æ˜¾ç¤ºä¸å¯¹
âœ… æ£€æŸ¥:
   1. stock.unit åº”ä¸ºæœ€å°å•ä½ï¼ˆç²’/ç‰‡/mlï¼‰
   2. stock.specInfo å­—æ®µæ˜¯å¦å­˜åœ¨
   3. location å­—æ®µæ˜¯å¦æ­£ç¡®
```

---

## ğŸ“š æ”¯æŒçš„è§„æ ¼æ ¼å¼

```javascript
âœ… æ ‡å‡†æ ¼å¼: 0.25gÃ—24ç²’/ç›’
âœ… ç®€åŒ–æ ¼å¼: 0.1Ã—12ç²’/ç›’  â­ å…³é”®
âœ… ç®€åŒ–æ ¼å¼: 24ç²’/ç›’
âœ… å•ä¸€åŒ…è£…: 20g/æ”¯
âœ… çº¯æ•°é‡: 100ç‰‡

âŒ ä¸æ”¯æŒ: "24ç²’" (æ²¡æœ‰åŒ…è£…å•ä½)
âŒ ä¸æ”¯æŒ: "0.25g" (æ²¡æœ‰æ•°é‡)
```

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿ï¼ˆè®°ä½è¿™3ç‚¹ï¼‰

```
1ï¸âƒ£ ç¬¦åˆå®é™…ä¸šåŠ¡
   âœ… è¯åº“ä»“å‚¨ä¹ æƒ¯ï¼ˆæ•´ç®±æ•´ç›’ï¼‰
   âœ… å›­åŒºè¯Šç–—ç²¾åº¦ï¼ˆç²¾ç¡®åˆ°ç²’ï¼‰

2ï¸âƒ£ æé«˜æ€§èƒ½
   âœ… é—¨è¯Šæ¶ˆè€—æ— éœ€è½¬æ¢ï¼ˆç›´æ¥æ‰£å‡ï¼‰
   âœ… å‡å°‘è®¡ç®—å¤æ‚åº¦ 70%

3ï¸âƒ£ æ•°æ®ç²¾ç¡®
   âœ… é¿å…åå¤è½¬æ¢çš„ç²¾åº¦æŸå¤±
   âœ… å®¡è®¡è¿½è¸ªå®Œæ•´
```

---

## ğŸ“ å¿«é€Ÿé“¾æ¥

- ğŸ“– **å®Œæ•´æ–‡æ¡£**: `docs/v3.14_å®æ–½æŒ‡å—.md`
- ğŸ¨ **ç•Œé¢è®¾è®¡**: `_backup_docs/ğŸ“åˆ†å›­åŒºå•ä½è½¬æ¢ç•Œé¢è®¾è®¡_v3.14_ç»ˆæç‰ˆ.md`
- ğŸ’¾ **æ•°æ®åº“è®¾è®¡**: `docs/æ•°æ®åº“è®¾è®¡_v3.14_åŒè½¨åˆ¶.md`
- ğŸ‰ **å®ŒæˆæŠ¥å‘Š**: `docs/v3.14_å®ŒæˆæŠ¥å‘Š.md`

---

## ğŸš€ ä¸€å¥è¯æ€»ç»“

**è¯åº“ç”¨åŒ…è£…ï¼Œå›­åŒºç”¨æœ€å°ï¼Œå‡ºåº“è‡ªåŠ¨è½¬æ¢ï¼**

---

**ç‰ˆæœ¬**: v3.14 Ultimate  
**æ›´æ–°**: 2025-11-06







