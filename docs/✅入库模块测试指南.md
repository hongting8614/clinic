# ✅ 入库模块测试指南

## 📋 测试概览

已创建完整的入库模块测试页面,包含8个核心测试项目。

---

## 🎯 测试项目列表

### 1. API命名测试 - action: add
**测试目的**: 验证新的 `add` action 是否可用  
**预期结果**: ✅ 成功创建入库单  
**测试数据**: 空药品列表的草稿单

### 2. API命名测试 - action: create
**测试目的**: 验证旧的 `create` action 向后兼容  
**预期结果**: ✅ 成功创建入库单  
**测试数据**: 空药品列表的草稿单

### 3. 创建完整入库单
**测试目的**: 测试创建包含药品的完整入库单  
**预期结果**: ✅ 成功创建包含2种药品的入库单  
**测试数据**: 
- 阿莫西林胶囊 100盒
- 头孢克肟颗粒 50盒

### 4. 获取入库单列表
**测试目的**: 测试获取入库单列表功能  
**预期结果**: ✅ 返回入库单列表数据  
**测试参数**: 
- pageSize: 10
- pageNum: 1

### 5. 获取入库单详情
**测试目的**: 测试获取单个入库单详情  
**预期结果**: ✅ 返回完整的入库单信息  
**前置条件**: 需要先运行测试3创建入库单

### 6. 获取统计数据
**测试目的**: 测试获取入库统计功能  
**预期结果**: ✅ 返回统计数据  
**统计项**: 
- 今日入库
- 本周入库
- 本月入库
- 待审核数量

### 7. 双签名测试
**测试目的**: 测试入库人和复核人双签名  
**预期结果**: ✅ 成功保存双签名信息  
**测试数据**: 
- 入库人: 李医生
- 复核人: 王医生

### 8. 数据验证测试
**测试目的**: 测试必填字段验证  
**预期结果**: ✅ 验证生效,返回错误提示  
**测试方法**: 故意提交空数据

---

## 🚀 使用方法

### 方法1: 在pages.json中添加测试页面

```json
{
  "pages": [
    // ... 其他页面
    {
      "path": "pages/test/inbound-test",
      "style": {
        "navigationBarTitleText": "入库模块测试",
        "enablePullDownRefresh": false
      }
    }
  ]
}
```

### 方法2: 直接访问测试页面

在小程序中使用:
```javascript
uni.navigateTo({
  url: '/pages/test/inbound-test'
});
```

---

## 📱 测试界面说明

### 页面结构

```
┌─────────────────────────────────┐
│  📦 入库模块测试                │
│  Inbound Module Test            │
├─────────────────────────────────┤
│  测试进度                        │
│  ████████░░░░░░░░░░ 50%        │
│  4/8 已完成                     │
├─────────────────────────────────┤
│  ⚪ 1. API命名测试 - add        │
│     [开始测试]                  │
│  ✅ 2. API命名测试 - create    │
│     ✅ 通过                     │
│  ✅ 3. 创建完整入库单           │
│     ✅ 通过                     │
│  ...                            │
├─────────────────────────────────┤
│  [🚀 运行所有测试]              │
│  [🔄 重置所有测试]              │
├─────────────────────────────────┤
│  📊 测试报告                    │
│  总测试项: 8  通过: 6           │
│  失败: 0     通过率: 100%       │
└─────────────────────────────────┘
```

### 测试状态说明

| 图标 | 状态 | 说明 |
|------|------|------|
| ⚪ | 待测试 | 尚未开始测试 |
| 🔵 | 测试中 | 正在执行测试 |
| ✅ | 已通过 | 测试成功 |
| ❌ | 已失败 | 测试失败 |

---

## 🔧 测试操作

### 单个测试
1. 点击测试项右侧的 **[开始测试]** 按钮
2. 等待测试完成
3. 查看测试结果

### 批量测试
1. 点击底部的 **[🚀 运行所有测试]** 按钮
2. 系统会自动依次执行所有测试
3. 查看测试报告

### 重新测试
1. 点击失败测试项的 **[重新测试]** 按钮
2. 或点击 **[🔄 重置所有测试]** 重置所有测试

### 查看详情
1. 点击测试项展开详情
2. 查看请求参数和响应结果
3. 如果失败,查看错误信息

---

## 📊 测试报告

测试完成后,页面底部会显示测试报告:

```
┌─────────────────────────────────┐
│  📊 测试报告                    │
├─────────────────────────────────┤
│  总测试项        通过           │
│     8             7             │
│  失败           通过率          │
│     1            87%            │
└─────────────────────────────────┘
```

---

## ✅ 测试检查清单

### 部署前检查
- [ ] 云函数 `inRecords` 已部署
- [ ] 云函数支持 `action: 'add'`
- [ ] 云函数支持 `action: 'create'`
- [ ] 数据库集合 `in_records` 已创建

### 功能测试
- [ ] API命名测试通过
- [ ] 创建入库单成功
- [ ] 获取列表成功
- [ ] 获取详情成功
- [ ] 统计数据正确
- [ ] 双签名保存成功
- [ ] 数据验证生效

### 性能测试
- [ ] 响应时间 < 2秒
- [ ] 无内存泄漏
- [ ] 无崩溃

---

## 🐛 常见问题

### 问题1: 测试失败 - "云函数未部署"
**原因**: 云函数 `inRecords` 未部署或未更新  
**解决**: 
```bash
1. 打开微信开发者工具
2. 进入云开发控制台
3. 找到 inRecords 云函数
4. 右键 → 上传并部署：云端安装依赖
```

### 问题2: 测试失败 - "未知操作"
**原因**: 云函数不支持 `action: 'add'`  
**解决**: 
```bash
1. 确认已修改 cloudfunctions/inRecords/index.js
2. 添加了 case 'add': 分支
3. 重新部署云函数
```

### 问题3: 测试失败 - "数据库集合不存在"
**原因**: 数据库集合 `in_records` 未创建  
**解决**: 
```bash
1. 打开微信开发者工具
2. 进入云开发 → 数据库
3. 点击"添加集合"
4. 输入集合名称: in_records
5. 点击"确定"
```

### 问题4: 测试5失败 - "请先运行测试3"
**原因**: 测试5依赖测试3创建的记录ID  
**解决**: 
```bash
1. 先运行测试3创建入库单
2. 再运行测试5获取详情
或
点击"运行所有测试"按钮,自动按顺序执行
```

---

## 📝 测试数据说明

### 测试用药品数据
```javascript
{
  drugId: 'test_drug_001',
  drugName: '阿莫西林胶囊',
  spec: '0.25g*24粒',
  unit: '盒',
  manufacturer: '华北制药',
  batch: 'TEST001',
  productionDate: '2025-01-01',
  expireDate: '2027-01-01',
  quantity: 100,
  price: 15.5
}
```

### 测试用签名数据
```javascript
{
  operator: '李医生',
  operatorId: 'user_001',
  operatorSign: 'cloud://sign_001.png',
  reviewer: '王医生',
  reviewerId: 'user_002',
  reviewerSign: 'cloud://sign_002.png'
}
```

---

## 🎯 预期测试结果

### 全部通过的情况
```
✅ 1. API命名测试 - action: add
✅ 2. API命名测试 - action: create
✅ 3. 创建完整入库单
✅ 4. 获取入库单列表
✅ 5. 获取入库单详情
✅ 6. 获取统计数据
✅ 7. 双签名测试
✅ 8. 数据验证测试

测试报告:
- 总测试项: 8
- 通过: 8
- 失败: 0
- 通过率: 100%
```

---

## 🚀 下一步

测试通过后:
1. ✅ 确认入库模块功能正常
2. ✅ 开始实际使用入库功能
3. ✅ 按照设计方案实现优化功能

---

## 📖 相关文档

- 设计方案: `docs/入库功能优化设计方案_v4.0.md`
- API修复: `docs/入库模块API修复说明.md`
- 测试页面: `pages/test/inbound-test.vue`

---

**创建时间**: 2025-11-08  
**测试页面**: `pages/test/inbound-test.vue`  
**状态**: ✅ 可用


