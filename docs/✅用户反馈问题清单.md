# ✅ 用户反馈问题清单

## 📋 问题汇总 (2025-11-08)

### 🔴 紧急问题

#### 1. 签名功能问题
- ❌ **问题1**: 为什么用两个签名处,怎么不合并一个
- ❌ **问题2**: 点击放大,不用横屏
- ❌ **问题3**: 现在点击后不能签名

#### 2. 入库药材排序问题
- ❌ **问题**: 后入库药材排上,方便查看,进库后按入库顺序排

#### 3. 查询功能缺失
- ❌ **问题1**: 要有查询入库单功能(按时间或药名)
- ❌ **问题2**: 库存查询功能
- ❌ **问题3**: 入库单报表
- ❌ **问题4**: 库存报表
- ❌ **问题5**: 报表字段标头设计按规定

---

## 🎯 解决方案

### 1. 签名功能优化

#### 问题分析
- 当前使用双签名(入库人+复核人)是为了符合药材管理规范
- 签名组件点击后无法签名可能是组件加载问题

#### 解决方案

**方案A: 保留双签名但优化流程**
```
优点: 符合规范,责任明确
缺点: 需要两次签名

流程:
1. 填写入库信息
2. 入库人签名
3. 复核人签名(可选)
4. 提交
```

**方案B: 合并为单签名**
```
优点: 操作简单
缺点: 不符合药材管理规范

流程:
1. 填写入库信息
2. 经办人签名
3. 提交
```

**推荐**: 方案A + 优化
- 保留双签名(符合规范)
- 复核人签名改为可选
- 修复签名组件无法签名的问题
- 签名界面改为全屏竖屏(不横屏)

#### 修复计划
1. ✅ 修复签名组件点击无响应问题
2. ✅ 优化签名界面为全屏竖屏
3. ✅ 复核人签名改为可选
4. ✅ 添加"跳过复核"选项

---

### 2. 入库药材排序优化

#### 当前问题
- 药材列表按添加顺序排列
- 新添加的药材在底部,不方便查看

#### 解决方案
```javascript
// 新添加的药材排在最上面
drugList.unshift(newDrug)  // 而不是 push

// 或者按入库时间倒序排列
drugList.sort((a, b) => {
  return new Date(b.createTime) - new Date(a.createTime)
})
```

#### 实现位置
- 文件: `pages-sub/in/add.vue`
- 文件: `pages-sub/in/list.vue`

---

### 3. 查询功能实现

#### 3.1 入库单查询

**查询条件**:
- 时间范围(开始日期-结束日期)
- 药材名称
- 供应商
- 入库人
- 单据状态

**界面设计**:
```
┌─────────────────────────────────┐
│  🔍 入库单查询                  │
├─────────────────────────────────┤
│  时间范围:                      │
│  [2025-01-01] 至 [2025-12-31]  │
│                                 │
│  药材名称:                      │
│  [输入药材名称]                 │
│                                 │
│  供应商:                        │
│  [输入供应商名称]               │
│                                 │
│  [🔍 查询] [🔄 重置]            │
├─────────────────────────────────┤
│  查询结果: 共 10 条             │
│  ┌─────────────────────────┐   │
│  │ RK20251108001           │   │
│  │ 阿莫西林胶囊 100盒      │   │
│  │ 2025-11-08 10:30        │   │
│  └─────────────────────────┘   │
└─────────────────────────────────┘
```

#### 3.2 库存查询

**查询条件**:
- 药材名称
- 药材分类
- 库存状态(正常/近效期/过期)
- 所属园区

**界面设计**:
```
┌─────────────────────────────────┐
│  🔍 库存查询                    │
├─────────────────────────────────┤
│  药材名称:                      │
│  [输入药材名称]                 │
│                                 │
│  所属园区:                      │
│  [全部] [陆园] [水园]          │
│                                 │
│  库存状态:                      │
│  [全部] [正常] [近效期] [过期] │
│                                 │
│  [🔍 查询] [🔄 重置]            │
├─────────────────────────────────┤
│  查询结果: 共 50 条             │
│  ┌─────────────────────────┐   │
│  │ 阿莫西林胶囊            │   │
│  │ 库存: 500盒 | 陆园      │   │
│  │ 有效期: 2027-01-01      │   │
│  └─────────────────────────┘   │
└─────────────────────────────────┘
```

---

### 4. 报表功能实现

#### 4.1 入库单报表

**报表字段**:
```
┌────────────────────────────────────────────────────┐
│              入库单汇总报表                        │
│              统计时间: 2025-11-01 至 2025-11-30   │
├────┬──────┬──────┬────┬────┬────┬────┬──────┤
│序号│入库日期│单据号│药材名│规格│数量│单价│金额  │
├────┼──────┼──────┼────┼────┼────┼────┼──────┤
│ 1  │11-01 │RK001 │阿莫│0.25│100 │15.5│1550  │
│ 2  │11-02 │RK002 │头孢│50mg│50  │28.0│1400  │
│ 3  │11-03 │RK003 │布洛│0.1g│80  │12.0│960   │
├────┴──────┴──────┴────┴────┴────┴────┼──────┤
│                              合计金额│3910  │
└──────────────────────────────────────┴──────┘
```

**标头设计**:
```
报表名称: 入库单汇总报表
单位名称: 北京欢乐谷医务室
统计时间: YYYY-MM-DD 至 YYYY-MM-DD
制表人: XXX
制表日期: YYYY-MM-DD
```

#### 4.2 库存报表

**报表字段**:
```
┌────────────────────────────────────────────────────┐
│              药材库存汇总报表                      │
│              统计时间: 2025-11-30                 │
├────┬──────┬──────┬────┬────┬────┬────┬──────┤
│序号│药材名│规格  │单位│批号│效期│库存│金额  │
├────┼──────┼──────┼────┼────┼────┼────┼──────┤
│ 1  │阿莫西│0.25g │盒  │A001│27-1│500 │7750  │
│ 2  │头孢克│50mg  │盒  │B001│27-2│300 │8400  │
│ 3  │布洛芬│0.1g  │盒  │C001│27-3│200 │2400  │
├────┴──────┴──────┴────┴────┴────┼────┼──────┤
│                          合计数量│1000│18550 │
└──────────────────────────────────┴────┴──────┘
```

**标头设计**:
```
报表名称: 药材库存汇总报表
单位名称: 北京欢乐谷医务室
统计日期: YYYY-MM-DD
制表人: XXX
制表日期: YYYY-MM-DD
```

---

## 🚀 实施计划

### 第一阶段: 紧急修复 (1-2小时)
- [ ] 修复签名组件无法签名问题
- [ ] 优化签名界面为全屏竖屏
- [ ] 修改药材列表排序(新的在上)

### 第二阶段: 查询功能 (3-4小时)
- [ ] 实现入库单查询功能
- [ ] 实现库存查询功能
- [ ] 添加查询条件和筛选

### 第三阶段: 报表功能 (4-5小时)
- [ ] 设计报表模板
- [ ] 实现入库单报表
- [ ] 实现库存报表
- [ ] 添加导出功能

### 第四阶段: 优化完善 (2-3小时)
- [ ] 复核人签名改为可选
- [ ] 添加"跳过复核"选项
- [ ] 优化用户体验
- [ ] 测试验证

---

## 📝 详细设计文档

### 1. 签名功能修复
- 文档: `docs/签名功能修复方案.md`
- 组件: `components/signature/signature-v3.vue`

### 2. 排序功能优化
- 文档: `docs/入库药材排序优化.md`
- 页面: `pages-sub/in/add.vue`

### 3. 查询功能实现
- 文档: `docs/查询功能设计方案.md`
- 页面: `pages-sub/in/search.vue`
- 页面: `pages/stock/search.vue`

### 4. 报表功能实现
- 文档: `docs/报表功能设计方案.md`
- 页面: `pages-sub/report/inbound.vue`
- 页面: `pages-sub/report/stock.vue`

---

## ✅ 验收标准

### 签名功能
- [ ] 点击后可以正常签名
- [ ] 签名界面全屏竖屏显示
- [ ] 复核人签名可选
- [ ] 可以跳过复核直接提交

### 排序功能
- [ ] 新添加的药材显示在最上面
- [ ] 入库单列表按时间倒序
- [ ] 查看入库单时药材按入库顺序

### 查询功能
- [ ] 可以按时间范围查询入库单
- [ ] 可以按药材名称查询入库单
- [ ] 可以按条件查询库存
- [ ] 查询结果准确

### 报表功能
- [ ] 入库单报表字段完整
- [ ] 库存报表字段完整
- [ ] 报表标头符合规定
- [ ] 可以导出报表

---

**反馈时间**: 2025-11-08  
**优先级**: 🔴 高  
**预计完成**: 2-3天


