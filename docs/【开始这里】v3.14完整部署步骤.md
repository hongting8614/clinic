# ğŸš€ v3.14 åŒè½¨åˆ¶å­˜å‚¨ - å®Œæ•´éƒ¨ç½²æ­¥éª¤

> **ä»é›¶å¼€å§‹ï¼Œä¸€æ­¥æ­¥å®Œæˆæ•´ä¸ªç³»ç»Ÿçš„éƒ¨ç½²å’Œæµ‹è¯•**

---

## ğŸ“‹ ç›®å½•

- [ç¬¬ä¸€éƒ¨åˆ†ï¼šç¯å¢ƒå‡†å¤‡](#ç¬¬ä¸€éƒ¨åˆ†ç¯å¢ƒå‡†å¤‡)
- [ç¬¬äºŒéƒ¨åˆ†ï¼šäº‘å‡½æ•°éƒ¨ç½²](#ç¬¬äºŒéƒ¨åˆ†äº‘å‡½æ•°éƒ¨ç½²)
- [ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”Ÿæˆæµ‹è¯•æ•°æ®](#ç¬¬ä¸‰éƒ¨åˆ†ç”Ÿæˆæµ‹è¯•æ•°æ®)
- [ç¬¬å››éƒ¨åˆ†ï¼šåŠŸèƒ½æµ‹è¯•](#ç¬¬å››éƒ¨åˆ†åŠŸèƒ½æµ‹è¯•)
- [ç¬¬äº”éƒ¨åˆ†ï¼šå¸¸è§é—®é¢˜](#ç¬¬äº”éƒ¨åˆ†å¸¸è§é—®é¢˜)

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šç¯å¢ƒå‡†å¤‡

### æ­¥éª¤1.1ï¼šæ£€æŸ¥é¡¹ç›®çŠ¶æ€

**æ“ä½œ**ï¼šåœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€é¡¹ç›®

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] é¡¹ç›®è·¯å¾„ï¼š`D:\AK-PMS`
- [ ] äº‘å¼€å‘å·²å¼€é€š
- [ ] ç¯å¢ƒIDæ˜¾ç¤ºï¼š`cloud1-3gv7spppf7d2d0f4`

**é¢„æœŸç»“æœ**ï¼š
```
âœ… äº‘å¼€å‘åˆå§‹åŒ–æˆåŠŸï¼ç¯å¢ƒID: cloud1-3gv7spppf7d2d0f4
```

---

### æ­¥éª¤1.2ï¼šç¼–è¯‘é¡¹ç›®

**æ“ä½œ**ï¼š
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·é¡¶éƒ¨
2. ç‚¹å‡» **"ç¼–è¯‘"** æŒ‰é’®
3. ç­‰å¾…ç¼–è¯‘å®Œæˆ

**é¢„æœŸç»“æœ**ï¼š
- æ§åˆ¶å°æ˜¾ç¤º "ç¼–è¯‘æˆåŠŸ"
- æ²¡æœ‰çº¢è‰²é”™è¯¯ä¿¡æ¯
- å°ç¨‹åºæ­£å¸¸æ˜¾ç¤ºé¦–é¡µ

**å¦‚æœæœ‰é”™è¯¯**ï¼š
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
- è®°å½•é”™è¯¯å†…å®¹
- ç»§ç»­ä¸‹ä¸€æ­¥ï¼ˆéƒ¨åˆ†é”™è¯¯å¯ä»¥ç¨åä¿®å¤ï¼‰

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šäº‘å‡½æ•°éƒ¨ç½²

### æ­¥éª¤2.1ï¼šæ£€æŸ¥äº‘å‡½æ•°æ–‡ä»¶

**æ“ä½œ**ï¼šåœ¨ VSCode æˆ–å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ£€æŸ¥æ–‡ä»¶

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] `cloudfunctions/inRecords/index.js` å­˜åœ¨
- [ ] `cloudfunctions/outRecords/index.js` å­˜åœ¨ï¼ˆä¸æ˜¯ `index_v3.14.js`ï¼‰

**å¦‚æœæ–‡ä»¶åæ˜¯ `index_v3.14.js`**ï¼š
1. å³é”®ç‚¹å‡»æ–‡ä»¶
2. é€‰æ‹© "é‡å‘½å"
3. æ”¹ä¸º `index.js`

---

### æ­¥éª¤2.2ï¼šä¸Šä¼  inRecords äº‘å‡½æ•°

**æ“ä½œ**ï¼š
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·å·¦ä¾§æ–‡ä»¶åˆ—è¡¨
2. æ‰¾åˆ° `cloudfunctions/inRecords` æ–‡ä»¶å¤¹
3. **å³é”®ç‚¹å‡»** `inRecords` æ–‡ä»¶å¤¹
4. é€‰æ‹© **"ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–"**
5. ç­‰å¾…ä¸Šä¼ å®Œæˆï¼ˆçº¦10-30ç§’ï¼‰

**é¢„æœŸç»“æœ**ï¼š
```
ä¸Šä¼ æˆåŠŸ
éƒ¨ç½²æˆåŠŸ
```

**éªŒè¯ä¸Šä¼ **ï¼š
1. æ‰“å¼€äº‘å¼€å‘æ§åˆ¶å°
2. ç‚¹å‡» "äº‘å‡½æ•°"
3. æŸ¥çœ‹ `inRecords` çŠ¶æ€ä¸º "éƒ¨ç½²æˆåŠŸ"

---

### æ­¥éª¤2.3ï¼šä¸Šä¼  outRecords äº‘å‡½æ•°

**æ“ä½œ**ï¼š
1. æ‰¾åˆ° `cloudfunctions/outRecords` æ–‡ä»¶å¤¹
2. **å³é”®ç‚¹å‡»** `outRecords` æ–‡ä»¶å¤¹
3. é€‰æ‹© **"ä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–"**
4. ç­‰å¾…ä¸Šä¼ å®Œæˆï¼ˆçº¦10-30ç§’ï¼‰

**é¢„æœŸç»“æœ**ï¼š
```
ä¸Šä¼ æˆåŠŸ
éƒ¨ç½²æˆåŠŸ
```

**éªŒè¯ä¸Šä¼ **ï¼š
1. åœ¨äº‘å¼€å‘æ§åˆ¶å°æŸ¥çœ‹
2. `outRecords` çŠ¶æ€ä¸º "éƒ¨ç½²æˆåŠŸ"

---

### æ­¥éª¤2.4ï¼šæµ‹è¯•äº‘å‡½æ•°

**æ“ä½œ**ï¼šåœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…· **æ§åˆ¶å°ï¼ˆConsoleï¼‰** ä¸­æ‰§è¡Œ

**æµ‹è¯• inRecords**ï¼š
```javascript
wx.cloud.callFunction({
  name: 'inRecords',
  data: { action: 'getCounts' }
}).then(res => {
  console.log('inRecords æµ‹è¯•ç»“æœ:', res)
})
```

**é¢„æœŸç»“æœ**ï¼š
```javascript
inRecords æµ‹è¯•ç»“æœ: {
  result: {
    success: true,
    data: { ... }
  }
}
```

**æµ‹è¯• outRecords**ï¼š
```javascript
wx.cloud.callFunction({
  name: 'outRecords',
  data: { action: 'getCounts' }
}).then(res => {
  console.log('outRecords æµ‹è¯•ç»“æœ:', res)
})
```

**é¢„æœŸç»“æœ**ï¼š
```javascript
outRecords æµ‹è¯•ç»“æœ: {
  result: {
    success: true,
    data: { ... }
  }
}
```

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥äº‘å‡½æ•°æ˜¯å¦ä¸Šä¼ æˆåŠŸ
- æŸ¥çœ‹äº‘å¼€å‘æ§åˆ¶å°æ—¥å¿—
- é‡æ–°ä¸Šä¼ äº‘å‡½æ•°

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”Ÿæˆæµ‹è¯•æ•°æ®

### æ­¥éª¤3.1ï¼šæ‰“å¼€æ§åˆ¶å°

**æ“ä½œ**ï¼š
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·åº•éƒ¨
2. æ‰¾åˆ° **"Console"** æ ‡ç­¾
3. ç‚¹å‡»æ‰“å¼€æ§åˆ¶å°

**ä½ç½®è¯´æ˜**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¾®ä¿¡å¼€å‘è€…å·¥å…·               â”‚
â”‚                                â”‚
â”‚   æ¨¡æ‹Ÿå™¨åŒºåŸŸ                   â”‚
â”‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Console] [Network] [Storage]  â”‚ â† ç‚¹å‡» Console
â”‚                                â”‚
â”‚  è¿™é‡Œæ˜¯æ§åˆ¶å°è¾“å‡ºåŒºåŸŸ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ­¥éª¤3.2ï¼šå¤åˆ¶ç”Ÿæˆè„šæœ¬

**æ“ä½œ**ï¼šå¤åˆ¶ä¸‹é¢çš„å®Œæ•´è„šæœ¬

```javascript
(async function generateTestData() {
  console.log('â”'.repeat(40))
  console.log('ğŸš€ å¼€å§‹ç”Ÿæˆ v3.14 æµ‹è¯•æ•°æ®')
  console.log('â”'.repeat(40))
  
  const db = wx.cloud.database()
  
  try {
    // ============= ç¬¬1æ­¥ï¼šæ·»åŠ åœ°ç‚¹ =============
    console.log('\nğŸ“ ã€ç¬¬1æ­¥ã€‘æ·»åŠ åœ°ç‚¹é…ç½®...')
    const locations = [
      { code: 'drug_storage', name: 'è¯åº“', icon: 'ğŸ¥', type: 'storage', sort: 0 },
      { code: 'land_park', name: 'é™†åœ°å›­åŒº', icon: 'ğŸ¢', type: 'park', sort: 1 },
      { code: 'water_park', name: 'æ°´ä¸Šå›­åŒº', icon: 'ğŸŠ', type: 'park', sort: 2 }
    ]
    
    for (let loc of locations) {
      const exists = await db.collection('locations')
        .where({ code: loc.code })
        .count()
      
      if (exists.total === 0) {
        await db.collection('locations').add({
          data: { 
            ...loc, 
            status: 'active',
            createTime: new Date(),
            updateTime: new Date()
          }
        })
        console.log(`  âœ… æ·»åŠ åœ°ç‚¹ï¼š${loc.name}`)
      } else {
        console.log(`  â„¹ï¸  åœ°ç‚¹å·²å­˜åœ¨ï¼š${loc.name}`)
      }
    }
    console.log('  âœ“ åœ°ç‚¹é…ç½®å®Œæˆ')
    
    // ============= ç¬¬2æ­¥ï¼šæ·»åŠ ä¾›åº”å•† =============
    console.log('\nğŸ¢ ã€ç¬¬2æ­¥ã€‘æ·»åŠ ä¾›åº”å•†...')
    const suppliers = [
      { name: 'åº·ç¾è¯ä¸š', code: 'SUP001', contact: 'å¼ ç»ç†', phone: '13800138000' },
      { name: 'ä¹å·é€šåŒ»è¯', code: 'SUP002', contact: 'æç»ç†', phone: '13800138001' },
      { name: 'åæ¶¦åŒ»è¯', code: 'SUP003', contact: 'ç‹ç»ç†', phone: '13800138002' },
      { name: 'å›½è¯é›†å›¢', code: 'SUP004', contact: 'èµµç»ç†', phone: '13800138003' }
    ]
    
    for (let sup of suppliers) {
      const exists = await db.collection('suppliers')
        .where({ code: sup.code })
        .count()
      
      if (exists.total === 0) {
        await db.collection('suppliers').add({
          data: { 
            ...sup, 
            status: 'active',
            createTime: new Date(),
            updateTime: new Date()
          }
        })
        console.log(`  âœ… æ·»åŠ ä¾›åº”å•†ï¼š${sup.name}`)
      } else {
        console.log(`  â„¹ï¸  ä¾›åº”å•†å·²å­˜åœ¨ï¼š${sup.name}`)
      }
    }
    console.log('  âœ“ ä¾›åº”å•†é…ç½®å®Œæˆ')
    
    // ============= ç¬¬3æ­¥ï¼šæ·»åŠ è¯æ =============
    console.log('\nğŸ’Š ã€ç¬¬3æ­¥ã€‘æ·»åŠ è¯ææ¡£æ¡ˆ...')
    const drugs = [
      { name: 'é˜¿è«è¥¿æ—èƒ¶å›Š', specification: '0.25gÃ—24ç²’', unit: 'ç›’', price: 15.8, category: 'æŠ—ç”Ÿç´ ' },
      { name: 'å¤´å­¢å…‹è‚Ÿç‰‡', specification: '0.1gÃ—12ç‰‡', unit: 'ç›’', price: 28.5, category: 'æŠ—ç”Ÿç´ ' },
      { name: 'å¸ƒæ´›èŠ¬ç¼“é‡Šèƒ¶å›Š', specification: '0.3gÃ—20ç²’', unit: 'ç›’', price: 12.6, category: 'è§£çƒ­é•‡ç—›' },
      { name: 'å¯¹ä¹™é…°æ°¨åŸºé…šç‰‡', specification: '0.5gÃ—16ç‰‡', unit: 'ç›’', price: 8.9, category: 'è§£çƒ­é•‡ç—›' },
      { name: 'æ°¯é›·ä»–å®šç‰‡', specification: '10mgÃ—10ç‰‡', unit: 'ç›’', price: 18.5, category: 'æŠ—è¿‡æ•' },
      { name: 'å°å„¿æ„Ÿå†’ç³–æµ†', specification: '100ml', unit: 'ç“¶', price: 15.2, category: 'å„¿ç§‘ç”¨è¯' },
      { name: 'å¤æ–¹ç”˜è‰å£æœæ¶²', specification: '10mlÃ—6æ”¯', unit: 'ç›’', price: 22.5, category: 'å‘¼å¸ç³»ç»Ÿ' },
      { name: 'æ¿è“æ ¹é¢—ç²’', specification: '10gÃ—20è¢‹', unit: 'ç›’', price: 16.8, category: 'ä¸­æˆè¯' }
    ]
    
    const addedDrugs = []
    for (let drug of drugs) {
      const exists = await db.collection('drugs')
        .where({ name: drug.name, specification: drug.specification })
        .get()
      
      if (exists.data.length === 0) {
        const result = await db.collection('drugs').add({
          data: { 
            ...drug, 
            status: 'active',
            createTime: new Date(),
            updateTime: new Date()
          }
        })
        addedDrugs.push({ _id: result._id, ...drug })
        console.log(`  âœ… æ·»åŠ è¯æï¼š${drug.name}`)
      } else {
        addedDrugs.push({ _id: exists.data[0]._id, ...drug })
        console.log(`  â„¹ï¸  è¯æå·²å­˜åœ¨ï¼š${drug.name}`)
      }
    }
    console.log(`  âœ“ è¯ææ¡£æ¡ˆå®Œæˆï¼ˆå…± ${addedDrugs.length} ç§ï¼‰`)
    
    // ============= ç¬¬4æ­¥ï¼šç”Ÿæˆè¯åº“åº“å­˜ =============
    console.log('\nğŸ“¦ ã€ç¬¬4æ­¥ã€‘ç”Ÿæˆè¯åº“åº“å­˜ï¼ˆåŒ…è£…å•ä½ï¼‰...')
    
    // è§„æ ¼è§£æå‡½æ•°
    function parseSpec(spec) {
      // æ ¼å¼1: 0.25gÃ—24ç²’/ç›’
      const p1 = /^([\d.]+)(\w+)Ã—(\d+)(\w+)\/(\w+)$/
      const m1 = spec.match(p1)
      if (m1) {
        return {
          dosage: parseFloat(m1[1]),
          dosageUnit: m1[2],
          conversionRate: parseInt(m1[3]),
          minUnit: m1[4],
          packUnit: m1[5]
        }
      }
      
      // æ ¼å¼2: 100ml/ç“¶
      const p2 = /^([\d.]+)(\w+)\/(\w+)$/
      const m2 = spec.match(p2)
      if (m2) {
        return {
          dosage: parseFloat(m2[1]),
          dosageUnit: m2[2],
          conversionRate: 1,
          minUnit: m2[2],
          packUnit: m2[3]
        }
      }
      
      return null
    }
    
    let stockCount = 0
    for (let drug of addedDrugs) {
      const specInfo = parseSpec(drug.specification)
      if (!specInfo) {
        console.log(`  âš ï¸  æ— æ³•è§£æè§„æ ¼ï¼š${drug.name}`)
        continue
      }
      
      // æ¯ç§è¯æç”Ÿæˆ2ä¸ªæ‰¹æ¬¡
      for (let i = 0; i < 2; i++) {
        const now = Date.now()
        const batch = `LOT${now.toString().slice(-8)}${i}`
        const quantity = Math.floor(Math.random() * 50) + 10 // 10-60ç›’
        const pricePerMin = specInfo.conversionRate > 0 
          ? (drug.price / specInfo.conversionRate).toFixed(4)
          : drug.price
        
        await db.collection('stock').add({
          data: {
            drugId: drug._id,
            drugName: drug.name,
            specification: drug.specification,
            specInfo: specInfo,
            location: 'drug_storage',
            batch: batch,
            productionDate: new Date(now - 60 * 24 * 60 * 60 * 1000), // 60å¤©å‰
            expireDate: new Date(now + 365 * 24 * 60 * 60 * 1000), // 365å¤©å
            quantity: quantity,
            unit: specInfo.packUnit,
            lockQuantity: 0,
            price: drug.price,
            pricePerMin: parseFloat(pricePerMin),
            status: 'normal',
            createTime: new Date(),
            updateTime: new Date()
          }
        })
        
        stockCount++
        
        // æ·»åŠ å»¶è¿Ÿï¼Œé¿å…æ‰¹å·é‡å¤
        await new Promise(resolve => setTimeout(resolve, 10))
      }
      
      console.log(`  âœ… ${drug.name}ï¼š2æ‰¹æ¬¡`)
    }
    console.log(`  âœ“ è¯åº“åº“å­˜å®Œæˆï¼ˆå…± ${stockCount} æ¡ï¼‰`)
    
    // ============= ç¬¬5æ­¥ï¼šç”Ÿæˆå›­åŒºåº“å­˜ =============
    console.log('\nğŸ¢ ã€ç¬¬5æ­¥ã€‘ç”Ÿæˆå›­åŒºåº“å­˜ï¼ˆæœ€å°å•ä½ï¼‰...')
    
    const parks = ['land_park', 'water_park']
    let totalParkStock = 0
    
    for (let park of parks) {
      const parkName = park === 'land_park' ? 'é™†åœ°å›­åŒº' : 'æ°´ä¸Šå›­åŒº'
      console.log(`  æ­£åœ¨ç”Ÿæˆ ${parkName} åº“å­˜...`)
      
      // é€‰æ‹©60%çš„è¯æ
      const selected = addedDrugs.slice(0, Math.floor(addedDrugs.length * 0.6))
      let parkCount = 0
      
      for (let drug of selected) {
        const specInfo = parseSpec(drug.specification)
        if (!specInfo) continue
        
        const now = Date.now()
        const batch = `LOT${now.toString().slice(-8)}${park.slice(0,1)}`
        const minQuantity = Math.floor(Math.random() * 100) + 20 // 20-120ä¸ªæœ€å°å•ä½
        const pricePerMin = specInfo.conversionRate > 0 
          ? (drug.price / specInfo.conversionRate).toFixed(4)
          : drug.price
        
        await db.collection('stock').add({
          data: {
            drugId: drug._id,
            drugName: drug.name,
            specification: drug.specification,
            specInfo: specInfo,
            location: park,
            batch: batch,
            productionDate: new Date(now - 45 * 24 * 60 * 60 * 1000), // 45å¤©å‰
            expireDate: new Date(now + 400 * 24 * 60 * 60 * 1000), // 400å¤©å
            quantity: minQuantity,
            unit: specInfo.minUnit,
            lockQuantity: 0,
            price: drug.price,
            pricePerMin: parseFloat(pricePerMin),
            status: 'normal',
            createTime: new Date(),
            updateTime: new Date()
          }
        })
        
        parkCount++
        totalParkStock++
        
        await new Promise(resolve => setTimeout(resolve, 10))
      }
      
      console.log(`  âœ… ${parkName}ï¼š${parkCount} æ¡`)
    }
    console.log(`  âœ“ å›­åŒºåº“å­˜å®Œæˆï¼ˆå…± ${totalParkStock} æ¡ï¼‰`)
    
    // ============= ç¬¬6æ­¥ï¼šæ•°æ®ç»Ÿè®¡ =============
    console.log('\nğŸ“Š ã€ç¬¬6æ­¥ã€‘æ•°æ®ç»Ÿè®¡...')
    console.log('  â”€'.repeat(30))
    
    const locCount = await db.collection('locations').count()
    console.log(`  ğŸ“ åœ°ç‚¹æ•°é‡ï¼š${locCount.total}`)
    
    const supCount = await db.collection('suppliers').count()
    console.log(`  ğŸ¢ ä¾›åº”å•†æ•°é‡ï¼š${supCount.total}`)
    
    const drugCount = await db.collection('drugs').count()
    console.log(`  ğŸ’Š è¯ææ•°é‡ï¼š${drugCount.total}`)
    
    const allStock = await db.collection('stock').count()
    console.log(`  ğŸ“¦ æ€»åº“å­˜è®°å½•ï¼š${allStock.total}`)
    
    const drugStorageStock = await db.collection('stock')
      .where({ location: 'drug_storage' })
      .count()
    console.log(`     â””â”€ è¯åº“ï¼š${drugStorageStock.total} æ¡ï¼ˆåŒ…è£…å•ä½ï¼‰`)
    
    const landStock = await db.collection('stock')
      .where({ location: 'land_park' })
      .count()
    console.log(`     â””â”€ é™†åœ°å›­åŒºï¼š${landStock.total} æ¡ï¼ˆæœ€å°å•ä½ï¼‰`)
    
    const waterStock = await db.collection('stock')
      .where({ location: 'water_park' })
      .count()
    console.log(`     â””â”€ æ°´ä¸Šå›­åŒºï¼š${waterStock.total} æ¡ï¼ˆæœ€å°å•ä½ï¼‰`)
    
    console.log('  â”€'.repeat(30))
    
    // ============= å®Œæˆ =============
    console.log('\n' + 'â”'.repeat(40))
    console.log('ğŸ‰ æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼')
    console.log('â”'.repeat(40))
    console.log('\nâœ… ä¸‹ä¸€æ­¥å¯ä»¥ï¼š')
    console.log('   1. è®¿é—®å…¥åº“å•é¡µé¢æµ‹è¯•å…¥åº“')
    console.log('   2. è®¿é—®å‡ºåº“å•é¡µé¢æµ‹è¯•å‡ºåº“ï¼ˆå•ä½è½¬æ¢ï¼‰')
    console.log('   3. è®¿é—®é—¨è¯Šé¡µé¢æµ‹è¯•æ¶ˆè€—')
    console.log('')
    
    wx.showToast({ title: 'ç”ŸæˆæˆåŠŸï¼', icon: 'success', duration: 2000 })
    
  } catch (error) {
    console.error('\nâŒ ç”Ÿæˆå¤±è´¥:', error)
    console.error('é”™è¯¯è¯¦æƒ…:', error.message)
    wx.showToast({ title: 'ç”Ÿæˆå¤±è´¥', icon: 'none' })
  }
})()
```

---

### æ­¥éª¤3.3ï¼šæ‰§è¡Œè„šæœ¬

**æ“ä½œ**ï¼š
1. åœ¨æ§åˆ¶å°ä¸­ **ç‚¹å‡»ä¸€ä¸‹**ï¼ˆç¡®ä¿å…‰æ ‡åœ¨æ§åˆ¶å°ä¸­ï¼‰
2. æŒ‰ `Ctrl + V` ç²˜è´´è„šæœ¬
3. æŒ‰ `Enter` æ‰§è¡Œ

**æ‰§è¡Œä¸­çš„ç”»é¢**ï¼š
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ å¼€å§‹ç”Ÿæˆ v3.14 æµ‹è¯•æ•°æ®
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ ã€ç¬¬1æ­¥ã€‘æ·»åŠ åœ°ç‚¹é…ç½®...
  âœ… æ·»åŠ åœ°ç‚¹ï¼šè¯åº“
  âœ… æ·»åŠ åœ°ç‚¹ï¼šé™†åœ°å›­åŒº
  âœ… æ·»åŠ åœ°ç‚¹ï¼šæ°´ä¸Šå›­åŒº
  âœ“ åœ°ç‚¹é…ç½®å®Œæˆ

ğŸ¢ ã€ç¬¬2æ­¥ã€‘æ·»åŠ ä¾›åº”å•†...
  âœ… æ·»åŠ ä¾›åº”å•†ï¼šåº·ç¾è¯ä¸š
  âœ… æ·»åŠ ä¾›åº”å•†ï¼šä¹å·é€šåŒ»è¯
  âœ… æ·»åŠ ä¾›åº”å•†ï¼šåæ¶¦åŒ»è¯
  âœ… æ·»åŠ ä¾›åº”å•†ï¼šå›½è¯é›†å›¢
  âœ“ ä¾›åº”å•†é…ç½®å®Œæˆ

ğŸ’Š ã€ç¬¬3æ­¥ã€‘æ·»åŠ è¯ææ¡£æ¡ˆ...
  âœ… æ·»åŠ è¯æï¼šé˜¿è«è¥¿æ—èƒ¶å›Š
  âœ… æ·»åŠ è¯æï¼šå¤´å­¢å…‹è‚Ÿç‰‡
  ...
  âœ“ è¯ææ¡£æ¡ˆå®Œæˆï¼ˆå…± 8 ç§ï¼‰

ğŸ“¦ ã€ç¬¬4æ­¥ã€‘ç”Ÿæˆè¯åº“åº“å­˜ï¼ˆåŒ…è£…å•ä½ï¼‰...
  âœ… é˜¿è«è¥¿æ—èƒ¶å›Šï¼š2æ‰¹æ¬¡
  âœ… å¤´å­¢å…‹è‚Ÿç‰‡ï¼š2æ‰¹æ¬¡
  ...
  âœ“ è¯åº“åº“å­˜å®Œæˆï¼ˆå…± 16 æ¡ï¼‰

ğŸ¢ ã€ç¬¬5æ­¥ã€‘ç”Ÿæˆå›­åŒºåº“å­˜ï¼ˆæœ€å°å•ä½ï¼‰...
  æ­£åœ¨ç”Ÿæˆ é™†åœ°å›­åŒº åº“å­˜...
  âœ… é™†åœ°å›­åŒºï¼š5 æ¡
  æ­£åœ¨ç”Ÿæˆ æ°´ä¸Šå›­åŒº åº“å­˜...
  âœ… æ°´ä¸Šå›­åŒºï¼š5 æ¡
  âœ“ å›­åŒºåº“å­˜å®Œæˆï¼ˆå…± 10 æ¡ï¼‰

ğŸ“Š ã€ç¬¬6æ­¥ã€‘æ•°æ®ç»Ÿè®¡...
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ğŸ“ åœ°ç‚¹æ•°é‡ï¼š3
  ğŸ¢ ä¾›åº”å•†æ•°é‡ï¼š4
  ğŸ’Š è¯ææ•°é‡ï¼š8
  ğŸ“¦ æ€»åº“å­˜è®°å½•ï¼š26
     â””â”€ è¯åº“ï¼š16 æ¡ï¼ˆåŒ…è£…å•ä½ï¼‰
     â””â”€ é™†åœ°å›­åŒºï¼š5 æ¡ï¼ˆæœ€å°å•ä½ï¼‰
     â””â”€ æ°´ä¸Šå›­åŒºï¼š5 æ¡ï¼ˆæœ€å°å•ä½ï¼‰
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… ä¸‹ä¸€æ­¥å¯ä»¥ï¼š
   1. è®¿é—®å…¥åº“å•é¡µé¢æµ‹è¯•å…¥åº“
   2. è®¿é—®å‡ºåº“å•é¡µé¢æµ‹è¯•å‡ºåº“ï¼ˆå•ä½è½¬æ¢ï¼‰
   3. è®¿é—®é—¨è¯Šé¡µé¢æµ‹è¯•æ¶ˆè€—
```

**ç­‰å¾…æ—¶é—´**ï¼šçº¦ 30-60 ç§’

---

### æ­¥éª¤3.4ï¼šéªŒè¯æ•°æ®

**æ“ä½œ**ï¼šåœ¨æ§åˆ¶å°æ‰§è¡ŒéªŒè¯è„šæœ¬

```javascript
// éªŒè¯æ•°æ®å®Œæ•´æ€§
(async function() {
  const db = wx.cloud.database()
  
  console.log('\nğŸ” éªŒè¯æ•°æ®...')
  
  // æŸ¥çœ‹è¯åº“åº“å­˜ç¤ºä¾‹
  const drugStorage = await db.collection('stock')
    .where({ location: 'drug_storage' })
    .limit(1)
    .get()
  
  console.log('ğŸ“¦ è¯åº“åº“å­˜ç¤ºä¾‹ï¼š')
  console.log(drugStorage.data[0])
  
  // æŸ¥çœ‹å›­åŒºåº“å­˜ç¤ºä¾‹
  const parkStock = await db.collection('stock')
    .where({ location: 'land_park' })
    .limit(1)
    .get()
  
  console.log('\nğŸ¢ å›­åŒºåº“å­˜ç¤ºä¾‹ï¼š')
  console.log(parkStock.data[0])
  
  console.log('\nâœ… æ•°æ®éªŒè¯å®Œæˆï¼')
})()
```

**é¢„æœŸè¾“å‡º**ï¼š
```javascript
ğŸ“¦ è¯åº“åº“å­˜ç¤ºä¾‹ï¼š
{
  drugName: "é˜¿è«è¥¿æ—èƒ¶å›Š",
  specification: "0.25gÃ—24ç²’/ç›’",
  location: "drug_storage",
  quantity: 35,
  unit: "ç›’",  // â† åŒ…è£…å•ä½
  specInfo: {
    conversionRate: 24,
    minUnit: "ç²’",
    packUnit: "ç›’"
  },
  pricePerMin: "0.6583"
}

ğŸ¢ å›­åŒºåº“å­˜ç¤ºä¾‹ï¼š
{
  drugName: "é˜¿è«è¥¿æ—èƒ¶å›Š",
  specification: "0.25gÃ—24ç²’/ç›’",
  location: "land_park",
  quantity: 85,
  unit: "ç²’",  // â† æœ€å°å•ä½
  specInfo: {
    conversionRate: 24,
    minUnit: "ç²’",
    packUnit: "ç›’"
  },
  pricePerMin: "0.6583"
}

âœ… æ•°æ®éªŒè¯å®Œæˆï¼
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šåŠŸèƒ½æµ‹è¯•

### æ­¥éª¤4.1ï¼šæµ‹è¯•å…¥åº“åŠŸèƒ½

**æ“ä½œ**ï¼š
1. åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
wx.navigateTo({
  url: '/pages-sub/in/add'
})
```

2. åœ¨å…¥åº“å•é¡µé¢ï¼š
   - é€‰æ‹©ä¾›åº”å•†ï¼ˆå¦‚æœå·²ä¿®æ”¹ï¼‰æˆ–è¾“å…¥ä¾›åº”å•†
   - ç‚¹å‡»"é€‰æ‹©è¯æ"
   - é€‰æ‹©ä¸€ä¸ªè¯æ
   - å¡«å†™æ‰¹å·ã€æ—¥æœŸã€æ•°é‡ç­‰
   - ç‚¹å‡»"æäº¤"

**é¢„æœŸç»“æœ**ï¼š
- å…¥åº“æˆåŠŸ
- è¯åº“åº“å­˜å¢åŠ 

---

### æ­¥éª¤4.2ï¼šæµ‹è¯•å‡ºåº“åŠŸèƒ½ï¼ˆæ ¸å¿ƒï¼‰

**æ“ä½œ**ï¼š
1. åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
wx.navigateTo({
  url: '/pages-sub/out/add'
})
```

2. åœ¨å‡ºåº“å•é¡µé¢ï¼š
   - é€‰æ‹©"ä»è¯åº“" â†’ "åˆ°é™†åœ°å›­åŒº"
   - é€‰æ‹©è¯æï¼šé˜¿è«è¥¿æ—èƒ¶å›Š
   - è¾“å…¥æ•°é‡ï¼š2ï¼ˆè¡¨ç¤º2ç›’ï¼‰
   - æäº¤

**é¢„æœŸç»“æœ**ï¼š
- å‡ºåº“æˆåŠŸ
- è¯åº“åº“å­˜å‡å°‘ï¼š2ç›’
- å›­åŒºåº“å­˜å¢åŠ ï¼š48ç²’ï¼ˆ2ç›’ Ã— 24ç²’/ç›’ï¼‰
- **å•ä½è‡ªåŠ¨è½¬æ¢ï¼**

---

### æ­¥éª¤4.3ï¼šéªŒè¯å•ä½è½¬æ¢

**æ“ä½œ**ï¼šåœ¨æ§åˆ¶å°æ‰§è¡Œ

```javascript
(async function() {
  const db = wx.cloud.database()
  
  // æŸ¥çœ‹å‡ºåº“è®°å½•
  const outRecords = await db.collection('out_records')
    .orderBy('createTime', 'desc')
    .limit(1)
    .get()
  
  console.log('ğŸ“¤ æœ€æ–°å‡ºåº“è®°å½•ï¼š')
  console.log(outRecords.data[0])
  
  console.log('\nâœ… æ³¨æ„æŸ¥çœ‹ï¼š')
  console.log('   - packQuantity: åŒ…è£…æ•°é‡ï¼ˆç›’ï¼‰')
  console.log('   - minQuantity: æœ€å°æ•°é‡ï¼ˆç²’ï¼‰')
  console.log('   - è½¬æ¢ç‡ï¼špackQuantity Ã— conversionRate = minQuantity')
})()
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šå¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šè„šæœ¬æ‰§è¡Œå¤±è´¥

**ç—‡çŠ¶**ï¼š
```
âŒ ç”Ÿæˆå¤±è´¥: Error: ...
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤äº‘å¼€å‘å·²å¼€é€š
3. æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
4. é‡æ–°æ‰§è¡Œè„šæœ¬

---

### é—®é¢˜2ï¼šäº‘å‡½æ•°è°ƒç”¨å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Resource.NotFound.Function
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥äº‘å‡½æ•°æ˜¯å¦ä¸Šä¼ 
2. åœ¨äº‘å¼€å‘æ§åˆ¶å°æŸ¥çœ‹çŠ¶æ€
3. é‡æ–°ä¸Šä¼ äº‘å‡½æ•°
4. ç­‰å¾…1-2åˆ†é’Ÿåé‡è¯•

---

### é—®é¢˜3ï¼šæ•°æ®é‡å¤

**ç—‡çŠ¶**ï¼š
å¤šæ¬¡æ‰§è¡Œè„šæœ¬åæ•°æ®é‡å¤

**è§£å†³æ–¹æ¡ˆ**ï¼š
è„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥ï¼Œä¸ä¼šé‡å¤æ·»åŠ ç›¸åŒæ•°æ®

**å¦‚éœ€æ¸…ç©ºé‡æ–°ç”Ÿæˆ**ï¼š
```javascript
(async function() {
  const db = wx.cloud.database()
  
  const confirm = await new Promise(resolve => {
    wx.showModal({
      title: 'ç¡®è®¤æ¸…ç©º',
      content: 'å°†åˆ é™¤æ‰€æœ‰åº“å­˜æ•°æ®',
      success: res => resolve(res.confirm)
    })
  })
  
  if (confirm) {
    const res = await db.collection('stock').where({}).remove()
    console.log(`âœ… åˆ é™¤ ${res.removed} æ¡åº“å­˜`)
    
    wx.showToast({ title: 'æ¸…ç©ºæˆåŠŸ', icon: 'success' })
  }
})()
```

---

### é—®é¢˜4ï¼šå‡ºåº“å•åˆ—è¡¨é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
list.vue:214 åŠ è½½å¤±è´¥: Error: åŠ è½½å¤±è´¥
```

**åŸå› **ï¼š
`outRecords` äº‘å‡½æ•°ç¼ºå°‘ `getRecords` æ–¹æ³•

**ä¸´æ—¶è§£å†³**ï¼š
å…ˆä¸è®¿é—®å‡ºåº“å•åˆ—è¡¨é¡µé¢ï¼Œç›´æ¥åˆ›å»ºå‡ºåº“å•

**å®Œæ•´è§£å†³**ï¼š
éœ€è¦æ›´æ–° `outRecords` äº‘å‡½æ•°ä»£ç 

---

## ğŸ“‹ å®Œæˆæ£€æŸ¥æ¸…å•

### ç¯å¢ƒå‡†å¤‡
- [ ] é¡¹ç›®ç¼–è¯‘æˆåŠŸ
- [ ] äº‘å¼€å‘åˆå§‹åŒ–æˆåŠŸ

### äº‘å‡½æ•°éƒ¨ç½²
- [ ] inRecords ä¸Šä¼ æˆåŠŸ
- [ ] outRecords ä¸Šä¼ æˆåŠŸ
- [ ] äº‘å‡½æ•°æµ‹è¯•é€šè¿‡

### æµ‹è¯•æ•°æ®ç”Ÿæˆ
- [ ] è„šæœ¬æ‰§è¡ŒæˆåŠŸ
- [ ] çœ‹åˆ°"ğŸ‰ æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼"
- [ ] æ•°æ®éªŒè¯é€šè¿‡
- [ ] åœ°ç‚¹ã€ä¾›åº”å•†ã€è¯æã€åº“å­˜éƒ½å·²ç”Ÿæˆ

### åŠŸèƒ½æµ‹è¯•
- [ ] å…¥åº“åŠŸèƒ½æ­£å¸¸
- [ ] å‡ºåº“åŠŸèƒ½æ­£å¸¸
- [ ] å•ä½è½¬æ¢éªŒè¯æˆåŠŸ

---

## ğŸ‰ å…¨éƒ¨å®Œæˆï¼

æ­å–œæ‚¨å®Œæˆäº† v3.14 åŒè½¨åˆ¶å­˜å‚¨ç³»ç»Ÿçš„éƒ¨ç½²ï¼

### ä¸‹ä¸€æ­¥å¯ä»¥ï¼š

1. **æµ‹è¯•æ›´å¤šåŠŸèƒ½**
   - é—¨è¯Šæ¶ˆè€—
   - åº“å­˜æŸ¥è¯¢
   - æ•°æ®æŠ¥è¡¨

2. **ä¼˜åŒ–ä¾›åº”å•†åŠŸèƒ½**
   - å‚è€ƒï¼š`docs/å…¥åº“å•ä¼˜åŒ–æŒ‡å—.md`

3. **å­¦ä¹ ç³»ç»Ÿè®¾è®¡**
   - å‚è€ƒï¼š`_backup_docs/ğŸ“åˆ†å›­åŒºå•ä½è½¬æ¢ç•Œé¢è®¾è®¡_v3.14_ç»ˆæç‰ˆ.md`

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

- æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š`docs/` ç›®å½•
- æŸ¥çœ‹è®¾è®¡æ–‡æ¡£ï¼š`_backup_docs/` ç›®å½•
- éšæ—¶å‘Šè¯‰æˆ‘é‡åˆ°çš„é—®é¢˜

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€

