# ☁️ 云函数批量上传指南

## 📋 需要上传的云函数列表

### 核心云函数（必须）

| 云函数名 | 功能 | 优先级 |
|---------|------|--------|
| `login` | 用户登录验证 | ⭐⭐⭐ |
| `inRecords` | 入库单管理 | ⭐⭐⭐ |
| `outRecords` | 出库单管理 | ⭐⭐⭐ |
| `drugManage` | 药品管理 | ⭐⭐⭐ |
| `stockManage` | 库存管理 | ⭐⭐⭐ |
| `getUserList` | 获取用户列表 | ⭐⭐⭐ |
| `addUser` | 添加用户 | ⭐⭐⭐ |
| `updateUser` | 更新用户信息 | ⭐⭐⭐ |
| `updateMyInfo` | 更新个人信息 | ⭐⭐⭐ |
| `clearInRecords` | 清空入库记录（测试用）| ⭐⭐ |

### 其他云函数（可选）

| 云函数名 | 功能 | 优先级 |
|---------|------|--------|
| `getDrugList` | 获取药品列表 | ⭐⭐ |
| `getStockList` | 获取库存列表 | ⭐⭐ |
| `drugAPI` | 第三方药品API | ⭐ |
| `drugBarcodeQuery` | 条形码查询 | ⭐ |
| `clinicRecords` | 门诊记录 | ⭐ |
| `consumeRecords` | 消耗记录 | ⭐ |
| `requisitionRecords` | 请领记录 | ⭐ |
| `reportService` | 报表服务 | ⭐ |
| `queryService` | 查询服务 | ⭐ |
| `expiryMonitor` | 效期监控 | ⭐ |
| `dailySummary` | 每日汇总 | ⭐ |
| `updateStock` | 更新库存 | ⭐ |

---

## 🚀 批量上传方法

### 方法1：逐个上传（推荐）

**步骤：**

1. 在微信开发者工具中，找到左侧文件列表
2. 展开 `cloudfunctions` 文件夹
3. **按优先级顺序**逐个上传：

#### 第一批：核心登录和入库（最重要）

```
1. 右键 cloudfunctions/login → 上传并部署：云端安装依赖
2. 右键 cloudfunctions/inRecords → 上传并部署：云端安装依赖
3. 右键 cloudfunctions/drugManage → 上传并部署：云端安装依赖
```

**等待这3个上传完成后，测试入库功能是否正常**

#### 第二批：用户管理

```
4. 右键 cloudfunctions/getUserList → 上传并部署：云端安装依赖
5. 右键 cloudfunctions/addUser → 上传并部署：云端安装依赖
6. 右键 cloudfunctions/updateUser → 上传并部署：云端安装依赖
7. 右键 cloudfunctions/updateMyInfo → 上传并部署：云端安装依赖
```

#### 第三批：其他核心功能

```
8. 右键 cloudfunctions/outRecords → 上传并部署：云端安装依赖
9. 右键 cloudfunctions/stockManage → 上传并部署：云端安装依赖
10. 右键 cloudfunctions/clearInRecords → 上传并部署：云端安装依赖
```

---

### 方法2：通过云开发控制台

**步骤：**

1. 点击微信开发者工具左侧的 **"云开发"** 图标 ☁️
2. 进入 **"云函数"** 标签
3. 点击右上角 **"新建云函数"** 或 **"上传"**
4. 选择对应的云函数文件夹上传

---

## 📝 上传注意事项

### 1. 选择正确的上传方式

**推荐：** "上传并部署：云端安装依赖"

**原因：**
- ✅ 自动安装 `node_modules` 依赖
- ✅ 确保云函数能正常运行
- ✅ 不需要本地安装依赖

**不推荐：** "上传并部署：不安装依赖"
- ❌ 如果云函数有依赖，会运行失败

### 2. 等待上传完成

每个云函数上传需要 **10-30秒**，请耐心等待：

```
上传中... → 正在安装依赖... → 上传成功 ✅
```

### 3. 检查上传状态

**成功标志：**
- ✅ 控制台显示 "上传成功"
- ✅ 云函数列表中显示该函数
- ✅ 状态显示为 "部署成功"

**失败标志：**
- ❌ 显示错误信息
- ❌ 状态显示为 "部署失败"

---

## 🧪 验证云函数是否上传成功

### 方法1：在云开发控制台查看

1. 点击 **"云开发"** → **"云函数"**
2. 查看云函数列表
3. 确认以下云函数都存在：

```
✅ login
✅ inRecords
✅ outRecords
✅ drugManage
✅ stockManage
✅ getUserList
✅ addUser
✅ updateUser
✅ updateMyInfo
✅ clearInRecords
```

### 方法2：在控制台测试调用

```javascript
// 测试 login 云函数
wx.cloud.callFunction({
  name: 'login',
  success: res => {
    console.log('✅ login 云函数可用:', res)
  },
  fail: err => {
    console.error('❌ login 云函数不可用:', err)
  }
})

// 测试 drugManage 云函数
wx.cloud.callFunction({
  name: 'drugManage',
  data: {
    action: 'getList',
    data: { pageSize: 1, pageNum: 1 }
  },
  success: res => {
    console.log('✅ drugManage 云函数可用:', res)
  },
  fail: err => {
    console.error('❌ drugManage 云函数不可用:', err)
  }
})
```

---

## ⚠️ 常见问题

### 问题1：上传失败

**错误信息：**
```
上传失败：网络错误
```

**解决方案：**
1. 检查网络连接
2. 重新上传
3. 尝试使用云开发控制台上传

### 问题2：部署失败

**错误信息：**
```
部署失败：依赖安装失败
```

**解决方案：**
1. 检查 `package.json` 是否正确
2. 重新上传并选择 "云端安装依赖"
3. 查看云函数日志获取详细错误

### 问题3：调用失败

**错误信息：**
```
FunctionName parameter could not be found
```

**解决方案：**
1. 确认云函数已上传
2. 检查云函数名称是否正确
3. 刷新云函数列表

---

## 🎯 快速上传脚本

### 上传优先级顺序

```
第一优先级（立即上传）：
1. login          - 登录必需
2. inRecords      - 入库功能必需
3. drugManage     - 搜索药品必需

第二优先级（尽快上传）：
4. getUserList    - 用户管理
5. addUser        - 添加用户
6. updateUser     - 编辑用户
7. updateMyInfo   - 个人信息

第三优先级（功能完善）：
8. outRecords     - 出库功能
9. stockManage    - 库存管理
10. clearInRecords - 测试清理
```

---

## ✅ 上传完成检查清单

- [ ] login - 登录功能
- [ ] inRecords - 入库管理
- [ ] drugManage - 药品管理
- [ ] getUserList - 用户列表
- [ ] addUser - 添加用户
- [ ] updateUser - 更新用户
- [ ] updateMyInfo - 更新个人信息
- [ ] outRecords - 出库管理
- [ ] stockManage - 库存管理
- [ ] clearInRecords - 清空记录

---

## 📊 上传进度追踪

```
当前进度：0/10

已上传：
✅ login
✅ inRecords

待上传：
⏳ drugManage
⏳ getUserList
⏳ addUser
⏳ updateUser
⏳ updateMyInfo
⏳ outRecords
⏳ stockManage
⏳ clearInRecords
```

---

## 🚀 开始上传

**请按照以下顺序上传：**

### 1. 上传 login（如果还没上传）

```
右键 cloudfunctions/login → 上传并部署：云端安装依赖
```

### 2. 上传 drugManage（解决搜索药品问题）

```
右键 cloudfunctions/drugManage → 上传并部署：云端安装依赖
```

### 3. 测试

上传完成后，重新编译小程序，测试：
- ✅ 搜索药品是否正常
- ✅ 提交入库单是否正常

---

**最后更新：** 2025年11月10日  
**状态：** 等待上传

