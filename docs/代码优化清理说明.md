# ğŸ§¹ ä»£ç ä¼˜åŒ–æ¸…ç†è¯´æ˜

## ğŸ“‹ ä¼˜åŒ–ç›®æ ‡

1. åˆ é™¤æ—§çš„ã€ä¸ç”¨çš„æ–¹æ³•å’Œæ§ä»¶
2. åˆ é™¤å†—ä½™çš„CSSæ ·å¼
3. åˆå¹¶é‡å¤çš„é€»è¾‘
4. ä¼˜åŒ–ä»£ç ç»“æ„

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. åˆ é™¤é‡å¤çš„CSSæ³¨é‡Š

**æ–‡ä»¶ï¼š** `pages-sub/in/add.vue`

**ä¿®æ”¹å‰ï¼š**
```scss
// ç­¾åå¡ç‰‡
// ç­¾åå¡ç‰‡ï¼ˆä¸å¤æ ¸é¡µé¢ä¿æŒä¸€è‡´ï¼‰
.signature-card {
```

**ä¿®æ”¹åï¼š**
```scss
// ç­¾åå¡ç‰‡ï¼ˆä¸å¤æ ¸é¡µé¢ä¿æŒä¸€è‡´ï¼‰
.signature-card {
```

---

### 2. åˆå¹¶é‡å¤çš„ç”¨æˆ·ä¿¡æ¯è·å–é€»è¾‘

**æ–‡ä»¶ï¼š** `pages-sub/in/add.vue`

#### é—®é¢˜

`onShow()` å’Œ `initPage()` ä¸­éƒ½æœ‰è·å–ç”¨æˆ·ä¿¡æ¯çš„é‡å¤ä»£ç ï¼š

```javascript
// onShow ä¸­
const userInfo = uni.getStorageSync('userInfo')
if (userInfo && userInfo.name) {
  this.operator = userInfo.name
} else {
  this.operator = 'æœªç™»å½•'
}

// initPage ä¸­
const userInfo = uni.getStorageSync('userInfo')
this.userInfo = userInfo || {}
this.userRoleText = this.getRoleText(userInfo?.role)
this.operator = userInfo.name
```

#### ä¼˜åŒ–æ–¹æ¡ˆ

æå–ä¸ºç»Ÿä¸€çš„æ–¹æ³• `updateUserInfo()`ï¼š

```javascript
// æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆç»Ÿä¸€æ–¹æ³•ï¼‰
updateUserInfo() {
  const userInfo = uni.getStorageSync('userInfo')
  this.userInfo = userInfo || {}
  this.userRoleText = this.getRoleText(userInfo?.role)
  this.operator = userInfo?.name || 'æœªç™»å½•'
},
```

#### è°ƒç”¨ä½ç½®

```javascript
onShow() {
  // é¡µé¢æ˜¾ç¤ºæ—¶æ›´æ–°ç”¨æˆ·ä¿¡æ¯
  this.updateUserInfo()
},

async initPage() {
  // ç”Ÿæˆå…¥åº“å•å·
  this.recordNo = Common.generateRecordNo('RK')
  
  // è·å–å½“å‰æ—¶é—´
  const now = new Date()
  this.currentDate = Common.formatDate(now)
  this.maxDate = Common.formatDate(now)
  
  // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
  this.updateUserInfo()
  
  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  if (!this.userInfo || !this.userInfo.name) {
    // æç¤ºç”¨æˆ·ç™»å½•
    // ...
  }
}
```

#### ä¼˜åŒ–æ•ˆæœ

- âœ… å‡å°‘ä»£ç é‡å¤
- âœ… ç»Ÿä¸€é€»è¾‘å¤„ç†
- âœ… æ˜“äºç»´æŠ¤
- âœ… å‡å°‘å‡ºé”™å¯èƒ½

---

## ğŸ” æ£€æŸ¥ç»“æœ

### å·²æ£€æŸ¥çš„é¡¹ç›®

#### 1. CSSæ ·å¼

**æ£€æŸ¥é¡¹ï¼š**
- âœ… `.signature-title` - ä¸åœ¨ç­¾åå¡ç‰‡ä¸­ä½¿ç”¨ï¼ˆå·²åˆ é™¤æ—§æ ·å¼ï¼‰
- âœ… `.signature-box` - ä¸å­˜åœ¨ï¼ˆå·²åˆ é™¤ï¼‰
- âœ… `.signature-placeholder` - ä¸å­˜åœ¨ï¼ˆå·²åˆ é™¤ï¼‰
- âœ… `.required` - åœ¨å…¶ä»–è¡¨å•ä¸­ä½¿ç”¨ï¼ˆä¿ç•™ï¼‰

**ç»“è®ºï¼š** æ— å†—ä½™CSS

#### 2. æ•°æ®å­—æ®µ

**æ£€æŸ¥é¡¹ï¼š**
- âœ… `operator` - åœ¨æ¨¡æ¿å’Œé€»è¾‘ä¸­ä½¿ç”¨ï¼ˆä¿ç•™ï¼‰
- âœ… `operatorSign` - ç­¾åæ•°æ®ï¼ˆä¿ç•™ï¼‰
- âœ… `userInfo` - ç”¨æˆ·ä¿¡æ¯å¯¹è±¡ï¼ˆä¿ç•™ï¼‰
- âœ… `userRoleText` - è§’è‰²æ–‡æœ¬ï¼ˆä¿ç•™ï¼‰

**ç»“è®ºï¼š** æ— å†—ä½™æ•°æ®å­—æ®µ

#### 3. æ–¹æ³•

**æ£€æŸ¥é¡¹ï¼š**
- âœ… `getRoleText()` - è·å–è§’è‰²æ–‡æœ¬ï¼ˆä¿ç•™ï¼‰
- âœ… `formatTime()` - æ ¼å¼åŒ–æ—¶é—´ï¼ˆä¿ç•™ï¼‰
- âœ… `getCurrentTime()` - è·å–å½“å‰æ—¶é—´ï¼ˆä¿ç•™ï¼‰
- âœ… `updateUserInfo()` - ç»Ÿä¸€æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆæ–°å¢ï¼‰

**ç»“è®ºï¼š** æ— å†—ä½™æ–¹æ³•

---

## ğŸ“Š ä¼˜åŒ–ç»Ÿè®¡

### ä»£ç è¡Œæ•°å˜åŒ–

| æ–‡ä»¶ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘ |
|------|--------|--------|------|
| `pages-sub/in/add.vue` | ~2340è¡Œ | ~2330è¡Œ | ~10è¡Œ |

### é‡å¤ä»£ç æ¶ˆé™¤

| ç±»å‹ | æ¶ˆé™¤æ•°é‡ |
|------|---------|
| é‡å¤çš„ç”¨æˆ·ä¿¡æ¯è·å–é€»è¾‘ | 1å¤„ |
| é‡å¤çš„CSSæ³¨é‡Š | 1å¤„ |

### æ–°å¢æ–¹æ³•

| æ–¹æ³•å | ä½œç”¨ | è°ƒç”¨æ¬¡æ•° |
|--------|------|---------|
| `updateUserInfo()` | ç»Ÿä¸€æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | 2æ¬¡ |

---

## ğŸ¯ ä¼˜åŒ–åŸåˆ™

### 1. DRYåŸåˆ™ï¼ˆDon't Repeat Yourselfï¼‰

**ç¤ºä¾‹ï¼š**
- å°†é‡å¤çš„ç”¨æˆ·ä¿¡æ¯è·å–é€»è¾‘æå–ä¸º `updateUserInfo()` æ–¹æ³•
- é¿å…åœ¨å¤šä¸ªåœ°æ–¹å†™ç›¸åŒçš„ä»£ç 

### 2. å•ä¸€èŒè´£åŸåˆ™

**ç¤ºä¾‹ï¼š**
- `updateUserInfo()` åªè´Ÿè´£æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- `initPage()` è´Ÿè´£é¡µé¢åˆå§‹åŒ–
- `onShow()` è´Ÿè´£é¡µé¢æ˜¾ç¤ºæ—¶çš„æ›´æ–°

### 3. ä¿æŒç®€æ´

**ç¤ºä¾‹ï¼š**
- åˆ é™¤é‡å¤çš„æ³¨é‡Š
- åˆ é™¤æœªä½¿ç”¨çš„æ ·å¼
- åˆå¹¶ç›¸ä¼¼çš„é€»è¾‘

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

### 1. è¿›ä¸€æ­¥æå–å…¬å…±æ–¹æ³•

**å¯ä»¥æå–çš„é€»è¾‘ï¼š**

#### ç™»å½•æ£€æŸ¥

```javascript
// å½“å‰ä»£ç ï¼ˆåœ¨å¤šä¸ªåœ°æ–¹é‡å¤ï¼‰
const userInfo = uni.getStorageSync('userInfo')
const userId = userInfo?.userId || userInfo?._id

if (!userInfo || !userInfo.name || !userId) {
  // æç¤ºç™»å½•
}
```

**å»ºè®®æå–ä¸ºï¼š**
```javascript
// utils/auth.js
export function checkLoginAndPrompt() {
  const userInfo = uni.getStorageSync('userInfo')
  const userId = userInfo?.userId || userInfo?._id
  
  if (!userInfo || !userInfo.name || !userId) {
    uni.showModal({
      title: 'è¯·å…ˆç™»å½•',
      content: 'æ‚¨è¿˜æœªç™»å½•ï¼Œæ— æ³•è¿›è¡Œæ­¤æ“ä½œã€‚æ˜¯å¦å‰å¾€ç™»å½•ï¼Ÿ',
      confirmText: 'å»ç™»å½•',
      cancelText: 'å–æ¶ˆ',
      success: (res) => {
        if (res.confirm) {
          uni.switchTab({ url: '/pages/user/index' })
        }
      }
    })
    return false
  }
  
  return { userInfo, userId }
}
```

---

### 2. ç»Ÿä¸€æ—¶é—´æ ¼å¼åŒ–

**å½“å‰çŠ¶æ€ï¼š**
- `pages-sub/in/add.vue` æœ‰ `formatTime()`
- `pages-sub/in/review.vue` æœ‰ `formatTime()`
- `utils/common.js` æœ‰ `formatDate()`

**å»ºè®®ï¼š**
å°†æ‰€æœ‰æ—¶é—´æ ¼å¼åŒ–æ–¹æ³•ç»Ÿä¸€åˆ° `utils/common.js`ï¼š

```javascript
// utils/common.js
export default {
  // æ ¼å¼åŒ–æ—¥æœŸï¼šYYYY-MM-DD
  formatDate(date) {
    // ...
  },
  
  // æ ¼å¼åŒ–æ—¶é—´ï¼šMM-DD HH:mm
  formatTime(timeStr) {
    if (!timeStr) return '--'
    const date = new Date(timeStr)
    const month = String(date.getMonth() + 1).padStart(2, '0')
    const day = String(date.getDate()).padStart(2, '0')
    const hours = String(date.getHours()).padStart(2, '0')
    const minutes = String(date.getMinutes()).padStart(2, '0')
    return `${month}-${day} ${hours}:${minutes}`
  },
  
  // æ ¼å¼åŒ–å®Œæ•´æ—¶é—´ï¼šYYYY-MM-DD HH:mm:ss
  formatDateTime(date) {
    // ...
  }
}
```

---

### 3. ç»Ÿä¸€è§’è‰²æ–‡æœ¬è·å–

**å½“å‰çŠ¶æ€ï¼š**
- `pages-sub/in/add.vue` æœ‰ `getRoleText()`
- `pages-sub/in/review.vue` æœ‰ `getRoleText()`
- `utils/permission.js` æœ‰ `getRoleText()`

**å»ºè®®ï¼š**
ç»Ÿä¸€ä½¿ç”¨ `utils/permission.js` ä¸­çš„æ–¹æ³•ï¼š

```javascript
// pages-sub/in/add.vue
import { getRoleText } from '@/utils/permission.js'

export default {
  methods: {
    updateUserInfo() {
      const userInfo = uni.getStorageSync('userInfo')
      this.userInfo = userInfo || {}
      this.userRoleText = getRoleText(userInfo?.role)  // ä½¿ç”¨å¯¼å…¥çš„æ–¹æ³•
      this.operator = userInfo?.name || 'æœªç™»å½•'
    }
  }
}
```

---

## ğŸ“ ä¼˜åŒ–æ£€æŸ¥æ¸…å•

### å·²å®Œæˆ âœ…

- [x] åˆ é™¤é‡å¤çš„CSSæ³¨é‡Š
- [x] åˆå¹¶é‡å¤çš„ç”¨æˆ·ä¿¡æ¯è·å–é€»è¾‘
- [x] æ£€æŸ¥å¹¶ç¡®è®¤æ— å†—ä½™CSSæ ·å¼
- [x] æ£€æŸ¥å¹¶ç¡®è®¤æ— å†—ä½™æ•°æ®å­—æ®µ
- [x] æ£€æŸ¥å¹¶ç¡®è®¤æ— å†—ä½™æ–¹æ³•

### å»ºè®®è¿›ä¸€æ­¥ä¼˜åŒ– ğŸ“‹

- [ ] æå–å…¬å…±çš„ç™»å½•æ£€æŸ¥é€»è¾‘
- [ ] ç»Ÿä¸€æ—¶é—´æ ¼å¼åŒ–æ–¹æ³•åˆ° `utils/common.js`
- [ ] ç»Ÿä¸€è§’è‰²æ–‡æœ¬è·å–æ–¹æ³•
- [ ] æ£€æŸ¥å…¶ä»–é¡µé¢æ˜¯å¦æœ‰ç±»ä¼¼çš„é‡å¤ä»£ç 
- [ ] è€ƒè™‘ä½¿ç”¨ Vuex æˆ– Pinia ç»Ÿä¸€ç®¡ç†ç”¨æˆ·çŠ¶æ€

---

## ğŸ’¡ ä¼˜åŒ–æ•ˆæœ

### ä»£ç è´¨é‡æå‡

- âœ… **å¯ç»´æŠ¤æ€§æå‡**ï¼šå‡å°‘é‡å¤ä»£ç ï¼Œä¿®æ”¹æ—¶åªéœ€æ”¹ä¸€å¤„
- âœ… **å¯è¯»æ€§æå‡**ï¼šä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œé€»è¾‘æ›´ç®€æ´
- âœ… **ä¸€è‡´æ€§æå‡**ï¼šç»Ÿä¸€çš„æ–¹æ³•ç¡®ä¿è¡Œä¸ºä¸€è‡´
- âœ… **å‡å°‘bug**ï¼šå‡å°‘é‡å¤ä»£ç å‡å°‘å‡ºé”™å¯èƒ½

### æ€§èƒ½å½±å“

- âœ… **æ— è´Ÿé¢å½±å“**ï¼šä¼˜åŒ–ä¸å½±å“æ€§èƒ½
- âœ… **ä»£ç ä½“ç§¯ç•¥å‡**ï¼šå‡å°‘çº¦10è¡Œä»£ç 

---

## ğŸ”§ å¦‚ä½•åº”ç”¨è¿™äº›ä¼˜åŒ–

### 1. ç«‹å³åº”ç”¨

å·²å®Œæˆçš„ä¼˜åŒ–å·²ç»åº”ç”¨åˆ°ä»£ç ä¸­ï¼Œæ— éœ€é¢å¤–æ“ä½œã€‚

### 2. åç»­ä¼˜åŒ–

å¦‚éœ€åº”ç”¨å»ºè®®çš„è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š

1. **æå–å…¬å…±æ–¹æ³•**
   - åœ¨ `utils/auth.js` ä¸­æ·»åŠ  `checkLoginAndPrompt()`
   - åœ¨å„é¡µé¢ä¸­æ›¿æ¢é‡å¤çš„ç™»å½•æ£€æŸ¥ä»£ç 

2. **ç»Ÿä¸€æ—¶é—´æ ¼å¼åŒ–**
   - åœ¨ `utils/common.js` ä¸­æ·»åŠ  `formatTime()`
   - åœ¨å„é¡µé¢ä¸­å¯¼å…¥å¹¶ä½¿ç”¨

3. **ç»Ÿä¸€è§’è‰²æ–‡æœ¬**
   - åœ¨å„é¡µé¢ä¸­å¯¼å…¥ `utils/permission.js` çš„ `getRoleText()`
   - åˆ é™¤é¡µé¢ä¸­çš„é‡å¤æ–¹æ³•

---

## âœ… ä¼˜åŒ–å®Œæˆ

**ä¼˜åŒ–æ—¶é—´ï¼š** 2025å¹´11æœˆ10æ—¥

**ä¼˜åŒ–å†…å®¹ï¼š**
- âœ… åˆ é™¤é‡å¤çš„CSSæ³¨é‡Š
- âœ… åˆå¹¶é‡å¤çš„ç”¨æˆ·ä¿¡æ¯è·å–é€»è¾‘
- âœ… æ–°å¢ `updateUserInfo()` ç»Ÿä¸€æ–¹æ³•
- âœ… æ£€æŸ¥å¹¶ç¡®è®¤æ— å…¶ä»–å†—ä½™ä»£ç 

**ä¼˜åŒ–æ•ˆæœï¼š**
- âœ… ä»£ç æ›´ç®€æ´
- âœ… é€»è¾‘æ›´æ¸…æ™°
- âœ… æ˜“äºç»´æŠ¤
- âœ… å‡å°‘å‡ºé”™å¯èƒ½

---

**æœ€åæ›´æ–°ï¼š** 2025å¹´11æœˆ10æ—¥
