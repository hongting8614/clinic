# 📦 入库功能优化设计方案 v4.0

## 📅 设计时间
2025-11-08

## 🎯 优化目标
打造快速、智能、高效的药材入库流程

---

## 一、页面命名优化

### 1.1 当前问题
- ❌ "入库统计" 名称容易误解为统计报表
- ❌ 不能直观体现入库操作的核心功能

### 1.2 优化方案

#### 推荐方案（按优先级）

| 方案 | 页面名称 | 英文标识 | 说明 | 推荐指数 |
|------|---------|---------|------|---------|
| 方案1 | **药材入库单** | Drug Inbound | 最直观，符合业务习惯 | ⭐⭐⭐⭐⭐ |
| 方案2 | **快速入库** | Quick Inbound | 强调效率，适合扫码场景 | ⭐⭐⭐⭐ |
| 方案3 | **入库登记** | Inbound Registration | 正式，适合规范管理 | ⭐⭐⭐ |
| 方案4 | **收货入库** | Receiving Inbound | 强调收货环节 | ⭐⭐⭐ |

#### 最终建议
```
页面标题：药材入库单
副标题：北京欢乐谷医务室 · 入库登记
```

**理由**：
- ✅ 直观明确，一看就懂
- ✅ 符合医药行业习惯
- ✅ 与"出库单"、"调拨单"命名统一

---

## 二、扫码直接入库功能

### 2.1 当前流程（问题）
```
扫码 → 识别药材 → 弹窗确认 → 手动填写批号/日期 → 添加到列表
```
**问题**：操作步骤多，效率低

### 2.2 优化后流程
```
扫码 → 自动添加到入库列表 → 自动定位到该行 → 补充批号/日期
```

### 2.3 字段映射关系

#### 扫码返回字段 → 入库单字段

| 扫码字段 | 入库单字段 | 自动填充 | 必填 | 说明 |
|---------|-----------|---------|------|------|
| `name` | `drugName` | ✅ | ✅ | 药材名称 |
| `specification` | `specification` | ✅ | ✅ | 规格 |
| `unit` | `packUnit` | ✅ | ✅ | 包装单位 |
| `manufacturer` | `manufacturer` | ✅ | ❌ | 生产厂家 |
| `barcode` | `barcode` | ✅ | ❌ | 条形码 |
| - | `batchNo` | ❌ | ✅ | **批号（手动填写）** |
| - | `productionDate` | ❌ | ✅ | **生产日期（手动填写）** |
| - | `expiryDate` | ❌ | ✅ | **有效期（手动填写）** |
| - | `quantity` | ❌ | ✅ | **数量（手动填写）** |
| - | `unitPrice` | ❌ | ❌ | 单价（可选） |

#### 自动计算字段

| 字段 | 计算规则 | 说明 |
|------|---------|------|
| `daysToExpiry` | `有效期 - 当前日期` | 距有效期天数 |
| `amount` | `数量 × 单价` | 金额 |
| `hasError` | 验证规则 | 是否有错误 |

### 2.4 扫码后行为

```javascript
// 扫码成功后
onScanSuccess(drugInfo) {
  // 1. 自动添加到列表
  const newRow = {
    drugId: drugInfo._id || '',
    drugName: drugInfo.name,
    specification: drugInfo.specification,
    packUnit: drugInfo.unit,
    manufacturer: drugInfo.manufacturer || '',
    barcode: drugInfo.barcode || '',
    
    // 待填写字段
    batchNo: '',
    productionDate: '',
    expiryDate: '',
    quantity: '',
    unitPrice: '',
    
    // 自动计算
    daysToExpiry: 0,
    amount: 0,
    hasError: true  // 因为批号等必填项未填
  }
  
  this.drugList.push(newRow)
  
  // 2. 滚动到该行
  this.scrollToRow(this.drugList.length - 1)
  
  // 3. 自动聚焦到批号输入框
  this.focusBatchNo(this.drugList.length - 1)
  
  // 4. 提示用户
  uni.showToast({
    title: '✅ 已添加，请填写批号',
    icon: 'none'
  })
}
```

---

## 三、扫码查询优化（成本优化）

### 3.1 当前查询顺序（问题）
```
1. 本地药材档案
2. 缓存数据库
3. 第三方API ← 成本高
```

### 3.2 优化后查询顺序
```
1. 本地药材档案（优先）← 免费，最准确
2. 第三方API（备用）← 仅在本地无数据时调用
3. 缓存数据库（删除）← 不再使用，避免数据不一致
```

### 3.3 查询逻辑

```javascript
async function queryByBarcode(barcode) {
  console.log('🔍 开始查询条形码:', barcode)
  
  // 第一级：查询本地药材档案（优先）
  console.log('📦 [第1级] 查询本地药材档案...')
  let drugInfo = await queryLocalDrugs(barcode)
  
  if (drugInfo) {
    console.log('✅ [第1级] 本地药材档案命中!')
    console.log('药材名称:', drugInfo.name)
    console.log('💰 成本: ¥0（免费）')
    
    return {
      success: true,
      data: drugInfo,
      source: 'local',
      cost: 0
    }
  }
  
  console.log('❌ [第1级] 本地药材档案未找到')
  
  // 第二级：调用第三方API（仅在本地无数据时）
  console.log('📡 [第2级] 调用第三方API...')
  console.log('⚠️ 注意: 将消耗API次数')
  
  drugInfo = await queryThirdPartyAPI(barcode)
  
  if (drugInfo) {
    console.log('✅ [第2级] 第三方API查询成功!')
    console.log('药材名称:', drugInfo.name)
    console.log('💰 成本: ¥0.01-0.05（付费）')
    
    // 自动保存到本地档案（下次免费）
    console.log('💾 自动保存到本地药材档案...')
    await saveToDrugArchive(drugInfo)
    
    return {
      success: true,
      data: drugInfo,
      source: 'api',
      cost: 0.01,
      saved: true  // 已保存到本地
    }
  }
  
  console.log('❌ [第2级] 第三方API未找到')
  console.log('💡 建议: 手动新建药材档案')
  
  return {
    success: false,
    message: '未找到药材信息',
    barcode: barcode
  }
}
```

### 3.4 成本对比

| 查询方式 | 单次成本 | 响应速度 | 数据准确性 | 推荐 |
|---------|---------|---------|-----------|------|
| 本地药材档案 | ¥0 | <50ms | ⭐⭐⭐⭐⭐ | ✅ 优先 |
| 第三方API | ¥0.01-0.05 | 200-800ms | ⭐⭐⭐⭐ | ⚠️ 备用 |
| 缓存数据库 | ¥0 | 100-200ms | ⭐⭐⭐ | ❌ 废弃 |

**优化效果**：
- 💰 成本降低 90%（大部分从本地查询）
- ⚡ 速度提升 5-10倍
- ✅ 数据更准确（本地档案可维护）

---

## 四、扫码/输入/新建一体化

### 4.1 当前问题
- ❌ 扫码按钮和新建药材按钮分开
- ❌ 操作不连贯，用户需要思考
- ❌ 界面复杂，按钮多

### 4.2 优化方案：智能输入框

#### 界面设计
```
┌─────────────────────────────────────┐
│  🔍 扫码或输入药材名称/条形码          │
│  ┌───────────────────────────────┐  │
│  │ [扫码图标] 阿莫西林胶囊        │  │
│  └───────────────────────────────┘  │
│  💡 扫码、输入药名或条形码快速入库     │
└─────────────────────────────────────┘
```

#### 操作流程

```
用户操作 → 智能识别 → 自动处理
```

##### 场景1：扫码条形码
```
用户点击扫码图标
  ↓
扫描条形码: 6901234567890
  ↓
查询本地药材档案
  ↓
找到 → 直接添加到入库列表
未找到 → 调用API查询
  ↓
找到 → 保存到档案 + 添加到入库列表
未找到 → 弹出新建药材表单（条形码已填充）
```

##### 场景2：手动输入条形码
```
用户输入: 6901234567890
  ↓
识别为条形码（纯数字8-14位）
  ↓
自动查询（同扫码流程）
```

##### 场景3：输入药材名称
```
用户输入: 阿莫
  ↓
实时搜索本地药材档案
  ↓
显示下拉列表
  ↓
用户选择 → 添加到入库列表
未找到 → 提示"新建药材"
```

##### 场景4：新建药材
```
未找到药材
  ↓
弹出快速新建表单
  ↓
填写必填项（名称、规格、单位）
  ↓
保存到药材档案
  ↓
自动添加到入库列表
```

### 4.3 组件设计

```vue
<template>
  <view class="smart-input-section">
    <!-- 智能输入框 -->
    <view class="input-wrapper">
      <view class="scan-icon" @click="scanBarcode">
        <text>📷</text>
      </view>
      <input 
        v-model="searchKeyword"
        class="smart-input"
        placeholder="扫码或输入药材名称/条形码"
        @input="onInput"
        @confirm="onConfirm"
      />
      <view v-if="searchKeyword" class="clear-icon" @click="clearInput">
        <text>✕</text>
      </view>
    </view>
    
    <!-- 搜索结果下拉列表 -->
    <view v-if="showDropdown" class="dropdown-list">
      <view 
        v-for="item in searchResults" 
        :key="item._id"
        class="dropdown-item"
        @click="selectDrug(item)"
      >
        <view class="drug-name">{{ item.drugName }}</view>
        <view class="drug-spec">{{ item.specification }}</view>
      </view>
      
      <!-- 未找到时显示新建选项 -->
      <view 
        v-if="searchResults.length === 0 && searchKeyword"
        class="dropdown-item create-new"
        @click="createNewDrug"
      >
        <text class="create-icon">➕</text>
        <text>新建药材"{{ searchKeyword }}"</text>
      </view>
    </view>
    
    <!-- 提示文本 -->
    <view class="hint-text">
      💡 扫码、输入药名或条形码快速入库
    </view>
  </view>
</template>
```

### 4.4 智能识别逻辑

```javascript
methods: {
  // 输入时实时识别
  onInput(e) {
    const keyword = e.detail.value.trim()
    
    if (!keyword) {
      this.showDropdown = false
      return
    }
    
    // 判断是条形码还是药材名称
    if (this.isBarcode(keyword)) {
      // 条形码：直接查询
      this.queryByBarcode(keyword)
    } else {
      // 药材名称：实时搜索
      this.searchDrugs(keyword)
    }
  },
  
  // 判断是否为条形码
  isBarcode(str) {
    return /^\d{8,14}$/.test(str)
  },
  
  // 扫码
  async scanBarcode() {
    uni.scanCode({
      success: async (res) => {
        const barcode = res.result
        await this.handleBarcode(barcode)
      }
    })
  },
  
  // 处理条形码
  async handleBarcode(barcode) {
    uni.showLoading({ title: '查询中...' })
    
    try {
      // 1. 查询本地药材档案
      let drugInfo = await this.queryLocalDrug(barcode)
      
      if (drugInfo) {
        // 找到：直接添加到入库列表
        this.addToInboundList(drugInfo)
        uni.showToast({
          title: '✅ 已添加到入库列表',
          icon: 'success'
        })
        return
      }
      
      // 2. 调用第三方API
      drugInfo = await this.queryAPI(barcode)
      
      if (drugInfo) {
        // 找到：保存到档案 + 添加到入库列表
        await this.saveToDrugArchive(drugInfo)
        this.addToInboundList(drugInfo)
        uni.showToast({
          title: '✅ 已添加（新药材已保存）',
          icon: 'success'
        })
        return
      }
      
      // 3. 未找到：弹出新建表单
      this.showCreateDrugDialog(barcode)
      
    } catch (err) {
      uni.showToast({
        title: '查询失败',
        icon: 'none'
      })
    } finally {
      uni.hideLoading()
    }
  },
  
  // 搜索药材（本地档案）
  async searchDrugs(keyword) {
    const results = await this.$api.callFunction('drugManage', {
      action: 'search',
      keyword: keyword,
      limit: 10
    })
    
    this.searchResults = results.data || []
    this.showDropdown = true
  },
  
  // 选择药材
  selectDrug(drug) {
    this.addToInboundList(drug)
    this.clearInput()
    uni.showToast({
      title: '✅ 已添加到入库列表',
      icon: 'success'
    })
  },
  
  // 添加到入库列表
  addToInboundList(drugInfo) {
    const newRow = {
      drugId: drugInfo._id,
      drugName: drugInfo.drugName,
      specification: drugInfo.specification,
      packUnit: drugInfo.packUnit,
      manufacturer: drugInfo.manufacturer || '',
      barcode: drugInfo.barcode || '',
      
      // 待填写
      batchNo: '',
      productionDate: '',
      expiryDate: '',
      quantity: '',
      unitPrice: '',
      
      hasError: true
    }
    
    this.drugList.push(newRow)
    
    // 滚动到该行并聚焦
    this.$nextTick(() => {
      this.scrollToRow(this.drugList.length - 1)
      this.focusBatchNo(this.drugList.length - 1)
    })
  }
}
```

---

## 五、连续入库 + 单据级签名

### 5.1 当前问题
- ❌ 每个药材都要签名（效率低）
- ❌ 签名次数过多（用户体验差）
- ❌ 无法体现"一单一签"的业务逻辑

### 5.2 优化方案：双签名机制

#### 签名位置
```
┌─────────────────────────────────────┐
│  药材入库单                          │
│  ─────────────────────────────────  │
│  基本信息                            │
│  供应商: [输入框]                    │
│  ─────────────────────────────────  │
│  药材明细（可连续添加）               │
│  1. 阿莫西林胶囊 ...                 │
│  2. 头孢克肟颗粒 ...                 │
│  3. 布洛芬片 ...                     │
│  ─────────────────────────────────  │
│  📝 入库人签名 *                     │
│  [点击签名区域]                      │
│  ─────────────────────────────────  │
│  📝 复核人签名 *                     │
│  [点击签名区域]                      │
│  ─────────────────────────────────  │
│  [保存草稿]  [提交入库] ← 一次性提交 │
└─────────────────────────────────────┘
```

### 5.3 签名流程

```
连续添加药材
  ↓
填写完所有药材信息
  ↓
入库人签名（一次）
  ↓
复核人签名（一次）
  ↓
提交入库单
  ↓
所有药材一次性入库
```

### 5.4 数据结构

```javascript
{
  recordNo: 'RK20251108001',
  operator: '李医生',
  supplier: 'XX医药公司',
  location: 'main_pharmacy',
  
  // 药材列表（可多个）
  drugList: [
    {
      drugId: 'drug_001',
      drugName: '阿莫西林胶囊',
      specification: '0.25g*24粒',
      batchNo: 'A20251101',
      productionDate: '2025-11-01',
      expiryDate: '2027-11-01',
      quantity: 10,
      unitPrice: 15.5,
      amount: 155
    },
    {
      drugId: 'drug_002',
      drugName: '头孢克肟颗粒',
      // ...
    }
  ],
  
  // 单据级签名（一次）
  inboundSign: 'cloud://signature_001.png',  // 入库人签名
  reviewSign: 'cloud://signature_002.png',   // 复核人签名
  
  status: 'completed',
  createTime: '2025-11-08 11:06:00'
}
```

### 5.5 签名组件

```vue
<template>
  <view class="signature-section">
    <!-- 入库人签名 -->
    <view class="sign-item">
      <view class="sign-label">📝 入库人签名 *</view>
      <signature 
        v-model="inboundSign"
        title="入库人签名"
        :required="true"
      ></signature>
    </view>
    
    <!-- 复核人签名 -->
    <view class="sign-item">
      <view class="sign-label">📝 复核人签名 *</view>
      <signature 
        v-model="reviewSign"
        title="复核人签名"
        :required="true"
      ></signature>
    </view>
  </view>
</template>
```

### 5.6 提交验证

```javascript
async submitInbound() {
  // 1. 验证药材列表
  if (this.drugList.length === 0) {
    uni.showToast({
      title: '请至少添加一个药材',
      icon: 'none'
    })
    return
  }
  
  // 2. 验证每个药材的必填项
  for (let i = 0; i < this.drugList.length; i++) {
    const drug = this.drugList[i]
    if (!drug.batchNo || !drug.productionDate || !drug.expiryDate || !drug.quantity) {
      uni.showToast({
        title: `第${i+1}行药材信息不完整`,
        icon: 'none'
      })
      return
    }
  }
  
  // 3. 验证签名
  if (!this.inboundSign) {
    uni.showToast({
      title: '请入库人签名',
      icon: 'none'
    })
    return
  }
  
  if (!this.reviewSign) {
    uni.showToast({
      title: '请复核人签名',
      icon: 'none'
    })
    return
  }
  
  // 4. 提交入库单
  uni.showLoading({ title: '提交中...' })
  
  try {
    const result = await this.$api.callFunction('inRecords', {
      action: 'add',
      data: {
        recordNo: this.recordNo,
        operator: this.operator,
        supplier: this.supplier,
        location: this.location,
        drugList: this.drugList,
        inboundSign: this.inboundSign,
        reviewSign: this.reviewSign,
        status: 'completed',
        createTime: new Date()
      }
    })
    
    if (result.success) {
      uni.showToast({
        title: '✅ 入库成功',
        icon: 'success'
      })
      
      // 返回列表页
      setTimeout(() => {
        uni.navigateBack()
      }, 1500)
    }
  } catch (err) {
    uni.showToast({
      title: '提交失败',
      icon: 'none'
    })
  } finally {
    uni.hideLoading()
  }
}
```

---

## 六、完整操作流程

### 6.1 快速入库流程（推荐）

```
步骤1: 打开药材入库单页面
  ↓
步骤2: 填写供应商信息
  ↓
步骤3: 扫码添加药材（连续）
  📷 扫码 → 自动添加 → 填写批号/日期/数量
  📷 扫码 → 自动添加 → 填写批号/日期/数量
  📷 扫码 → 自动添加 → 填写批号/日期/数量
  ↓
步骤4: 入库人签名（一次）
  ↓
步骤5: 复核人签名（一次）
  ↓
步骤6: 提交入库单
  ↓
完成：所有药材一次性入库
```

**时间估算**：
- 单个药材：30秒（扫码3秒 + 填写27秒）
- 10个药材：5-6分钟
- 签名：1分钟
- **总计：6-7分钟**（比原流程快50%）

### 6.2 手动入库流程（备用）

```
步骤1: 打开药材入库单页面
  ↓
步骤2: 输入药材名称
  ↓
步骤3: 选择药材（下拉列表）
  ↓
步骤4: 填写批号/日期/数量
  ↓
重复步骤2-4（连续添加）
  ↓
步骤5: 双签名
  ↓
步骤6: 提交入库单
```

### 6.3 新药材入库流程

```
步骤1: 扫码/输入
  ↓
步骤2: 未找到药材
  ↓
步骤3: 弹出快速新建表单
  填写：药材名称、规格、单位、厂家
  ↓
步骤4: 保存到药材档案
  ↓
步骤5: 自动添加到入库列表
  ↓
步骤6: 填写批号/日期/数量
  ↓
继续添加其他药材...
```

---

## 七、界面设计

### 7.1 页面布局

```
┌─────────────────────────────────────┐
│  ← 药材入库单                    ⋮ ⊙ │
├─────────────────────────────────────┤
│  🏥 爱康医务室管理系统               │
│  北京欢乐谷医务室 · 入库登记         │
├─────────────────────────────────────┤
│  📋 基本信息                         │
│  单号: RK20251108001  时间: 11:06   │
│  操作: 李医生         供应: [输入]  │
├─────────────────────────────────────┤
│  🔍 扫码或输入药材名称/条形码         │
│  ┌───────────────────────────────┐  │
│  │ 📷 [输入框]                ✕ │  │
│  └───────────────────────────────┘  │
│  💡 扫码、输入药名或条形码快速入库     │
├─────────────────────────────────────┤
│  📦 药材明细 (3种)                   │
│  ┌─────────────────────────────┐    │
│  │ 1. 阿莫西林胶囊              │    │
│  │    规格: 0.25g*24粒          │    │
│  │    批号: [A20251101]         │    │
│  │    生产: [2025-11-01]        │    │
│  │    有效: [2027-11-01] 730天  │    │
│  │    数量: [10] 盒  单价: 15.5 │    │
│  │    金额: ¥155.00        [删] │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │ 2. 头孢克肟颗粒 ...          │    │
│  └─────────────────────────────┘    │
│  ┌─────────────────────────────┐    │
│  │ 3. 布洛芬片 ...              │    │
│  └─────────────────────────────┘    │
├─────────────────────────────────────┤
│  📝 入库人签名 *                     │
│  [点击全屏签名]                      │
├─────────────────────────────────────┤
│  📝 复核人签名 *                     │
│  [点击全屏签名]                      │
├─────────────────────────────────────┤
│  [保存草稿]         [✓ 提交入库]    │
└─────────────────────────────────────┘
```

### 7.2 颜色方案

| 元素 | 颜色 | 说明 |
|------|------|------|
| 主色调 | `#9C27B0` | 紫色，医疗感 |
| 成功色 | `#4CAF50` | 绿色，入库成功 |
| 警告色 | `#FF9800` | 橙色，近效期 |
| 错误色 | `#F44336` | 红色，过期/错误 |
| 背景色 | `#F8F8F8` | 浅灰，舒适 |

### 7.3 交互设计

#### 扫码动画
```
扫码中 → 识别中 → 添加成功
[📷]  →  [🔍]  →  [✅]
```

#### 行高亮
```
新添加的行：淡绿色背景 + 边框闪烁（2秒）
有错误的行：淡红色背景 + 错误图标
```

#### 自动滚动
```
添加新药材后，自动滚动到该行
聚焦到批号输入框
```

---

## 八、技术实现要点

### 8.1 核心组件

| 组件 | 文件路径 | 功能 |
|------|---------|------|
| 智能输入框 | `components/smart-input/index.vue` | 扫码/输入/搜索一体 |
| 药材行组件 | `components/drug-row/index.vue` | 单行药材信息 |
| 签名组件 | `components/signature/index.vue` | 全屏签名 |
| 入库页面 | `pages-sub/in/add.vue` | 主页面 |

### 8.2 云函数调用

```javascript
// 1. 查询本地药材档案
await this.$api.callFunction('drugManage', {
  action: 'getByBarcode',
  barcode: '6901234567890'
})

// 2. 搜索药材
await this.$api.callFunction('drugManage', {
  action: 'search',
  keyword: '阿莫西林',
  limit: 10
})

// 3. 新建药材档案
await this.$api.callFunction('drugManage', {
  action: 'add',
  data: { ... }
})

// 4. 提交入库单
await this.$api.callFunction('inRecords', {
  action: 'add',
  data: { ... }
})
```

### 8.3 数据验证

```javascript
// 批号验证
validateBatchNo(batchNo) {
  return /^[A-Z0-9]{6,20}$/.test(batchNo)
}

// 日期验证
validateDate(date) {
  const d = new Date(date)
  return d instanceof Date && !isNaN(d)
}

// 有效期验证
validateExpiry(productionDate, expiryDate) {
  const prod = new Date(productionDate)
  const exp = new Date(expiryDate)
  return exp > prod
}

// 数量验证
validateQuantity(quantity) {
  return quantity > 0 && Number.isInteger(quantity)
}
```

---

## 九、优化效果预估

### 9.1 效率提升

| 指标 | 优化前 | 优化后 | 提升 |
|------|-------|-------|------|
| 单个药材入库时间 | 60秒 | 30秒 | **50%** ↑ |
| 10个药材入库时间 | 12分钟 | 6分钟 | **50%** ↑ |
| 签名次数 | 10次 | 2次 | **80%** ↓ |
| 操作步骤 | 6步/药材 | 3步/药材 | **50%** ↓ |

### 9.2 成本优化

| 项目 | 优化前 | 优化后 | 节省 |
|------|-------|-------|------|
| API调用次数 | 100次/天 | 10次/天 | **90%** ↓ |
| API成本 | ¥5/天 | ¥0.5/天 | **¥4.5/天** |
| 月度成本 | ¥150 | ¥15 | **¥135/月** |

### 9.3 用户体验

| 维度 | 评分（优化前） | 评分（优化后） |
|------|--------------|--------------|
| 操作便捷性 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 学习成本 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 出错率 | ⭐⭐ | ⭐⭐⭐⭐ |
| 整体满意度 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 十、开发计划

### 10.1 开发阶段

| 阶段 | 任务 | 工作量 | 优先级 |
|------|------|-------|--------|
| 阶段1 | 页面重命名 + 基础优化 | 2小时 | P0 |
| 阶段2 | 智能输入框组件 | 4小时 | P0 |
| 阶段3 | 扫码直接入库 | 3小时 | P0 |
| 阶段4 | 查询逻辑优化 | 2小时 | P0 |
| 阶段5 | 双签名机制 | 2小时 | P0 |
| 阶段6 | 测试 + 优化 | 3小时 | P0 |
| **总计** | | **16小时** | |

### 10.2 开发顺序

```
第1步：页面重命名（30分钟）
  ↓
第2步：优化查询逻辑（2小时）
  ↓
第3步：开发智能输入框（4小时）
  ↓
第4步：实现扫码直接入库（3小时）
  ↓
第5步：调整签名机制（2小时）
  ↓
第6步：界面美化（2小时）
  ↓
第7步：测试优化（2.5小时）
  ↓
完成！
```

---

## 十一、测试用例

### 11.1 功能测试

| 用例 | 操作 | 预期结果 |
|------|------|---------|
| 扫码入库 | 扫描条形码 | 自动添加到列表 |
| 输入条形码 | 手动输入条形码 | 自动查询并添加 |
| 搜索药材 | 输入药材名称 | 显示下拉列表 |
| 新建药材 | 未找到时新建 | 保存档案并添加 |
| 连续入库 | 连续扫码10次 | 添加10个药材 |
| 双签名 | 入库人+复核人签名 | 签名成功 |
| 提交入库 | 点击提交按钮 | 入库成功 |

### 11.2 异常测试

| 用例 | 操作 | 预期结果 |
|------|------|---------|
| 无效条形码 | 输入abc123 | 提示格式错误 |
| 重复添加 | 扫描同一药材2次 | 提示已添加 |
| 未填批号 | 提交时批号为空 | 提示必填 |
| 未签名 | 提交时未签名 | 提示需签名 |
| 网络断开 | 扫码时断网 | 提示网络错误 |

---

## 十二、总结

### 12.1 核心优化点

1. ✅ **页面重命名**：入库统计 → 药材入库单
2. ✅ **扫码直接入库**：扫码后自动添加到列表
3. ✅ **查询优化**：优先本地档案，节省90%成本
4. ✅ **一体化输入**：扫码/输入/新建合并为一个操作
5. ✅ **双签名机制**：单据级签名，减少80%签名次数

### 12.2 预期收益

- 💰 **成本降低90%**（API调用优化）
- ⚡ **效率提升50%**（操作流程简化）
- 😊 **体验提升**（操作更流畅）
- 🎯 **准确性提升**（本地档案更准确）

### 12.3 下一步行动

1. [ ] 评审设计方案
2. [ ] 确认开发优先级
3. [ ] 开始开发实现
4. [ ] 内部测试
5. [ ] 用户培训
6. [ ] 正式上线

---

**设计完成日期**: 2025-11-08  
**版本**: v4.0  
**状态**: ✅ 设计完成，待评审

