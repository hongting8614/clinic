# 🎬 入库功能测试演示流程

## 📅 测试时间
2025-11-08

---

## 🎯 演示目标

通过实际操作演示入库功能的完整流程，验证所有优化功能是否正常工作。

---

## 📱 演示流程

### 第一步：进入入库页面

```
操作：
1. 启动小程序
2. 点击底部"库存"标签
3. 点击"入库记录"（注意：不是"入库统计"）
4. 点击右下角绿色➕按钮

预期结果：
✅ 进入"药品入库"页面
✅ 页面头部显示绿色渐变背景
✅ 标题显示"药品入库"
✅ 显示智能搜索框
```

---

### 第二步：测试智能搜索

#### 2.1 搜索已有药品

```
操作：
1. 在搜索框输入"阿莫西林"
2. 观察下拉列表

预期结果：
✅ 搜索框获得焦点（绿色边框）
✅ 300ms后显示下拉列表
✅ 列表显示匹配的药品
✅ 每个药品显示名称和规格

操作：
3. 点击列表中的某个药品

预期结果：
✅ 药品添加到下方列表
✅ 显示"已添加"提示
✅ 手机轻微振动
✅ 搜索框自动清空
✅ 下拉列表消失
```

#### 2.2 搜索不存在的药品

```
操作：
1. 在搜索框输入"测试药品XYZ"
2. 等待搜索完成

预期结果：
✅ 显示"未找到'测试药品XYZ'"
✅ 显示绿色"新建药品档案"按钮

操作：
3. 点击"新建药品档案"按钮

预期结果：
✅ 弹出"新建药品档案"弹窗
✅ 药品名称自动填充为"测试药品XYZ"
✅ 显示规格输入框
✅ 显示单位选择器
```

---

### 第三步：测试扫码功能

```
操作：
1. 点击搜索框右侧📷图标
2. 扫描药品条形码

场景A：本地档案存在
预期结果：
✅ 显示"识别中..."
✅ 快速查询完成（<100ms）
✅ 显示"✅ 已添加 (本地档案)"
✅ 药品添加到列表
✅ 不消耗API次数

场景B：本地档案不存在，API有余额
预期结果：
✅ 显示"识别中..."
✅ 先查本地（未找到）
✅ 检查API次数（充足）
✅ 调用第三方API
✅ 显示"✅ 已添加 (API查询)"
✅ 如果剩余<20次：显示"⚠️ 今日剩余X次API"
✅ 药品添加到列表
✅ 消耗1次API

场景C：API次数不足
预期结果：
✅ 显示"🚫 API次数不足"弹窗
✅ 提示手动新建
✅ 点击"手动新建"打开新建弹窗
```

---

### 第四步：测试新建药品

```
操作：
1. 在新建弹窗中填写信息：
   - 药品名称："测试药品A"
   - 规格："0.5g×20片/盒"
   - 单位：选择"盒"
2. 点击"确定"

预期结果：
✅ 验证必填字段
✅ 关闭弹窗
✅ 药品添加到列表
✅ 显示"已添加到列表"提示
```

---

### 第五步：测试连续添加

```
操作：
1. 通过搜索添加"阿莫西林胶囊"
2. 通过扫码添加"布洛芬缓释胶囊"
3. 通过新建添加"测试药品B"

预期结果：
✅ 列表显示3个药品卡片
✅ 每个卡片独立显示
✅ 顶部显示"入库明细 3 种"
✅ 每个卡片右上角有删除按钮
```

---

### 第六步：填写药品信息

```
操作：对第1个药品填写信息
1. 批号：输入"A20250101"
2. 生产日期：选择"2025-01-01"
3. 有效期：选择"2027-01-01"
4. 数量：输入"100"
5. 单价：输入"25.50"（选填）

预期结果：
✅ 所有信息正确保存
✅ 自动计算距有效期天数
✅ 显示有效期徽章（绿色，约730天）
✅ 自动计算金额：¥2,550.00
✅ 底部合计更新：
   - 品种：3 种
   - 总数量：100
   - 总金额：¥2,550.00
```

---

### 第七步：测试有效期徽章

```
操作：对第2个药品填写不同有效期
1. 有效期：2025-03-01（约30天）

预期结果：
✅ 徽章显示黄色（30-89天）

操作：对第3个药品填写
2. 有效期：2025-02-01（约20天）

预期结果：
✅ 徽章显示红色（<30天）

操作：测试过期药品
3. 有效期：2024-01-01（已过期）

预期结果：
✅ 徽章显示黑色
✅ 提交时拒绝："药品已过期，不能入库"
```

---

### 第八步：测试删除功能

```
操作：
1. 点击第3个药品卡片右上角✕按钮
2. 在弹窗中点击"确定"

预期结果：
✅ 显示"确认删除"弹窗
✅ 第3个药品被删除
✅ 列表剩余2个药品
✅ 顶部显示"入库明细 2 种"
✅ 底部合计更新
```

---

### 第九步：测试表单验证

#### 9.1 测试必填项

```
操作：
1. 添加一个新药品
2. 不填写任何信息
3. 点击"提交复核"

预期结果：
✅ 显示"第X行：批号不能为空"
✅ 不提交表单
✅ 对应卡片左侧显示红色边框
```

#### 9.2 测试签名验证

```
操作：
1. 填写完整药品信息
2. 不签名
3. 点击"提交复核"

预期结果：
✅ 显示"请先签名"提示
✅ 不提交表单
```

---

### 第十步：测试签名功能

```
操作：
1. 点击"操作员签名"区域
2. 在弹窗中手写签名
3. 点击"确定"

预期结果：
✅ 弹出签名弹窗
✅ 可以在画布上绘制
✅ 点击"清除"可以重新签名
✅ 点击"确定"后签名显示在签名区域
✅ 签名图片清晰可见
```

---

### 第十一步：提交入库单

```
操作：
1. 确认所有信息填写完整
2. 确认已签名
3. 点击"提交复核"

预期结果：
✅ 显示"提交中..."加载提示
✅ 调用云函数创建入库单
✅ 显示"提交成功"提示
✅ 1.5秒后自动返回列表页
✅ 列表页显示新创建的入库单
✅ 状态为"待复核"（橙色徽章）
```

---

### 第十二步：查看入库单详情

```
操作：
1. 在列表页点击刚创建的入库单

预期结果：
✅ 跳转到详情页
✅ 显示紫色渐变头部
✅ 显示状态流程指示器（创建→复核→完成）
✅ 当前在"复核"阶段（橙色）
✅ 显示基本信息（单号、时间、操作人）
✅ 显示药品明细列表
✅ 显示操作员签名
✅ 如果是其他人：显示"复核操作"区域
```

---

### 第十三步：测试复核功能

```
注意：需要切换到其他账号进行复核

操作：
1. 使用另一个账号登录
2. 进入"入库记录"
3. 点击"待复核"标签
4. 点击待复核的入库单
5. 查看药品明细
6. 在"复核操作"区域手写签名
7. 点击"通过复核"
8. 在确认弹窗点击"确定"

预期结果：
✅ 显示"处理中..."
✅ 调用云函数通过复核
✅ 自动更新库存
✅ 显示"复核通过"提示
✅ 返回列表页
✅ 单据状态变为"已完成"（绿色）
✅ 状态流程指示器全部变绿
```

---

## 🎨 UI风格检查

### 微信风格验证

```
✅ 主色调：微信绿（#07C160）
✅ 按钮：圆角50rpx
✅ 卡片：圆角16rpx
✅ 渐变色：正确显示
✅ 阴影：柔和自然
✅ 字体：清晰易读
✅ 间距：合理舒适
```

### 交互效果验证

```
✅ 按钮按下：缩放0.98
✅ 扫码成功：振动反馈
✅ 焦点状态：绿色边框
✅ 动画过渡：流畅自然
✅ 加载提示：及时显示
✅ 错误提示：清晰明确
```

---

## 📊 性能检查

### 响应速度

```
✅ 本地搜索：<100ms
✅ API查询：<2000ms
✅ 页面切换：<500ms
✅ 列表渲染：流畅无卡顿
```

### 内存占用

```
✅ 正常使用：<50MB
✅ 添加10个药品：<60MB
✅ 无内存泄漏
```

---

## ✅ 测试完成标准

### 必须通过的测试

- [x] 智能搜索功能正常
- [x] 扫码功能正常
- [x] 新建药品功能正常
- [x] 连续添加功能正常
- [x] 表单验证正常
- [x] 签名功能正常
- [x] 提交功能正常
- [x] 复核功能正常
- [x] 微信风格UI正确
- [x] 交互效果流畅

---

## 🐛 问题记录模板

如果发现问题，请按此格式记录：

```
问题描述：
重现步骤：
预期结果：
实际结果：
严重程度：⬜ 高 / ⬜ 中 / ⬜ 低
截图/视频：
```

---

## 📸 测试截图建议

建议截取以下关键界面：

1. 智能搜索框（有下拉列表）
2. 药品卡片列表（多个药品）
3. 有效期徽章（不同颜色）
4. 签名界面
5. 提交成功提示
6. 入库单详情页
7. 复核操作界面

---

**准备好了吗？开始测试吧！** 🚀

有任何问题随时告诉我！



