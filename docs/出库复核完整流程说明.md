# å‡ºåº“å¤æ ¸å®Œæ•´æµç¨‹è¯´æ˜

## ğŸ”„ å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤1ï¼šåˆ›å»ºå‡ºåº“å• (add.vue)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ç‚¹å‡»"+ æ·»åŠ è¯æ"                                     â”‚
â”‚  2. é€‰æ‹©è¯æ â†’ é€‰æ‹©æ‰¹æ¬¡                                  â”‚
â”‚  3. å¡«å†™å‡ºåº“æ•°é‡                                         â”‚
â”‚  4. å‘æ”¾äººç­¾å                                           â”‚
â”‚  5. ç‚¹å‡»"æäº¤å¤æ ¸" âœ…                                    â”‚
â”‚     â†“                                                    â”‚
â”‚  çŠ¶æ€ï¼šdraft â†’ pending_review                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤2ï¼šå‡ºåº“åˆ—è¡¨æ˜¾ç¤ºå¾…å¤æ ¸ (list.vue)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä½ç½®ï¼šé¦–é¡µ â†’ å‡ºåº“ç®¡ç† â†’ å‡ºåº“åˆ—è¡¨                       â”‚
â”‚                                                          â”‚
â”‚  [å…¨éƒ¨] [è‰ç¨¿] [å¾…å¤æ ¸(1)] [å·²å®Œæˆ] [å·²é©³å›]            â”‚
â”‚                    â†‘                                     â”‚
â”‚              æ˜¾ç¤ºå¾…å¤æ ¸æ•°é‡                              â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ CK20251123001         [å¾…å¤æ ¸]          â”‚            â”‚
â”‚  â”‚ é™†å›­                                    â”‚            â”‚
â”‚  â”‚ å‘æ”¾äººï¼šå¼ ä¸‰                            â”‚            â”‚
â”‚  â”‚ è¯æï¼š2ç§                               â”‚            â”‚
â”‚  â”‚                      [å»å¤æ ¸] â† ç‚¹å‡»    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤3ï¼šå¤æ ¸é¡µé¢ (detail.vue?action=review)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æŸ¥çœ‹å‡ºåº“å•è¯¦æƒ…ï¼š                                        â”‚
â”‚  - å•å·ã€çŠ¶æ€ã€å‘æ”¾äºº                                    â”‚
â”‚  - è¯ææ˜ç»†åˆ—è¡¨                                          â”‚
â”‚  - å‘æ”¾äººç­¾åï¼ˆå·²å®Œæˆï¼‰                                  â”‚
â”‚                                                          â”‚
â”‚  æ¥æ”¶æ“ä½œåŒºï¼š                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ âœï¸ æ¥æ”¶ç¡®è®¤                            â”‚            â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚            â”‚
â”‚  â”‚ â”‚  [æ¥æ”¶äººç­¾ååŒºåŸŸ]              â”‚      â”‚            â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚            â”‚
â”‚  â”‚ é©³å›åŸå› ï¼ˆé€‰å¡«ï¼‰ï¼š                     â”‚            â”‚
â”‚  â”‚ [___________________________]          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                          â”‚
â”‚  [  é©³å›  ]              [  ç¡®è®¤æ¥æ”¶  ] â† ç‚¹å‡»          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤4ï¼šå¤æ ¸å®Œæˆ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… ç¡®è®¤æ¥æ”¶ï¼š                                           â”‚
â”‚     - çŠ¶æ€ï¼špending_review â†’ completed                  â”‚
â”‚     - æ‰£å‡è¯åº“åº“å­˜ï¼ˆåŒ…è£…å•ä½ï¼‰                          â”‚
â”‚     - å¢åŠ å›­åŒºåº“å­˜ï¼ˆæœ€å°å•ä½ï¼‰                          â”‚
â”‚     - æç¤ºï¼š"å·²é€šè¿‡å¹¶å‡ºåº“"                              â”‚
â”‚                                                          â”‚
â”‚  âŒ é©³å›ï¼š                                               â”‚
â”‚     - çŠ¶æ€ï¼špending_review â†’ rejected                   â”‚
â”‚     - åº“å­˜ä¸å˜                                           â”‚
â”‚     - å‘æ”¾äººå¯é‡æ–°ç¼–è¾‘                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å„é¡µé¢è¯¦ç»†è¯´æ˜

### **1. å‡ºåº“æ–°å¢é¡µé¢**
**æ–‡ä»¶ï¼š** `pages-sub/out/add.vue`  
**è·¯å¾„ï¼š** é¦–é¡µ â†’ å‡ºåº“ç®¡ç† â†’ + æ–°å»ºå‡ºåº“å•

#### **åŠŸèƒ½ï¼š**
- âœ… é€‰æ‹©è¯æå’Œæ‰¹æ¬¡
- âœ… å¡«å†™å‡ºåº“æ•°é‡
- âœ… å‘æ”¾äººç­¾å
- âœ… æäº¤å¤æ ¸

#### **æäº¤å¤æ ¸æ–¹æ³•ï¼š**
```javascript
async submitReview() {
  // éªŒè¯ç­¾å
  if (!this.dispenserSign) {
    uni.showToast({ title: 'è¯·å…ˆå®Œæˆå‘æ”¾äººç­¾å', icon: 'none' })
    return
  }
  
  // éªŒè¯è¯æ
  if (this.drugList.length === 0) {
    uni.showToast({ title: 'è¯·è‡³å°‘æ·»åŠ ä¸€ç§è¯æ', icon: 'none' })
    return
  }
  
  // è°ƒç”¨äº‘å‡½æ•°
  const result = await this.$api.callFunction('outRecords', {
    action: 'create',
    data: {
      ...this.formData,
      status: 'pending_review',  // â† å…³é”®ï¼šè®¾ç½®ä¸ºå¾…å¤æ ¸
      dispenserSign: this.dispenserSign,
      items: this.drugList
    }
  })
  
  if (result.success) {
    uni.showToast({ title: 'æäº¤æˆåŠŸ', icon: 'success' })
    uni.navigateBack()
  }
}
```

---

### **2. å‡ºåº“åˆ—è¡¨é¡µ**
**æ–‡ä»¶ï¼š** `pages-sub/out/list.vue`  
**è·¯å¾„ï¼š** é¦–é¡µ â†’ å‡ºåº“ç®¡ç† â†’ å‡ºåº“åˆ—è¡¨

#### **åŠŸèƒ½ï¼š**
- âœ… æ˜¾ç¤ºæ‰€æœ‰å‡ºåº“å•
- âœ… ç­›é€‰æ ‡ç­¾ï¼šå…¨éƒ¨/è‰ç¨¿/å¾…å¤æ ¸/å·²å®Œæˆ/å·²é©³å›
- âœ… æ˜¾ç¤ºå¾…å¤æ ¸æ•°é‡
- âœ… "å»å¤æ ¸"æŒ‰é’®ï¼ˆä»…å¾…å¤æ ¸çŠ¶æ€æ˜¾ç¤ºï¼‰

#### **å¾…å¤æ ¸æ˜¾ç¤ºé€»è¾‘ï¼š**
```vue
<template>
  <!-- ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view 
      v-for="tab in tabs" 
      :class="['tab-item', { active: currentTab === tab.value }]"
      @click="switchTab(tab.value)"
    >
      <text>{{ tab.label }}</text>
      <text v-if="tab.count > 0" class="tab-badge">{{ tab.count }}</text>
    </view>
  </view>
  
  <!-- å‡ºåº“å•å¡ç‰‡ -->
  <view 
    v-for="item in recordList" 
    class="record-card"
  >
    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="record-header">
      <text>{{ item.recordNo }}</text>
      <view :class="['status', `status-${item.status}`]">
        {{ getStatusText(item.status) }}
      </view>
    </view>
    
    <!-- å¾…å¤æ ¸æ—¶æ˜¾ç¤ºæ“ä½œæŒ‰é’® -->
    <view v-if="item.status === 'pending_review'">
      <button @click="goReview(item._id)">å»å¤æ ¸</button>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      tabs: [
        { label: 'å…¨éƒ¨', value: 'all', count: 0 },
        { label: 'è‰ç¨¿', value: 'draft', count: 0 },
        { label: 'å¾…å¤æ ¸', value: 'pending_review', count: 0 },  // â† è¿™é‡Œ
        { label: 'å·²å®Œæˆ', value: 'completed', count: 0 },
        { label: 'å·²é©³å›', value: 'rejected', count: 0 }
      ]
    }
  },
  
  methods: {
    // åŠ è½½å„çŠ¶æ€æ•°é‡
    async loadCounts() {
      const result = await this.$api.callFunction('outRecords', {
        action: 'getCounts',
        data: {}
      })
      
      if (result.success) {
        this.tabs.forEach(tab => {
          if (tab.value === 'pending_review') {
            tab.count = result.pending_review || 0
          }
        })
      }
    },
    
    // å»å¤æ ¸
    goReview(id) {
      uni.navigateTo({
        url: `/pages-sub/out/detail?id=${id}&action=review`
      })
    }
  }
}
</script>
```

---

### **3. å‡ºåº“è¯¦æƒ…/å¤æ ¸é¡µ**
**æ–‡ä»¶ï¼š** `pages-sub/out/detail.vue`  
**è·¯å¾„ï¼š** å‡ºåº“åˆ—è¡¨ â†’ ç‚¹å‡»å¡ç‰‡ or ç‚¹å‡»"å»å¤æ ¸"

#### **åŠŸèƒ½ï¼š**
- âœ… æŸ¥çœ‹å‡ºåº“å•è¯¦æƒ…
- âœ… æ¥æ”¶äººç­¾å
- âœ… é©³å›åŸå› è¾“å…¥
- âœ… ç¡®è®¤æ¥æ”¶ / é©³å›æŒ‰é’®

#### **å¤æ ¸é€»è¾‘ï¼š**
```vue
<template>
  <view>
    <!-- å‡ºåº“å•è¯¦æƒ… -->
    <view class="detail-section">
      <view>å•å·ï¼š{{ record.recordNo }}</view>
      <view>å‘æ”¾äººï¼š{{ record.dispenser }}</view>
      <view>è¯ææ˜ç»†ï¼š</view>
      <view v-for="item in record.items">
        {{ item.drugName }} Ã— {{ item.quantity }}
      </view>
    </view>
    
    <!-- å‘æ”¾äººç­¾åï¼ˆå·²å®Œæˆï¼‰ -->
    <view class="signature-display">
      <image :src="record.dispenserSign" />
      <text>{{ record.dispenser }}</text>
    </view>
    
    <!-- æ¥æ”¶äººç­¾ååŒºåŸŸ -->
    <view v-if="isReviewAction && record.status === 'pending_review'">
      <signature 
        v-model="receiverSign"
        title="è¯·ç­¾åç¡®è®¤æ¥æ”¶"
      />
      
      <textarea 
        v-model="rejectReason"
        placeholder="å¦‚éœ€é©³å›ï¼Œè¯·å¡«å†™åŸå› "
      />
    </view>
    
    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view v-if="isReviewAction && record.status === 'pending_review'">
      <button @tap="handleReject">é©³å›</button>
      <button @tap="handleApprove">ç¡®è®¤æ¥æ”¶</button>
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      recordId: '',
      isReviewAction: false,
      record: {},
      receiverSign: '',
      rejectReason: ''
    }
  },
  
  onLoad(options) {
    this.recordId = options.id
    this.isReviewAction = options.action === 'review'
    this.loadRecord()
  },
  
  methods: {
    // ç¡®è®¤æ¥æ”¶
    async handleApprove() {
      if (!this.receiverSign) {
        uni.showToast({ title: 'è¯·å…ˆç­¾å', icon: 'none' })
        return
      }
      
      const result = await this.$api.callFunction('outRecords', {
        action: 'complete',  // â† å…³é”®action
        data: {
          _id: this.recordId,
          receiver: this.currentUser.name,
          receiverId: this.currentUser._id,
          receiverSign: this.receiverSign,
          receiverSignTime: new Date().toISOString()
        }
      })
      
      if (result.success) {
        uni.showToast({ title: 'å·²ç¡®è®¤æ¥æ”¶', icon: 'success' })
        setTimeout(() => uni.navigateBack(), 1500)
      }
    },
    
    // é©³å›
    async handleReject() {
      if (!this.rejectReason.trim()) {
        uni.showToast({ title: 'è¯·è¾“å…¥é©³å›åŸå› ', icon: 'none' })
        return
      }
      
      const result = await this.$api.callFunction('outRecords', {
        action: 'update',
        data: {
          _id: this.recordId,
          status: 'rejected',
          rejectReason: this.rejectReason,
          reviewer: this.currentUser.name,
          reviewerId: this.currentUser._id
        }
      })
      
      if (result.success) {
        uni.showToast({ title: 'å·²é©³å›', icon: 'success' })
        setTimeout(() => uni.navigateBack(), 1500)
      }
    }
  }
}
</script>
```

---

## ğŸ”§ äº‘å‡½æ•° (outRecords)

**æ–‡ä»¶ï¼š** `cloudfunctions/outRecords/index.js`

### **æ”¯æŒçš„ Actionsï¼š**

1. **create** - åˆ›å»ºå‡ºåº“å•
2. **getList** - è·å–å‡ºåº“å•åˆ—è¡¨
3. **getDetail** - è·å–å‡ºåº“å•è¯¦æƒ…
4. **complete** - å®Œæˆå‡ºåº“ï¼ˆå¤æ ¸é€šè¿‡ï¼‰â­
5. **getCounts** - è·å–å„çŠ¶æ€æ•°é‡
6. **update** - æ›´æ–°å‡ºåº“å•ï¼ˆç”¨äºé©³å›ï¼‰
7. **delete** - åˆ é™¤å‡ºåº“å•ï¼ˆä»…è‰ç¨¿ï¼‰

### **å…³é”®ï¼šcompleteï¼ˆå¤æ ¸é€šè¿‡ï¼‰**

```javascript
/**
 * å®Œæˆå‡ºåº“ï¼ˆæ‰§è¡Œåº“å­˜å˜æ›´ï¼‰
 */
async function complete(data, wxContext) {
  const { 
    _id,
    receiver,
    receiverId,
    receiverSign,
    receiverSignTime
  } = data
  
  // 1. è·å–å‡ºåº“å•
  const record = await db.collection('out_records').doc(_id).get()
  
  // 2. å¼€å§‹äº‹åŠ¡ï¼šæ‰£å‡åº“å­˜
  for (const item of record.data.items) {
    // æ‰£å‡è¯åº“åº“å­˜ï¼ˆåŒ…è£…å•ä½ï¼‰
    await db.collection('stock').where({
      drugId: item.drugId,
      batch: item.batch,
      location: record.data.fromLocation  // è¯æåº“
    }).update({
      data: {
        quantity: _.inc(-item.packQuantity)  // æ‰£å‡åŒ…è£…æ•°é‡
      }
    })
    
    // å¢åŠ å›­åŒºåº“å­˜ï¼ˆæœ€å°å•ä½ï¼‰â­ å…³é”®ï¼
    await db.collection('stock').where({
      drugId: item.drugId,
      batch: item.batch,
      location: record.data.toLocation  // é™†å›­/æ°´å›­
    }).update({
      data: {
        quantity: _.inc(item.minQuantity)  // å¢åŠ æœ€å°å•ä½
      }
    })
  }
  
  // 3. æ›´æ–°å‡ºåº“å•çŠ¶æ€
  await db.collection('out_records').doc(_id).update({
    data: {
      status: 'completed',
      receiver,
      receiverId,
      receiverSign,
      receiverSignTime,
      completeTime: new Date()
    }
  })
  
  return { success: true, message: 'å‡ºåº“æˆåŠŸ' }
}
```

---

## ğŸ“Š çŠ¶æ€æµè½¬

```
draft (è‰ç¨¿)
  â†“ ç‚¹å‡»"æäº¤å¤æ ¸"
pending_review (å¾…å¤æ ¸)
  â†“ 
  â”œâ†’ ç‚¹å‡»"ç¡®è®¤æ¥æ”¶" â†’ completed (å·²å®Œæˆ)
  â””â†’ ç‚¹å‡»"é©³å›" â†’ rejected (å·²é©³å›)
       â†“ 
       å¯é‡æ–°ç¼–è¾‘ â†’ draft
```

---

## ğŸ¯ æƒé™æ§åˆ¶

### **è°å¯ä»¥åˆ›å»ºå‡ºåº“å•ï¼Ÿ**
- âœ… ç®¡ç†å‘˜ (admin)
- âœ… é¡¹ç›®ç»ç† (project_manager)
- âœ… è¯æˆ¿äººå‘˜ (pharmacy)

### **è°å¯ä»¥å¤æ ¸ï¼Ÿ**
- âœ… ç®¡ç†å‘˜ (admin)
- âœ… é¡¹ç›®ç»ç† (project_manager)
- âŒ ä¸èƒ½å¤æ ¸è‡ªå·±åˆ›å»ºçš„å‡ºåº“å•

### **æƒé™åˆ¤æ–­é€»è¾‘ï¼š**
```javascript
// åœ¨ list.vue ä¸­
canReview(item) {
  const userInfo = uni.getStorageSync('userInfo')
  return item.status === 'pending_review' && 
         item.dispenserId !== userInfo._id  // ä¸èƒ½å¤æ ¸è‡ªå·±çš„å•
}

// åœ¨ detail.vue ä¸­
onLoad(options) {
  this.isReviewAction = options.action === 'review'
  const userInfo = uni.getStorageSync('userInfo')
  
  // æ£€æŸ¥æƒé™
  if (this.isReviewAction) {
    if (!['admin', 'project_manager'].includes(userInfo.role)) {
      uni.showToast({ title: 'æ— æƒé™å¤æ ¸', icon: 'none' })
      uni.navigateBack()
    }
  }
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### **1. åº“å­˜å•ä½è½¬æ¢**
- è¯æåº“ï¼šåŒ…è£…å•ä½ï¼ˆç›’ã€ç“¶ï¼‰
- å›­åŒºåº“ï¼šæœ€å°å•ä½ï¼ˆç‰‡ã€ç²’ï¼‰
- å‡ºåº“æ—¶è‡ªåŠ¨è½¬æ¢ï¼

### **2. ç­¾åä¸Šä¼ **
```javascript
// ç­¾åå›¾ç‰‡éœ€è¦å…ˆä¸Šä¼ åˆ°äº‘å­˜å‚¨
const uploadResult = await wx.cloud.uploadFile({
  cloudPath: `signatures/out_${Date.now()}.png`,
  filePath: signatureData
})

this.dispenserSign = uploadResult.fileID  // ä¿å­˜äº‘å­˜å‚¨ID
```

### **3. é©³å›åç¼–è¾‘**
- é©³å›åçŠ¶æ€å˜ä¸º `rejected`
- å‘æ”¾äººå¯ä»¥é‡æ–°ç¼–è¾‘
- ç¼–è¾‘åçŠ¶æ€å˜å› `draft`
- éœ€è¦é‡æ–°æäº¤å¤æ ¸

---

## ğŸš€ æµ‹è¯•æµç¨‹

### **å®Œæ•´æµ‹è¯•æ­¥éª¤ï¼š**

1. **åˆ›å»ºå‡ºåº“å•**
   ```
   ç™»å½• â†’ å‡ºåº“ç®¡ç† â†’ + æ–°å»º
   â†’ é€‰æ‹©è¯æï¼ˆæ£‰ç­¾ï¼‰
   â†’ é€‰æ‹©æ‰¹æ¬¡ï¼ˆ221443ï¼‰
   â†’ å¡«å†™æ•°é‡ï¼ˆ1åŒ…ï¼‰
   â†’ å‘æ”¾äººç­¾å
   â†’ æäº¤å¤æ ¸ âœ…
   ```

2. **æŸ¥çœ‹å¾…å¤æ ¸**
   ```
   è¿”å›å‡ºåº“åˆ—è¡¨
   â†’ ç‚¹å‡»"å¾…å¤æ ¸"æ ‡ç­¾
   â†’ åº”è¯¥æ˜¾ç¤ºåˆšæ‰åˆ›å»ºçš„å•å­
   â†’ æ˜¾ç¤º"å»å¤æ ¸"æŒ‰é’® âœ…
   ```

3. **æ‰§è¡Œå¤æ ¸**
   ```
   ç‚¹å‡»"å»å¤æ ¸"
   â†’ æŸ¥çœ‹å‡ºåº“å•è¯¦æƒ…
   â†’ æ¥æ”¶äººç­¾å
   â†’ ç‚¹å‡»"ç¡®è®¤æ¥æ”¶" âœ…
   ```

4. **éªŒè¯ç»“æœ**
   ```
   è¿”å›å‡ºåº“åˆ—è¡¨
   â†’ å•å­çŠ¶æ€å˜ä¸º"å·²å®Œæˆ"
   â†’ æŸ¥çœ‹åº“å­˜ï¼š
     - è¯æåº“ï¼ˆdrug_storageï¼‰ï¼šæ£‰ç­¾ -1åŒ…
     - ç›®æ ‡å›­åŒºï¼ˆå¦‚é™†å›­ï¼‰ï¼šæ£‰ç­¾ +2000æ”¯ âœ…
   ```

---

## ğŸ“± ç•Œé¢æ•ˆæœ

### **å‡ºåº“åˆ—è¡¨ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å…¨éƒ¨] [è‰ç¨¿] [å¾…å¤æ ¸(3)] [å·²å®Œæˆ]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CK20251123001           [å¾…å¤æ ¸]     â”‚
â”‚ é™†å›­                                  â”‚
â”‚ å‘æ”¾äººï¼šå¼ ä¸‰                          â”‚
â”‚ åˆ›å»ºæ—¶é—´ï¼š2025-11-23 10:30           â”‚
â”‚ è¯æç§ç±»ï¼š2 ç§                        â”‚
â”‚                       [å»å¤æ ¸] â†ç‚¹å‡» â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **å¤æ ¸é¡µé¢ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‡ºåº“å•è¯¦æƒ…                            â”‚
â”‚ å•å·ï¼šCK20251123001                   â”‚
â”‚ å‘æ”¾äººï¼šå¼ ä¸‰                          â”‚
â”‚ çŠ¶æ€ï¼šå¾…å¤æ ¸                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¯ææ˜ç»†ï¼š                            â”‚
â”‚ 1. æ£‰ç­¾ - 2000æ”¯/åŒ… Ã— 1åŒ…           â”‚
â”‚ 2. ç¢˜ä¼ - 100ml/ç“¶ Ã— 2ç“¶            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœï¸ æ¥æ”¶ç¡®è®¤                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ [æ¥æ”¶äººç­¾ååŒºåŸŸ]                â”‚  â”‚
â”‚ â”‚ ğŸ–Šï¸ ç‚¹å‡»å…¨å±ç­¾å                 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚
â”‚ é©³å›åŸå› ï¼ˆé€‰å¡«ï¼‰ï¼š                   â”‚
â”‚ [________________________]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [  é©³å›  ]          [  ç¡®è®¤æ¥æ”¶  ]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**å®Œæ•´æµç¨‹å·²æ¢³ç†ï¼ç°åœ¨å¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼** ğŸ‰
