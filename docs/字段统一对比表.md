# è¯æå­—æ®µç»Ÿä¸€å¯¹æ¯”è¡¨

## âœ… ç»Ÿä¸€å®Œæˆ (2025-11-04)

### ğŸ“Š å­—æ®µå¯¹æ¯”

| å­—æ®µå | å…¥åº“ (in/add.vue) | å‡ºåº“ (out/add.vue) | é—¨è¯Šç™»è®° (clinic/add.vue) | ç»Ÿä¸€çŠ¶æ€ |
|--------|------------------|-------------------|------------------------|---------|
| **drugId** | âœ… drugInfo._id | âœ… drugInfo._id | âœ… this.form.drugId | âœ… ç»Ÿä¸€ |
| **drugCode** | âœ… drugCode \|\| code | âœ… drugCode \|\| code | âœ… drugCode \|\| code | âœ… ç»Ÿä¸€ |
| **drugName** | âœ… name \|\| drugName | âœ… name | âœ… name | âœ… ç»Ÿä¸€ |
| **specification** | âœ… specification \|\| spec | âœ… specification \|\| spec | âœ… specification | âœ… ç»Ÿä¸€ |
| **unit** | âœ… unit | âœ… unit | âœ… minUnit | âœ… ç»Ÿä¸€ |
| **manufacturer** | âœ… manufacturer | âœ… manufacturer | - | âœ… ä¸€è‡´ |

---

## ğŸ“¦ æ•°æ®ç»“æ„å¯¹æ¯”

### å…¥åº“å• (inRecords)

```javascript
{
  recordNo: "IN20251104001",
  supplier: "XXåŒ»è¯å…¬å¸",
  items: [
    {
      drugId: "cloud://drug_abc123",      // âœ… ç³»ç»Ÿå†…éƒ¨ID
      drugCode: "AMOX500-TAB",            // âœ… è¯æä»£ç 
      drugName: "é˜¿è«è¥¿æ—èƒ¶å›Š",           // âœ… è¯æåç§°
      specification: "0.25g*24ç²’",        // âœ… è§„æ ¼ï¼ˆç»Ÿä¸€å­—æ®µåï¼‰
      unit: "ç›’",                         // âœ… å•ä½
      manufacturer: "XXåˆ¶è¯æœ‰é™å…¬å¸",
      batch: "20250101",
      productionDate: "2025-01-01",
      expireDate: "2027-01-01",
      quantity: 100,
      price: 25.50,
      isHighValue: false,
      isEmergency: false
    }
  ],
  operator: "å¼ ä¸‰",
  status: "pending_review"
}
```

### å‡ºåº“å• (outRecords)

```javascript
{
  recordNo: "OUT20251104001",
  location: "land_park",
  locationName: "é™†å›­",
  items: [
    {
      drugId: "cloud://drug_abc123",      // âœ… ç³»ç»Ÿå†…éƒ¨ID
      drugCode: "AMOX500-TAB",            // âœ… è¯æä»£ç 
      drugName: "é˜¿è«è¥¿æ—èƒ¶å›Š",           // âœ… è¯æåç§°
      specification: "0.25g*24ç²’",        // âœ… è§„æ ¼ï¼ˆç»Ÿä¸€å­—æ®µåï¼‰
      unit: "ç›’",                         // âœ… å•ä½
      manufacturer: "XXåˆ¶è¯æœ‰é™å…¬å¸",
      batch: "20250101",
      batchId: "cloud://batch_xyz789",
      expireDate: "2027-01-01",
      quantity: 10,
      price: 25.50,
      isHighValue: false,
      isEmergency: false
    }
  ],
  dispenser: "æå››",
  status: "pending_review"
}
```

### é—¨è¯Šç™»è®° (clinicRecords)

```javascript
{
  visitDateTime: "2025-11-04 11:25",
  name: "ç‹äº”",
  gender: "ç”·",
  age: 28,
  identity: "æ¸¸å®¢",
  location: "land_park",
  drugInfo: {
    drugId: "cloud://drug_abc123",      // âœ… ç³»ç»Ÿå†…éƒ¨ID
    drugCode: "AMOX500-TAB",            // âœ… è¯æä»£ç 
    drugName: "é˜¿è«è¥¿æ—èƒ¶å›Š",           // âœ… è¯æåç§°
    specification: "0.25g*24ç²’",        // âœ… è§„æ ¼ï¼ˆç»Ÿä¸€å­—æ®µåï¼‰
    unit: "ç›’",                         // âœ… å•ä½
    quantity: 2,
    batchId: "cloud://batch_xyz789",
    batch: "20250101",
    location: "land_park",
    minUnit: "ç²’",
    packUnit: "ç›’",
    conversionRate: 24
  },
  doctorSign: "cloud://signature.png",
  signTime: "2025-11-04 11:25"
}
```

---

## ğŸ”„ å…¼å®¹æ€§å¤„ç†

æ‰€æœ‰é¡µé¢å‡æ”¯æŒæ—§å­—æ®µçš„å…¼å®¹æ€§è¯»å–ï¼š

```javascript
// âœ… ç»Ÿä¸€çš„å…¼å®¹æ€§å¤„ç†
{
  drugId: drugInfo._id,                                      // ä¸»é”®
  drugCode: drugInfo.drugCode || drugInfo.code || '',        // ä»£ç ï¼ˆå…¼å®¹æ—§å­—æ®µï¼‰
  drugName: drugInfo.name || drugInfo.drugName || 'æœªçŸ¥è¯æ', // åç§°ï¼ˆå…¼å®¹æ—§å­—æ®µï¼‰
  specification: drugInfo.specification || drugInfo.spec || '', // è§„æ ¼ï¼ˆå…¼å®¹æ—§å­—æ®µï¼‰
  unit: drugInfo.unit || drugInfo.unitName || '',            // å•ä½ï¼ˆå…¼å®¹æ—§å­—æ®µï¼‰
  manufacturer: drugInfo.manufacturer || drugInfo.manufacturerName || '' // å‚å®¶ï¼ˆå…¼å®¹æ—§å­—æ®µï¼‰
}
```

---

## ğŸ¯ ç»Ÿä¸€åŸåˆ™

| ä¼˜å…ˆçº§ | å­—æ®µè§„èŒƒ | è¯´æ˜ |
|--------|---------|------|
| **ğŸ¥‡ ä¼˜å…ˆä½¿ç”¨** | `specification` | è§„æ ¼å­—æ®µï¼Œä¸å†ä½¿ç”¨ `spec` |
| **ğŸ¥‡ ä¼˜å…ˆä½¿ç”¨** | `drugCode` | è¯æä»£ç ï¼Œä¸å†ä½¿ç”¨ `code` |
| **ğŸ¥‡ ä¼˜å…ˆä½¿ç”¨** | `drugName` | è¯æåç§°ï¼ˆæäº¤æ—¶ï¼‰ |
| **âš ï¸ å…¼å®¹è¯»å–** | `spec` | ä»…ç”¨äºè¯»å–æ—§æ•°æ® |
| **âš ï¸ å…¼å®¹è¯»å–** | `code` | ä»…ç”¨äºè¯»å–æ—§æ•°æ® |
| **âš ï¸ å…¼å®¹è¯»å–** | `name` | ä»…ç”¨äºè¯»å–æ—§æ•°æ® |

---

## ğŸ“ UI æ˜¾ç¤ºæ›´æ–°

### å…¥åº“é¡µé¢
```html
<!-- âœ… æ˜¾ç¤ºä»£ç  -->
<view v-if="item.drugCode" class="info-row">
  <text class="info-label">ä»£ç ï¼š</text>
  <text class="code-badge">{{ item.drugCode }}</text>
</view>

<!-- âœ… è§„æ ¼ï¼ˆå…¼å®¹æ˜¾ç¤ºï¼‰ -->
<view class="info-row">
  <text class="info-label">è§„æ ¼ï¼š</text>
  <text>{{ item.specification || item.spec || 'æœªè®¾ç½®' }}</text>
</view>
```

### å‡ºåº“é¡µé¢
```html
<!-- âœ… æ˜¾ç¤ºä»£ç  -->
<view v-if="item.drugCode" class="info-row">
  <text class="info-label">ä»£ç ï¼š</text>
  <text class="code-badge">{{ item.drugCode }}</text>
</view>

<!-- âœ… è§„æ ¼ï¼ˆå…¼å®¹æ˜¾ç¤ºï¼‰ -->
<view class="info-row">
  <text class="info-label">è§„æ ¼ï¼š</text>
  <text>{{ item.specification || item.spec }}</text>
</view>
```

### é—¨è¯Šç™»è®°é¡µé¢
```html
<!-- âœ… ç”¨è¯ä¿¡æ¯æ±‡æ€»å¡ç‰‡ -->
<view class="core-item full-width">
  <view class="core-label">ğŸ“¦ è¯æä»£ç </view>
  <view class="core-value code-value">
    {{ selectedDrug.drugCode || selectedDrug.code || 'æœªè®¾ç½®' }}
  </view>
</view>
```

---

## âœ… ä¿®æ”¹æ¸…å•

### âœ… å…¥åº“é¡µé¢ (in/add.vue)

- [x] æ·»åŠ  `drugCode` å­—æ®µ
- [x] ç»Ÿä¸€ä½¿ç”¨ `specification` å­—æ®µ
- [x] UI æ˜¾ç¤ºè¯æä»£ç 
- [x] æäº¤æ•°æ®åŒ…å«å®Œæ•´å­—æ®µ
- [x] å…¼å®¹æ€§å¤„ç†

### âœ… å‡ºåº“é¡µé¢ (out/add.vue)

- [x] æ·»åŠ  `drugCode` å­—æ®µ
- [x] ç»Ÿä¸€ä½¿ç”¨ `specification` å­—æ®µ
- [x] UI æ˜¾ç¤ºè¯æä»£ç 
- [x] æäº¤æ•°æ®åŒ…å«å®Œæ•´å­—æ®µ
- [x] å…¼å®¹æ€§å¤„ç†

### âœ… é—¨è¯Šç™»è®°é¡µé¢ (clinic/add.vue)

- [x] å·²ä½¿ç”¨ `drugCode` å­—æ®µ
- [x] å·²ä½¿ç”¨ `specification` å­—æ®µ
- [x] UI æ˜¾ç¤ºå®Œæ•´è¯æä¿¡æ¯
- [x] æäº¤æ•°æ®åŒ…å«å®Œæ•´å­—æ®µ
- [x] å…¼å®¹æ€§å¤„ç†

---

## ğŸ¨ æ ·å¼ç»Ÿä¸€

æ‰€æœ‰é¡µé¢çš„è¯æä»£ç ä½¿ç”¨ç»Ÿä¸€æ ·å¼ï¼š

```scss
.code-badge {
  background: #e6fffb;
  color: #0e7490;
  padding: 4rpx 12rpx;
  border-radius: 8rpx;
  font-size: 22rpx;
  font-family: 'Courier New', monospace;
  border: 1rpx solid #67e8f9;
}
```

---

## ğŸ” æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯

1. **å…¥åº“æ“ä½œ**
   - æ‰«ç æ·»åŠ è¯æï¼Œæ£€æŸ¥ `drugCode` å’Œ `specification` å­—æ®µ
   - æ‰‹åŠ¨æ·»åŠ è¯æï¼Œæ£€æŸ¥å­—æ®µæ˜¾ç¤º
   - æäº¤å…¥åº“å•ï¼Œæ£€æŸ¥æ•°æ®åº“å­—æ®µ

2. **å‡ºåº“æ“ä½œ**
   - æ‰«ç æ·»åŠ è¯æï¼Œæ£€æŸ¥ `drugCode` å’Œ `specification` å­—æ®µ
   - é€‰æ‹©æ‰¹æ¬¡ï¼Œæ£€æŸ¥å­—æ®µæ˜¾ç¤º
   - æäº¤å‡ºåº“å•ï¼Œæ£€æŸ¥æ•°æ®åº“å­—æ®µ

3. **é—¨è¯Šç™»è®°**
   - é€‰æ‹©è¯æï¼Œæ£€æŸ¥ç”¨è¯ä¿¡æ¯æ±‡æ€»å¡ç‰‡
   - æäº¤ç™»è®°ï¼Œæ£€æŸ¥æ•°æ®åº“ `drugInfo` å¯¹è±¡

4. **å…¼å®¹æ€§æµ‹è¯•**
   - è¯»å–åŒ…å« `spec` å­—æ®µçš„æ—§æ•°æ®
   - è¯»å–åŒ…å« `code` å­—æ®µçš„æ—§æ•°æ®
   - ç¡®ä¿æ­£å¸¸æ˜¾ç¤ºå’Œå¤„ç†

---

## ğŸ“Š æ•°æ®åº“å…³è”

### ç»Ÿä¸€å­—æ®µç¡®ä¿ä»¥ä¸‹å…³è”ï¼š

1. âœ… **å…¥åº“ â†’ åº“å­˜**
   - `drugId` â†’ `stock.drugId`
   - `drugCode` â†’ `stock.drugCode`
   - `specification` â†’ `stock.specification`

2. âœ… **å‡ºåº“ â†’ åº“å­˜**
   - `drugId` â†’ `stock.drugId`
   - `batchId` â†’ `stock.batches[].batchId`
   - ä»å¯¹åº”å›­åŒºæ‰£å‡åº“å­˜

3. âœ… **é—¨è¯Šç™»è®° â†’ åº“å­˜**
   - `drugId` â†’ `stock.drugId`
   - `batchId` â†’ `stock.batches[].batchId`
   - `location` â†’ å¯¹åº”å›­åŒºåº“å­˜æ‰£å‡

---

## âœ… å®ŒæˆçŠ¶æ€

| ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆæ—¶é—´ |
|------|------|----------|
| ç»Ÿä¸€è¯æå­—æ®µå‘½åè§„èŒƒ | âœ… å®Œæˆ | 2025-11-04 |
| åœ¨å…¥åº“é¡µé¢æ·»åŠ drugCodeå­—æ®µ | âœ… å®Œæˆ | 2025-11-04 |
| åœ¨å‡ºåº“é¡µé¢æ·»åŠ drugCodeå­—æ®µ | âœ… å®Œæˆ | 2025-11-04 |
| ç»Ÿä¸€è§„æ ¼å­—æ®µå‘½åï¼ˆspecificationï¼‰ | âœ… å®Œæˆ | 2025-11-04 |
| ç¡®ä¿æ‰€æœ‰æäº¤æ•°æ®åŒ…å«å®Œæ•´è¯æä¿¡æ¯ | âœ… å®Œæˆ | 2025-11-04 |

---

**æ‰€æœ‰å­—æ®µå·²ç»Ÿä¸€ï¼Œå…¥åº“ã€å‡ºåº“ã€é—¨è¯Šç™»è®°çš„è¯ææ•°æ®å®Œå…¨å…³è”ï¼** âœ…ğŸ‰

