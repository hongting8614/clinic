# 🚀 开发者快速登录指南

## 适用场景

- ✅ 您是开发者本人
- ✅ 使用自己的微信账号测试
- ✅ 想快速设置自己为管理员
- ✅ 在开发测试阶段

---

## ⚡ 快速登录（3分钟）

### 步骤1️⃣：获取您的 OpenID（1分钟）

**在微信开发者工具中：**

1. 打开您的小程序项目
2. 点击顶部工具栏的 **"真机调试"** 或直接在模拟器中运行
3. 打开 **"控制台"** 标签
4. 在控制台输入以下代码：

```javascript
wx.cloud.callFunction({
  name: 'login',
  success: res => {
    console.log('=== 您的 OpenID ===')
    console.log(res.result.openid)
  }
})
```

5. 复制控制台显示的 OpenID（例如：`oXYZ123abc...`）

**或者查看登录失败信息：**
- 直接打开小程序，系统会提示"您不在系统白名单内"
- 错误信息中会包含您的 OpenID

---

### 步骤2️⃣：在数据库添加自己为管理员（1分钟）

1. 打开浏览器，访问 [微信云开发控制台](https://console.cloud.tencent.com/tcb)
2. 选择您的环境（例如：`cloud1-3gv7spppf7d2d0f4`）
3. 点击左侧菜单 **"数据库"**
4. 找到 **"users"** 集合（如果没有则创建）
5. 点击 **"添加记录"**
6. 切换到 **"导入"** 模式，粘贴以下内容：

```json
{
  "openid": "刚才复制的您的OpenID",
  "name": "开发者",
  "realName": "您的真实姓名",
  "nickname": "开发者",
  "phone": "您的手机号",
  "wechatId": "您的微信号",
  "role": "admin",
  "password": null,
  "status": "active",
  "createTime": "2025-11-09T12:00:00.000Z",
  "updateTime": "2025-11-09T12:00:00.000Z",
  "lastLogin": null
}
```

7. 点击 **"确定"** 保存

**⚠️ 重要提示：**
- 将 `"刚才复制的您的OpenID"` 替换为步骤1中获取的真实 OpenID
- 填写您的真实手机号和微信号
- `role` 必须是 `"admin"` 才有管理员权限
- `status` 必须是 `"active"` 才能登录

---

### 步骤3️⃣：打开小程序登录（30秒）

1. 在微信开发者工具中，点击 **"编译"** 重新加载小程序
2. 或者按 `Ctrl + B`（Windows）/ `Cmd + B`（Mac）
3. 小程序会自动识别您的 OpenID
4. **自动登录成功** ✅

**登录成功标志：**
- 页面不再提示"不在白名单内"
- "我的"页面显示您的姓名和"管理员"角色
- 可以访问"用户管理"等管理功能

---

### 步骤4️⃣：设置密码（30秒）

虽然系统使用 OpenID 自动登录，但建议设置密码：

1. 进入 **"我的"** 页面
2. 点击 **"系统设置"**
3. 点击 **"修改密码"**
4. **当前密码：** 留空（首次设置）
5. **新密码：** 输入密码（至少8位，包含大小写字母和数字）
   - 例如：`Admin123`、`Test2024`
6. **确认密码：** 再次输入
7. 点击 **"确认修改"**

---

## 🎯 完整示例

### 实际操作示例：

**假设您获取的 OpenID 是：** `oXYZ123abc456def789`

**在数据库中添加：**
```json
{
  "openid": "oXYZ123abc456def789",
  "name": "张三",
  "realName": "张三",
  "nickname": "张三",
  "phone": "13800138000",
  "wechatId": "zhangsan123",
  "role": "admin",
  "password": null,
  "status": "active",
  "createTime": "2025-11-09T12:00:00.000Z",
  "updateTime": "2025-11-09T12:00:00.000Z",
  "lastLogin": null
}
```

保存后，重新打开小程序，就能自动登录了！

---

## 🔍 验证登录成功

### 检查1：查看"我的"页面

打开小程序底部菜单的 **"我的"**，应该看到：
- ✅ 您的姓名
- ✅ 角色显示为"管理员"
- ✅ 可以看到"用户管理"等菜单

### 检查2：尝试访问管理功能

点击 **"用户管理"**：
- ✅ 能正常打开
- ✅ 可以看到用户列表（包括您自己）
- ✅ 可以添加新用户

---

## ⚠️ 常见问题

### 问题1：还是提示"不在白名单内"

**检查清单：**
- [ ] OpenID 是否复制正确？（注意前后空格）
- [ ] 数据库记录是否保存成功？
- [ ] `status` 字段是否为 `"active"`？
- [ ] 是否重新编译了小程序？

**解决方法：**
1. 在云开发控制台，打开数据库 → users 集合
2. 找到您刚才添加的记录
3. 核对 `openid` 字段是否与步骤1获取的一致
4. 确认 `status` 为 `"active"`
5. 重新编译小程序（Ctrl + B）

---

### 问题2：如何查看完整的 OpenID？

**方法1：控制台日志**
```javascript
wx.cloud.callFunction({
  name: 'login'
}).then(res => {
  console.log('完整返回:', res)
  console.log('OpenID:', res.result.openid || res.result.message)
})
```

**方法2：查看云函数日志**
1. 打开云开发控制台
2. 点击 **"云函数"** → **"login"**
3. 点击 **"日志"** 标签
4. 查看最新的调用记录，里面有 OpenID

---

### 问题3：误删了自己的管理员账号

**解决方法：**
重新按照步骤2，在数据库中添加自己的账号即可。

---

## 🎨 开发技巧

### 技巧1：快速切换测试账号

如果需要测试不同角色：

1. 在数据库中创建多个测试账号（不同 OpenID）
2. 使用不同微信号登录测试
3. 或者临时修改数据库中的 `role` 字段切换角色

### 技巧2：批量添加测试用户

在数据库中点击 **"导入"**，可以批量导入多个测试用户：

```json
[
  {
    "openid": "test-openid-001",
    "name": "测试用户1",
    "role": "doctor",
    "status": "active"
  },
  {
    "openid": "test-openid-002",
    "name": "测试用户2",
    "role": "project_manager",
    "status": "active"
  }
]
```

### 技巧3：清除登录缓存

如果遇到登录异常，清除缓存：

**在微信开发者工具中：**
1. 点击顶部菜单 **"工具"** → **"清除缓存"**
2. 勾选 **"清除数据缓存"** 和 **"清除文件缓存"**
3. 点击 **"清除"**
4. 重新编译小程序

---

## 📊 登录流程图

```
┌─────────────────────────────────────────┐
│  1. 打开小程序                           │
│     ↓                                   │
│  2. 系统自动获取您的微信 OpenID          │
│     ↓                                   │
│  3. 调用 login 云函数                    │
│     ↓                                   │
│  4. 查询数据库 users 表                  │
│     ├─ 找到记录 → 登录成功 ✅            │
│     └─ 未找到 → 提示"不在白名单内" ❌     │
│     ↓                                   │
│  5. 保存用户信息到本地                   │
│     ↓                                   │
│  6. 跳转到首页 / 我的页面                │
└─────────────────────────────────────────┘
```

---

## ✅ 完成检查清单

登录成功后，确认以下功能：

- [ ] "我的"页面显示正确的姓名和角色
- [ ] 可以访问"用户管理"页面
- [ ] 可以添加新用户
- [ ] 可以创建入库单
- [ ] 可以修改密码
- [ ] 可以查看报表

---

## 🚀 下一步

登录成功后，您可以：

1. **设置密码**
   - 进入"修改密码"设置您的密码

2. **添加其他测试用户**
   - 在"用户管理"中添加其他角色的测试账号

3. **开始测试功能**
   - 测试入库、出库等核心功能

4. **查看开发文档**
   - 阅读 `docs/` 目录下的其他文档

---

## 📞 需要帮助？

如果还有问题：
1. 检查云函数是否已上传
2. 检查云开发环境ID是否正确（`App.vue`）
3. 查看微信开发者工具的控制台错误信息
4. 查看云函数日志

---

**最后更新：** 2025-11-09  
**版本：** v1.0  
**适用场景：** 开发测试阶段

