# å¾®ä¿¡å®˜æ–¹æ‰«ç APIä½¿ç”¨è¯´æ˜

## ğŸ“± APIæ¦‚è¿°

**ä½ çš„å°ç¨‹åºå·²ç»åœ¨ä½¿ç”¨å¾®ä¿¡å®˜æ–¹æ‰«ç APIï¼**

```javascript
// uni-app å°è£…ï¼ˆæ¨èï¼‰
uni.scanCode(options)

// å¾®ä¿¡åŸç”ŸAPI
wx.scanCode(options)
```

è¿™å°±æ˜¯ä½ åœ¨å¾®ä¿¡é‡Œç”¨"æ‰«ä¸€æ‰«"çš„**åŒä¸€ä¸ªAPI**ï¼

---

## âœ… å·²å®ç°çš„åŠŸèƒ½

### **1. å¤šç§ç ç±»å‹æ”¯æŒ**

```javascript
scanType: [
  'barCode',    // æ¡å½¢ç ï¼ˆä¸€ç»´ç ï¼‰- å¦‚EAN-13, CODE128ç­‰
  'qrCode',     // äºŒç»´ç  - å¦‚å¾®ä¿¡äºŒç»´ç 
  'datamatrix', // Data Matrixç  - åŒ»è¯è¡Œä¸šå¸¸ç”¨
  'pdf417'      // PDF417ç  - ç‰©æµã€è¯ä»¶å¸¸ç”¨
]
```

### **2. çµæ´»çš„æ‰«ç æ–¹å¼**

- âœ… **ç›¸æœºæ‰«ç ** - å®æ—¶æ‰«æ
- âœ… **ç›¸å†Œé€‰æ‹©** - ä»æ‰‹æœºç›¸å†Œé€‰æ‹©æ¡å½¢ç å›¾ç‰‡
- âœ… **è‡ªåŠ¨è§£ç ** - æ— éœ€æ‰‹åŠ¨å¤„ç†

### **3. å®Œæ•´çš„é”™è¯¯å¤„ç†**

- âœ… æ‰«ç å¤±è´¥æç¤º
- âœ… ç”¨æˆ·å–æ¶ˆå¤„ç†
- âœ… ç»“æœéªŒè¯
- âœ… æ ¼å¼æ£€æŸ¥

---

## ğŸ” APIè¯¦ç»†è¯´æ˜

### **å‚æ•°é…ç½®**

```javascript
uni.scanCode({
  // æ‰«ç ç±»å‹ï¼ˆæ•°ç»„ï¼‰
  scanType: ['barCode', 'qrCode'],
  
  // æ˜¯å¦åªèƒ½ä»ç›¸æœºæ‰«ç 
  onlyFromCamera: false,  // falseå…è®¸ä»ç›¸å†Œé€‰æ‹©
  
  // æ˜¯å¦è‡ªåŠ¨è§£ç 
  autoDecrypt: true,
  
  // æˆåŠŸå›è°ƒ
  success(res) {
    console.log('æ‰«ç ç»“æœ:', res.result)
    console.log('ç ç±»å‹:', res.scanType)
    console.log('å­—ç¬¦é›†:', res.charSet)
  },
  
  // å¤±è´¥å›è°ƒ
  fail(err) {
    console.error('æ‰«ç å¤±è´¥:', err)
  }
})
```

### **è¿”å›ç»“æœ**

```javascript
{
  result: "6936435555607",    // æ‰«ç å†…å®¹ï¼ˆæ¡å½¢ç å­—ç¬¦ä¸²ï¼‰
  scanType: "EAN_13",         // ç ç±»å‹
  charSet: "utf8",            // å­—ç¬¦é›†
  path: "",                   // äºŒç»´ç çš„è·¯å¾„ï¼ˆå¦‚æœæ˜¯å°ç¨‹åºç ï¼‰
  errMsg: "scanCode:ok"       // çŠ¶æ€ä¿¡æ¯
}
```

---

## ğŸ“Š æ”¯æŒçš„æ¡å½¢ç ç±»å‹

### **ä¸€ç»´æ¡å½¢ç ï¼ˆbarCodeï¼‰**

| ç±»å‹ | åç§° | å¸¸è§åœºæ™¯ |
|------|------|---------|
| EAN-13 | æ¬§æ´²å•†å“æ¡ç  | è¶…å¸‚å•†å“ã€è¯æ â­ |
| EAN-8 | çŸ­æ¬§æ´²å•†å“æ¡ç  | å°åŒ…è£…å•†å“ |
| CODE-128 | 128ç¼–ç  | ç‰©æµã€ä»“å‚¨ |
| CODE-39 | 39ç¼–ç  | å·¥ä¸šã€å›¾ä¹¦ |
| UPC-A | ç¾å›½å•†å“æ¡ç  | è¿›å£å•†å“ |

### **äºŒç»´ç ï¼ˆqrCodeï¼‰**

- å¾®ä¿¡äºŒç»´ç 
- æ™®é€šäºŒç»´ç 
- å°ç¨‹åºç 

### **å…¶ä»–ç±»å‹**

- **Data Matrix** - åŒ»è¯ç›‘ç®¡ç ï¼ˆè¯æç”µå­ç›‘ç®¡ç ï¼Œå·²åœç”¨ï¼‰
- **PDF417** - è¯ä»¶ã€ç‰©æµæ ‡ç­¾

---

## ğŸ¯ åœ¨ä½ çš„é¡¹ç›®ä¸­çš„ä½¿ç”¨

### **ä½ç½®ï¼š** `pages-sub/in/add.vue`

```javascript
// æ‰«ç æ·»åŠ è¯æ
async scanBarcode() {
  try {
    // è°ƒç”¨å¾®ä¿¡å®˜æ–¹æ‰«ç API
    const scanRes = await uni.scanCode({
      scanType: ['barCode', 'qrCode', 'datamatrix', 'pdf417'],
      onlyFromCamera: false,
      autoDecrypt: true
    })
    
    // è·å–æ¡å½¢ç 
    const barcode = scanRes.result
    
    // æŸ¥è¯¢è¯ææ•°æ®åº“
    await this.queryDrugByBarcode(barcode)
    
  } catch (err) {
    if (!err.errMsg.includes('cancel')) {
      uni.showToast({ title: 'æ‰«ç å¤±è´¥', icon: 'none' })
    }
  }
}
```

---

## âš ï¸ é‡è¦è¯´æ˜

### **1. APIåªè¿”å›æ¡å½¢ç å­—ç¬¦ä¸²**

```javascript
// è¿”å›çš„åªæ˜¯æ¡å½¢ç æ•°å­—
result: "6936435555607"

// ä¸ä¼šè¿”å›å•†å“ä¿¡æ¯ï¼
// âŒ ä¸è¿”å›è¯æåç§°
// âŒ ä¸è¿”å›è§„æ ¼
// âŒ ä¸è¿”å›ä¼ä¸š
// âŒ ä¸è¿”å›ä»·æ ¼
```

### **2. éœ€è¦è‡ªå·±æŸ¥è¯¢æ•°æ®**

```javascript
æ‰«ç  â†’ è·å¾—æ¡å½¢ç  â†’ æŸ¥è¯¢ä½ çš„æ•°æ®åº“
  â†“
  æ•°æ®åº“æœ‰ â†’ è¿”å›è¯æä¿¡æ¯ âœ…
  â†“
  æ•°æ®åº“æ²¡æœ‰ â†’ æŸ¥è¯¢NMPA â†’ ä¿å­˜ â†’ è¿”å› âœ…
```

### **3. å¾®ä¿¡æ‰«ä¸€æ‰«çš„å•†å“ä¿¡æ¯æ¥è‡ªå“ªé‡Œï¼Ÿ**

- å¾®ä¿¡æœ‰è‡ªå·±çš„**å•†å“æ•°æ®åº“**
- è¿™ä¸ªæ•°æ®åº“**ä¸å¯¹å¤–å¼€æ”¾**
- å°ç¨‹åºAPI **æ— æ³•è®¿é—®**è¿™äº›æ•°æ®
- éœ€è¦ç”¨è‡ªå·±çš„æ•°æ®æºï¼ˆå¦‚NMPAï¼‰

---

## ğŸš€ ä¼˜åŠ¿

### **vs å¾®ä¿¡æ‰«ä¸€æ‰«ï¼š**

| å¯¹æ¯”é¡¹ | å¾®ä¿¡æ‰«ä¸€æ‰« | ä½ çš„å°ç¨‹åº |
|--------|-----------|-----------|
| æ‰«ç èƒ½åŠ› | âœ… | âœ… ç›¸åŒAPI |
| æ•°æ®æ¥æº | å¾®ä¿¡æœåŠ¡å™¨ | NMPAå®˜æ–¹ â­ |
| æ•°æ®æƒå¨æ€§ | æœªçŸ¥ | å›½å®¶è¯ç›‘å±€ â­ |
| è¯æè¦†ç›– | éƒ¨åˆ† | 100%ï¼ˆé¦–æ¬¡å½•å…¥ï¼‰ |
| å¯å®šåˆ¶æ€§ | âŒ | âœ… å®Œå…¨å¯æ§ |
| æ•°æ®æŒä¹…åŒ– | âŒ | âœ… ä¿å­˜åˆ°æ•°æ®åº“ |

---

## ğŸ“± çœŸæœºæµ‹è¯•

### **æ­¥éª¤1ï¼šç¼–è¯‘å°ç¨‹åº**

ç‚¹å‡»"ç¼–è¯‘"æˆ–"çœŸæœºè°ƒè¯•"

### **æ­¥éª¤2ï¼šæ‰“å¼€æ‰«ç åŠŸèƒ½**

è¿›å…¥å…¥åº“é¡µé¢ â†’ ç‚¹å‡»æ‰«ç æŒ‰é’®

### **æ­¥éª¤3ï¼šæ‰«ææ¡å½¢ç **

- **æ–¹å¼Aï¼š** å¯¹å‡†å®ç‰©æ¡å½¢ç æ‰«æ
- **æ–¹å¼Bï¼š** ç‚¹å‡»å³ä¸Šè§’"ä»ç›¸å†Œé€‰æ‹©"

### **æ­¥éª¤4ï¼šæŸ¥çœ‹ç»“æœ**

- æ‰¾åˆ°è¯æ â†’ è‡ªåŠ¨æ·»åŠ  âœ…
- æœªæ‰¾åˆ° â†’ é€‰æ‹©/è¾“å…¥è¯æåç§° â†’ è‡ªåŠ¨æŸ¥NMPA â†’ ä¿å­˜

---

## ğŸ”§ è°ƒè¯•æŠ€å·§

### **æŸ¥çœ‹æ‰«ç ç»“æœï¼š**

æ‰“å¼€è°ƒè¯•æ¨¡å¼ï¼Œæ‰«ç åæŸ¥çœ‹æ§åˆ¶å°ï¼š

```javascript
ğŸ“· æ‰«ç ç»“æœ: {result: "6936435555607", scanType: "EAN_13", ...}
ğŸ“· æ¡å½¢ç : 6936435555607
ğŸ“· æ¡å½¢ç ç±»å‹: EAN_13
```

### **æ‰‹åŠ¨æµ‹è¯•æ¡å½¢ç ï¼š**

åœ¨æ§åˆ¶å°ç›´æ¥è°ƒç”¨ï¼š

```javascript
// æ¨¡æ‹Ÿæ‰«ç ç»“æœ
const testBarcode = "6936435555607"

// æ‰‹åŠ¨è°ƒç”¨æŸ¥è¯¢
wx.cloud.callFunction({
  name: 'drugBarcodeQuery',
  data: {
    action: 'queryByBarcode',
    barcode: testBarcode
  }
}).then(res => {
  console.log('æŸ¥è¯¢ç»“æœ:', res.result)
})
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### **1. æ”¯æŒå¤šç§ç ç±»å‹**

```javascript
scanType: ['barCode', 'qrCode', 'datamatrix', 'pdf417']
```

### **2. å…è®¸ç›¸å†Œé€‰æ‹©**

```javascript
onlyFromCamera: false  // æ–¹ä¾¿æµ‹è¯•å’Œç‰¹æ®Šåœºæ™¯
```

### **3. å®Œå–„çš„é”™è¯¯å¤„ç†**

```javascript
catch (err) {
  if (!err.errMsg.includes('cancel')) {
    // å¤„ç†çœŸæ­£çš„é”™è¯¯
  }
  // ç”¨æˆ·å–æ¶ˆä¸æç¤º
}
```

### **4. ç»“æœéªŒè¯**

```javascript
if (!scanRes || !scanRes.result) {
  uni.showToast({ title: 'æ‰«ç å¤±è´¥', icon: 'none' })
  return
}

if (scanRes.result.length < 8) {
  uni.showToast({ title: 'æ¡å½¢ç æ ¼å¼é”™è¯¯', icon: 'none' })
  return
}
```

---

## ğŸ“š å®˜æ–¹æ–‡æ¡£

- **uni-appæ–‡æ¡£ï¼š** https://uniapp.dcloud.net.cn/api/system/barcode.html
- **å¾®ä¿¡å°ç¨‹åºæ–‡æ¡£ï¼š** https://developers.weixin.qq.com/miniprogram/dev/api/device/scan/wx.scanCode.html

---

## âœ… æ€»ç»“

### **ä½ çš„å°ç¨‹åºå·²ç»ï¼š**

âœ… ä½¿ç”¨å¾®ä¿¡å®˜æ–¹æ‰«ç API  
âœ… æ”¯æŒå¤šç§ç ç±»å‹  
âœ… æ”¯æŒç›¸æœºå’Œç›¸å†Œ  
âœ… å®Œå–„çš„é”™è¯¯å¤„ç†  
âœ… è‡ªåŠ¨æŸ¥è¯¢è¯ææ•°æ®  
âœ… é¦–æ¬¡å½•å…¥è‡ªåŠ¨ä¿å­˜  
âœ… æ•°æ®æ¥è‡ªNMPAå®˜æ–¹  

### **è¿™æ¯”å¾®ä¿¡æ‰«ä¸€æ‰«æ›´å¥½ï¼š**

â­ æ•°æ®æ›´æƒå¨ï¼ˆå›½å®¶è¯ç›‘å±€ï¼‰  
â­ è¦†ç›–ç‡100%ï¼ˆé¦–æ¬¡å½•å…¥ï¼‰  
â­ æ•°æ®æŒä¹…åŒ–  
â­ å®Œå…¨å¯æ§  

---

**ä½ çš„å°ç¨‹åºæ‰«ç åŠŸèƒ½å·²ç»å¾ˆå®Œå–„äº†ï¼** ğŸ‰

**ç°åœ¨å¯ä»¥ç›´æ¥çœŸæœºæµ‹è¯•ï¼** ğŸ“±
