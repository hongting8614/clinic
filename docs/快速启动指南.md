# AK-PMS 快速启动指南

## 🚀 5分钟快速开始

本指南将帮助你在5分钟内运行AK-PMS项目。

---

## 📋 前置要求

### 必需软件
1. **HBuilderX** - [下载地址](https://www.dcloud.io/hbuilderx.html)
2. **微信开发者工具** - [下载地址](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
3. **Node.js** (可选) - [下载地址](https://nodejs.org/)

### 必需账号
1. **微信小程序账号** - [注册地址](https://mp.weixin.qq.com/)
2. **微信云开发环境** - 在小程序后台开通

---

## 📦 步骤1：获取项目

### 方式一：克隆仓库（推荐）
```bash
git clone https://github.com/your-repo/AK-PMS.git
cd AK-PMS
```

### 方式二：下载ZIP
1. 点击GitHub页面的"Code" → "Download ZIP"
2. 解压到本地目录

---

## 🔧 步骤2：配置项目

### 2.1 打开项目
1. 启动 **HBuilderX**
2. 文件 → 打开目录 → 选择项目根目录

### 2.2 安装依赖（如需使用npm包）
```bash
# 进入项目根目录
cd AK-PMS

# 安装依赖
npm install
```

**注意**：如果使用uView Plus等UI库，需要先安装：
```bash
npm install uview-plus
```

### 2.3 配置小程序AppID

**重要**：必须配置正确的AppID才能运行！

1. 打开 `manifest.json`
2. 找到 `mp-weixin` 节点
3. 填入你的小程序AppID：

```json
{
  "mp-weixin": {
    "appid": "你的小程序AppID",  // ← 在这里填入
    "setting": {
      "urlCheck": false
    }
  }
}
```

**获取AppID**：
- 登录 [微信公众平台](https://mp.weixin.qq.com/)
- 开发 → 开发设置 → 开发者ID → AppID

---

## ☁️ 步骤3：配置云开发

### 3.1 开通云开发
1. 在微信开发者工具中打开项目
2. 点击顶部"云开发"按钮
3. 开通云开发（选择基础版-免费）
4. 记录环境ID（env-xxxxx）

### 3.2 创建数据库集合
在云开发控制台 → 数据库 → 创建以下集合：

```
✅ 必须创建的集合（14个）：
1. users          - 用户表
2. drugs          - 药品档案表
3. stock          - 库存表
4. in_records     - 入库记录表
5. out_records    - 出库记录表
6. transfer_records - 园区调拨记录表
7. consume_records - 消耗记录表
8. requisition_records - 请领记录表
9. inventory_records - 盘点记录表
10. damage_records - 报损记录表
11. return_records - 退货记录表
12. departments   - 部门表
13. locations     - 园区配置表
14. system_config - 系统配置表
```

**快速创建方法**：
- 点击"添加集合"
- 依次输入上述集合名称
- 权限设置：选择"仅创建者可读写"（后续可调整）

### 3.3 上传云函数
1. 在HBuilderX或微信开发者工具中
2. 右键 `cloudfunctions/updateStock`
3. 点击"上传并部署：云端安装依赖"

### 3.4 初始化数据

#### 方式一：手动导入（推荐）
在云开发控制台 → 数据库 → 选择集合 → 导入：

**locations 集合**（园区数据）：
```json
[
  {
    "code": "land_park",
    "name": "陆园",
    "icon": "🏞️",
    "status": "active",
    "sort": 1
  },
  {
    "code": "water_park",
    "name": "水园",
    "icon": "💧",
    "status": "active",
    "sort": 2
  }
]
```

**system_config 集合**（系统配置）：
```json
{
  "clinicName": "北京欢乐谷医务室",
  "safeStock": 100,
  "minStock": 50,
  "expireWarningDays": 90
}
```

#### 方式二：云函数初始化（开发中）
```bash
# TODO: 创建初始化云函数
```

---

## 🎮 步骤4：运行项目

### 4.1 在HBuilderX中运行
1. 点击顶部菜单：运行 → 运行到小程序模拟器 → 微信开发者工具
2. 等待编译完成
3. 微信开发者工具自动打开项目

### 4.2 查看效果
运行成功后，你应该看到：
- ✅ 首页显示"北京欢乐谷医务室"
- ✅ 底部显示4个Tab（首页、库存、单据、我的）
- ✅ 可以点击各个菜单浏览

---

## 🧪 步骤5：测试功能

### 5.1 测试扫码功能
1. 进入"单据"页面
2. 点击"新建入库单"
3. 点击"📷 扫码添加"
4. 扫描任意条形码（目前返回模拟数据）

### 5.2 测试签名功能
1. 在入库单页面
2. 滚动到"操作员签名"
3. 点击签名区域
4. 在全屏签名板上签名
5. 点击"✓ 确认签名"

---

## 🐛 常见问题

### Q1：运行时报错"云开发未初始化"
**解决**：
1. 确认已开通云开发
2. 检查 `App.vue` 中的云开发初始化代码
3. 确保 `manifest.json` 中配置了正确的AppID

### Q2：扫码功能无法使用
**解决**：
- 小程序模拟器不支持扫码功能
- 需要真机调试或使用"扫码调试"功能
- 在真机上预览二维码即可

### Q3：签名保存失败
**解决**：
1. 检查云存储权限
2. 在云开发控制台 → 存储 → 权限设置
3. 添加规则：所有用户可读写（或仅创建者）

### Q4：页面显示空白
**解决**：
1. 打开微信开发者工具控制台
2. 查看报错信息
3. 常见原因：
   - uView Plus未正确安装
   - pages.json配置错误
   - 图片路径错误

### Q5：云函数调用失败
**解决**：
1. 确认云函数已上传
2. 在云开发控制台 → 云函数 → 检查函数状态
3. 查看云函数日志排查错误

---

## 📱 真机调试

### 方式一：预览二维码
1. 在微信开发者工具中点击"预览"
2. 用手机微信扫描二维码
3. 在手机上查看效果

### 方式二：远程调试
1. 点击"真机调试"
2. 扫描二维码
3. 手机上操作，电脑上查看日志

---

## 🎨 修改医务室名称

### 方法一：修改系统配置
1. 登录云开发控制台
2. 数据库 → system_config 集合
3. 修改 `clinicName` 字段

### 方法二：小程序内修改（开发中）
1. 进入"我的"页面
2. 系统设置 → 系统参数
3. 修改医务室名称

---

## 📊 添加测试数据

### 添加测试药品
在云开发控制台 → drugs 集合 → 添加记录：

```json
{
  "name": "阿莫西林胶囊",
  "pinyin": "AMXLJN",
  "spec": "0.25g*24粒",
  "unit": "盒",
  "manufacturer": "XX制药有限公司",
  "category": "抗生素",
  "barcode": "6901234567890",
  "isHighValue": false,
  "isEmergency": false,
  "safeStock": 100,
  "minStock": 50
}
```

### 添加测试部门
在云开发控制台 → departments 集合 → 添加记录：

```json
{
  "name": "内科",
  "manager": "张医生",
  "phone": "138xxxx1234",
  "status": "active",
  "sort": 1
}
```

---

## 🔐 配置权限

### 数据库权限（推荐配置）

**开发阶段**：
- 所有集合：所有用户可读写

**生产环境**：
- users: 仅创建者及管理员可读写
- drugs: 所有用户可读，仅管理员可写
- stock: 所有用户可读，仅管理员可写
- 记录表: 所有用户可读写（需验证创建者）

### 云存储权限

**开发阶段**：
- 所有用户可读写

**生产环境**：
- signatures/: 仅创建者可读写
- photos/: 仅创建者可读写

---

## 📈 下一步

恭喜！项目已成功运行。接下来你可以：

1. ✅ 阅读 [需求文档](./需求文档_最终版.md) 了解完整功能
2. ✅ 阅读 [数据库设计](./数据库设计.md) 了解数据结构
3. ✅ 阅读 [开发进度报告](./开发进度报告.md) 了解开发状态
4. ✅ 开始开发剩余功能

---

## 🆘 获取帮助

如遇到问题：
1. 查看 [常见问题](#常见问题)
2. 查看微信开发者工具控制台错误信息
3. 查看云开发控制台日志
4. 提交 GitHub Issue

---

## 📝 检查清单

运行前请确认：
- [ ] 已安装HBuilderX和微信开发者工具
- [ ] 已注册小程序账号并获得AppID
- [ ] 已开通云开发环境
- [ ] 已配置manifest.json中的AppID
- [ ] 已创建14个数据库集合
- [ ] 已上传云函数
- [ ] 已导入初始数据（园区、系统配置）

运行后检查：
- [ ] 首页正常显示
- [ ] 可以切换Tab
- [ ] 扫码功能可调用（真机）
- [ ] 签名功能正常
- [ ] 云函数调用成功

---

**祝你开发顺利！** 🎉

如有问题，请查看[开发进度报告](./开发进度报告.md)或提交Issue。






























