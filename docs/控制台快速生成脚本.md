# ğŸš€ æ§åˆ¶å°å¿«é€Ÿç”Ÿæˆæµ‹è¯•æ•°æ®è„šæœ¬

## ğŸ“‹ ç›´æ¥åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ§åˆ¶å°å¤åˆ¶æ‰§è¡Œ

### å®Œæ•´ç‰ˆè„šæœ¬ï¼ˆæ¨èï¼‰

```javascript
(async function generateTestData() {
  console.log('ğŸš€ å¼€å§‹ç”Ÿæˆæµ‹è¯•æ•°æ®...')
  const db = wx.cloud.database()
  
  try {
    // ===== 1. æ·»åŠ åœ°ç‚¹ =====
    console.log('\nğŸ“ æ­¥éª¤1: æ·»åŠ åœ°ç‚¹...')
    const locations = [
      { code: 'drug_storage', name: 'è¯åº“', icon: 'ğŸ¥', type: 'storage' },
      { code: 'land_park', name: 'é™†åœ°å›­åŒº', icon: 'ğŸ¢', type: 'park' },
      { code: 'water_park', name: 'æ°´ä¸Šå›­åŒº', icon: 'ğŸŠ', type: 'park' }
    ]
    
    for (let loc of locations) {
      const exists = await db.collection('locations').where({ code: loc.code }).count()
      if (exists.total === 0) {
        await db.collection('locations').add({
          data: { ...loc, status: 'active', sort: 0, createTime: new Date() }
        })
        console.log(`âœ… ${loc.name}`)
      } else {
        console.log(`â„¹ï¸ ${loc.name} å·²å­˜åœ¨`)
      }
    }
    
    // ===== 2. æ·»åŠ ä¾›åº”å•† =====
    console.log('\nğŸ¢ æ­¥éª¤2: æ·»åŠ ä¾›åº”å•†...')
    const suppliers = [
      { name: 'åº·ç¾è¯ä¸š', code: 'SUP001', contact: 'å¼ ç»ç†', phone: '13800138000' },
      { name: 'ä¹å·é€šåŒ»è¯', code: 'SUP002', contact: 'æç»ç†', phone: '13800138001' },
      { name: 'åæ¶¦åŒ»è¯', code: 'SUP003', contact: 'ç‹ç»ç†', phone: '13800138002' },
      { name: 'å›½è¯é›†å›¢', code: 'SUP004', contact: 'èµµç»ç†', phone: '13800138003' }
    ]
    
    for (let sup of suppliers) {
      const exists = await db.collection('suppliers').where({ code: sup.code }).count()
      if (exists.total === 0) {
        await db.collection('suppliers').add({
          data: { ...sup, status: 'active', createTime: new Date() }
        })
        console.log(`âœ… ${sup.name}`)
      } else {
        console.log(`â„¹ï¸ ${sup.name} å·²å­˜åœ¨`)
      }
    }
    
    // ===== 3. æ·»åŠ è¯æ =====
    console.log('\nğŸ’Š æ­¥éª¤3: æ·»åŠ è¯æ...')
    const drugs = [
      { name: 'é˜¿è«è¥¿æ—èƒ¶å›Š', specification: '0.25gÃ—24ç²’/ç›’', unit: 'ç›’', price: 15.8, category: 'æŠ—ç”Ÿç´ ' },
      { name: 'å¤´å­¢å…‹è‚Ÿç‰‡', specification: '0.1gÃ—12ç‰‡/ç›’', unit: 'ç›’', price: 28.5, category: 'æŠ—ç”Ÿç´ ' },
      { name: 'å¸ƒæ´›èŠ¬ç¼“é‡Šèƒ¶å›Š', specification: '0.3gÃ—20ç²’/ç›’', unit: 'ç›’', price: 12.6, category: 'è§£çƒ­é•‡ç—›' },
      { name: 'å¯¹ä¹™é…°æ°¨åŸºé…šç‰‡', specification: '0.5gÃ—16ç‰‡/ç›’', unit: 'ç›’', price: 8.9, category: 'è§£çƒ­é•‡ç—›' },
      { name: 'æ°¯é›·ä»–å®šç‰‡', specification: '10mgÃ—10ç‰‡/ç›’', unit: 'ç›’', price: 18.5, category: 'æŠ—è¿‡æ•' },
      { name: 'å°å„¿æ„Ÿå†’ç³–æµ†', specification: '100ml/ç“¶', unit: 'ç“¶', price: 15.2, category: 'å„¿ç§‘ç”¨è¯' },
      { name: 'å¤æ–¹ç”˜è‰å£æœæ¶²', specification: '10mlÃ—6æ”¯/ç›’', unit: 'ç›’', price: 22.5, category: 'å‘¼å¸ç³»ç»Ÿ' },
      { name: 'æ¿è“æ ¹é¢—ç²’', specification: '10gÃ—20è¢‹/ç›’', unit: 'ç›’', price: 16.8, category: 'ä¸­æˆè¯' }
    ]
    
    const addedDrugs = []
    for (let drug of drugs) {
      const exists = await db.collection('drugs')
        .where({ name: drug.name, specification: drug.specification })
        .get()
      
      if (exists.data.length === 0) {
        const result = await db.collection('drugs').add({
          data: { ...drug, status: 'active', createTime: new Date() }
        })
        addedDrugs.push({ _id: result._id, ...drug })
        console.log(`âœ… ${drug.name}`)
      } else {
        addedDrugs.push({ _id: exists.data[0]._id, ...drug })
        console.log(`â„¹ï¸ ${drug.name} å·²å­˜åœ¨`)
      }
    }
    
    // ===== 4. ç”Ÿæˆè¯åº“åº“å­˜ =====
    console.log('\nğŸ“¦ æ­¥éª¤4: ç”Ÿæˆè¯åº“åº“å­˜...')
    
    // è§„æ ¼è§£æå‡½æ•°
    function parseSpec(spec) {
      const p1 = /^([\d.]+)(\w+)Ã—(\d+)(\w+)\/(\w+)$/
      const m1 = spec.match(p1)
      if (m1) {
        return {
          dosage: parseFloat(m1[1]),
          dosageUnit: m1[2],
          conversionRate: parseInt(m1[3]),
          minUnit: m1[4],
          packUnit: m1[5]
        }
      }
      const p2 = /^([\d.]+)(\w+)\/(\w+)$/
      const m2 = spec.match(p2)
      if (m2) {
        return {
          dosage: parseFloat(m2[1]),
          dosageUnit: m2[2],
          conversionRate: 1,
          minUnit: m2[2],
          packUnit: m2[3]
        }
      }
      return null
    }
    
    let stockCount = 0
    for (let drug of addedDrugs) {
      const specInfo = parseSpec(drug.specification)
      if (!specInfo) continue
      
      // æ¯ç§è¯æç”Ÿæˆ2ä¸ªæ‰¹æ¬¡
      for (let i = 0; i < 2; i++) {
        const batch = `LOT${Date.now()}${i}`
        const quantity = Math.floor(Math.random() * 50) + 10
        const pricePerMin = specInfo.conversionRate > 0 
          ? (drug.price / specInfo.conversionRate).toFixed(4)
          : drug.price
        
        await db.collection('stock').add({
          data: {
            drugId: drug._id,
            drugName: drug.name,
            specification: drug.specification,
            specInfo: specInfo,
            location: 'drug_storage',
            batch: batch,
            productionDate: new Date(Date.now() - 60 * 24 * 60 * 60 * 1000),
            expireDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000),
            quantity: quantity,
            unit: specInfo.packUnit,
            lockQuantity: 0,
            price: drug.price,
            pricePerMin: parseFloat(pricePerMin),
            status: 'normal',
            createTime: new Date()
          }
        })
        
        stockCount++
      }
    }
    console.log(`âœ… è¯åº“åº“å­˜: ${stockCount} æ¡`)
    
    // ===== 5. ç”Ÿæˆå›­åŒºåº“å­˜ =====
    console.log('\nğŸ¢ æ­¥éª¤5: ç”Ÿæˆå›­åŒºåº“å­˜...')
    
    const parks = ['land_park', 'water_park']
    let parkStockCount = 0
    
    for (let park of parks) {
      // é€‰æ‹©60%çš„è¯æ
      const selected = addedDrugs.slice(0, Math.floor(addedDrugs.length * 0.6))
      
      for (let drug of selected) {
        const specInfo = parseSpec(drug.specification)
        if (!specInfo) continue
        
        const batch = `LOT${Date.now()}${park}`
        const minQuantity = Math.floor(Math.random() * 100) + 20
        const pricePerMin = specInfo.conversionRate > 0 
          ? (drug.price / specInfo.conversionRate).toFixed(4)
          : drug.price
        
        await db.collection('stock').add({
          data: {
            drugId: drug._id,
            drugName: drug.name,
            specification: drug.specification,
            specInfo: specInfo,
            location: park,
            batch: batch,
            productionDate: new Date(Date.now() - 45 * 24 * 60 * 60 * 1000),
            expireDate: new Date(Date.now() + 400 * 24 * 60 * 60 * 1000),
            quantity: minQuantity,
            unit: specInfo.minUnit,
            lockQuantity: 0,
            price: drug.price,
            pricePerMin: parseFloat(pricePerMin),
            status: 'normal',
            createTime: new Date()
          }
        })
        
        parkStockCount++
      }
    }
    console.log(`âœ… å›­åŒºåº“å­˜: ${parkStockCount} æ¡`)
    
    // ===== 6. ç»Ÿè®¡ =====
    console.log('\nğŸ“Š æ•°æ®ç»Ÿè®¡:')
    const locCount = await db.collection('locations').count()
    console.log(`ğŸ“ åœ°ç‚¹: ${locCount.total}`)
    
    const supCount = await db.collection('suppliers').count()
    console.log(`ğŸ¢ ä¾›åº”å•†: ${supCount.total}`)
    
    const drugCount = await db.collection('drugs').count()
    console.log(`ğŸ’Š è¯æ: ${drugCount.total}`)
    
    const allStock = await db.collection('stock').count()
    console.log(`ğŸ“¦ æ€»åº“å­˜: ${allStock.total}`)
    
    console.log('\nğŸ‰ æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼')
    wx.showToast({ title: 'ç”ŸæˆæˆåŠŸ', icon: 'success' })
    
  } catch (error) {
    console.error('âŒ ç”Ÿæˆå¤±è´¥:', error)
    wx.showToast({ title: 'ç”Ÿæˆå¤±è´¥', icon: 'none' })
  }
})()
```

---

## âš¡ æœ€å°ç‰ˆè„šæœ¬ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰

```javascript
(async function() {
  const db = wx.cloud.database()
  
  // æ·»åŠ è¯åº“
  await db.collection('locations').add({
    data: { code: 'drug_storage', name: 'è¯åº“', icon: 'ğŸ¥', type: 'storage', status: 'active', createTime: new Date() }
  })
  
  // æ·»åŠ å›­åŒº
  await db.collection('locations').add({
    data: { code: 'land_park', name: 'é™†åœ°å›­åŒº', icon: 'ğŸ¢', type: 'park', status: 'active', createTime: new Date() }
  })
  
  console.log('âœ… åŸºç¡€åœ°ç‚¹å·²æ·»åŠ ')
  wx.showToast({ title: 'åŸºç¡€æ•°æ®OK', icon: 'success' })
})()
```

---

## ğŸ—‘ï¸ æ¸…ç©ºè„šæœ¬

```javascript
(async function() {
  const db = wx.cloud.database()
  
  const confirm = await new Promise(resolve => {
    wx.showModal({
      title: 'ç¡®è®¤æ¸…ç©º',
      content: 'å°†åˆ é™¤æ‰€æœ‰åº“å­˜æ•°æ®',
      success: res => resolve(res.confirm)
    })
  })
  
  if (confirm) {
    const res = await db.collection('stock').where({}).remove()
    console.log(`âœ… åˆ é™¤ ${res.removed} æ¡åº“å­˜`)
    wx.showToast({ title: 'æ¸…ç©ºæˆåŠŸ', icon: 'success' })
  }
})()
```

---

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

1. **å¤åˆ¶å®Œæ•´ç‰ˆè„šæœ¬**
2. **æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·æ§åˆ¶å°**
3. **ç²˜è´´å¹¶å›è½¦æ‰§è¡Œ**
4. **ç­‰å¾… 30-60 ç§’å®Œæˆ**
5. **æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º**

---

## âœ… æ‰§è¡Œååº”çœ‹åˆ°

```
ğŸš€ å¼€å§‹ç”Ÿæˆæµ‹è¯•æ•°æ®...

ğŸ“ æ­¥éª¤1: æ·»åŠ åœ°ç‚¹...
âœ… è¯åº“
âœ… é™†åœ°å›­åŒº
âœ… æ°´ä¸Šå›­åŒº

ğŸ¢ æ­¥éª¤2: æ·»åŠ ä¾›åº”å•†...
âœ… åº·ç¾è¯ä¸š
âœ… ä¹å·é€šåŒ»è¯
âœ… åæ¶¦åŒ»è¯
âœ… å›½è¯é›†å›¢

ğŸ’Š æ­¥éª¤3: æ·»åŠ è¯æ...
âœ… é˜¿è«è¥¿æ—èƒ¶å›Š
âœ… å¤´å­¢å…‹è‚Ÿç‰‡
...

ğŸ“¦ æ­¥éª¤4: ç”Ÿæˆè¯åº“åº“å­˜...
âœ… è¯åº“åº“å­˜: 16 æ¡

ğŸ¢ æ­¥éª¤5: ç”Ÿæˆå›­åŒºåº“å­˜...
âœ… å›­åŒºåº“å­˜: 10 æ¡

ğŸ“Š æ•°æ®ç»Ÿè®¡:
ğŸ“ åœ°ç‚¹: 3
ğŸ¢ ä¾›åº”å•†: 4
ğŸ’Š è¯æ: 8
ğŸ“¦ æ€»åº“å­˜: 26

ğŸ‰ æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼
```

