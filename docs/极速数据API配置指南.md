# 极速数据API配置指南

## 📋 应用认证表单填写

在极速数据平台（https://www.jisuapi.com）完成应用认证，按以下内容填写：

### 1. 应用平台
选择：**微信**（小程序图标）

### 2. 应用名称
```
爱康医务室管理系统
```

### 3. 应用URL
```
https://weixin.qq.com
```
*说明：如果有正式域名可以填写正式域名，没有的话填写微信官网即可*

### 4. 应用描述
```
1、应用介绍：爱康医务室药品进销存管理系统，用于医务室日常药品管理、库存管理、出入库记录等功能。

2、应用场景：通过扫描药品条形码快速识别药品信息，实现药品入库、出库、盘点等业务流程的自动化管理，提高医务室工作效率。

3、详细介绍：本系统为北京欢乐谷医务室开发的专业药品管理小程序，主要功能包括：药品基础信息管理、入库管理、出库管理、库存查询、效期预警、请领管理等。使用条形码API可以快速获取药品的标准信息（名称、规格、厂家等），避免手工录入错误，提升数据准确性。
```

---

## 🔑 获取API密钥

提交应用认证后，您会获得：
- **AppKey**（应用密钥）

示例：`xxxxxxxxxxxxxxxxxxxxxxxx`

---

## ⚙️ 配置云函数环境变量

### 步骤1：打开微信开发者工具

1. 打开项目
2. 点击顶部菜单：**云开发** → **云开发控制台**

### 步骤2：配置环境变量

1. 在云开发控制台左侧，点击 **云函数**
2. 找到 `drugBarcodeQuery` 云函数
3. 点击右侧的 **配置** 按钮
4. 找到 **环境变量** 选项卡
5. 点击 **添加环境变量**

### 步骤3：添加密钥

添加以下环境变量：

| 变量名 | 变量值 | 说明 |
|--------|--------|------|
| `JISUAPI_APPKEY` | 您的AppKey | 极速数据API密钥 |

示例：
```
变量名：JISUAPI_APPKEY
变量值：xxxxxxxxxxxxxxxxxxxxxxxx
```

### 步骤4：保存并重新部署

1. 点击 **保存**
2. 右键点击 `drugBarcodeQuery` 云函数
3. 选择 **云端安装依赖（不上传node_modules）**
4. 等待安装完成后，选择 **上传并部署：云端安装依赖**

---

## 🧪 测试API

### 方法1：在小程序中测试

1. 打开任意入库/出库页面
2. 点击"扫码添加"按钮
3. 扫描药品条形码
4. 查看是否能正确识别药品信息

### 方法2：在云函数中测试

1. 打开云开发控制台
2. 找到 `drugBarcodeQuery` 云函数
3. 点击 **测试** 按钮
4. 输入测试参数：
```json
{
  "action": "queryByBarcode",
  "barcode": "6901234567890"
}
```
5. 点击 **运行测试**
6. 查看返回结果

---

## 📊 API查询优先级

系统采用三级查询策略，确保查询效率和成本优化：

```
第1级：本地药品档案（免费，最快）
   ↓ 未找到
第2级：缓存数据库（免费，较快）
   ↓ 未找到
第3级：第三方API（付费，较慢）
   ├─ 阿里云市场API
   ├─ 聚合数据API
   └─ 极速数据API ← 新增
```

---

## 💡 多API配置建议

为了提高查询成功率，建议配置多个API作为备选：

### 配置多个环境变量

| 变量名 | API服务商 | 获取地址 |
|--------|-----------|----------|
| `ALIYUN_APPCODE` | 阿里云市场 | https://market.aliyun.com |
| `JUHE_API_KEY` | 聚合数据 | https://www.juhe.cn |
| `JISUAPI_APPKEY` | 极速数据 | https://www.jisuapi.com |

系统会按顺序尝试各个API，直到查询成功。

---

## ❓ 常见问题

### Q1：提示"未配置API密钥"
**A**：检查云函数环境变量是否正确配置，变量名是否拼写正确（区分大小写）

### Q2：API调用失败
**A**：
1. 检查AppKey是否正确
2. 检查API账户余额是否充足
3. 查看云函数日志，确认错误信息

### Q3：如何查看API调用日志
**A**：
1. 打开云开发控制台
2. 点击左侧 **云函数**
3. 找到 `drugBarcodeQuery`
4. 点击 **日志** 查看详细调用记录

### Q4：API费用说明
**A**：
- 极速数据：免费版每天100次，付费版按次计费
- 建议先使用免费版测试，确认可用后再购买套餐

---

## 📞 技术支持

如遇到问题，可以：
1. 查看云函数日志
2. 查看极速数据API文档：https://www.jisuapi.com/api/barcode/
3. 联系极速数据客服

---

## ✅ 配置完成检查清单

- [ ] 在极速数据平台完成应用认证
- [ ] 获取到AppKey
- [ ] 在云函数中配置环境变量 `JISUAPI_APPKEY`
- [ ] 重新部署云函数
- [ ] 测试扫码功能是否正常
- [ ] 查看云函数日志确认API调用成功

---

**配置完成后，您的药品扫码功能将支持极速数据API查询！** 🎉



