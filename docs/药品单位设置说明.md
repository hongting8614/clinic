# 药品单位设置说明

## ✅ 单位联动机制

系统已实现**动态联动**机制：

```
入库时的数量单位 = 药品档案中的包装单位（packUnit）
```

### 代码逻辑

```javascript
// 从药品档案选择药品时
unit: drugInfo.packUnit || drugInfo.unit || drugInfo.unitName || ''
      ↑ 第1优先        ↑ 第2优先      ↑ 第3优先
```

---

## 🔍 问题分析

如果入库时显示的单位与预期不符，说明**药品档案中的单位设置有误**。

### 示例

**问题现象：**
- 开塞露在药品档案中的单位应该是「支」
- 但入库时显示为「盒」

**原因：**
- 药品档案中开塞露的 `packUnit` 被设置成了「盒」

**解决：**
- 修改药品档案中开塞露的包装单位为「支」

---

## 🔧 修改药品档案单位

### 操作步骤

#### 第1步：进入药品档案

1. 在首页点击【药品档案】
2. 找到需要修改的药品（如：开塞露）
3. 点击进入详情/编辑页面

#### 第2步：修改单位信息

在「📦 单位转换」部分进行设置：

**方案1：开塞露按支销售和使用**
```
包装单位：支  ← 主库存单位
最小单位：支  ← 园区使用单位
转换率：  1 支 = 1 支
```

**方案2：开塞露按盒入库，按支使用**
```
包装单位：盒  ← 主库存单位（入库用）
最小单位：支  ← 园区使用单位（门诊用）
转换率：  1 盒 = 10 支  ← 填写实际转换率
```

#### 第3步：保存修改

点击【提交】或【保存】按钮

---

## 💡 常见药品单位设置

| 药品类型 | 包装单位 | 最小单位 | 转换率 | 说明 |
|---------|---------|---------|--------|------|
| 片剂/胶囊 | 盒 | 片/粒 | 24 | 1盒=24片 |
| 口服液 | 瓶 | ml | 100 | 1瓶=100ml |
| 注射液 | 盒 | 支 | 10 | 1盒=10支 |
| **开塞露** | **支** | **支** | **1** | 1支=1支 |
| 软膏/乳膏 | 支 | g | 20 | 1支=20g |
| 滴眼液 | 盒 | 瓶 | 1 | 1盒=1瓶 |
| 颗粒剂 | 盒 | 袋 | 12 | 1盒=12袋 |

---

## 🎯 验证修改

修改药品档案后，验证步骤：

1. 回到【药品入库】页面
2. 删除已添加的该药品
3. 重新从【从档案选择】添加该药品
4. 查看数量输入框后面的单位
5. 应该显示您在药品档案中设置的包装单位 ✅

---

## 📋 系统工作流程

### 完整流程示例（以开塞露为例）

#### 1. 药品档案设置
```
药品名称：开塞露
包装单位：支  ← 入库用
最小单位：支  ← 使用用
转换率：1
```

#### 2. 药品入库
```
从药品档案选择「开塞露」
↓
自动读取 packUnit
↓
数量输入框显示：[__] 支  ✅
```

#### 3. 出库到园区
```
出库数量：5 支（包装单位）
↓
转换：5支 × 1 = 5支
↓
园区库存增加：5 支（最小单位）
```

#### 4. 门诊使用
```
使用数量：1 支（最小单位）
↓
从园区库存扣减：1 支
```

---

## ⚠️ 重要说明

### 单位设置原则

1. **包装单位（packUnit）**
   - 用于：主库房入库、库存管理
   - 通常是：盒、瓶、支、盘等整包装单位

2. **最小单位（minUnit）**
   - 用于：园区库存、门诊使用
   - 通常是：片、粒、ml、g、支等使用单位

3. **转换率（conversionRate）**
   - 1个包装单位 = X个最小单位
   - 用于：出库到园区时的单位转换

### 特殊情况

**如果药品没有更小的单位**（如开塞露）：
- 包装单位 = 最小单位 = 支
- 转换率 = 1
- 整个流程都使用同一个单位

---

## ✅ 总结

✅ **代码已实现动态联动**
- 入库单位自动读取药品档案的 `packUnit`
- 无需修改代码

⚠️ **需要正确设置药品档案**
- 每个药品都要设置正确的包装单位和最小单位
- 设置转换率（如果有）

🎯 **下一步操作**
- 检查并修改药品档案中的单位设置
- 特别是开塞露、注射液等特殊包装的药品

---

## 📞 常见问题

### Q1: 为什么入库时显示的单位不对？
**A:** 药品档案中的包装单位设置有误，请修改药品档案。

### Q2: 如何批量修改药品单位？
**A:** 目前需要逐个修改，建议在录入药品档案时就设置正确。

### Q3: 修改单位后，已有的库存记录会变吗？
**A:** 不会。只影响新的入库、出库记录。

### Q4: 开塞露应该设置什么单位？
**A:** 
- 如果按支入库、按支使用：包装单位=支，最小单位=支，转换率=1
- 如果按盒入库、按支使用：包装单位=盒，最小单位=支，转换率=实际支数

---

**💡 建议：新增药品时，务必正确设置包装单位和最小单位！**




