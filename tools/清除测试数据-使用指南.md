# ğŸ—‘ï¸ æ¸…é™¤æµ‹è¯•æ•°æ®ä½¿ç”¨æŒ‡å—

**åˆ›å»ºæ—¥æœŸï¼š** 2026å¹´1æœˆ2æ—¥  
**é€‚ç”¨åœºæ™¯ï¼š** å‘å¸ƒå‰æ¸…ç†æµ‹è¯•æ•°æ®

---

## âš ï¸ é‡è¦è­¦å‘Š

**æ­¤æ“ä½œä¸å¯é€†ï¼æ¸…é™¤åæ•°æ®æ— æ³•æ¢å¤ï¼**

å»ºè®®æ“ä½œå‰ï¼š
1. âœ… ç¡®è®¤è¦æ¸…é™¤çš„æ•°æ®
2. âœ… å¤‡ä»½é‡è¦æ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰
3. âœ… åœ¨æµ‹è¯•ç¯å¢ƒä¸­å…ˆè¯•è¿è¡Œ

---

## ğŸ“‹ æ¸…é™¤å†…å®¹

### ä¼šè¢«æ¸…é™¤çš„æ•°æ®

1. **åº“å­˜æ•°æ®** (`stock` é›†åˆ)
   - æ‰€æœ‰è¯å“çš„åº“å­˜è®°å½•
   - æ‰¹æ¬¡ä¿¡æ¯
   - åº“å­˜æ•°é‡

2. **å‡ºåº“è®°å½•** (`outRecords` é›†åˆ)
   - æ‰€æœ‰å‡ºåº“è®°å½•
   - å‡ºåº“æ˜ç»†

3. **å…¥åº“è®°å½•** (`inRecords` é›†åˆ)
   - æ‰€æœ‰å…¥åº“è®°å½•
   - å…¥åº“æ˜ç»†

4. **è¯Šæ–­è®°å½•** (`clinicRecords` é›†åˆ)
   - æ‰€æœ‰æ‚£è€…è¯Šæ–­è®°å½•
   - å°±è¯Šä¿¡æ¯

5. **å¤„æ–¹è®°å½•** (`prescriptions` é›†åˆ)
   - æ‰€æœ‰å¤„æ–¹è®°å½•
   - ç”¨è¯ä¿¡æ¯

### ä¸ä¼šè¢«æ¸…é™¤çš„æ•°æ®

1. **è¯å“åŸºç¡€æ•°æ®** (`drugs` é›†åˆ)
   - è¯å“åç§°ã€è§„æ ¼ç­‰åŸºç¡€ä¿¡æ¯
   - å¦‚éœ€æ¸…é™¤ï¼Œè¯·æ‰‹åŠ¨æ‰§è¡Œ

2. **ç”¨æˆ·æ•°æ®** (`users` é›†åˆ)
   - ç”¨æˆ·ä¿¡æ¯ä¿ç•™

3. **ç³»ç»Ÿé…ç½®** (`settings` é›†åˆ)
   - ç³»ç»Ÿé…ç½®ä¿ç•™

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1ï¼šä¸€é”®æ¸…é™¤ï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•æ•°æ®

**æ­¥éª¤ï¼š**

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. æ‰“å¼€æ§åˆ¶å°ï¼ˆConsoleï¼‰
3. å¤åˆ¶ `æ¸…é™¤æµ‹è¯•æ•°æ®.js` æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹
4. ç²˜è´´åˆ°æ§åˆ¶å°
5. æŒ‰ Enter æ‰§è¡Œ

**ä»£ç ï¼š**

```javascript
// å¤åˆ¶ æ¸…é™¤æµ‹è¯•æ•°æ®.js æ–‡ä»¶çš„å†…å®¹åˆ°æ§åˆ¶å°æ‰§è¡Œ
(async function clearTestData() {
  const db = wx.cloud.database()
  const _ = db.command
  
  console.log('ğŸš€ å¼€å§‹æ¸…é™¤æµ‹è¯•æ•°æ®...')
  
  try {
    // 1. æ¸…é™¤åº“å­˜æ•°æ®
    console.log('\nğŸ“¦ 1. æ¸…é™¤åº“å­˜æ•°æ®...')
    const stockRes = await db.collection('stock').where({
      _id: _.exists(true)
    }).remove()
    console.log(`âœ… å·²æ¸…é™¤ ${stockRes.stats.removed} æ¡åº“å­˜è®°å½•`)
    
    // 2. æ¸…é™¤å‡ºåº“è®°å½•
    console.log('\nğŸ“¤ 2. æ¸…é™¤å‡ºåº“è®°å½•...')
    const outRes = await db.collection('outRecords').where({
      _id: _.exists(true)
    }).remove()
    console.log(`âœ… å·²æ¸…é™¤ ${outRes.stats.removed} æ¡å‡ºåº“è®°å½•`)
    
    // 3. æ¸…é™¤å…¥åº“è®°å½•
    console.log('\nğŸ“¥ 3. æ¸…é™¤å…¥åº“è®°å½•...')
    const inRes = await db.collection('inRecords').where({
      _id: _.exists(true)
    }).remove()
    console.log(`âœ… å·²æ¸…é™¤ ${inRes.stats.removed} æ¡å…¥åº“è®°å½•`)
    
    // 4. æ¸…é™¤è¯Šæ–­è®°å½•
    console.log('\nğŸ¥ 4. æ¸…é™¤è¯Šæ–­è®°å½•...')
    const clinicRes = await db.collection('clinicRecords').where({
      _id: _.exists(true)
    }).remove()
    console.log(`âœ… å·²æ¸…é™¤ ${clinicRes.stats.removed} æ¡è¯Šæ–­è®°å½•`)
    
    // 5. æ¸…é™¤å¤„æ–¹è®°å½•
    console.log('\nğŸ’Š 5. æ¸…é™¤å¤„æ–¹è®°å½•...')
    const prescriptionRes = await db.collection('prescriptions').where({
      _id: _.exists(true)
    }).remove()
    console.log(`âœ… å·²æ¸…é™¤ ${prescriptionRes.stats.removed} æ¡å¤„æ–¹è®°å½•`)
    
    console.log('\nâœ… æµ‹è¯•æ•°æ®æ¸…é™¤å®Œæˆï¼')
    console.log('\nğŸ“Š æ¸…é™¤ç»Ÿè®¡ï¼š')
    console.log(`  - åº“å­˜è®°å½•ï¼š${stockRes.stats.removed} æ¡`)
    console.log(`  - å‡ºåº“è®°å½•ï¼š${outRes.stats.removed} æ¡`)
    console.log(`  - å…¥åº“è®°å½•ï¼š${inRes.stats.removed} æ¡`)
    console.log(`  - è¯Šæ–­è®°å½•ï¼š${clinicRes.stats.removed} æ¡`)
    console.log(`  - å¤„æ–¹è®°å½•ï¼š${prescriptionRes.stats.removed} æ¡`)
    
  } catch (err) {
    console.error('âŒ æ¸…é™¤æ•°æ®å¤±è´¥:', err)
  }
})()
```

---

### æ–¹æ³•2ï¼šåˆ†æ­¥æ¸…é™¤ï¼ˆè°¨æ…ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** åªæƒ³æ¸…é™¤éƒ¨åˆ†æ•°æ®ï¼Œæˆ–è€…æƒ³é€æ­¥ç¡®è®¤

**æ­¥éª¤ï¼š**

#### æ­¥éª¤1ï¼šæŸ¥çœ‹å½“å‰æ•°æ®é‡

```javascript
(async function checkDataCount() {
  const db = wx.cloud.database()
  
  console.log('ğŸ“Š å½“å‰æ•°æ®ç»Ÿè®¡ï¼š')
  
  const stockCount = await db.collection('stock').count()
  console.log(`  - åº“å­˜è®°å½•ï¼š${stockCount.total} æ¡`)
  
  const outCount = await db.collection('outRecords').count()
  console.log(`  - å‡ºåº“è®°å½•ï¼š${outCount.total} æ¡`)
  
  const inCount = await db.collection('inRecords').count()
  console.log(`  - å…¥åº“è®°å½•ï¼š${inCount.total} æ¡`)
  
  const clinicCount = await db.collection('clinicRecords').count()
  console.log(`  - è¯Šæ–­è®°å½•ï¼š${clinicCount.total} æ¡`)
  
  const prescriptionCount = await db.collection('prescriptions').count()
  console.log(`  - å¤„æ–¹è®°å½•ï¼š${prescriptionCount.total} æ¡`)
})()
```

#### æ­¥éª¤2ï¼šæ¸…é™¤åº“å­˜æ•°æ®

```javascript
(async function clearStock() {
  const db = wx.cloud.database()
  const _ = db.command
  
  console.log('ğŸ“¦ æ¸…é™¤åº“å­˜æ•°æ®...')
  const res = await db.collection('stock').where({
    _id: _.exists(true)
  }).remove()
  console.log(`âœ… å·²æ¸…é™¤ ${res.stats.removed} æ¡åº“å­˜è®°å½•`)
})()
```

#### æ­¥éª¤3ï¼šæ¸…é™¤å‡ºåº“è®°å½•

```javascript
(async function clearOutRecords() {
  const db = wx.cloud.database()
  const _ = db.command
  
  console.log('ğŸ“¤ æ¸…é™¤å‡ºåº“è®°å½•...')
  const res = await db.collection('outRecords').where({
    _id: _.exists(true)
  }).remove()
  console.log(`âœ… å·²æ¸…é™¤ ${res.stats.removed} æ¡å‡ºåº“è®°å½•`)
})()
```

#### æ­¥éª¤4ï¼šæ¸…é™¤å…¥åº“è®°å½•

```javascript
(async function clearInRecords() {
  const db = wx.cloud.database()
  const _ = db.command
  
  console.log('ğŸ“¥ æ¸…é™¤å…¥åº“è®°å½•...')
  const res = await db.collection('inRecords').where({
    _id: _.exists(true)
  }).remove()
  console.log(`âœ… å·²æ¸…é™¤ ${res.stats.removed} æ¡å…¥åº“è®°å½•`)
})()
```

#### æ­¥éª¤5ï¼šæ¸…é™¤è¯Šæ–­è®°å½•

```javascript
(async function clearClinicRecords() {
  const db = wx.cloud.database()
  const _ = db.command
  
  console.log('ğŸ¥ æ¸…é™¤è¯Šæ–­è®°å½•...')
  const res = await db.collection('clinicRecords').where({
    _id: _.exists(true)
  }).remove()
  console.log(`âœ… å·²æ¸…é™¤ ${res.stats.removed} æ¡è¯Šæ–­è®°å½•`)
})()
```

#### æ­¥éª¤6ï¼šæ¸…é™¤å¤„æ–¹è®°å½•

```javascript
(async function clearPrescriptions() {
  const db = wx.cloud.database()
  const _ = db.command
  
  console.log('ğŸ’Š æ¸…é™¤å¤„æ–¹è®°å½•...')
  const res = await db.collection('prescriptions').where({
    _id: _.exists(true)
  }).remove()
  console.log(`âœ… å·²æ¸…é™¤ ${res.stats.removed} æ¡å¤„æ–¹è®°å½•`)
})()
```

---

### æ–¹æ³•3ï¼šé€‰æ‹©æ€§æ¸…é™¤

**é€‚ç”¨åœºæ™¯ï¼š** åªæ¸…é™¤ç‰¹å®šæ¡ä»¶çš„æ•°æ®

#### ç¤ºä¾‹1ï¼šåªæ¸…é™¤æŸä¸ªå›­åŒºçš„åº“å­˜

```javascript
(async function clearStockByLocation() {
  const db = wx.cloud.database()
  
  console.log('ğŸ“¦ æ¸…é™¤æŒ‡å®šå›­åŒºçš„åº“å­˜æ•°æ®...')
  const res = await db.collection('stock').where({
    location: 'land_park'  // åªæ¸…é™¤é™†å›­çš„åº“å­˜
  }).remove()
  console.log(`âœ… å·²æ¸…é™¤ ${res.stats.removed} æ¡åº“å­˜è®°å½•`)
})()
```

#### ç¤ºä¾‹2ï¼šåªæ¸…é™¤æŸä¸ªæ—¥æœŸä¹‹å‰çš„è®°å½•

```javascript
(async function clearOldRecords() {
  const db = wx.cloud.database()
  const _ = db.command
  
  console.log('ğŸ—‘ï¸ æ¸…é™¤æ—§è®°å½•...')
  const cutoffDate = new Date('2026-01-01')  // 2026å¹´1æœˆ1æ—¥ä¹‹å‰çš„è®°å½•
  
  const res = await db.collection('clinicRecords').where({
    visitDateTime: _.lt(cutoffDate)
  }).remove()
  console.log(`âœ… å·²æ¸…é™¤ ${res.stats.removed} æ¡æ—§è®°å½•`)
})()
```

#### ç¤ºä¾‹3ï¼šåªæ¸…é™¤æµ‹è¯•æ‚£è€…çš„è®°å½•

```javascript
(async function clearTestPatients() {
  const db = wx.cloud.database()
  const _ = db.command
  
  console.log('ğŸ§ª æ¸…é™¤æµ‹è¯•æ‚£è€…è®°å½•...')
  const res = await db.collection('clinicRecords').where({
    name: _.or([
      db.RegExp({ regexp: 'æµ‹è¯•', options: 'i' }),
      db.RegExp({ regexp: 'test', options: 'i' })
    ])
  }).remove()
  console.log(`âœ… å·²æ¸…é™¤ ${res.stats.removed} æ¡æµ‹è¯•è®°å½•`)
})()
```

---

## ğŸ“Š æ‰§è¡Œç»“æœç¤ºä¾‹

### æˆåŠŸæ‰§è¡Œçš„è¾“å‡º

```
ğŸš€ å¼€å§‹æ¸…é™¤æµ‹è¯•æ•°æ®...

ğŸ“¦ 1. æ¸…é™¤åº“å­˜æ•°æ®...
âœ… å·²æ¸…é™¤ 45 æ¡åº“å­˜è®°å½•

ğŸ“¤ 2. æ¸…é™¤å‡ºåº“è®°å½•...
âœ… å·²æ¸…é™¤ 23 æ¡å‡ºåº“è®°å½•

ğŸ“¥ 3. æ¸…é™¤å…¥åº“è®°å½•...
âœ… å·²æ¸…é™¤ 18 æ¡å…¥åº“è®°å½•

ğŸ¥ 4. æ¸…é™¤è¯Šæ–­è®°å½•...
âœ… å·²æ¸…é™¤ 67 æ¡è¯Šæ–­è®°å½•

ğŸ’Š 5. æ¸…é™¤å¤„æ–¹è®°å½•...
âœ… å·²æ¸…é™¤ 34 æ¡å¤„æ–¹è®°å½•

âœ… æµ‹è¯•æ•°æ®æ¸…é™¤å®Œæˆï¼

ğŸ“Š æ¸…é™¤ç»Ÿè®¡ï¼š
  - åº“å­˜è®°å½•ï¼š45 æ¡
  - å‡ºåº“è®°å½•ï¼š23 æ¡
  - å…¥åº“è®°å½•ï¼š18 æ¡
  - è¯Šæ–­è®°å½•ï¼š67 æ¡
  - å¤„æ–¹è®°å½•ï¼š34 æ¡

ğŸ‰ æ•°æ®åº“å·²æ¸…ç†å¹²å‡€ï¼
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šæƒé™ä¸è¶³

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: permission denied
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥æ•°æ®åº“æƒé™è®¾ç½®
2. ç¡®ä¿å½“å‰ç”¨æˆ·æœ‰åˆ é™¤æƒé™
3. åœ¨äº‘å¼€å‘æ§åˆ¶å°ä¸­è®¾ç½®æƒé™ä¸º"æ‰€æœ‰ç”¨æˆ·å¯è¯»å†™"ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

---

### é—®é¢˜2ï¼šåˆ é™¤æ•°é‡ä¸º0

**å¯èƒ½åŸå› ï¼š**
1. æ•°æ®åº“ä¸­æœ¬æ¥å°±æ²¡æœ‰æ•°æ®
2. æŸ¥è¯¢æ¡ä»¶ä¸åŒ¹é…
3. æ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// å…ˆæŸ¥è¯¢ç¡®è®¤æ•°æ®å­˜åœ¨
const db = wx.cloud.database()
const res = await db.collection('stock').get()
console.log('åº“å­˜æ•°æ®:', res.data)
```

---

### é—®é¢˜3ï¼šæ‰§è¡Œè¶…æ—¶

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: timeout
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ•°æ®é‡å¤ªå¤§ï¼Œåˆ†æ‰¹åˆ é™¤
2. ä½¿ç”¨åˆ†æ­¥æ¸…é™¤æ–¹æ³•
3. åœ¨äº‘å‡½æ•°ä¸­æ‰§è¡Œï¼ˆäº‘å‡½æ•°è¶…æ—¶æ—¶é—´æ›´é•¿ï¼‰

---

## âœ… æ¸…é™¤åéªŒè¯

æ‰§è¡Œæ¸…é™¤åï¼Œå»ºè®®éªŒè¯æ•°æ®æ˜¯å¦å·²æ¸…é™¤ï¼š

```javascript
// éªŒè¯æ•°æ®æ˜¯å¦å·²æ¸…é™¤
(async function verifyCleared() {
  const db = wx.cloud.database()
  
  console.log('ğŸ” éªŒè¯æ•°æ®æ¸…é™¤ç»“æœï¼š')
  
  const stockCount = await db.collection('stock').count()
  console.log(`  - åº“å­˜è®°å½•ï¼š${stockCount.total} æ¡ ${stockCount.total === 0 ? 'âœ…' : 'âš ï¸'}`)
  
  const outCount = await db.collection('outRecords').count()
  console.log(`  - å‡ºåº“è®°å½•ï¼š${outCount.total} æ¡ ${outCount.total === 0 ? 'âœ…' : 'âš ï¸'}`)
  
  const inCount = await db.collection('inRecords').count()
  console.log(`  - å…¥åº“è®°å½•ï¼š${inCount.total} æ¡ ${inCount.total === 0 ? 'âœ…' : 'âš ï¸'}`)
  
  const clinicCount = await db.collection('clinicRecords').count()
  console.log(`  - è¯Šæ–­è®°å½•ï¼š${clinicCount.total} æ¡ ${clinicCount.total === 0 ? 'âœ…' : 'âš ï¸'}`)
  
  const prescriptionCount = await db.collection('prescriptions').count()
  console.log(`  - å¤„æ–¹è®°å½•ï¼š${prescriptionCount.total} æ¡ ${prescriptionCount.total === 0 ? 'âœ…' : 'âš ï¸'}`)
  
  if (stockCount.total === 0 && outCount.total === 0 && inCount.total === 0 && 
      clinicCount.total === 0 && prescriptionCount.total === 0) {
    console.log('\nâœ… æ‰€æœ‰æµ‹è¯•æ•°æ®å·²æ¸…é™¤å¹²å‡€ï¼')
  } else {
    console.log('\nâš ï¸ éƒ¨åˆ†æ•°æ®æœªæ¸…é™¤ï¼Œè¯·æ£€æŸ¥')
  }
})()
```

---

## ğŸ“‹ å‘å¸ƒå‰æ£€æŸ¥æ¸…å•

æ¸…é™¤æµ‹è¯•æ•°æ®åï¼Œå‘å¸ƒå‰è¯·ç¡®è®¤ï¼š

- [ ] âœ… æµ‹è¯•æ•°æ®å·²æ¸…é™¤
- [ ] âœ… è¯å“åŸºç¡€æ•°æ®ä¿ç•™ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] âœ… ç³»ç»Ÿé…ç½®æ­£å¸¸
- [ ] âœ… äº‘å‡½æ•°å·²éƒ¨ç½²
- [ ] âœ… æ•°æ®åº“ç´¢å¼•å·²åˆ›å»º
- [ ] âœ… åŠŸèƒ½æµ‹è¯•é€šè¿‡

---

## ğŸ¯ æ€»ç»“

### æ¨èæµç¨‹

1. **å‘å¸ƒå‰æ¸…ç†**
   ```
   æŸ¥çœ‹æ•°æ®é‡ â†’ ç¡®è®¤æ¸…é™¤èŒƒå›´ â†’ æ‰§è¡Œæ¸…é™¤ â†’ éªŒè¯ç»“æœ
   ```

2. **æ¸…é™¤åæ“ä½œ**
   ```
   éªŒè¯åŠŸèƒ½ â†’ æµ‹è¯•æ ¸å¿ƒæµç¨‹ â†’ ä¸Šä¼ ä»£ç  â†’ æäº¤å®¡æ ¸
   ```

3. **æ³¨æ„äº‹é¡¹**
   - âš ï¸ æ¸…é™¤æ“ä½œä¸å¯é€†
   - âœ… ä¿ç•™è¯å“åŸºç¡€æ•°æ®
   - âœ… ä¿ç•™ç³»ç»Ÿé…ç½®
   - âœ… æ¸…é™¤åéªŒè¯åŠŸèƒ½

---

**åˆ›å»ºäººå‘˜ï¼š** AI Assistant  
**åˆ›å»ºæ—¶é—´ï¼š** 2026å¹´1æœˆ2æ—¥  
**é€‚ç”¨ç‰ˆæœ¬ï¼š** v3.16.2

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- ã€Šå¾®ä¿¡å°ç¨‹åºå‘å¸ƒæŒ‡å—-2026-01-02.mdã€‹
- ã€Šæ§åˆ¶å°è­¦å‘Šå’Œé”™è¯¯åˆ†æ-2026-01-02.mdã€‹

ç¥æ¸…ç†é¡ºåˆ©ï¼ğŸ‰

