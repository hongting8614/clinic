{"version":3,"sources":["uni-app:///main.js","webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?48e3","webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?1fe6","webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?061e","webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?93c8","uni-app:///pages-sub/clinic/add.vue","webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?57b7","webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?e7ad"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","components","Signature","data","locations","label","value","identityOptions","visitTypeOptions","diseaseTemplates","treatmentTemplates","complaintTemplates","treatmentCautions","diseaseTemplateLib","complaint","symptoms","diagnoses","treatments","suggestDrugs","drugSuggestionList","rxDrugNames","form","visitDateTime","name","gender","age","identity","location","visitType","injuryLocation","chiefComplaint","symptom","diseaseName","diagnosis","treatment","drugId","quantity","remark","doctorSign","signTime","showLocationTip","noTipNextTime","currentDateTime","selectedDrug","selectedBatch","availableStock","drugSearchText","allDrugs","filteredDrugs","showDrugList","diseaseOptions","filteredDiseases","showDiseaseList","filteredDiagnosis","showDiagnosisList","filteredTreatments","showTreatmentList","filteredComplaints","showComplaintList","complaintSelectedMode","complaintFocus","diseaseBlurTimer","complaintBlurTimer","diagnosisBlurTimer","ageFocus","allLocations","filteredLocations","showLocationList","showDrugSelector","submitting","continueAfterSubmit","activeFieldId","dateTimeTimerId","userDiseaseTemplates","templateIndex","globalSearchKeyword","computed","currentLocationLabel","locationLocked","complaintFontSizeClass","diagnosisFontSizeClass","onLoad","onUnload","clearInterval","methods","onFieldFocus","onDoctorSignChange","restoreUserDiseaseTemplates","console","buildTemplateIndex","Object","list","index","disease","source","idx","userIdx","performGlobalSearch","diseases","complaints","match","key","record","matchedRecords","setIdentity","setVisitType","openLocationSelector","uni","itemList","success","closeLocationTip","handleLocationSelect","updateDateTime","loadAllDrugs","action","pageSize","res","onDrugInputFocus","loadLocationDrugs","title","stockList","filter","map","_id","specification","minUnit","packUnit","conversionRate","stock","onDrugSearch","genericName","spec","hitTrade","pinyin","selectDrugFromList","onDiseaseFocus","clearTimeout","onDiseaseBlur","onDiseaseInput","selectDisease","loadTemplatesForDisease","flatMap","autoFillByDisease","arr","pushUnique","onDiagnosisFocus","onDiagnosisInput","selectDiagnosis","onComplaintFocus","onComplaintInput","onComplaintBlur","selectComplaint","onTreatmentFocus","onTreatmentInput","selectTreatment","appendTreatment","saveCurrentAsTemplate","icon","target","promptSaveTemplate","content","confirmText","cancelText","normalizeText","ensureStockLoaded","isPrescriptionDrug","applySuggestDrugs","findDrugByName","onDrugChip","drug","restoreLastLocation","selectLocation","duration","onLocationFocus","onLocationInput","selectLocationFromList","onDrugSelect","id","drugCode","manufacturer","loadBatches","enableFIFO","batches","parkName","openSignature","onSignatureConfirm","handleSubmit","hasValidDrugUsage","submitData","isOutcall","intQuantity","drugName","unit","batchId","batch","setTimeout","scrollTop","resetForm","formatDate","toggleContinue","goBack","generateDailyReport","today","year","month","day","dateStr","locationName","records","startDate","endDate","useClinicRecords","report","stats","tableData","reportDate","url","fail","formatDailyReport","total","visitor","employee","outcall","existing","count","loc","visitorParts","calculateStats","visitorTotal","employeeTotal","outcallTotal","prepareTableData","doctorName","visitTime","visitorData","employeeData"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,YAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA4H;AAC5H;AACuD;AACL;AACsC;;;AAGxF;AAC4M;AAC5M,gBAAgB,gNAAU;AAC1B,EAAE,yEAAM;AACR,EAAE,0FAAM;AACR,EAAE,mGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,8FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC3DA;AAAA;AAAA;AAAA;AAAgyB,CAAgB,4xBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eC0fpzB;EACAC;IACAC;EACA;EACAC;IACA;MACAC,YACA;QAAAC;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACAC,kBACA;QAAAF;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACAE,mBACA;QAAAH;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACA;MACAG;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;MACAC;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;MACA;MACAC;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;MACA;MACAC;QACA,OACA,gBACA,eACA,sBACA;QACA,OACA,gBACA,aACA,aACA;QACA,OACA,WACA,gBACA,mBACA;QACA,OACA,mBACA,WACA;MAEA;MACA;MACA;MACAC;QACA,OACA;UACAC;UACAC,WACA,8BACA,gBACA;UACAC,YACA,cACA,cACA;UACAC,aACA,cACA,kBACA;QAEA,GACA;UACAH;UACAC,WACA,oBACA,cACA;UACAC,YACA,QACA,WACA;UACAC,aACA,mBACA,eACA;QAEA,GACA;UACAH;UACAC,WACA,sBACA,cACA;UACAC,YACA,QACA,WACA;UACAC,aACA,iBACA,kBACA;QAEA,EACA;QACA,OACA;UACAH;UACAC,WACA,kBACA,aACA;UACAC,YACA,YACA,SACA;UACAC,aACA,aACA,iBACA;QAEA,GACA;UACAH;UACAC,WACA,mBACA,SACA;UACAC,YACA,SACA,YACA;UACAC,aACA,aACA,iBACA;QAEA,GACA;UACAH;UACAC,WACA,gBACA,iBACA;UACAC,YACA,WACA;UACAC,aACA,aACA,cACA;QAEA,EACA;QACA,OACA;UACAH;UACAC,WACA,iBACA,aACA;UACAC,YACA,WACA;UACAC,aACA,eACA,eACA,oBACA;UACAC;QACA,GACA;UACAJ;UACAC,WACA,oBACA,cACA;UACAC,YACA,WACA;UACAC,aACA,UACA,mBACA,aACA;UACAC;QACA,GACA;UACAJ;UACAC,WACA,sBACA,mBACA;UACAC,YACA,WACA;UACAC,aACA,eACA,eACA;QAEA,EACA;QACA,OACA;UACAH;UACAC,WACA,kBACA,gBACA;UACAC,YACA,YACA;UACAC,aACA,iBACA,gBACA,iBACA;UACAC;QACA,GACA;UACAJ;UACAC,WACA,iBACA,cACA;UACAC,YACA,UACA;UACAC,aACA,YACA,iBACA;QAEA,GACA;UACAH;UACAC,WACA,iBACA,iBACA;UACAC,YACA,UACA;UACAC,aACA,iBACA,gBACA;QAEA,EACA;QACA,OACA;UACAH;UACAC,WACA,yBACA,aACA;UACAC,YACA,OACA;UACAC,aACA,cACA,cACA,kBACA,iBACA;UACAC;QACA,GACA;UACAJ;UACAC,WACA,mBACA,WACA;UACAC,YACA,QACA;UACAC,aACA,iBACA,kBACA;QAEA,EACA;QACA,OACA;UACAH;UACAC,WACA,iBACA,eACA;UACAC,YACA,YACA;UACAC,aACA,oBACA,eACA,sBACA;UACAC;QACA,GACA;UACAJ;UACAC,WACA,mBACA,WACA;UACAC,YACA,WACA,OACA;UACAC,aACA,eACA,gBACA;QAEA,EACA;QACA,OACA;UACAH;UACAC,WACA,qBACA,aACA;UACAC,YACA,UACA,OACA;UACAC,aACA,YACA,aACA,qBACA;UACAC;QACA,GACA;UACAJ;UACAC,WACA,gBACA,WACA;UACAC,YACA,QACA;UACAC,aACA,eACA,aACA;QAEA,GACA;UACAH;UACAC,WACA,6BACA,eACA;UACAC,YACA,aACA;UACAC,aACA,YACA,kBACA;QAEA,EACA;QACA,OACA;UACAH;UACAC,WACA,sBACA,gBACA;UACAC,YACA,YACA,SACA;UACAC,aACA,aACA,cACA;QAEA,GACA;UACAH;UACAC,WACA,yBACA,aACA;UACAC,YACA,QACA,SACA;UACAC,aACA,cACA,eACA;QAEA,EACA;QACA,OACA;UACAH;UACAC,WACA,uBACA,kBACA;UACAC,YACA,SACA,UACA;UACAC,aACA,iBACA,iBACA;QAEA,GACA;UACAH;UACAC,WACA,cACA,gBACA;UACAC,YACA,WACA;UACAC,aACA,kBACA,gBACA;QAEA,EACA;QAEA;QACA,QACA;UACAH;UACAC,WACA,sBACA,YACA;UACAC,YACA,UACA,YACA;UACAC,aACA,kBACA,wBACA,8BACA;UACAC;QACA,GACA;UACAJ;UACAC,WACA,gBACA,gBACA;UACAC,YACA,YACA;UACAC,aACA,qBACA,eACA;QAEA,EACA;QAEA;QACA,OACA;UACAH;UACAC,WACA,gBACA,eACA;UACAC,YACA,cACA;UACAC,aACA,2BACA,sBACA;QAEA,GACA;UACAH;UACAC,WACA,eACA,iBACA;UACAC,YACA,UACA;UACAC,aACA,uBACA,eACA;QAEA,GACA;UACAH;UACAC,WACA,oBACA,cACA;UACAC,YACA,WACA;UACAC,aACA,kBACA,eACA;QAEA,EACA;QAEA;QACA,SACA;UACAH;UACAC,WACA,iBACA,mBACA;UACAC,YACA,aACA;UACAC,aACA,mBACA;QAEA,GACA;UACAH;UACAC,WACA,kBACA,aACA;UACAC,YACA,cACA,UACA;UACAC,aACA,eACA,uBACA;QAEA,GACA;UACAH;UACAC,WACA,YACA,qBACA;UACAC,YACA,cACA,SACA;UACAC,aACA,gBACA,kBACA,mBACA;UACAC;QACA,EACA;QAEA;QACA,YACA;UACAJ;UACAC,WACA,WACA,iBACA;UACAC,YACA,SACA;UACAC,aACA,sBACA,eACA;QAEA,GACA;UACAH;UACAC,WACA,aACA,iBACA;UACAC,YACA,QACA;UACAC,aACA,qBACA,iBACA;QAEA;MAEA;MACA;MACAE,qBACA,+DACA,2DACA,0DACA,uDACA,yDACA,YACA;MACAC;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;MAEA;MACAC;MACAC;MACAC;MACAC;MAEA;MACAC,iBACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,QACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,MACA,OACA,MACA,MACA,MACA,MACA,KACA;MACAC;MACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACA;MACAC;MACAC;MACAC;MAAA;MACAC;MAAA;MACA;MACAC;MACAC;MACAC;MACA;MACAC;MACA;MACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA,uCACA;MACAC;MACAC;MAEAC;MACAC;MACAC;MAAA;;MAEA;MACAC;MAEA;MACAC;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAC;MAEA;MACAC;MACA;MACAC;IACA;EACA;EAEAC;IACAC;MAAA;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;MACA;IACA;EACA;EAEAC;IAAA;IACA;IACA;IACA;MACA;IACA;;IAEA;IACA;;IAEA;IACA;;IAEA;IACA;;IAEA;IACA;EACA;EAEAC;IACA;IACA;MACAC;MACA;IACA;EACA;EAEAC;IACAC;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;QACA;QACA;UACA;QACA;MACA;QACAC;QACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;;MAEA;MACAC;QACA;QACAC;UACA;YACAC;cACAC;cACA/E;cACAC;cACAC;cACAC;cACA6E;cACAC;YACA;UACA;QACA;MACA;;MAEA;MACAL;QAAA;QACA;QACA;QACA;QACA;UACAE;YACAC;YACA/E;YACAC;YACAC;YACAC;YACA6E;UACA;QACA;MACA;;MAEA;MACAJ;QACA;QACA;QACA;UACA;YACAE;cACAC;cACA/E;cACAC;cACAC;cACAC;cACA6E;cACAE;YACA;UACA;QACA;MACA;MAEA;MACAR;IACA;IAEA;IACAS;MACA;MACA;MACA;;MAEA;MACA;QACA;UACAC;UACAC;UACAnF;QACA;MACA;;MAEA;MACA;QACA;;QAEA;QACA;UACAoF;QACA;;QAEA;QACA;UACAA;QACA;;QAEA;QACA;UACAA;YAAA;UAAA;QACA;QAEA;MACA;;MAEA;MACA;QAAA;MAAA;MACA;QAAA;UACAC;UAAA;UACAhG;UACAwF;UACAS;QACA;MAAA;MACA;MACAC;QACA;UAAA;QAAA;MACA;MACA;MAEA;QAAAL;QAAAC;QAAAnF;MAAA;IACA;IAEAwF;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MAAA;MACA;QAAA;MAAA;MACAC;QACAC;QACAC;UACA;UACA;UACA;YACA;UACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;QACA;UACAH;QACA;MACA;IACA;IAEA;IACAI;MACA;MACA;QACA;UACAJ;QACA;MACA;MACA;IACA;IACAK;MACA;MACA;MACA;MACA;MACA;MACA;MAEA;MACA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEArH;kBACA2B;kBACApB;oBACA+G;oBACA/G;sBAAAgH;oBAAA;kBACA;gBACA;cAAA;gBANAC;gBAQA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA5B;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACA6B;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBACA;;gBAEA;gBACA;kBACA;kBACA;gBACA;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAX;kBAAAY;gBAAA;gBAAA;gBAAA,OAEA3H;kBACA2B;kBACApB;oBACA+G;oBACA/G;sBACAwB;sBACAwF;oBACA;kBACA;gBACA;cAAA;gBATAC;gBAWAT;gBAEA;kBACAa,wCACA;kBACA,iCACAC;oBAAA;kBAAA,GACAC;oBAAA;sBACAC;sBACApG;sBACAqG;sBACAC;sBACAC;sBACAC;sBACAC;oBACA;kBAAA;kBAEAxC;gBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;gBACAmB;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAsB;MACA;QACA;QACA;QACA;MACA;MAEA;MACA;MACA;QACA;QACA;QACA;UACA;UACA;UACA;UACA;UACA;YAAA;UAAA;UAEA,iCACAC,iCACAC,0BACAC;QACA;MACA;QACA;QACA;UACA;UACA;UACA;UACA;UACA;UACA;YAAA;UAAA;UAEA,iCACAF,iCACAG,4BACAF,0BACAC;QACA;MACA;IACA;IAEA;IACAE;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;QACAC;QACA;MACA;;MAEA;MACA,sCACA,uBACA,0BACA,oBACA;MACA;MACA;MACA;;MAEA;MACA;IACA;IAEAC;MAAA;MACA;MACA;QACA;QACA;UAAA;QAAA;QACA;UACA;QACA;UACA;UACA;YAAA,OACA;cAAA;YAAA;UAAA,EACA;UACA;YACA;UACA;QACA;MACA;;MAEA;MACA;QACA;MACA;IACA;IAEA;IACAC;MACA,sCACA,uBACA,0BACA,oBACA;MACA;MACA;MACA;MAEA;MACA;MACA;MACA;MACA;QACA;MACA;IACA;IAEA;IACAC;MACA;MACA;QACAH;QACA;MACA;;MAEA;MACA;;MAEA;MACA;QAAA;MAAA;MACA;QACA;QACA;QACA;QACA;UACA;QACA;QACA;UACA;UACA;QACA;QACA;UACA;QACA;QACA;UACA;QACA;MACA;QACA;QACA;QACA;MACA;IACA;IACA;IACAI;MAAA;MACA;MACA;MACA,uKACAC;QAAA;MAAA;MACA;MACA;MACA;MACA;IACA;IACA;IACAC;MAAA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;QACAC;UACA;QACA;MACA;MACAC;MACAA;MACA;MACA;MACA;QACA;QACA;QACA;MACA;MACA;IACA;IACA;IACA;IACAC;MACA;MACA,sCACA,uBACA,0BACA,oBACA;MACA;MACA;MACA;;MAEA;MACA;IACA;IACAC;MACA,sCACA,uBACA,0BACA,oBACA;MACA;MACA;MACA;MAEA;IACA;IACAC;MAAA;MACA;MACA;QAAA,OACA;UAAA;QAAA;MAAA,EACA;MAEA;QACA;QACA;QACA;QACA;QACA;UACA;QACA;UACA;QACA;QACA;UACA;QACA;QACA;UACA;QACA;QACA;QACA;UACA7C;YACA;cACA;YACA;UACA;QACA;MACA;QACA;MACA;MAEA;IACA;IACA;IACA8C;MACA;MACA;QACAZ;QACA;MACA;MAEA;;MAEA;MACA;QACA;QACA;MACA;;MAEA;MACA;QACA;MACA;;MAEA;MACA,sCACA,uBACA,0BACA,oBACA;MACA;MACA;MACA;;MAEA;MACA;IACA;IACAa;MACA;;MAEA;MACA;QACA;MACA;;MAEA;MACA;QACA;QACA;MACA;;MAEA;MACA,sCACA,uBACA,0BACA,oBACA;MACA;MACA;MACA;MAEA;IACA;IAEAC;MAAA;MACA;MACA;MACA;MACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MACA;QACAf;QACA;MACA;MAEA;MACA;;MAEA;MACA;MACA;MACA;MACA;QACA;MACA;MACA;QACA;QACA;MACA;MACA;QACA;MACA;MACA;QACA;MACA;;MAEA;MACA;MACA;;MAEA;MACA;QACA;QACA;UACA;QACA;MACA;IACA;IACA;IACAgB;MACA;QAAA;QACA;QACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MACA;MACA;QACA;QACA;QACA;MACA;MACA;QAAA;MAAA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;QACAjD;UAAAY;UAAAsC;QAAA;QACA;MACA;MAEA;MACA;MACA;MAEA;QACAlD;UAAAY;UAAAsC;QAAA;QACA;MACA;;MAEA;MACA;QACA;UACA1D;UACAlE;UACAhB;QACA;MACA;MAEA;MAEA;QACA6I;QACAA;MACA;MAEA;QACAA;QACAA;MACA;MAEA;QACAA;QACAA;MACA;;MAEA;MACA;QACAnD;QACA;QACA;QACAA;UAAAY;UAAAsC;QAAA;MACA;QACArE;QACAmB;UAAAY;UAAAsC;QAAA;MACA;IACA;IACA;IACAE;MAAA;MACA;MACA;MACA;MACA;;MAEA;MACA;QACA;MACA;MAEApD;QACAY;QACAyC;QACAC;QACAC;QACArD;UACA;YACA;UACA;QACA;MACA;IACA;IACA;IACAsD;MACA;QACA;MACA;QACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAGA;IACAC;MACA;MACA;MACA;IACA;IACAC;MAAA;MACA;MACA3E;QACA;QACA;QACA;UACA;QACA;UACA;QACA;MACA;IACA;IACA4E;MAAA;MACA;MACA;QACA;UACA;UACA;UACA;QACA;MACA;MACA;MACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBACA;gBACA;gBAAA;gBAAA,OACA;cAAA;gBACAC;gBAAA,MACAA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBACA9D;kBAAAY;kBAAAsC;gBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;gBAKAlD;kBAAAY;kBAAAsC;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAa;MACA;QACA;QACA;QACA;;QAEA;QACA;QACA;QACA;QACA;UACA;UACA;UACA;UACA;UACAlF;QACA;UACA;UACA;UACA;QACA;;QAEA;QACA;QACA;UACA;QACA;MACA;QACAA;QACA;MACA;IACA;IAEAmF;MACA;;MAEA;MACA;QACAhE;MACA;QACAnB;MACA;;MAEA;MACA;QACAmB;UACAY;UACAsC;UACAe;QACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;QACA;QACA;MACA;QACA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;QACA;MACA;QACA;UAAA;QAAA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;IACA;IAGAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBACA;gBACA;;gBAEA;gBAAA;gBAEArE;kBAAAY;gBAAA;gBAAA;gBAAA,OACA3H;kBACA2B;kBACApB;oBACA+G;oBACA/G;sBAAA8K;oBAAA;kBACA;gBACA;cAAA;gBANA7D;gBAQA;kBACA;kBACA,uDACAA;oBACAO;oBACAuD;oBACA3J;oBACAqG;oBACAC;oBACAC;oBACAC;oBACAoD;kBAAA,EACA;gBACA;kBACA;kBACA,uDACAV;oBACA5C;oBACAC;oBACAC;kBAAA,EACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAvC;gBACA;gBACA,uDACAiF;kBACA5C;kBACAC;kBACAC;gBAAA,EACA;cAAA;gBAAA;gBAEApB;gBAAA;cAAA;gBAAA;gBAAA,OAIA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEAyE;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAzE;kBAAAY;gBAAA;gBAAA;gBAAA;gBAAA,OAEA3H;kBACA2B;kBACApB;oBACA+G;oBACA/G;sBACAgC;sBACAR;sBACA0J;oBACA;kBACA;gBACA;cAAA;gBAVAjE;gBAYA;kBACAkE;kBACA;kBACA;oBAAA;kBAAA;gBACA;kBACA;kBACA;kBACAC;kBACA5E;oBACAY;oBACAsC;oBACAe;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAjE;kBACAY;kBACAsC;gBACA;cAAA;gBAAA;gBAEAlD;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA6E;MACA;IACA;IAEAC;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MAEA;MAEA9E;QACAY;QACAsC;QACAe;MACA;IACA;IAEAc;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MAEA;kBAAA;kBAAA;gBAAA;gBACA/E;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAAA,MAKA;kBAAA;kBAAA;gBAAA;gBACAlD;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAAA,IAGA;kBAAA;kBAAA;gBAAA;gBACAlD;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAlD;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAAA,IAGA;kBAAA;kBAAA;gBAAA;gBACAlD;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAAA,IAGA;kBAAA;kBAAA;gBAAA;gBACAlD;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAlD;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAlD;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAlD;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAlD;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAlD;kBAAAY;kBAAAsC;gBAAA;gBAAA;cAAA;gBAIA;gBACA8B;gBAAA,KACA;kBAAA;kBAAA;gBAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA,MAEA;kBAAA;kBAAA;gBAAA;gBACAhF;kBACAY;kBACAsC;kBACAe;gBACA;gBAAA;cAAA;gBAGAe;gBAAA;gBAAA;cAAA;gBAEA;gBACA;gBACA;gBACA;gBACA;gBACA;cAAA;gBAIA;gBACAhF;kBAAAY;gBAAA;gBAAA;gBAGA;gBACAqE;kBACAtK;kBACAC;kBACAC;kBACAC;kBACAC;kBACAC;kBAAA;kBACAC;kBACAiK;kBACAhK;kBACAC;kBACAE;kBACAC;kBACAC;kBACAG;gBACA,GAEA;gBACA;kBACA;kBACAyJ;kBAEAF;oBACAzJ;oBAAA;oBACA+I;oBAAA;oBACAa;oBACAnE;oBACAoE;oBACA5J;oBACA6J;oBACAC;oBACAvK;oBAAA;oBACAkG;oBACAC;oBACAC;kBACA;;kBAEA;kBACA6D;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;gBACA;gBAAA;gBAAA,OAEAhM;kBACA2B;kBACApB;oBACA+G;oBACA/G;kBACA;gBACA;cAAA;gBANAiH;gBAQA;kBACA;kBACA;kBAEA;oBACA;oBACAT;sBACAY;sBACAsC;sBACAe;oBACA;oBAEAuB;sBACA;sBACA;sBACAxF;wBACAyF;wBACAxB;sBACA;oBACA;kBACA;oBACA;oBACAjE;sBACAY;sBACAsC;oBACA;oBACAsC;sBACA;sBACA;sBACAxF;oBACA;kBACA;gBACA;kBACAA;oBACAY;oBACAsC;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEArE;gBACAmB;kBACAY;kBACAsC;gBACA;cAAA;gBAAA;gBAEA;gBACAlD;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA0F;MACA;MACA;;MAEA;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;;MAEA;MACA;QACA5F;MACA;QACAnB;MACA;MAEAmB;QACAY;QACAsC;QACAe;MACA;IACA;IAEA4B;MACA7F;IACA;IAEA;IACA8F;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEA9F;kBAAAY;gBAAA;;gBAEA;gBACAmF;gBACAC;gBACAC;gBACAC;gBACAC,+DAEA;gBACAnL;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBACAgF;gBACAA;kBAAAY;kBAAAsC;gBAAA;gBACA;gBACA;gBAAA;cAAA;gBAGAkD,uDAEA;gBACA;gBACAC;gBAAA;gBAAA;gBAAA,OAGApN;kBACA2B;kBACApB;oBACA+G;oBACA/G;sBACAwB;sBACAsL;sBACAC;sBACA/F;sBACAgG;oBACA;kBACA;gBACA;cAAA;gBAZA/F;gBAcA;kBACA4F;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAxH;cAAA;gBAAA,MAGAwH;kBAAA;kBAAA;gBAAA;gBACArG;gBACAA;kBACAY;kBACAsC;kBACAe;gBACA;gBAAA;cAAA;gBAIA;gBACAwC;gBACAC,yCAEA;gBACAC;gBAEA3G;;gBAEA;gBACA4G;gBACA5G;kBACA6G;kBACAC;oBACAjI;oBACA;oBACAmB;sBACAxG;sBACA0G;wBACAF;0BACAY;0BACAsC;wBACA;sBACA;oBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEArE;gBACAmB;gBACAA;kBACAY;kBACAsC;kBACAe;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACA8C;MACA;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA;QACAC;QACAC;QACAC;QACAC;MACA;;MAEA;MACAd;QACA;QACA;QACA;QACA;QAEA;UACA;UACA;YAAA;UAAA;UACA;YACAe;UACA;YACAV;cAAA1L;cAAAqM;YAAA;UACA;QACA;QAEA;UACA;UACA;YAAA;UAAA;UACA;YACA;cACA;gBAAA;cAAA;cACA;gBACAC;cACA;gBACAF;kBAAAxM;kBAAAyM;gBAAA;cACA;YACA;YACAD;UACA;YACAV;cACAxH;cACA8H;cACAvN;gBAAAmB;gBAAAyM;cAAA;YACA;UACA;QACA;UACA;UACA;YAAA;UAAA;UACA;YACAD;UACA;YACAV;cACAxH;cACA8H;YACA;UACA;QACA;MACA;;MAEA;MACA;;MAEA;MACA;QACA;UAAA;QAAA;QACAP;QAEA;QACAC;UACA;YACA;YACA;cAAA;YAAA;YACAa;UACA;YACA;YACAA;UACA;QACA;QACAd;MACA;;MAEA;MACA;QACA;UAAA;QAAA;QACAA;QACA;UAAA;QAAA;QACAA;MACA;;MAEA;MACA;QACA;UAAA;QAAA;QACAA;QACA;UAAA;QAAA;QACAA;MACA;MAEA;IACA;IAEA;IACAe;MACA;QACAR;QACAS;QACAC;QACAC;MACA;MAEAtB;QACA;QACA;QAEA;UACAK;QACA;UACAA;QACA;QAEA;UACAA;QACA;MACA;MAEA;IACA;IAEA;IACAkB;MACA;MACA;MACA;MACA;QACA;QACAC;MACA;QACAhJ;MACA;MAEAwH;QACA;QACA,kBACA1G,sBACAA,oBACAA,yBACA;QACA;UACA/E;UACAS;UACAL;UACA8M;UACA5C;UACA2C;QACA;QAEA;UACAE;QACA;UACAC;QACA;MACA;MAEA;QACAf;QACAC;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACv1FA;AAAA;AAAA;AAAA;AAA+/C,CAAgB,+6CAAG,EAAC,C;;;;;;;;;;;ACAnhD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages-sub/clinic/add.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages-sub/clinic/add.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./add.vue?vue&type=template&id=0904e2e0&scoped=true&\"\nvar renderjs\nimport script from \"./add.vue?vue&type=script&lang=js&\"\nexport * from \"./add.vue?vue&type=script&lang=js&\"\nimport style0 from \"./add.vue?vue&type=style&index=0&id=0904e2e0&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0904e2e0\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages-sub/clinic/add.vue\"\nexport default component.exports","export * from \"-!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./add.vue?vue&type=template&id=0904e2e0&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.showComplaintList && _vm.filteredComplaints.length > 0\n  var g1 = _vm.showLocationList && _vm.filteredLocations.length > 0\n  var g2 = _vm.showDiagnosisList && _vm.filteredDiagnosis.length > 0\n  var g3 = _vm.showDiseaseList && _vm.filteredDiseases.length > 0\n  var g4 = _vm.showTreatmentList && _vm.filteredTreatments.length > 0\n  var g5 = _vm.showDrugList && _vm.filteredDrugs.length > 0\n  var g6 = g5 ? _vm.filteredDrugs.length : null\n  var g7 =\n    _vm.showDrugList && _vm.drugSearchText && _vm.filteredDrugs.length === 0\n  var m0 = _vm.selectedBatch\n    ? _vm.formatDate(_vm.selectedBatch.expiryDate)\n    : null\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      _vm.noTipNextTime = !_vm.noTipNextTime\n    }\n    _vm.e1 = function ($event) {\n      _vm.form.gender = \"男\"\n    }\n    _vm.e2 = function ($event) {\n      _vm.form.gender = \"女\"\n    }\n    _vm.e3 = function ($event) {\n      _vm.ageFocus = true\n    }\n    _vm.e4 = function ($event) {\n      _vm.ageFocus = false\n    }\n    _vm.e5 = function ($event) {\n      _vm.showDrugSelector = false\n    }\n    _vm.e6 = function ($event) {\n      _vm.showDrugSelector = false\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        g2: g2,\n        g3: g3,\n        g4: g4,\n        g5: g5,\n        g6: g6,\n        g7: g7,\n        m0: m0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./add.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./add.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"clinic-add\">\n    <scroll-view\n      class=\"clinic-scroll\"\n      scroll-y\n      :scroll-into-view=\"activeFieldId\"\n    >\n    <!-- 顶部标题 -->\n    <view class=\"page-header\">\n      <view class=\"title\">北京欢乐谷医务室</view>\n      <view class=\"subtitle\">门诊登记表</view>\n    </view>\n\n    <!-- 功能按钮区域：选择园区 + 门诊日报 -->\n    <view class=\"top-actions-card\">\n      <view class=\"top-buttons\">\n        <button class=\"top-btn primary\" @tap=\"openLocationSelector\">\n          {{ locationLocked ? '选择园区' : currentLocationLabel }}\n        </button>\n        <button class=\"top-btn ghost\" @tap=\"generateDailyReport\">门诊日报</button>\n      </view>\n    </view>\n\n    <!-- 园区选择提示弹窗（悬浮窗） -->\n    <view v-if=\"showLocationTip\" class=\"location-modal-overlay\">\n      <view class=\"location-modal\">\n        <view class=\"modal-icon-row\">\n          <view class=\"modal-icon-circle\">园</view>\n        </view>\n        <view class=\"modal-title\">请选择当前所在园区</view>\n        <view class=\"modal-subtitle\">当前：{{ currentLocationLabel }}，用于统计门诊登记、日报等数据</view>\n\n        <view class=\"modal-location-buttons\">\n          <button class=\"modal-loc-btn\" :class=\"{ active: form.location === 'land_park' }\" @tap=\"handleLocationSelect('land_park')\">陆园</button>\n          <button class=\"modal-loc-btn\" :class=\"{ active: form.location === 'water_park' }\" @tap=\"handleLocationSelect('water_park')\">水园</button>\n        </view>\n\n        <view class=\"modal-hint-text\">后续可随时通过上方“选择园区”按钮切换，不影响已登记记录。</view>\n\n        <view class=\"modal-row\" @tap=\"noTipNextTime = !noTipNextTime\">\n          <checkbox :checked=\"noTipNextTime\" />\n          <text class=\"modal-checkbox-text\">下次不再提醒</text>\n        </view>\n\n        <button class=\"modal-close-btn\" @tap=\"closeLocationTip\">关闭提示</button>\n      </view>\n    </view>\n\n    <view id=\"field-remark\" class=\"form-section\">\n      <!-- 基本信息 -->\n      <view class=\"section-title\">患者基本信息</view>\n      \n      <!-- 就诊日期时间 + 身份 并排 -->\n      <view class=\"form-row\">\n        <view id=\"field-name\" class=\"form-item half\">\n          <view class=\"label required\">就诊日期时间</view>\n          <view class=\"datetime-display\">{{ form.visitDateTime }}</view>\n        </view>\n        <view class=\"form-item half\">\n          <view class=\"label required\">身份</view>\n          <view class=\"identity-selector\">\n            <view \n              v-for=\"idOpt in identityOptions\"\n              :key=\"idOpt.value\"\n              class=\"identity-item\" \n              :class=\"{ active: form.identity === idOpt.value }\"\n              @click=\"setIdentity(idOpt.value)\"\n            >\n              {{ idOpt.label }}\n            </view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 姓名 + 性别/年龄 -->\n      <view class=\"form-row\">\n        <view class=\"form-item half\">\n          <view class=\"label required\">姓名</view>\n          <input\n            v-model=\"form.name\"\n            type=\"text\"\n            placeholder=\"选园区后输入姓名\"\n            :disabled=\"locationLocked\"\n            cursor-spacing=\"80\"\n          />\n        </view>\n        <view class=\"form-item half\">\n          <view class=\"label required\">性别 / 年龄</view>\n          <view class=\"gender-age-row\">\n            <view class=\"gender-selector compact\">\n              <view \n                class=\"gender-item\" \n                :class=\"{ active: form.gender === '男' }\"\n                @click=\"form.gender = '男'\"\n              >\n                男\n              </view>\n              <view \n                class=\"gender-item\" \n                :class=\"{ active: form.gender === '女' }\"\n                @click=\"form.gender = '女'\"\n              >\n                女\n              </view>\n            </view>\n            <input\n              v-model.number=\"form.age\"\n              type=\"number\"\n              inputmode=\"numeric\"\n              pattern=\"[0-9]*\"\n              :maxlength=\"3\"\n              :focus=\"ageFocus\"\n              @tap=\"ageFocus = true\"\n              @blur=\"ageFocus = false\"\n              confirm-type=\"done\"\n              placeholder=\"年龄\"\n              class=\"age-input\"\n            />\n          </view>\n        </view>\n      </view>\n\n      <!-- 主诉 -->\n      <view id=\"field-chiefComplaint\" class=\"form-item\">\n        <view class=\"label required\">主诉</view>\n        <view class=\"disease-input-wrapper\">\n          <textarea\n            v-model=\"form.chiefComplaint\"\n            placeholder=\"请输入患者自述症状，例如：头部外伤伴头晕\"\n            maxlength=\"100\"\n            :class=\"['textarea-uniform', 'textarea-auto', complaintFontSizeClass]\"\n            :focus=\"complaintFocus\"\n            @focus=\"onComplaintFocus(); onFieldFocus('field-chiefComplaint')\"\n            @input=\"onComplaintInput\"\n            @blur=\"onComplaintBlur\"\n          />\n          <!-- 主诉下拉列表 -->\n          <view v-if=\"showComplaintList && filteredComplaints.length > 0\" class=\"disease-dropdown\">\n            <scroll-view scroll-y class=\"disease-scroll\">\n              <view\n                v-for=\"opt in filteredComplaints\"\n                :key=\"opt.key\"\n                class=\"disease-item\"\n                @click=\"selectComplaint(opt)\"\n              >\n                {{ opt.label }}\n              </view>\n            </scroll-view>\n          </view>\n        </view>\n      </view>\n\n    </view>\n\n    <!-- 就诊信息 -->\n    <view class=\"form-section\">\n      <view class=\"section-title\">就诊信息</view>\n\n      <!-- 是否出诊 + 受伤地点 -->\n      <view class=\"form-row\">\n        <view class=\"form-item half\">\n          <view class=\"label required\">是否出诊</view>\n          <view class=\"identity-selector visit-type-selector\">\n            <view\n              v-for=\"vt in visitTypeOptions\"\n              :key=\"vt.value\"\n              class=\"identity-item\"\n              :class=\"{ active: form.visitType === vt.value }\"\n              @click=\"setVisitType(vt.value)\"\n            >\n              <text class=\"visit-type-text\">{{ vt.label }}</text>\n            </view>\n          </view>\n        </view>\n        <view class=\"form-item half\">\n          <view class=\"label\" :class=\"{ required: form.visitType === 'outcall' }\">受伤地点</view>\n          <view class=\"location-input-wrapper\">\n            <input\n              v-model=\"form.injuryLocation\"\n              type=\"text\"\n              :placeholder=\"form.visitType === 'outcall' ? '请输入受伤地点（必填）' : '例如：机动游戏区、餐饮区（可选）'\"\n              class=\"input-uniform\"\n              @focus=\"onLocationFocus(); onFieldFocus('field-injuryLocation')\"\n              @input=\"onLocationInput\"\n            />\n            <!-- 地点下拉列表 -->\n            <view v-if=\"showLocationList && filteredLocations.length > 0\" class=\"location-dropdown\">\n              <scroll-view scroll-y class=\"location-scroll\">\n                <view\n                  v-for=\"loc in filteredLocations\"\n                  :key=\"loc\"\n                  class=\"location-item\"\n                  @click=\"selectLocationFromList(loc)\"\n                >\n                  {{ loc }}\n                </view>\n              </scroll-view>\n            </view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 诊断 -->\n      <view class=\"form-item\">\n        <view class=\"label required\">诊断</view>\n        <view class=\"disease-input-wrapper\">\n          <textarea\n            v-model=\"form.diagnosis\"\n            placeholder=\"请输入初步诊断结果，例如：轻度头部挫伤\"\n            maxlength=\"100\"\n            :class=\"['textarea-uniform', 'textarea-auto', diagnosisFontSizeClass]\"\n            @focus=\"onDiagnosisFocus(); onFieldFocus('field-diagnosis')\"\n            @input=\"onDiagnosisInput\"\n          />\n          <view v-if=\"showDiagnosisList && filteredDiagnosis.length > 0\" class=\"disease-dropdown\">\n            <scroll-view scroll-y class=\"disease-scroll\">\n              <view \n                v-for=\"it in filteredDiagnosis\" \n                :key=\"it\"\n                class=\"disease-item\"\n                @click=\"selectDiagnosis(it)\"\n              >\n                {{ it }}\n              </view>\n            </scroll-view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 症状 -->\n      <view class=\"form-item\">\n        <view class=\"label\">症状</view>\n        <view class=\"disease-input-wrapper\">\n          <textarea\n            v-model=\"form.symptom\"\n            placeholder=\"可记录体征/检查所见等补充症状信息（可选）\"\n            maxlength=\"150\"\n            class=\"textarea-uniform textarea-auto\"\n            @focus=\"onFieldFocus('field-symptom')\"\n          />\n        </view>\n      </view>\n\n      <!-- 疾病名称（带下拉列表） -->\n      <view class=\"form-item\">\n        <view class=\"label required\">疾病名称</view>\n        <view class=\"disease-input-wrapper\">\n          <input\n            v-model=\"form.diseaseName\" \n            type=\"text\" \n            placeholder=\"例如：感冒、外伤、中暑等\"\n            @input=\"onDiseaseInput\"\n            @focus=\"onDiseaseFocus(); onFieldFocus('field-diseaseName')\"\n            @blur=\"onDiseaseBlur\"\n            class=\"input-uniform\"\n          />\n          <!-- 疾病下拉列表 -->\n          <view v-if=\"showDiseaseList && filteredDiseases.length > 0\" class=\"disease-dropdown\">\n            <scroll-view scroll-y class=\"disease-scroll\">\n              <view \n                v-for=\"disease in filteredDiseases\" \n                :key=\"disease\"\n                class=\"disease-item\"\n                @click=\"selectDisease(disease)\"\n              >\n                {{ disease }}\n              </view>\n            </scroll-view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 处置 -->\n      <view class=\"form-item\">\n        <view class=\"label required\">处置</view>\n        <view class=\"disease-input-wrapper\">\n          <textarea\n            v-model=\"form.treatment\"\n            placeholder=\"请输入处理措施，例如：伤口清洗消毒、冷敷\"\n            maxlength=\"120\"\n            class=\"textarea-uniform textarea-auto\"\n            @focus=\"onTreatmentFocus(); onFieldFocus('field-treatment')\"\n            @input=\"onTreatmentInput\"\n          ></textarea>\n          <view v-if=\"showTreatmentList && filteredTreatments.length > 0\" class=\"disease-dropdown\">\n            <scroll-view scroll-y class=\"disease-scroll\">\n              <view \n                v-for=\"it in filteredTreatments\" \n                :key=\"it\"\n                class=\"disease-item\"\n                @click=\"selectTreatment(it)\"\n              >\n                {{ it }}\n              </view>\n            </scroll-view>\n          </view>\n        </view>\n      </view>\n      </view>\n\n    <!-- 用药信息 -->\n    <view class=\"form-section\">\n      <view class=\"section-title\">用药信息（可选）</view>\n\n      <!-- 药材选择 - 只手动输入 -->\n      <view class=\"form-item\">\n        <view class=\"label\">药材名称</view>\n        <view class=\"drug-input-wrapper\">\n          <input \n            v-model=\"drugSearchText\" \n            type=\"text\" \n            placeholder=\"点击查看所有药材或输入搜索\"\n            @input=\"onDrugSearch\"\n            @focus=\"onDrugInputFocus\"\n            class=\"input-uniform\"\n          />\n          <!-- 下拉列表 -->\n          <view v-if=\"showDrugList && filteredDrugs.length > 0\" class=\"drug-dropdown\">\n            <view class=\"dropdown-header\">\n              <text class=\"dropdown-title\">{{ form.location === 'land_park' ? '陆园' : '水园' }}库存药材</text>\n              <text class=\"dropdown-count\">({{ filteredDrugs.length }}种)</text>\n            </view>\n            <scroll-view scroll-y class=\"drug-scroll\">\n              <view \n                v-for=\"drug in filteredDrugs\" \n                :key=\"drug._id\"\n                class=\"drug-item\"\n                @click=\"selectDrugFromList(drug)\"\n              >\n                <view class=\"drug-name\">{{ drug.name }}</view>\n                <view class=\"drug-spec\">{{ drug.specification }}</view>\n              </view>\n            </scroll-view>\n          </view>\n          <!-- 无结果提示 -->\n          <view v-if=\"showDrugList && drugSearchText && filteredDrugs.length === 0\" class=\"no-result\">\n            未找到匹配的药材\n          </view>\n        </view>\n        <view v-if=\"selectedDrug\" class=\"drug-info\">\n          <text class=\"spec\">{{ selectedDrug.name }} - {{ selectedDrug.specification }}</text>\n          <text class=\"stock\">\n            {{ form.location === 'land_park' ? '陆园' : '水园' }}库存：{{ availableStock }} {{ selectedDrug.minUnit }}\n          </text>\n        </view>\n      </view>\n\n      <!-- 用药信息核心展示 - 快速登记版 -->\n      <view v-if=\"selectedDrug\" class=\"drug-quick-info\">\n        <!-- 药材名称大卡片 -->\n        <view class=\"drug-name-card\">\n          <view class=\"drug-details\">\n            <view class=\"drug-main-name\">{{ selectedDrug.name }}</view>\n            <view class=\"drug-spec-text\">{{ selectedDrug.specification }}</view>\n          </view>\n        </view>\n        \n        <!-- 快速信息栏 -->\n        <view class=\"quick-info-bar\">\n          <view class=\"info-tag park-tag\">\n            <text class=\"tag-text\">{{ form.location === 'land_park' ? '陆园' : '水园' }}</text>\n          </view>\n          <view class=\"info-tag stock-tag\" :class=\"{ 'stock-warning': availableStock < 10 }\">\n            <text class=\"tag-text\">库存 {{ availableStock }} {{ selectedDrug.minUnit }}</text>\n          </view>\n          <view class=\"info-tag unit-tag\">\n            <text class=\"tag-text\">{{ selectedDrug.minUnit }}</text>\n          </view>\n        </view>\n        \n        <!-- 数量输入大卡片 -->\n        <view class=\"quantity-card\">\n          <view class=\"quantity-label\">\n            <text class=\"label-text\">用药数量</text>\n            <text class=\"required-star\">*</text>\n          </view>\n          <view class=\"quantity-input-wrapper\">\n            <input\n              v-model.number=\"form.quantity\"\n              type=\"number\"\n              :placeholder=\"'请输入数量'\"\n              class=\"quantity-input-large\"\n            />\n            <view class=\"quantity-unit-display\">{{ selectedDrug.minUnit }}</view>\n          </view>\n          <!-- 库存不足警告 -->\n          <view v-if=\"form.quantity > availableStock\" class=\"quantity-warning\">\n            <text class=\"warning-text\">库存不足！当前库存：{{ availableStock }} {{ selectedDrug.minUnit }}</text>\n          </view>\n        </view>\n      </view>\n\n      <!-- 批次信息（自动FIFO） -->\n      <view v-if=\"selectedBatch\" class=\"batch-info\">\n        <view class=\"batch-item\">\n          <text class=\"label\">批次号：</text>\n          <text>{{ selectedBatch.batch }}</text>\n        </view>\n        <view class=\"batch-item\">\n          <text class=\"label\">有效期：</text>\n          <text>{{ formatDate(selectedBatch.expiryDate) }}</text>\n          <text v-if=\"selectedBatch.daysToExpiry <= 60\" class=\"warning\">\n            （{{ selectedBatch.daysToExpiry }}天后到期）\n          </text>\n        </view>\n        <view class=\"batch-item\">\n          <text class=\"label\">剩余库存：</text>\n          <text>{{ selectedBatch.quantity }} {{ selectedDrug.minUnit }}</text>\n        </view>\n      </view>\n    </view>\n\n    <!-- 备注 -->\n    <view class=\"form-section\">\n      <view class=\"section-title\">备注</view>\n      <view class=\"form-item\">\n        <textarea\n          v-model=\"form.remark\"\n          placeholder=\"其他说明或建议（可选）\"\n          maxlength=\"200\"\n          class=\"textarea-uniform textarea-auto\"\n          @focus=\"onFieldFocus('field-remark')\"\n        ></textarea>\n      </view>\n    </view>\n\n    <!-- 接诊医生签名 -->\n    <view class=\"form-section\">\n      <view class=\"section-title\">接诊医生签名</view>\n        <view class=\"signature-info\">\n          <view class=\"signature-tip\">\n          <text class=\"tip-text\">请医生在下方签名确认本次就诊信息</text>\n        </view>\n      </view>\n      <view class=\"signature-section\">\n        <view class=\"signature-label-row\">\n          <view class=\"signature-label\">医生签名</view>\n          <text class=\"required\">*</text>\n        </view>\n        <Signature\n          v-model=\"form.doctorSign\"\n          title=\"医生签名\"\n          @change=\"onDoctorSignChange\"\n        />\n        <view v-if=\"form.signTime\" class=\"signature-time\">\n          签名时间：{{ form.signTime }}\n        </view>\n      </view>\n    </view>\n\n    <!-- 继续登记选项 -->\n    <view class=\"continue-option\">\n      <view class=\"continue-card\" @click=\"toggleContinue\">\n        <view class=\"continue-checkbox\">\n          <checkbox :checked=\"continueAfterSubmit\" />\n        </view>\n        <view class=\"continue-text\">\n          <view class=\"continue-title\">连续登记模式</view>\n          <view class=\"continue-desc\">提交后自动清空表单，继续登记下一位患者</view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 药材选择器 -->\n    <drug-selector\n      v-if=\"showDrugSelector\"\n      @select=\"onDrugSelect\"\n      @close=\"showDrugSelector = false\"\n    />\n\n    </scroll-view>\n\n    <!-- 提交按钮 -->\n    <view class=\"submit-section\">\n      <button class=\"cancel-btn\" @click=\"goBack\">取消</button>\n      <button class=\"submit-btn\" :loading=\"submitting\" @click=\"handleSubmit\">\n        保存\n      </button>\n    </view>\n\n    <!-- 继续登记选项 -->\n    <view class=\"continue-option\">\n      <view class=\"continue-card\" @click=\"toggleContinue\">\n        <view class=\"continue-checkbox\">\n          <checkbox :checked=\"continueAfterSubmit\" />\n        </view>\n        <view class=\"continue-text\">\n          <view class=\"continue-title\">连续登记模式</view>\n          <view class=\"continue-desc\">提交后自动清空表单，继续登记下一位患者</view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 药材选择器 -->\n    <drug-selector\n      v-if=\"showDrugSelector\"\n      @select=\"onDrugSelect\"\n      @close=\"showDrugSelector = false\"\n    />\n\n  </view>\n</template>\n\n<script>\nimport Signature from '@/components/signature/index.vue';\n\nexport default {\n  components: {\n    Signature\n  },\n  data() {\n    return {\n      locations: [\n        { label: '陆园', value: 'land_park' },\n        { label: '水园', value: 'water_park' }\n      ],\n      identityOptions: [\n        { label: '游客', value: '游客' },\n        { label: '员工', value: '员工' }\n      ],\n      visitTypeOptions: [\n        { label: '否', value: 'clinic' },\n        { label: '是', value: 'outcall' }\n      ],\n      // 疾病→诊断与处置模板\n      diseaseTemplates: {\n        '扭伤': ['踝关节扭伤','腕关节扭伤','膝关节扭伤','肩关节扭伤','颈部肌肉拉伤','腰部肌筋膜拉伤','外侧副韧带拉伤'],\n        '擦伤': ['皮肤表浅擦伤','肘部擦伤','膝部擦伤','手掌擦伤','面部擦伤','小腿擦伤','躯干擦伤'],\n        '烫伤': ['Ⅰ度热烫伤','手部轻度烫伤','前臂轻度烫伤','躯干轻度烫伤','热液烫伤（表浅）','蒸汽烫伤（表浅）'],\n        '磕伤': ['软组织挫伤','头皮挫伤','膝部挫伤','前臂挫伤','小腿挫伤','肩部挫伤','足背挫伤'],\n        '冻伤': ['末端轻度冻伤','面部轻度冻伤','手指冻伤（表浅）','耳廓冻伤（表浅）','足趾冻伤（表浅）'],\n        '腹泻': ['急性胃肠炎','受凉所致腹泻','饮食不洁所致腹泻','功能性腹泻','旅游者腹泻'],\n        '头晕': ['体位性低血压','中暑轻型后遗症','疲劳性头晕','低血糖相关头晕','颈源性头晕可能'],\n        '头痛': ['紧张性头痛','外伤后轻度头痛','偏头痛样头痛（既往史）','感冒相关头痛','鼻窦炎相关头痛可能'],\n        '感冒': ['上呼吸道感染（轻）','风寒感冒','暑湿感冒','咽喉炎伴感冒','腺样体样症状可能'],\n        '脱臼': ['手指小关节脱位（已复位）','肩关节轻度半脱位（建议转诊）','髌骨半脱位可能'],\n        '骨折': ['疑似骨折（建议影像学检查）','手指末节疑似骨折','前臂疑似骨折','锁骨疑似骨折'],\n        '过敏': ['荨麻疹样皮疹','接触性皮炎','虫咬后过敏反应','花粉过敏样反应','食物相关过敏可能'],\n        '痛经': ['原发性痛经','寒凝血瘀型痛经','气滞血瘀型痛经'],\n        '测血压': ['血压偏高待复测','血压偏低伴轻度头晕','血压正常记录观察'],\n        '其他': ['一般外伤处理','非特异性不适，建议观察','情绪紧张相关不适']\n      },\n      treatmentTemplates: {\n        '扭伤': ['冷敷+弹性绷带加压包扎','制动抬高24-48h','必要时外固定并转诊','48小时后热敷功能锻炼'],\n        '擦伤': ['清创冲洗（盐水/3%双氧水）','碘伏消毒+无菌敷贴','必要时外用湿润烧伤膏','换药观察渗出感染'],\n        '烫伤': ['冷水冲洗15-20分钟','碘伏/湿润烧伤膏外用','无菌敷贴覆盖','避免刺破水疱并观察'],\n        '磕伤': ['局部冷敷+弹力绷带','碘伏消毒处理','必要时观察肿胀变化','超过48小时改热敷促进吸收'],\n        '冻伤': ['温水复温（37-40℃）','干燥保暖与保护','避免摩擦与再次受冷','必要时外用保护性敷贴'],\n        '腹泻': ['口服补液/葡萄糖粉剂一次','饮食清淡+观察','必要时解痉止泻','注意补盐与复诊提示'],\n        '头晕': ['测血压、观察休息','口服葡萄糖粉剂一次','必要时对症处理','避免剧烈运动与久站'],\n        '头痛': ['对症止痛（布洛芬一次）','补液与休息','观察诱因与复诊建议','避免强光久屏使用'],\n        '感冒': ['藿香正气水一次','对症退热镇痛（布洛芬一次）','多饮水休息','含服草珊瑚/板蓝根冲剂'],\n        '脱臼': ['制动固定+冷敷','建议影像学及专科处理','避免自行反复活动'],\n        '骨折': ['制动固定+冷敷','立即转诊影像学检查','必要时止痛处理'],\n        '过敏': ['口服氯雷他定一次','外用红肿冷敷','观察呼吸道症状','避免继续接触可疑过敏原'],\n        '痛经': ['热敷腹部、休息','必要时对症解痉','注意保暖与规律作息'],\n        '测血压': ['复测并记录','异常者建议随访或转诊','生活方式指导'],\n        '其他': ['对症观察+健康教育','必要时随访']\n      },\n      // 主诉（症状）模板\n      complaintTemplates: {\n        '扭伤': '扭伤后局部疼痛肿胀，活动受限',\n        '擦伤': '皮肤表浅擦伤，轻度渗血/疼痛',\n        '烫伤': '热液/蒸汽烫伤，局部红肿灼痛',\n        '磕伤': '碰撞致局部疼痛肿胀',\n        '冻伤': '受寒后局部麻木疼痛，皮肤颜色改变',\n        '腹泻': '近一天腹泻多次，伴轻度腹痛/乏力',\n        '头晕': '阵发性头晕，伴乏力/站立不稳',\n        '头痛': '持续性头痛，紧张诱发明显',\n        '感冒': '咳嗽流涕咽痛，乏力/低热',\n        '脱臼': '外伤后关节畸形疼痛，活动受限',\n        '骨折': '外伤后局部肿胀疼痛，活动受限',\n        '过敏': '全身/局部皮疹瘙痒，接触史阳性',\n        '痛经': '经期下腹阵发性疼痛',\n        '测血压': '测血压复查，无明显不适',\n        '中暑': '户外暴晒后头晕乏力出汗增多',\n        '咽喉痛': '咽部疼痛，吞咽不适',\n        '皮疹': '皮疹伴瘙痒，抓挠后加重',\n        '牙痛': '患牙疼痛，冷热刺激明显',\n        '关节痛': '关节活动痛，活动后加重'\n      },\n      // 注意事项/复诊提示（按疾病自动附加到处置）\n      treatmentCautions: {\n        '腹泻': [\n          '补液：小口频饮，注意补盐',\n          '清淡饮食，避免油腻辛辣',\n          '48小时未缓解或伴高热/血便请及时复诊'\n        ],\n        '头晕': [\n          '休息，避免久站/剧烈运动',\n          '监测血压与症状变化',\n          '症状持续或加重请复诊'\n        ],\n        '头痛': [\n          '注意休息与补水',\n          '减少长时间屏幕与强光刺激',\n          '频繁发作或伴呕吐/视物模糊请复诊'\n        ],\n        '感冒': [\n          '多饮水休息，注意保暖与口罩礼仪',\n          '对症用药后观察',\n          '发热＞38.5℃或持续超过3天请复诊'\n        ]\n      },\n      // 结构化疾病模板库：每个疾病下多条主诉，每条主诉有独立的症状/诊断/处置\n      // 后续可以扩展 drugs 字段\n      diseaseTemplateLib: {\n        '感冒': [\n          {\n            complaint: '咳嗽流涕咽痛，伴乏力低热',\n            symptoms: [\n              '近1～2日出现咳嗽、流涕、咽痛，体温不高于38.5℃',\n              '伴轻度乏力，无明显呼吸困难'\n            ],\n            diagnoses: [\n              '上呼吸道感染（轻型）',\n              '病毒性上呼吸道感染可能'\n            ],\n            treatments: [\n              '多饮水休息，注意保暖',\n              '口服对症药物（如退热镇痛药）',\n              '观察体温及症状变化，必要时复诊'\n            ]\n          },\n          {\n            complaint: '受凉后出现流涕咳嗽、咽痛，伴头痛乏力',\n            symptoms: [\n              '受凉后出现流涕、咳嗽、咽痛约1日',\n              '伴头痛乏力，无胸闷气促'\n            ],\n            diagnoses: [\n              '风寒感冒',\n              '急性上呼吸道感染'\n            ],\n            treatments: [\n              '口服感冒药物一次，注意用药间隔',\n              '注意保暖，减少户外暴露',\n              '嘱如体温持续升高或症状加重及时就诊'\n            ]\n          },\n          {\n            complaint: '游玩途中出现流涕、喷嚏、轻度咳嗽，伴乏力',\n            symptoms: [\n              '游玩途中出现流涕、喷嚏，偶有轻度咳嗽',\n              '体温基本正常或轻度升高'\n            ],\n            diagnoses: [\n              '普通感冒',\n              '上呼吸道感染待排'\n            ],\n            treatments: [\n              '暂时减少剧烈项目，多饮温水',\n              '根据需要给予含片或口服感冒药',\n              '嘱观察症状，如发热明显或精神状态差需就诊'\n            ]\n          }\n        ],\n        '扭伤': [\n          {\n            complaint: '行走时不慎扭伤踝关节，局部肿胀疼痛，活动受限',\n            symptoms: [\n              '踝关节局部肿胀疼痛，活动受限',\n              '皮肤完整，无明显畸形'\n            ],\n            diagnoses: [\n              '踝关节软组织扭伤',\n              '韧带拉伤可能'\n            ],\n            treatments: [\n              '24小时内局部冷敷',\n              '弹力绷带加压包扎，减少负重',\n              '抬高患肢，必要时转诊影像学检查'\n            ]\n          },\n          {\n            complaint: '运动时扭伤膝关节，行走困难',\n            symptoms: [\n              '膝关节局部肿胀疼痛，行走时加重',\n              '关节活动受限'\n            ],\n            diagnoses: [\n              '膝关节扭伤',\n              '内侧副韧带拉伤可能'\n            ],\n            treatments: [\n              '局部冷敷、制动休息',\n              '建议影像学检查，必要时转诊',\n              '避免剧烈运动及负重行走'\n            ]\n          },\n          {\n            complaint: '玩项目时不慎扭伤腕关节，局部疼痛肿胀',\n            symptoms: [\n              '腕关节局部压痛、轻度肿胀',\n              '活动时疼痛加重，静息时稍缓解'\n            ],\n            diagnoses: [\n              '腕关节软组织扭伤'\n            ],\n            treatments: [\n              '局部冷敷，抬高患肢',\n              '弹力绷带适度加压固定',\n              '嘱避免提重物，如疼痛明显或活动受限加重及时复诊'\n            ]\n          }\n        ],\n        '擦伤': [\n          {\n            complaint: '玩耍时摔倒致膝部皮肤擦伤，伴轻度渗血疼痛',\n            symptoms: [\n              '膝部皮肤表浅擦伤，少量渗血',\n              '局部疼痛，无明显肿胀'\n            ],\n            diagnoses: [\n              '膝部皮肤表浅擦伤'\n            ],\n            treatments: [\n              '清水/生理盐水冲洗创面',\n              '碘伏消毒后无菌敷贴覆盖',\n              '交代保持创面清洁干燥，观察感染迹象'\n            ],\n            suggestDrugs: ['碘伏', '无菌敷贴', '海诺创可贴']\n          },\n          {\n            complaint: '活动时摔倒致手掌擦伤，局部疼痛',\n            symptoms: [\n              '手掌皮肤表浅擦伤，少量渗血或渗液',\n              '局部疼痛，活动基本自如'\n            ],\n            diagnoses: [\n              '手掌皮肤表浅擦伤'\n            ],\n            treatments: [\n              '冲洗清洁创面',\n              '碘伏消毒后覆以创可贴或无菌敷贴',\n              '嘱避免频繁摩擦及浸水'\n            ],\n            suggestDrugs: ['碘伏', '海诺创可贴']\n          },\n          {\n            complaint: '滑倒致肘部擦伤，局部疼痛伴少量渗血',\n            symptoms: [\n              '肘部局部表浅皮肤擦伤，少量渗血或结痂',\n              '关节活动基本自如，可有轻微牵拉痛'\n            ],\n            diagnoses: [\n              '肘部皮肤表浅擦伤'\n            ],\n            treatments: [\n              '生理盐水或清水冲洗创面',\n              '碘伏消毒后敷贴无菌敷料',\n              '嘱保持伤口清洁干燥，避免剧烈活动'\n            ]\n          }\n        ],\n        '烫伤': [\n          {\n            complaint: '被热饮不慎泼洒致手部局部红肿灼痛',\n            symptoms: [\n              '手背/手掌局部皮肤潮红、水肿',\n              '疼痛明显，无大疱或少量小疱'\n            ],\n            diagnoses: [\n              '手部表浅Ⅰ度热烫伤'\n            ],\n            treatments: [\n              '流动冷水冲洗15～20分钟',\n              '外用湿润烧伤膏或同类药物',\n              '无菌敷料覆盖，嘱避免刺破水疱'\n            ],\n            suggestDrugs: ['湿润烧伤膏', '无菌敷贴']\n          },\n          {\n            complaint: '接触热汤/蒸汽后前臂烫伤，局部红肿疼痛',\n            symptoms: [\n              '前臂局部皮肤潮红，轻度水肿',\n              '疼痛明显，部分可见小疱'\n            ],\n            diagnoses: [\n              '前臂表浅热烫伤'\n            ],\n            treatments: [\n              '及时冷水冲洗降温',\n              '局部外用烧伤药物并覆盖敷料',\n              '交代观察感染迹象，如红肿加重及时复诊'\n            ]\n          },\n          {\n            complaint: '不慎接触热锅边缘致手指局部烫伤',\n            symptoms: [\n              '手指局部皮肤潮红或轻度水疱',\n              '局部灼痛明显，活动基本不受限'\n            ],\n            diagnoses: [\n              '手指轻度热烫伤'\n            ],\n            treatments: [\n              '冷水冲洗患处10～15分钟',\n              '外用湿润烧伤膏或同类药物',\n              '避免刺破水疱，注意保持患处清洁'\n            ]\n          }\n        ],\n        '中暑': [\n          {\n            complaint: '户外排队久站后出现头晕乏力出汗增多',\n            symptoms: [\n              '在高温环境中活动后出现头晕、乏力、出汗增多',\n              '皮肤潮红或湿冷，口渴'\n            ],\n            diagnoses: [\n              '中暑轻型'\n            ],\n            treatments: [\n              '转移至阴凉通风处休息',\n              '口服补液或葡萄糖溶液',\n              '物理降温（冷敷额头、颈部等）',\n              '观察症状变化，如加重及时转诊'\n            ],\n            suggestDrugs: ['藿香正气水', '葡萄糖粉剂']\n          },\n          {\n            complaint: '在阳光下玩耍后感到头痛、恶心、全身乏力',\n            symptoms: [\n              '户外暴晒后出现头痛、恶心、乏力',\n              '部分伴有轻度心悸'\n            ],\n            diagnoses: [\n              '中暑样反应'\n            ],\n            treatments: [\n              '立即脱离高温环境，卧床休息',\n              '口服补液，必要时给予对症药物',\n              '嘱家属/同伴观察，如出现意识改变立即送医'\n            ]\n          }\n        ],\n        '腹泻': [\n          {\n            complaint: '进食冷饮或不洁食物后出现腹泻，多次稀便',\n            symptoms: [\n              '近1日多次稀便，伴轻度腹痛',\n              '无明显高热或严重脱水表现'\n            ],\n            diagnoses: [\n              '急性胃肠炎（轻型）'\n            ],\n            treatments: [\n              '口服补液盐/葡萄糖溶液，小口多次',\n              '暂避油腻辛辣及生冷饮食',\n              '观察体温及大便次数，症状加重时及时就诊'\n            ],\n            suggestDrugs: ['诺氟沙星胶囊', '藿香正气水']\n          },\n          {\n            complaint: '游玩期间出现腹泻伴轻度腹痛乏力',\n            symptoms: [\n              '反复稀便，腹部隐痛或阵发性腹痛',\n              '伴乏力，食欲下降'\n            ],\n            diagnoses: [\n              '功能性腹泻可能',\n              '消化不良'\n            ],\n            treatments: [\n              '建议口服补液，注意休息',\n              '清淡饮食，避免刺激性食物',\n              '如出现血便、高热等需尽快就诊'\n            ]\n          }\n        ],\n        '过敏': [\n          {\n            complaint: '接触不明物后出现全身皮疹瘙痒',\n            symptoms: [\n              '全身或局部出现红色丘疹/风团样皮疹',\n              '瘙痒明显，无呼吸困难'\n            ],\n            diagnoses: [\n              '荨麻疹样皮疹',\n              '过敏反应'\n            ],\n            treatments: [\n              '口服抗组胺药一次',\n              '局部可外用止痒药物',\n              '避免继续接触可疑过敏原，观察症状变化'\n            ],\n            suggestDrugs: ['氯雷他定片（开瑞坦）']\n          },\n          {\n            complaint: '虫咬后局部红肿瘙痒不适',\n            symptoms: [\n              '局部红肿、皮疹，瘙痒明显',\n              '一般全身情况尚可'\n            ],\n            diagnoses: [\n              '虫咬性皮炎'\n            ],\n            treatments: [\n              '局部冷敷或外用止痒药膏',\n              '必要时口服抗过敏药',\n              '嘱避免搔抓，观察有无加重或全身反应'\n            ]\n          },\n          {\n            complaint: '食用某种食物后出现口唇轻度肿胀瘙痒',\n            symptoms: [\n              '食用可疑食物后短时间内出现口周或口唇轻度肿胀、瘙痒',\n              '无明显呼吸困难或胸闷气促'\n            ],\n            diagnoses: [\n              '食物相关轻度过敏反应'\n            ],\n            treatments: [\n              '口服抗组胺药一次',\n              '暂避可疑食物，嘱观察症状变化',\n              '如出现呼吸困难、胸闷或全身症状需立即就医'\n            ]\n          }\n        ],\n        '头晕': [\n          {\n            complaint: '在园区内长时间排队后出现头晕乏力',\n            symptoms: [\n              '长时间站立或排队后感到头晕、眼前发黑',\n              '伴轻度乏力，平卧休息后好转'\n            ],\n            diagnoses: [\n              '体位性低血压可能',\n              '疲劳相关头晕'\n            ],\n            treatments: [\n              '协助平卧或半卧休息',\n              '口服葡萄糖溶液或温水',\n              '嘱缓慢起身，短期内避免剧烈项目'\n            ]\n          },\n          {\n            complaint: '天气炎热时活动后出现头晕伴出汗乏力',\n            symptoms: [\n              '在高温环境下活动后出现头晕、乏力、大量出汗',\n              '皮肤潮红或湿冷，口渴'\n            ],\n            diagnoses: [\n              '中暑轻型',\n              '高温相关不适'\n            ],\n            treatments: [\n              '转移至阴凉通风处休息',\n              '口服补液盐或葡萄糖溶液',\n              '适当物理降温，观察症状变化'\n            ]\n          }\n        ],\n        '头痛': [\n          {\n            complaint: '久看手机或屏幕后出现头痛、眼胀',\n            symptoms: [\n              '长时间使用电子屏幕后出现额部或双侧头痛',\n              '伴眼胀、颈部酸痛，休息后可缓解'\n            ],\n            diagnoses: [\n              '紧张性头痛',\n              '视疲劳相关头痛'\n            ],\n            treatments: [\n              '建议暂时远离屏幕，闭目休息',\n              '根据需要口服对症止痛药一次',\n              '注意补水与颈肩放松练习'\n            ]\n          },\n          {\n            complaint: '户外活动后出现搏动性头痛，伴轻度恶心',\n            symptoms: [\n              '一侧或双侧搏动样头痛',\n              '可伴恶心、对强光和噪声敏感'\n            ],\n            diagnoses: [\n              '偏头痛样头痛可能'\n            ],\n            treatments: [\n              '安排在安静、光线柔和环境休息',\n              '根据情况口服止痛药物一次',\n              '如反复发作或伴有神经系统症状建议进一步检查'\n            ]\n          }\n        ],\n\n        // 低血糖相关\n        '低血糖': [\n          {\n            complaint: '空腹游玩后出现心慌出汗手抖',\n            symptoms: [\n              '长时间未进食后出现心慌、出冷汗、手抖',\n              '可伴轻度头晕、乏力'\n            ],\n            diagnoses: [\n              '低血糖样反应',\n              '空腹相关低血糖可能'\n            ],\n            treatments: [\n              '立即口服含糖饮料或葡萄糖溶液',\n              '短期观察症状变化，缓解后继续补充少量主食',\n              '提醒避免长时间空腹进行高强度活动，如症状不缓解建议就医'\n            ],\n            suggestDrugs: ['葡萄糖粉剂']\n          },\n          {\n            complaint: '测血糖结果偏低，伴头晕乏力',\n            symptoms: [\n              '血糖监测结果低于正常范围',\n              '伴有乏力、头晕、出汗等不适'\n            ],\n            diagnoses: [\n              '低血糖发作（轻型）'\n            ],\n            treatments: [\n              '立即补充糖分，口服葡萄糖或含糖饮料',\n              '复测血糖并观察症状变化',\n              '有糖尿病等基础疾病者建议回原随访医院评估用药'\n            ]\n          }\n        ],\n\n        // 发作/癫痫/晕厥相关\n        '发作': [\n          {\n            complaint: '既往有癫痫史，本次在园区内出现抽搐发作',\n            symptoms: [\n              '突发意识障碍，伴四肢抽动',\n              '发作后短暂嗜睡或意识模糊'\n            ],\n            diagnoses: [\n              '癫痫发作（既往癫痫史）'\n            ],\n            treatments: [\n              '发作期注意头偏向一侧，防止误吸，勿强行按压肢体',\n              '发作停止后侧卧位休息，保持呼吸道通畅',\n              '建议尽快联系家属并由神经专科进一步评估'\n            ]\n          },\n          {\n            complaint: '无明确既往史，本次突发抽搐样发作伴短暂意识丧失',\n            symptoms: [\n              '短暂意识障碍或意识丧失',\n              '四肢不自主抽动，事后记忆不清'\n            ],\n            diagnoses: [\n              '癫痫样发作待排'\n            ],\n            treatments: [\n              '发作期注意安全保护，防止跌落伤及头面部',\n              '发作后注意生命体征监测',\n              '建议尽快转诊神经专科完善检查'\n            ]\n          },\n          {\n            complaint: '短暂晕倒后自行苏醒，无持续神经功能缺损',\n            symptoms: [\n              '突发短暂意识丧失，倒地后很快清醒',\n              '事后可伴轻度乏力或头晕'\n            ],\n            diagnoses: [\n              '不明原因晕厥待排'\n            ],\n            treatments: [\n              '平卧抬高下肢，监测血压和心率',\n              '建议行心电图及相关检查',\n              '如反复发作或伴胸痛气促等症状应尽快就医'\n            ]\n          }\n        ],\n\n        // 测量/监测类\n        '测量监测': [\n          {\n            complaint: '因自觉不适前来测量血压',\n            symptoms: [\n              '主诉头晕、心慌或乏力等症状',\n              '血压监测结果在正常范围或略有波动'\n            ],\n            diagnoses: [\n              '血压监测（结果正常）'\n            ],\n            treatments: [\n              '记录血压结果，建议保持良好作息',\n              '如反复出现不适或血压明显波动，建议门诊随访'\n            ]\n          },\n          {\n            complaint: '因头晕来测血压，结果偏高',\n            symptoms: [\n              '血压监测结果偏高，伴轻度不适',\n              '可有头晕、头胀或耳鸣'\n            ],\n            diagnoses: [\n              '血压监测（结果偏高）',\n              '血压偏高待复测'\n            ],\n            treatments: [\n              '建议安静休息后复测血压',\n              '如多次测量均偏高，建议至门诊进一步评估',\n              '注意饮食和作息管理'\n            ]\n          },\n          {\n            complaint: '因乏力、心慌等不适来测血糖',\n            symptoms: [\n              '血糖监测结果偏低',\n              '伴有乏力、头晕、手抖等低血糖相关症状'\n            ],\n            diagnoses: [\n              '血糖监测（结果偏低）',\n              '低血糖样反应'\n            ],\n            treatments: [\n              '口服含糖饮料或葡萄糖溶液',\n              '短期内避免再次空腹高强度活动',\n              '如症状不缓解或反复发作应尽快就医'\n            ],\n            suggestDrugs: ['葡萄糖粉剂']\n          }\n        ],\n\n        // 劳损/慢性疼痛（主要面向员工）\n        '劳损/慢性疼痛': [\n          {\n            complaint: '长时间站立或弯腰后出现腰背酸痛',\n            symptoms: [\n              '腰背部酸胀不适',\n              '活动后疼痛加重，休息后可缓解'\n            ],\n            diagnoses: [\n              '腰背肌筋膜炎'\n            ],\n            treatments: [\n              '减少久坐久站，适当活动和拉伸腰背肌肉',\n              '可外用止痛贴等对症处理',\n              '如疼痛持续加重或伴下肢放射痛建议进一步检查'\n            ]\n          },\n          {\n            complaint: '长期伏案或低头工作后颈肩部酸痛不适',\n            symptoms: [\n              '颈肩部肌肉紧张酸痛',\n              '久坐或保持同一姿势后症状加重'\n            ],\n            diagnoses: [\n              '颈椎病可能'\n            ],\n            treatments: [\n              '注意工作姿势，每小时起身活动颈肩部',\n              '可行颈肩放松训练及局部热敷',\n              '如伴上肢放射痛或麻木应尽快就医'\n            ]\n          }\n        ]\n      },\n      // 常用药材（口服/外用一次）\n      drugSuggestionList: [\n        '棉签','碘伏','海诺创可贴','云南白药创可贴','一次性乳胶手套','纱布块','3%过氧化氢消毒液',\n        '余氯试纸','葡萄糖粉剂','利多卡因气雾剂','消旋山莨菪碱片','甲氧氯普胺片','诺氟沙星胶囊',\n        '维U颠茄铝胶囊','草珊瑚含片','氯芬黄敏片','布洛芬缓释胶囊','多潘立酮片','速效救心丸',\n        '脱敏胶带','盐水清洗液','一次性吸氧管','氧气袋','红霉素眼膏','左氧氟沙星滴眼液',\n        '藿香正气水','板蓝根颗粒','无菌敷贴','外科口罩','湿润烧伤膏','氯雷他定片（开瑞坦）',\n        '金士康和盐水清洗液'\n      ],\n      rxDrugNames: ['诺氟沙星胶囊', '速效救心丸', '布洛芬缓释胶囊', '多潘立酮片', '甲氧氯普胺片'],\n      form: {\n        visitDateTime: '',\n        name: '',\n        gender: '男',\n        age: null,\n        identity: '游客',\n        location: '',\n        visitType: 'clinic',\n        injuryLocation: '',\n        chiefComplaint: '',\n        symptom: '',\n        diseaseName: '',\n        diagnosis: '',\n        treatment: '',\n        drugId: '',\n        quantity: null,\n        remark: '',\n        doctorSign: '',\n        signTime: ''\n      },\n      showLocationTip: true, // 控制园区提示弹框是否显示\n      noTipNextTime: false,  // 下次不再提醒\n      currentDateTime: '',\n      selectedDrug: null,\n      selectedBatch: null,\n      availableStock: 0,\n      \n      // 药材搜索相关\n      drugSearchText: '',\n      allDrugs: [],\n      filteredDrugs: [],\n      showDrugList: false,\n      \n      // 疾病名称下拉列表\n      diseaseOptions: [\n        '感冒',\n        '发烧',\n        '头痛',\n        '头晕',\n        '咳嗽',\n        '腹泻',\n        '腹痛',\n        '恶心呕吐',\n        '外伤',\n        '扭伤',\n        '擦伤',\n        '割伤',\n        '烫伤',\n        '中暑',\n        '晕厥',\n        '过敏',\n        '皮疹',\n        '咽喉痛',\n        '牙痛',\n        '关节痛',\n        '腰痛',\n        '胸闷',\n        '心慌',\n        '失眠',\n        '其他'\n      ],\n      filteredDiseases: [],\n      showDiseaseList: false,\n      // 诊断/处置下拉\n      filteredDiagnosis: [],\n      showDiagnosisList: false,\n      filteredTreatments: [],\n      showTreatmentList: false,\n      // 主诉下拉\n      filteredComplaints: [],\n      showComplaintList: false,\n      complaintSelectedMode: false,  // 主诉是否已选择（自由编辑模式）\n      complaintFocus: false,  // 控制主诉输入框聚焦\n      // 下拉隐藏延迟计时器\n      diseaseBlurTimer: null,\n      complaintBlurTimer: null,\n      diagnosisBlurTimer: null,\n      // 年龄输入焦点（用于强制弹出数字键盘）\n      ageFocus: false,\n      // 园区常用地点词库（来自园区运营文件与现场点位）\n      allLocations: [\n        // 大区\n        '欢乐时光区','甜品王国区','香格里拉区','失落玛雅区','爱琴港区','峡湾深林区',\n        // 典型点位/场所\n        '欢乐广场','星闪舞台','旱喷泉','环道','树屋打卡点','情人廊','外广场','停车场','闸口','水公园闸口','大剧院正门',\n        // 乐园入口/屏幕\n        '香格里拉大屏幕','二期舞台屏幕','太空盒子外屏幕','海洋馆小舞台','奇幻海洋馆',\n        // 餐饮/店铺/项目口\n        '乐迪历险记门口','超飞主题餐厅','克罗索斯餐厅','家庭过山车入口','玛雅天灾入口',\n        // 糖果摊位\n        '甜蜜蜜','牛角包','太阳',\n        // 大型景观/设备标识\n        '水晶神翼大山','音乐过山车提升段','雪域金翅提升段','大剧院'\n      ],\n      filteredLocations: [],\n      showLocationList: false,\n      \n      showDrugSelector: false,\n      submitting: false,\n      continueAfterSubmit: true,  // 默认开启连续登记\n\n      // 当前聚焦字段的容器 id，用于配合 scroll-view 的 scroll-into-view，让输入框始终滚到键盘上方\n      activeFieldId: '',\n\n      // 定时器 ID：用于更新就诊时间，页面卸载时清理\n      dateTimeTimerId: null,\n\n      // 用户自定义疾病模板（本地持久化），按疾病名分组\n      // 结构示例：\n      // {\n      //   '扭伤': {\n      //      complaints: [ '行走时不慎扭伤踝关节，局部肿胀疼痛，活动受限', ... ],\n      //      diagnosis: [ '软组织扭伤（待进一步检查）', ... ],\n      //      treatments: [ '局部冷敷', '弹力绷带加压包扎', ... ]\n      //   },\n      //   ...\n      // }\n      userDiseaseTemplates: {},\n\n      // 多框搜索统一索引：汇总所有模板为 [{disease, complaint, diagnoses[], treatments[], symptoms[], source}]\n      templateIndex: [],\n      // 全局搜索关键词（用于跨字段联动）\n      globalSearchKeyword: ''\n    };\n  },\n\n  computed: {\n    currentLocationLabel() {\n      const loc = this.form?.location\n      if (loc === 'land_park') return '陆园'\n      if (loc === 'water_park') return '水园'\n      return '未选择'\n    },\n\n    // 未选择合法园区时，锁定表单核心输入\n    locationLocked() {\n      const loc = this.form?.location\n      return !loc || (loc !== 'land_park' && loc !== 'water_park')\n    },\n    \n    // 根据主诉内容长度动态调整字号\n    complaintFontSizeClass() {\n      const length = (this.form.chiefComplaint || '').length;\n      if (length > 50) return 'font-small';\n      if (length > 30) return 'font-medium';\n      return '';\n    },\n    \n    // 根据诊断内容长度动态调整字号\n    diagnosisFontSizeClass() {\n      const length = (this.form.diagnosis || '').length;\n      if (length > 50) return 'font-small';\n      if (length > 30) return 'font-medium';\n      return '';\n    }\n  },\n\n  onLoad() {\n    this.updateDateTime();\n    // 每分钟更新一次时间，并记录定时器 ID，便于卸载时清理\n    this.dateTimeTimerId = setInterval(() => {\n      this.updateDateTime();\n    }, 60000);\n    \n    // 恢复上次选择的园区\n    this.restoreLastLocation();\n    \n    // 恢复用户自定义疾病模板\n    this.restoreUserDiseaseTemplates();\n\n    // 构建多框搜索统一索引\n    this.buildTemplateIndex();\n\n    // 加载药材列表\n    this.loadAllDrugs();\n  },\n\n  onUnload() {\n    // 页面卸载时清理定时器，避免多次进入页面产生重复计时\n    if (this.dateTimeTimerId) {\n      clearInterval(this.dateTimeTimerId);\n      this.dateTimeTimerId = null;\n    }\n  },\n\n  methods: {\n    onFieldFocus(id) {\n      this.activeFieldId = id;\n    },\n    // 医生签名组件回调\n    onDoctorSignChange(value) {\n      // value 为签名图片的云文件ID或Base64，由 Signature 组件约定\n      this.form.doctorSign = value;\n      // 同时记录签名时间，便于在页面显示“签名时间”\n      const now = new Date();\n      const y = now.getFullYear();\n      const m = (now.getMonth() + 1).toString().padStart(2, '0');\n      const d = now.getDate().toString().padStart(2, '0');\n      const hh = now.getHours().toString().padStart(2, '0');\n      const mm = now.getMinutes().toString().padStart(2, '0');\n      const ss = now.getSeconds().toString().padStart(2, '0');\n      this.form.signTime = `${y}-${m}-${d} ${hh}:${mm}:${ss}`;\n    },\n\n    // 恢复用户自定义疾病模板（本地存储）\n    restoreUserDiseaseTemplates() {\n      try {\n        const stored = uni.getStorageSync('clinic_user_disease_templates');\n        if (stored && typeof stored === 'object') {\n          this.userDiseaseTemplates = stored;\n        }\n      } catch (e) {\n        console.error('恢复用户疾病模板失败:', e);\n        this.userDiseaseTemplates = {};\n      }\n    },\n\n    // 构建多框搜索统一索引：汇总系统模板、结构化模板、用户自定义模板\n    buildTemplateIndex() {\n      const index = [];\n\n      // 1) 结构化模板库 diseaseTemplateLib\n      Object.keys(this.diseaseTemplateLib || {}).forEach(disease => {\n        const list = this.diseaseTemplateLib[disease] || [];\n        list.forEach((tpl, idx) => {\n          if (tpl && tpl.complaint) {\n            index.push({\n              disease,\n              complaint: tpl.complaint,\n              symptoms: tpl.symptoms || [],\n              diagnoses: tpl.diagnoses || [],\n              treatments: tpl.treatments || [],\n              source: 'structured',\n              idx\n            });\n          }\n        });\n      });\n\n      // 2) 旧版模板：complaintTemplates + diseaseTemplates + treatmentTemplates\n      Object.keys(this.complaintTemplates || {}).forEach(disease => {\n        const complaint = this.complaintTemplates[disease];\n        const diagnoses = this.diseaseTemplates?.[disease] || [];\n        const treatments = this.treatmentTemplates?.[disease] || [];\n        if (complaint) {\n          index.push({\n            disease,\n            complaint,\n            symptoms: [],\n            diagnoses,\n            treatments,\n            source: 'legacy'\n          });\n        }\n      });\n\n      // 3) 用户自定义模板 userDiseaseTemplates\n      Object.keys(this.userDiseaseTemplates || {}).forEach(disease => {\n        const userTpl = this.userDiseaseTemplates[disease];\n        if (!userTpl) return;\n        (userTpl.complaints || []).forEach((complaint, idx) => {\n          if (complaint) {\n            index.push({\n              disease,\n              complaint,\n              symptoms: [],\n              diagnoses: userTpl.diagnosis || [],\n              treatments: userTpl.treatments || [],\n              source: 'user',\n              userIdx: idx\n            });\n          }\n        });\n      });\n\n      this.templateIndex = index;\n      console.log(`构建模板索引完成，共 ${index.length} 条记录`);\n    },\n\n    // 全局搜索：多条件并列搜索(AND逻辑)，同时匹配疾病/主诉/诊断三个关键词\n    performGlobalSearch(diseaseKw, complaintKw, diagnosisKw) {\n      const dKw = (diseaseKw || '').trim().toLowerCase();\n      const cKw = (complaintKw || '').trim().toLowerCase();\n      const dgKw = (diagnosisKw || '').trim().toLowerCase();\n\n      // 如果三个关键词都为空，返回所有疾病和空列表\n      if (!dKw && !cKw && !dgKw) {\n        return {\n          diseases: this.diseaseOptions,\n          complaints: [],\n          diagnoses: []\n        };\n      }\n\n      // 多条件并列过滤：同时满足所有非空关键词\n      const matchedRecords = this.templateIndex.filter(rec => {\n        let match = true;\n        \n        // 疾病关键词匹配\n        if (dKw) {\n          match = match && rec.disease.toLowerCase().includes(dKw);\n        }\n        \n        // 主诉关键词匹配\n        if (cKw) {\n          match = match && rec.complaint.toLowerCase().includes(cKw);\n        }\n        \n        // 诊断关键词匹配\n        if (dgKw) {\n          match = match && (rec.diagnoses || []).some(d => d.toLowerCase().includes(dgKw));\n        }\n        \n        return match;\n      });\n\n      // 提取匹配的疾病、主诉、诊断（去重）\n      const diseases = Array.from(new Set(matchedRecords.map(r => r.disease)));\n      const complaints = matchedRecords.map((r, idx) => ({\n        key: `${r.disease}_${idx}`,  // 添加唯一 key\n        label: r.complaint,\n        disease: r.disease,\n        record: r\n      }));\n      const diagSet = new Set();\n      matchedRecords.forEach(r => {\n        (r.diagnoses || []).forEach(d => diagSet.add(d));\n      });\n      const diagnoses = Array.from(diagSet);\n\n      return { diseases, complaints, diagnoses };\n    },\n\n    setIdentity(val) {\n      if (!this.form) return\n      this.form.identity = val\n    },\n    setVisitType(val) {\n      if (!this.form) return\n      this.form.visitType = val\n    },\n    openLocationSelector() {\n      const itemList = this.locations.map(l => l.label)\n      uni.showActionSheet({\n        itemList,\n        success: (res) => {\n          const idx = res.tapIndex\n          const target = this.locations[idx]\n          if (target) {\n            this.selectLocation(target.value)\n          }\n        }\n      })\n    },\n    // 关闭园区提示弹框\n    closeLocationTip() {\n      this.showLocationTip = false\n      try {\n        if (this.noTipNextTime) {\n          uni.setStorageSync('clinic_location_tip_closed', true)\n        }\n      } catch (e) {}\n    },\n\n    // 从弹框中选择园区\n    handleLocationSelect(location) {\n      this.selectLocation(location)\n      try {\n        if (this.noTipNextTime) {\n          uni.setStorageSync('clinic_location_tip_closed', true)\n        }\n      } catch (e) {}\n      this.showLocationTip = false\n    },\n    updateDateTime() {\n      const now = new Date();\n      const year = now.getFullYear();\n      const month = String(now.getMonth() + 1).padStart(2, '0');\n      const day = String(now.getDate()).padStart(2, '0');\n      const hours = String(now.getHours()).padStart(2, '0');\n      const minutes = String(now.getMinutes()).padStart(2, '0');\n      \n      this.currentDateTime = `${year}-${month}-${day} ${hours}:${minutes}`;\n      this.form.visitDateTime = `${year}-${month}-${day} ${hours}:${minutes}`;\n    },\n\n    // 加载所有药材\n    async loadAllDrugs() {\n      try {\n        const res = await wx.cloud.callFunction({\n          name: 'drugManage',\n          data: {\n            action: 'getList',\n            data: { pageSize: 1000 }\n          }\n        });\n\n        if (res.result.success) {\n          this.allDrugs = res.result.data.list || [];\n        }\n      } catch (err) {\n        console.error('加载药材列表失败:', err);\n      }\n    },\n\n    // 药材输入框获得焦点\n    async onDrugInputFocus() {\n      this.showDrugList = true;\n      \n      // 如果没有输入内容，显示当前园区的所有药材\n      if (!this.drugSearchText || this.drugSearchText.trim() === '') {\n        // 没有输入内容，显示所有药材\n        this.filteredDrugs = this.allDrugs;\n      } else {\n        this.onDrugSearch();\n      }\n    },\n\n    // 加载当前园区的药材\n    async loadLocationDrugs() {\n      try {\n        uni.showLoading({ title: '加载药材...' });\n        \n        const res = await wx.cloud.callFunction({\n          name: 'stockManage',\n          data: {\n            action: 'getStockList',\n            data: {\n              location: this.form.location,\n              pageSize: 1000\n            }\n          }\n        });\n        \n        uni.hideLoading();\n\n        if (res.result.success) {\n          const stockList = res.result.data.list || [];\n          // 过滤出有库存的药材\n          this.filteredDrugs = stockList\n            .filter(item => item.quantity > 0)\n            .map(item => ({\n              _id: item.drugId,\n              name: item.drugName || item.name,\n              specification: item.specification || item.spec,\n              minUnit: item.minUnit || item.unit,\n              packUnit: item.packUnit || item.unit,\n              conversionRate: item.conversionRate || 1,\n              stock: item.quantity\n            }));\n          \n          console.log(`加载了${this.filteredDrugs.length}种药材`);\n        } else {\n          // 如果获取失败，显示所有药材\n          this.filteredDrugs = this.allDrugs.slice(0, 50);\n        }\n      } catch (err) {\n        console.error('加载园区药材失败:', err);\n        uni.hideLoading();\n        // 失败时显示所有药材\n        this.filteredDrugs = this.allDrugs.slice(0, 50);\n      }\n    },\n\n    // 药材搜索\n    onDrugSearch() {\n      if (!this.drugSearchText || this.drugSearchText.trim() === '') {\n        // 没有搜索内容时，加载当前园区药材\n        this.loadLocationDrugs();\n        return;\n      }\n\n      const keyword = this.drugSearchText.toLowerCase();\n      // 从当前园区的药材中搜索\n      if (this.filteredDrugs.length > 0 && !this.drugSearchText) {\n        // 已经加载了园区药材，在其中搜索\n        const currentList = [...this.filteredDrugs];\n        this.filteredDrugs = currentList.filter(drug => {\n          const name = (drug.name || '').toLowerCase();\n          const genericName = (drug.genericName || '').toLowerCase();\n          const spec = (drug.specification || '').toLowerCase();\n          const tradeNames = Array.isArray(drug.tradeNames) ? drug.tradeNames : [];\n          const hitTrade = tradeNames.some(t => (t || '').toLowerCase().includes(keyword));\n\n          return name.includes(keyword) ||\n                 genericName.includes(keyword) ||\n                 spec.includes(keyword) ||\n                 hitTrade;\n        });\n      } else {\n        // 从所有药材中搜索\n        this.filteredDrugs = this.allDrugs.filter(drug => {\n          const name = (drug.name || '').toLowerCase();\n          const genericName = (drug.genericName || '').toLowerCase();\n          const pinyin = (drug.pinyin || '').toLowerCase();\n          const spec = (drug.specification || drug.spec || '').toLowerCase();\n          const tradeNames = Array.isArray(drug.tradeNames) ? drug.tradeNames : [];\n          const hitTrade = tradeNames.some(t => (t || '').toLowerCase().includes(keyword));\n\n          return name.includes(keyword) ||\n                 genericName.includes(keyword) ||\n                 pinyin.includes(keyword) ||\n                 spec.includes(keyword) ||\n                 hitTrade;\n        }).slice(0, 30); // 最多显示30个结果\n      }\n    },\n\n    // 从列表选择药材\n    selectDrugFromList(drug) {\n      this.drugSearchText = drug.name;\n      this.onDrugSelect(drug);\n      this.showDrugList = false;\n    },\n\n    // 疾病名称获得焦点：显示下拉列表\n    onDiseaseFocus() {\n      // 清除失焦隐藏计时器\n      if (this.diseaseBlurTimer) {\n        clearTimeout(this.diseaseBlurTimer);\n        this.diseaseBlurTimer = null;\n      }\n      \n      // 触发全局搜索，基于所有三个框的关键词\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n      \n      // 显示下拉（即使为空也显示，会显示所有疾病）\n      this.showDiseaseList = this.filteredDiseases.length > 0;\n    },\n    \n    onDiseaseBlur() {\n      const text = (this.form.diseaseName || '').trim();\n      if (text) {\n        // 1）先按疾病大类精确匹配\n        const hasDisease = this.templateIndex.some(r => r.disease === text);\n        if (hasDisease) {\n          this.selectDisease(text);\n        } else {\n          // 2）再按标准诊断名匹配\n          const diagRecord = this.templateIndex.find(r =>\n            (r.diagnoses || []).some(d => d === text)\n          );\n          if (diagRecord) {\n            this.selectDiagnosis(text);\n          }\n        }\n      }\n\n      // 延迟隐藏下拉，给点击事件留时间\n      this.diseaseBlurTimer = setTimeout(() => {\n        this.showDiseaseList = false;\n      }, 200);\n    },\n    \n    // 疾病名称输入：触发全局搜索并联动主诉/诊断下拉\n    onDiseaseInput() {\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n\n      this.showDiseaseList = this.filteredDiseases.length > 0;\n      // 主诉和诊断下拉在用户聚焦时才显示，这里只更新数据\n      // 如果当前输入的疾病名称与某个疾病完全匹配，则自动按该疾病刷新联动字段\n      const kw = (this.form.diseaseName || '').trim();\n      if (kw && this.filteredDiseases.includes(kw)) {\n        this.selectDisease(kw);\n      }\n    },\n\n    // 选择疾病：自动填充第一条匹配的主诉/诊断/处置\n    selectDisease(disease) {\n      // 清除失焦隐藏计时器\n      if (this.diseaseBlurTimer) {\n        clearTimeout(this.diseaseBlurTimer);\n        this.diseaseBlurTimer = null;\n      }\n      \n      // 选择后关闭下拉\n      this.showDiseaseList = false;\n\n      // 查找该疾病的第一条模板记录\n      const record = this.templateIndex.find(r => r.disease === disease);\n      if (record) {\n        const mainDiagnosis = (record.diagnoses && record.diagnoses[0]) || '';\n        this.form.diseaseName = mainDiagnosis || disease;\n        this.form.chiefComplaint = record.complaint;\n        if (record.symptoms && record.symptoms.length) {\n          this.form.symptom = record.symptoms.join('；');\n        }\n        if (record.diagnoses && record.diagnoses.length) {\n          // 初步诊断字段使用模板中的完整诊断组合\n          this.form.diagnosis = record.diagnoses.join('；');\n        }\n        if (record.treatments && record.treatments.length) {\n          this.form.treatment = record.treatments.join('；');\n        }\n        if (Array.isArray(record.suggestDrugs) && record.suggestDrugs.length) {\n          this.applySuggestDrugs(record.suggestDrugs);\n        }\n      } else {\n        // 回退到旧逻辑\n        this.loadTemplatesForDisease(disease);\n        this.autoFillByDisease(disease);\n      }\n    },\n    // 依据疾病载入诊断与处置模板\n    loadTemplatesForDisease(disease) {\n      const baseDiag = this.diseaseTemplates?.[disease] || [];\n      // 合并结构化模板中的诊断\n      const structDiag = (this.diseaseTemplateLib?.[disease] || [])\n        .flatMap(t => t.diagnoses || []);\n      const diag = Array.from(new Set([...(baseDiag || []), ...structDiag]));\n      const treat = this.treatmentTemplates?.[disease] || [];\n      this.filteredDiagnosis = diag;\n      this.filteredTreatments = treat;\n    },\n    // 自动按疾病填入主诉/诊断/处置（可编辑）\n    autoFillByDisease(disease) {\n      const complaint = this.complaintTemplates?.[disease];\n      const diagList = this.diseaseTemplates?.[disease] || [];\n      const diag = diagList[0];\n      const treats = (this.treatmentTemplates?.[disease] || []).slice(0, 2);\n      // 附加注意事项/复诊提示\n      const cautions = this.treatmentCautions?.[disease] || [];\n      const merged = [];\n      const pushUnique = (arr) => {\n        arr.forEach(t => {\n          if (t && !merged.includes(t)) merged.push(t);\n        });\n      };\n      pushUnique(treats);\n      pushUnique(cautions);\n      // 每次选择疾病时，都用模板覆盖联动字段，保证重新选择疾病也会刷新\n      if (complaint) this.form.chiefComplaint = complaint;\n      if (diag) {\n        // 疾病名称使用首个诊断，初步诊断使用全部诊断组合\n        this.form.diseaseName = diag;\n        this.form.diagnosis = diagList.length ? diagList.join('；') : diag;\n      }\n      if (merged.length) this.form.treatment = merged.join('；');\n    },\n    // 诊断输入与选择\n    // 诊断获得焦点：显示下拉列表\n    onDiagnosisFocus() {\n      // 触发全局搜索，基于所有三个框的关键词\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n      \n      // 显示下拉（即使为空也显示，基于其他框的关键词）\n      this.showDiagnosisList = this.filteredDiagnosis.length > 0;\n    },\n    onDiagnosisInput() {\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n\n      this.showDiagnosisList = this.filteredDiagnosis.length > 0;\n    },\n    selectDiagnosis(text) {\n      // 查找包含该诊断的第一条模板记录\n      const record = this.templateIndex.find(r => \n        (r.diagnoses || []).some(d => d === text)\n      );\n\n      if (record) {\n        // 疾病名称直接使用所选标准诊断名\n        this.form.diseaseName = text;\n        this.form.chiefComplaint = record.complaint;\n        // 初步诊断使用该模板下的完整诊断组合\n        if (record.diagnoses && record.diagnoses.length) {\n          this.form.diagnosis = record.diagnoses.join('；');\n        } else {\n          this.form.diagnosis = text;\n        }\n        if (record.symptoms && record.symptoms.length) {\n          this.form.symptom = record.symptoms.join('；');\n        }\n        if (record.treatments && record.treatments.length) {\n          this.form.treatment = record.treatments.join('；');\n        }\n        // 如模板提供推荐用药列表，自动按顺序触发联动药材逻辑\n        if (Array.isArray(record.suggestDrugs) && record.suggestDrugs.length) {\n          record.suggestDrugs.forEach(name => {\n            if (name) {\n              this.onDrugChip(name);\n            }\n          });\n        }\n      } else {\n        this.form.diagnosis = text;\n      }\n\n      this.showDiagnosisList = false;\n    },\n    // 主诉获得焦点：根据编辑模式决定是否触发搜索\n    onComplaintFocus() {\n      // 清除失焦隐藏计时器\n      if (this.complaintBlurTimer) {\n        clearTimeout(this.complaintBlurTimer);\n        this.complaintBlurTimer = null;\n      }\n      \n      const currentComplaint = (this.form.chiefComplaint || '').trim();\n      \n      // 情况1：自由编辑模式（已选择过） → 不触发搜索，不显示下拉\n      if (this.complaintSelectedMode && currentComplaint) {\n        this.showComplaintList = false;\n        return;\n      }\n      \n      // 情况2：输入框为空 → 重置为搜索模式，基于其他框的关键词显示联动结果\n      if (!currentComplaint) {\n        this.complaintSelectedMode = false;\n      }\n      \n      // 情况3：搜索模式 → 触发全局搜索（基于AND逻辑）并显示下拉\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n      \n      // 即使主诉框为空，只要有其他框的关键词，也显示联动结果\n      this.showComplaintList = this.filteredComplaints.length > 0;\n    },\n    onComplaintInput() {\n      const currentComplaint = (this.form.chiefComplaint || '').trim();\n      \n      // 如果内容被清空，重置为搜索模式\n      if (!currentComplaint) {\n        this.complaintSelectedMode = false;\n      }\n      \n      // 如果已选择主诉（自由编辑模式），不显示下拉\n      if (this.complaintSelectedMode && currentComplaint) {\n        this.showComplaintList = false;\n        return;\n      }\n      \n      // 搜索模式：执行全局搜索并显示下拉\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n\n      this.showComplaintList = this.filteredComplaints.length > 0;\n    },\n    \n    onComplaintBlur() {\n      // 失焦时重置聚焦状态\n      this.complaintFocus = false;\n      // 延迟隐藏下拉，给点击事件留时间\n      this.complaintBlurTimer = setTimeout(() => {\n        this.showComplaintList = false;\n      }, 200);\n    },\n    selectComplaint(opt) {\n      // 清除失焦隐藏计时器\n      if (this.complaintBlurTimer) {\n        clearTimeout(this.complaintBlurTimer);\n        this.complaintBlurTimer = null;\n      }\n      \n      if (!opt || !opt.record) return;\n      const rec = opt.record;\n\n      // 自动填充疾病、主诉、症状、诊断、处置\n      const mainDiagnosis = (rec.diagnoses && rec.diagnoses[0]) || '';\n      this.form.diseaseName = mainDiagnosis || rec.disease;\n      this.form.chiefComplaint = rec.complaint;\n      if (rec.symptoms && rec.symptoms.length) {\n        this.form.symptom = rec.symptoms.join('；');\n      }\n      if (rec.diagnoses && rec.diagnoses.length) {\n        // 初步诊断字段使用模板中的完整诊断组合\n        this.form.diagnosis = rec.diagnoses.join('；');\n      }\n      if (rec.treatments && rec.treatments.length) {\n        this.form.treatment = rec.treatments.join('；');\n      }\n      if (Array.isArray(rec.suggestDrugs) && rec.suggestDrugs.length) {\n        this.applySuggestDrugs(rec.suggestDrugs);\n      }\n\n      // 进入自由编辑模式\n      this.complaintSelectedMode = true;\n      this.showComplaintList = false;\n      \n      // 自动聚焦到主诉输入框，方便立即编辑\n      this.$nextTick(() => {\n        this.complaintFocus = false;\n        this.$nextTick(() => {\n          this.complaintFocus = true;\n        });\n      });\n    },\n    // 处置输入与选择\n    onTreatmentFocus() {\n      if (!this.form.treatment || this.form.treatment.trim() === '') {\n        const src = this.treatmentTemplates?.[this.form.diseaseName] || [];\n        this.filteredTreatments = src;\n        this.showTreatmentList = src.length > 0;\n      }\n    },\n    onTreatmentInput() {\n      const src = this.treatmentTemplates?.[this.form.diseaseName] || [];\n      const text = (this.form.treatment || '').trim().toLowerCase();\n      if (!text) {\n        this.filteredTreatments = src;\n        this.showTreatmentList = src.length > 0;\n        return;\n      }\n      this.filteredTreatments = src.filter(s => s.toLowerCase().includes(text));\n      this.showTreatmentList = this.filteredTreatments.length > 0;\n    },\n    selectTreatment(text) {\n      this.form.treatment = text;\n      this.showTreatmentList = false;\n    },\n    appendTreatment(token) {\n      const base = (this.form.treatment || '').trim();\n      this.form.treatment = base ? `${base}；${token}` : token;\n    },\n    // 将当前输入内容保存为自定义模板（全局搜索使用）\n    saveCurrentAsTemplate() {\n      const disease = (this.form.diseaseName || '').trim();\n      if (!disease) {\n        uni.showToast({ title: '请先选择疾病名称', icon: 'none' });\n        return;\n      }\n\n      const complaint = (this.form.chiefComplaint || '').trim();\n      const diagnosis = (this.form.diagnosis || '').trim();\n      const treatment = (this.form.treatment || '').trim();\n\n      if (!complaint && !diagnosis && !treatment) {\n        uni.showToast({ title: '请输入主诉/诊断/处置后再保存', icon: 'none' });\n        return;\n      }\n\n      // 直接更新 userDiseaseTemplates\n      if (!this.userDiseaseTemplates[disease]) {\n        this.userDiseaseTemplates[disease] = {\n          complaints: [],\n          diagnosis: [],\n          treatments: []\n        };\n      }\n\n      const target = this.userDiseaseTemplates[disease];\n\n      if (complaint && !target.complaints.includes(complaint)) {\n        target.complaints.unshift(complaint);\n        target.complaints = target.complaints.slice(0, 20);\n      }\n\n      if (diagnosis && !target.diagnosis.includes(diagnosis)) {\n        target.diagnosis.unshift(diagnosis);\n        target.diagnosis = target.diagnosis.slice(0, 20);\n      }\n\n      if (treatment && !target.treatments.includes(treatment)) {\n        target.treatments.unshift(treatment);\n        target.treatments = target.treatments.slice(0, 20);\n      }\n\n      // 持久化到本地\n      try {\n        uni.setStorageSync('userDiseaseTemplates', this.userDiseaseTemplates);\n        // 重新构建模板索引，包含新保存的模板\n        this.buildTemplateIndex();\n        uni.showToast({ title: '模板已保存', icon: 'success' });\n      } catch (e) {\n        console.error('保存模板失败:', e);\n        uni.showToast({ title: '保存失败', icon: 'none' });\n      }\n    },\n    // 提交后提示保存模板\n    promptSaveTemplate() {\n      const disease = (this.form.diseaseName || '').trim();\n      const complaint = (this.form.chiefComplaint || '').trim();\n      const diagnosis = (this.form.diagnosis || '').trim();\n      const treatment = (this.form.treatment || '').trim();\n\n      // 必须有疾病名和至少一项内容\n      if (!disease || (!complaint && !diagnosis && !treatment)) {\n        return;\n      }\n\n      uni.showModal({\n        title: '保存为模板',\n        content: '是否将当前主诉、诊断、处置保存为自定义模板？下次可快速调用',\n        confirmText: '保存',\n        cancelText: '跳过',\n        success: (res) => {\n          if (res.confirm) {\n            this.saveCurrentAsTemplate();\n          }\n        }\n      });\n    },\n    // —— 药材标签：与园区库存联动 —— //\n    normalizeText(text) {\n      try {\n        return String(text || '').toLowerCase().replace(/\\\\s+/g, '');\n      } catch (e) {\n        return '';\n      }\n    },\n    async ensureStockLoaded() {\n      if (!this.filteredDrugs || this.filteredDrugs.length === 0) {\n        try {\n          await this.loadLocationDrugs();\n        } catch (e) {}\n      }\n    },\n    isPrescriptionDrug(name) {\n      const n = (name || '').trim();\n      if (!n) return false;\n      return (this.rxDrugNames || []).includes(n);\n    },\n    applySuggestDrugs(list) {\n      if (!Array.isArray(list) || !list.length) return;\n      list.forEach(name => {\n        const n = (name || '').trim();\n        if (!n) return;\n        if (this.isPrescriptionDrug(n)) {\n          this.appendTreatment(`${n}（处方药，需开具处方单，在陆园/水园药房发药）`);\n        } else {\n          this.onDrugChip(n);\n        }\n      });\n    },\n    findDrugByName(name) {\n      const target = this.normalizeText(name);\n      const inList = (list) => {\n        return (list || []).find(d => {\n          const n1 = this.normalizeText(d.name || d.drugName);\n          const n2 = this.normalizeText(d.specification || d.spec);\n          return n1.includes(target) || target.includes(n1) || n2.includes(target);\n        });\n      };\n      let found = inList(this.filteredDrugs);\n      if (!found) found = inList(this.allDrugs);\n      return found;\n    },\n    async onDrugChip(name) {\n      // 1) 先附加“（一次）”到处置文本\n      this.appendTreatment(`${name}（一次）`);\n      // 2) 加载当前园区库存，并尝试选中对应药材\n      await this.ensureStockLoaded();\n      const drug = this.findDrugByName(name);\n      if (drug && drug._id) {\n        try {\n          await this.onDrugSelect(drug);\n          uni.showToast({ title: `已选中药材：${drug.name}`, icon: 'none' });\n        } catch (e) {\n          // 选中失败不影响处置文本\n        }\n      } else {\n        uni.showToast({ title: '当前园区暂无该药库存', icon: 'none' });\n      }\n    },\n\n    // 恢复上次选择的园区\n    restoreLastLocation() {\n      try {\n        const lastLocation = uni.getStorageSync('clinic_last_location');\n        const tipClosed = uni.getStorageSync('clinic_location_tip_closed');\n        const isValidLocation = lastLocation === 'land_park' || lastLocation === 'water_park';\n\n        // 规则：\n        // 1）默认不选园区，每次进入都弹窗；\n        // 2）只有当用户勾选了“下次不再提醒”并关闭弹窗时，才记住园区且下次不再弹窗；\n        // 3）此时才在进入页面时自动带出上次园区。\n        if (tipClosed && isValidLocation) {\n          // 用户明确选择了不再提醒，并有合法园区记录\n          this.form.location = lastLocation;\n          this.showLocationTip = false;\n          const locationName = lastLocation === 'land_park' ? '陆园' : '水园';\n          console.log(`已按上次记录自动选择园区: ${locationName}`);\n        } else {\n          // 其余情况：不自动选园区，始终弹出提示\n          this.form.location = '';\n          this.showLocationTip = true;\n        }\n        \n        // 恢复连续登记模式设置\n        const continueMode = uni.getStorageSync('clinic_continue_mode');\n        if (continueMode !== undefined && continueMode !== null) {\n          this.continueAfterSubmit = continueMode;\n        }\n      } catch (err) {\n        console.error('恢复园区选择失败:', err);\n        this.form.location = '';\n      }\n    },\n\n    selectLocation(location) {\n      this.form.location = location;\n      \n      // 保存到本地存储，记忆用户选择\n      try {\n        uni.setStorageSync('clinic_last_location', location);\n      } catch (err) {\n        console.error('保存园区选择失败:', err);\n      }\n      \n      // 切换园区后重新加载批次\n      if (this.selectedDrug) {\n        uni.showToast({\n          title: `已切换到${location === 'land_park' ? '陆园' : '水园'}`,\n          icon: 'none',\n          duration: 1500\n        });\n        this.loadBatches();\n      }\n    },\n    // 地点输入框：获得焦点\n    onLocationFocus() {\n      const text = (this.form.injuryLocation || '').trim().toLowerCase();\n      if (!text) {\n        // 展示全部常用地点\n        this.filteredLocations = Array.from(new Set(this.allLocations));\n      } else {\n        this.onLocationInput();\n      }\n      this.showLocationList = true;\n    },\n    // 地点输入：过滤\n    onLocationInput() {\n      const text = (this.form.injuryLocation || '').trim().toLowerCase();\n      const src = Array.from(new Set(this.allLocations));\n      if (!text) {\n        this.filteredLocations = src;\n      } else {\n        this.filteredLocations = src.filter(name => name.toLowerCase().includes(text));\n      }\n      this.showLocationList = true;\n    },\n    // 选择地点\n    selectLocationFromList(name) {\n      this.form.injuryLocation = name;\n      this.showLocationList = false;\n    },\n\n\n    async onDrugSelect(drug) {\n      // 先设置基本信息\n      this.form.drugId = drug._id;\n      this.showDrugSelector = false;\n      \n      // 从药材档案获取完整信息\n      try {\n        uni.showLoading({ title: '加载药材信息...' });\n        const res = await wx.cloud.callFunction({\n          name: 'drugManage',\n          data: {\n            action: 'getDetail',\n            data: { id: drug._id }\n          }\n        });\n        \n        if (res.result.success && res.result.data) {\n          // 使用完整的药材信息\n          this.selectedDrug = {\n            ...res.result.data,\n            _id: res.result.data._id,\n            drugCode: res.result.data.drugCode || res.result.data.code || '',\n            name: res.result.data.name,\n            specification: res.result.data.specification || res.result.data.spec || '',\n            minUnit: res.result.data.minUnit || res.result.data.unit || '个',\n            packUnit: res.result.data.packUnit || res.result.data.unit || '盒',\n            conversionRate: res.result.data.conversionRate || 1,\n            manufacturer: res.result.data.manufacturer || ''\n          };\n        } else {\n          // 如果获取失败，使用传入的drug数据\n          this.selectedDrug = {\n            ...drug,\n            minUnit: drug.minUnit || drug.unit || '个',\n            packUnit: drug.packUnit || drug.unit || '盒',\n            conversionRate: drug.conversionRate || 1\n          };\n        }\n      } catch (err) {\n        console.error('获取药材详情失败:', err);\n        // 使用传入的drug数据\n        this.selectedDrug = {\n          ...drug,\n          minUnit: drug.minUnit || drug.unit || '个',\n          packUnit: drug.packUnit || drug.unit || '盒',\n          conversionRate: drug.conversionRate || 1\n        };\n      } finally {\n        uni.hideLoading();\n      }\n      \n      // 加载该园区的批次和库存\n      await this.loadBatches();\n    },\n\n    async loadBatches() {\n      uni.showLoading({ title: '加载库存...' });\n      try {\n        const res = await wx.cloud.callFunction({\n          name: 'stockManage',\n          data: {\n            action: 'getBatchesByDrugId',\n            data: {\n              drugId: this.form.drugId,\n              location: this.form.location,\n              enableFIFO: true\n            }\n          }\n        });\n\n        if (res.result.success && res.result.data.length > 0) {\n          const batches = res.result.data;\n          this.selectedBatch = batches[0];\n          this.availableStock = batches.reduce((sum, b) => sum + b.quantity, 0);\n        } else {\n          this.selectedBatch = null;\n          this.availableStock = 0;\n          const parkName = this.form.location === 'land_park' ? '陆园' : '水园';\n          uni.showToast({\n            title: `${parkName}该药材库存不足`,\n            icon: 'none',\n            duration: 2000\n          });\n        }\n      } catch (err) {\n        uni.showToast({\n          title: '加载库存失败',\n          icon: 'none'\n        });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n\n    openSignature() {\n      this.showSignature = true;\n    },\n\n    onSignatureConfirm(signatureData) {\n      this.form.doctorSign = signatureData;\n      \n      // 记录签名时间\n      const now = new Date();\n      const year = now.getFullYear();\n      const month = String(now.getMonth() + 1).padStart(2, '0');\n      const day = String(now.getDate()).padStart(2, '0');\n      const hours = String(now.getHours()).padStart(2, '0');\n      const minutes = String(now.getMinutes()).padStart(2, '0');\n      this.form.signTime = `${year}-${month}-${day} ${hours}:${minutes}`;\n      \n      this.showSignature = false;\n      \n      uni.showToast({\n        title: '签名成功',\n        icon: 'success',\n        duration: 1500\n      });\n    },\n\n    async handleSubmit() {\n      // 必须先选择就诊园区\n      if (!this.form.location || (this.form.location !== 'land_park' && this.form.location !== 'water_park')) {\n        uni.showToast({ title: '请选择就诊园区', icon: 'none' });\n        return;\n      }\n\n      // 表单验证\n      if (!this.form.name || this.form.name.trim() === '') {\n        uni.showToast({ title: '请输入患者姓名', icon: 'none' });\n        return;\n      }\n      if (!this.form.gender) {\n        uni.showToast({ title: '请选择性别', icon: 'none' });\n        return;\n      }\n      if (!this.form.age || this.form.age <= 0) {\n        uni.showToast({ title: '请输入有效的年龄', icon: 'none' });\n        return;\n      }\n      if (!this.form.identity) {\n        uni.showToast({ title: '请选择身份', icon: 'none' });\n        return;\n      }\n      if (!this.form.visitType) {\n        uni.showToast({ title: '请选择接诊类型', icon: 'none' });\n        return;\n      }\n      if (this.form.visitType === 'outcall' && (!this.form.injuryLocation || this.form.injuryLocation.trim() === '')) {\n        uni.showToast({ title: '出诊时需填写受伤地点', icon: 'none' });\n        return;\n      }\n      if (!this.form.chiefComplaint || this.form.chiefComplaint.trim() === '') {\n        uni.showToast({ title: '请输入主诉', icon: 'none' });\n        return;\n      }\n      if (!this.form.diseaseName || this.form.diseaseName.trim() === '') {\n        uni.showToast({ title: '请输入疾病名称', icon: 'none' });\n        return;\n      }\n      if (!this.form.diagnosis || this.form.diagnosis.trim() === '') {\n        uni.showToast({ title: '请输入诊断', icon: 'none' });\n        return;\n      }\n      if (!this.form.treatment || this.form.treatment.trim() === '') {\n        uni.showToast({ title: '请输入处置措施', icon: 'none' });\n        return;\n      }\n\n      // 用药信息为选填：仅当选择了药材且数量>0时，才视为用药登记\n      let hasValidDrugUsage = false;\n      if (this.selectedDrug) {\n        if (this.form.quantity && this.form.quantity > 0) {\n          // 验证库存（园区使用最小单位，直接比较）\n          if (this.form.quantity > this.availableStock) {\n            uni.showToast({\n              title: `库存不足，最多${this.availableStock}${this.selectedDrug.minUnit}`,\n              icon: 'none',\n              duration: 3000\n            });\n            return;\n          }\n          hasValidDrugUsage = true;\n        } else {\n          // 选择了药材但未填写有效数量，视为本次不登记用药，清空用药相关状态\n          this.form.drugId = '';\n          this.form.quantity = null;\n          this.selectedDrug = null;\n          this.selectedBatch = null;\n          this.availableStock = 0;\n        }\n      }\n\n      this.submitting = true;\n      uni.showLoading({ title: '保存中...' });\n\n      try {\n        // 准备数据\n        const submitData = {\n          visitDateTime: this.form.visitDateTime,\n          name: this.form.name.trim(),\n          gender: this.form.gender,\n          age: this.form.age,\n          identity: this.form.identity,\n          location: this.form.location,  // 园区（陆园/水园）\n          visitType: this.form.visitType,\n          isOutcall: this.form.visitType === 'outcall',\n          injuryLocation: this.form.injuryLocation.trim(),\n          chiefComplaint: this.form.chiefComplaint.trim(),\n          diseaseName: this.form.diseaseName.trim(),\n          diagnosis: this.form.diagnosis.trim(),\n          treatment: this.form.treatment.trim(),\n          remark: this.form.remark.trim()\n        };\n\n        // 如果有有效用药信息，云函数会从对应园区扣减库存\n        if (hasValidDrugUsage && this.selectedDrug && this.form.quantity) {\n          // 确保数量是整数，避免小数\n          const intQuantity = Math.floor(this.form.quantity);\n          \n          submitData.drugInfo = {\n            drugId: this.form.drugId,  // 系统内部ID（主键）\n            drugCode: this.selectedDrug.drugCode || this.selectedDrug.code || '',  // 药材代码（业务编码）\n              drugName: this.selectedDrug.name,\n              specification: this.selectedDrug.specification,\n            unit: this.selectedDrug.minUnit,\n            quantity: intQuantity,\n              batchId: this.selectedBatch._id,\n            batch: this.selectedBatch.batch,\n            location: this.form.location,  // 关联园区\n              minUnit: this.selectedDrug.minUnit,\n              packUnit: this.selectedDrug.packUnit,\n            conversionRate: this.selectedDrug.conversionRate\n          };\n          \n          // 兼容旧字段\n          submitData.drugId = this.form.drugId;  // 系统内部ID（主键）\n          submitData.drugCode = this.selectedDrug.drugCode || this.selectedDrug.code || '';  // 药材代码（业务编码）\n          submitData.drugName = this.selectedDrug.name;\n          submitData.specification = this.selectedDrug.specification;\n          submitData.batchId = this.selectedBatch._id;\n          submitData.quantityMin = intQuantity;\n          submitData.minUnit = this.selectedDrug.minUnit;\n          submitData.packUnit = this.selectedDrug.packUnit;\n          submitData.conversionRate = this.selectedDrug.conversionRate;\n          submitData.patient = this.form.name.trim();\n          submitData.symptom = (this.form.symptom || this.form.chiefComplaint || '').trim();\n        }\n\n        const res = await wx.cloud.callFunction({\n          name: 'clinicRecords',\n          data: {\n            action: 'add',\n            data: submitData\n          }\n        });\n\n        if (res.result.success) {\n          // 提示保存为模板\n          this.promptSaveTemplate();\n          \n          if (this.continueAfterSubmit) {\n            // 连续登记模式：立即清空表单\n          uni.showToast({\n              title: '登记成功，可继续登记',\n              icon: 'success',\n              duration: 2000\n          });\n\n            setTimeout(() => {\n            this.resetForm();\n              // 滚动到顶部\n              uni.pageScrollTo({\n                scrollTop: 0,\n                duration: 300\n              });\n            }, 800);\n          } else {\n            // 返回列表\n            uni.showToast({\n              title: '登记成功',\n              icon: 'success'\n            });\n            setTimeout(() => {\n              // 确保离开页面前也重置一次，避免热更新或返回后残留\n              this.resetForm();\n              uni.navigateBack();\n            }, 1500);\n          }\n        } else {\n          uni.showToast({\n            title: res.result.error || '登记失败',\n            icon: 'none'\n          });\n        }\n      } catch (err) {\n        console.error('登记失败:', err);\n        uni.showToast({\n          title: '登记失败',\n          icon: 'none'\n        });\n      } finally {\n        this.submitting = false;\n        uni.hideLoading();\n      }\n    },\n\n    resetForm() {\n      // 保留当前园区选择，其他信息全部重置\n      const currentLocation = this.form.location || '';\n\n      // 更新时间（就诊时间始终为当前时间）\n      this.updateDateTime();\n\n      // 逐字段重置，避免整体替换对象可能带来的响应式问题\n      this.form.name = '';\n      this.form.gender = '男';\n      this.form.age = null;\n      this.form.identity = '游客';\n      this.form.location = currentLocation; // 保留园区选择\n      this.form.visitType = 'clinic';\n      this.form.injuryLocation = '';\n      this.form.chiefComplaint = '';\n      this.form.symptom = '';\n      this.form.diseaseName = '';\n      this.form.diagnosis = '';\n      this.form.treatment = '';\n      this.form.drugId = '';\n      this.form.quantity = null;\n      this.form.remark = '';\n      this.form.doctorSign = '';\n      this.form.signTime = '';\n\n      // 用药与库存相关状态\n      this.selectedDrug = null;\n      this.selectedBatch = null;\n      this.availableStock = 0;\n      this.convertedQuantity = null;\n      this.drugSearchText = '';\n      this.filteredDrugs = [];\n      this.showDrugList = false;\n\n      // 疾病/模板/下拉相关状态\n      this.filteredDiseases = [];\n      this.showDiseaseList = false;\n      this.filteredDiagnosis = [];\n      this.showDiagnosisList = false;\n      this.filteredTreatments = [];\n      this.showTreatmentList = false;\n      this.filteredComplaints = [];\n      this.showComplaintList = false;\n      this.complaintSelectedMode = false; // 重置主诉编辑模式\n    },\n\n    formatDate(dateStr) {\n      if (!dateStr) return '';\n      const date = new Date(dateStr);\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    },\n\n    // 切换连续登记模式\n    toggleContinue() {\n      this.continueAfterSubmit = !this.continueAfterSubmit;\n      \n      // 保存用户偏好\n      try {\n        uni.setStorageSync('clinic_continue_mode', this.continueAfterSubmit);\n      } catch (err) {\n        console.error('保存连续登记设置失败:', err);\n      }\n      \n      uni.showToast({\n        title: this.continueAfterSubmit ? '已开启连续登记' : '已关闭连续登记',\n        icon: 'none',\n        duration: 1500\n      });\n    },\n\n    goBack() {\n      uni.navigateBack();\n    },\n\n    // 生成日报\n    async generateDailyReport() {\n      try {\n        uni.showLoading({ title: '生成中...' });\n\n        // 获取当前日期和园区\n        const today = new Date();\n        const year = today.getFullYear();\n        const month = String(today.getMonth() + 1).padStart(2, '0');\n        const day = String(today.getDate()).padStart(2, '0');\n        const dateStr = `${year}-${month}-${day}`;\n\n        // 必须先选择就诊园区\n        const location = this.form.location;\n        if (!location || (location !== 'land_park' && location !== 'water_park')) {\n          uni.hideLoading();\n          uni.showToast({ title: '请选择就诊园区', icon: 'none' });\n          // 如有需要，可同时弹出园区选择提示\n          this.showLocationTip = true;\n          return;\n        }\n        const locationName = location === 'land_park' ? '陆园' : '水园';\n\n        // 查询当日的所有门诊记录\n        // 查询 clinic_records 集合（完整门诊登记信息）\n        let records = [];\n        try {\n          // 使用 clinicRecords 云函数查询完整的门诊登记记录\n          const res = await wx.cloud.callFunction({\n            name: 'clinicRecords',\n            data: {\n              action: 'list',\n              data: {\n                location: location,\n                startDate: dateStr,\n                endDate: dateStr,\n                pageSize: 1000,\n                useClinicRecords: true  // 查询完整的门诊登记记录\n              }\n            }\n          });\n\n          if (res.result && res.result.success && res.result.data && res.result.data.list) {\n            records = res.result.data.list;\n          }\n        } catch (err) {\n          console.error('查询门诊记录失败:', err);\n        }\n\n        if (records.length === 0) {\n          uni.hideLoading();\n          uni.showToast({\n            title: '当日无门诊记录',\n            icon: 'none',\n            duration: 2000\n          });\n          return;\n        }\n\n        // 生成文档和统计信息\n        const report = this.formatDailyReport(records, dateStr, locationName);\n        const stats = this.calculateStats(records);\n        \n        // 准备详细的表格数据\n        const tableData = this.prepareTableData(records);\n\n        uni.hideLoading();\n\n        // 跳转到日报显示页面\n        const reportDate = `${year}年${month}月${day}日`;\n        uni.navigateTo({\n          url: `/pages-sub/report/daily?content=${encodeURIComponent(report)}&date=${encodeURIComponent(reportDate)}&location=${encodeURIComponent(locationName)}&stats=${encodeURIComponent(JSON.stringify(stats))}&tableData=${encodeURIComponent(JSON.stringify(tableData))}`,\n          fail: (err) => {\n            console.error('跳转失败:', err);\n            // 如果跳转失败，复制到剪贴板\n            uni.setClipboardData({\n              data: report,\n              success: () => {\n                uni.showToast({\n                  title: '已复制到剪贴板',\n                  icon: 'success'\n                });\n              }\n            });\n          }\n        });\n      } catch (err) {\n        console.error('生成日报失败:', err);\n        uni.hideLoading();\n        uni.showToast({\n          title: '生成失败：' + (err.message || '未知错误'),\n          icon: 'none',\n          duration: 3000\n        });\n      }\n    },\n\n    // 格式化日报\n    formatDailyReport(records, dateStr, locationName) {\n      // 解析日期\n      const date = new Date(dateStr);\n      const year = date.getFullYear();\n      const month = date.getMonth() + 1;\n      const day = date.getDate();\n      const dateFormatted = `${year}年${month}月${day}日`;\n\n      // 统计信息\n      const stats = {\n        total: records.length,\n        visitor: [],\n        employee: [],\n        outcall: []\n      };\n\n      // 按身份和疾病分类统计\n      records.forEach(record => {\n        const identity = record.identity || '游客';\n        const diseaseName = record.diseaseName || '未知';\n        const injuryLocation = record.injuryLocation || '';\n        const isOutcall = record.isOutcall || record.visitType === 'outcall';\n\n        if (isOutcall && injuryLocation) {\n          // 统计出诊\n          const existing = stats.outcall.find(item => item.location === injuryLocation);\n          if (existing) {\n            existing.count++;\n          } else {\n            stats.outcall.push({ location: injuryLocation, count: 1 });\n          }\n        }\n\n        if (identity === '游客') {\n          // 游客统计\n          const existing = stats.visitor.find(item => item.disease === diseaseName);\n          if (existing) {\n            if (injuryLocation && injuryLocation.trim()) {\n              const loc = existing.locations.find(l => l.name === injuryLocation);\n              if (loc) {\n                loc.count++;\n              } else {\n                existing.locations.push({ name: injuryLocation, count: 1 });\n              }\n            }\n            existing.total++;\n          } else {\n            stats.visitor.push({\n              disease: diseaseName,\n              total: 1,\n              locations: (injuryLocation && injuryLocation.trim()) ? [{ name: injuryLocation, count: 1 }] : []\n            });\n          }\n        } else if (identity === '员工') {\n          // 员工统计\n          const existing = stats.employee.find(item => item.disease === diseaseName);\n          if (existing) {\n            existing.total++;\n          } else {\n            stats.employee.push({\n              disease: diseaseName,\n              total: 1\n            });\n          }\n        }\n      });\n\n      // 生成文档内容\n      let report = `${dateFormatted}欢乐谷医务室（${locationName}）当日接诊${stats.total}人。\\n`;\n\n      // 游客统计\n      if (stats.visitor.length > 0) {\n        const visitorTotal = stats.visitor.reduce((sum, item) => sum + item.total, 0);\n        report += `游客${visitorTotal}人：`;\n        \n        const visitorParts = [];\n        stats.visitor.forEach(item => {\n          if (item.locations && item.locations.length > 0) {\n            // 有地点的疾病：疾病X人（地点1X人，地点2X人）\n            const locationParts = item.locations.map(loc => `${loc.name}${loc.count}人`);\n            visitorParts.push(`${item.disease}${item.total}人（${locationParts.join('，')}）`);\n          } else {\n            // 无地点的疾病：疾病X人\n            visitorParts.push(`${item.disease}${item.total}人`);\n          }\n        });\n        report += visitorParts.join('，') + '。\\n';\n      }\n\n      // 员工统计\n      if (stats.employee.length > 0) {\n        const employeeTotal = stats.employee.reduce((sum, item) => sum + item.total, 0);\n        report += `员工${employeeTotal}人：`;\n        const employeeParts = stats.employee.map(item => `${item.disease}${item.total}人`);\n        report += employeeParts.join('，') + '。\\n';\n      }\n\n      // 出诊统计\n      if (stats.outcall.length > 0) {\n        const outcallTotal = stats.outcall.reduce((sum, item) => sum + item.count, 0);\n        report += `出诊${outcallTotal}次：`;\n        const outcallParts = stats.outcall.map(item => `${item.location}${item.count}次`);\n        report += outcallParts.join('，') + '。\\n';\n      }\n\n      return report.trim();\n    },\n\n    // 计算统计信息\n    calculateStats(records) {\n      const stats = {\n        total: records.length,\n        visitorTotal: 0,\n        employeeTotal: 0,\n        outcallTotal: 0\n      };\n\n      records.forEach(record => {\n        const identity = record.identity || '游客';\n        const isOutcall = record.isOutcall || record.visitType === 'outcall';\n\n        if (identity === '游客') {\n          stats.visitorTotal++;\n        } else if (identity === '员工') {\n          stats.employeeTotal++;\n        }\n\n        if (isOutcall) {\n          stats.outcallTotal++;\n        }\n      });\n\n      return stats;\n    },\n\n    // 准备表格数据\n    prepareTableData(records) {\n      const visitorData = [];\n      const employeeData = [];\n      let doctorName = '';\n      try {\n        const userInfo = uni.getStorageSync('userInfo');\n        doctorName = userInfo?.name || '';\n      } catch (err) {\n        console.error('获取用户信息失败:', err);\n      }\n\n      records.forEach(record => {\n        const identity = record.identity || '游客';\n        const diseaseName =\n          record.diseaseName ||\n          record.diagnosis ||\n          record.chiefComplaint ||\n          '未知';\n        const data = {\n          name: record.name || '',\n          diseaseName,\n          location: record.injuryLocation || '',\n          visitTime: record.visitDateTime || record.createTime || '',\n          isOutcall: record.isOutcall || record.visitType === 'outcall',\n          doctorName: doctorName\n        };\n\n        if (identity === '游客') {\n          visitorData.push(data);\n        } else if (identity === '员工') {\n          employeeData.push(data);\n        }\n      });\n\n      return {\n        visitor: visitorData,\n        employee: employeeData\n      };\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.clinic-add {\n  min-height: 100vh;\n  // 使用与首页/门诊首页一致的蓝色渐变背景\n  background: linear-gradient(180deg, #00c9ff 0%, #00a0ff 35%, #e5e7eb 100%);\n  padding: 24rpx 24rpx 40rpx;\n}\n\n.clinic-scroll {\n  box-sizing: border-box;\n  padding-bottom: 120rpx; // 预留空间避免被底部固定按钮遮挡\n}\n\n// 顶部标题\n.page-header {\n  // 顶部标题卡片：象牙白圆角卡片，宽度与首页 header-card 对齐\n  max-width: 702rpx;\n  margin: 0 auto 8rpx;\n  padding: 40rpx 30rpx;\n  background: #FFFFF0;\n  border-radius: 22rpx;\n  text-align: center;\n  box-shadow:\n    0 1rpx 0 rgba(255, 255, 255, 0.9) inset,\n    0 -1rpx 0 rgba(15, 23, 42, 0.06) inset,\n    0 18rpx 40rpx rgba(15, 23, 42, 0.14);\n\n  .title {\n    font-size: 44rpx;\n    font-weight: bold;\n    color: #0f172a;\n    margin-bottom: 16rpx;\n    letter-spacing: 2rpx;\n  }\n\n  .subtitle {\n    font-size: 36rpx;\n    font-weight: bold;\n    color: #111827;\n    margin-bottom: 16rpx;\n    padding: 16rpx 0;\n    border-bottom: 4rpx solid rgba(59, 130, 246, 0.6);\n    display: inline-block;\n  }\n}\n\n.top-actions-card {\n  margin: 0 0 12rpx 0;\n  padding: 16rpx 18rpx 18rpx;\n  background: #FFFFF0;\n  border-radius: 24rpx;\n  box-shadow: 0 8rpx 20rpx rgba(15, 23, 42, 0.14);\n}\n\n.top-buttons {\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n  justify-content: center;\n  flex-wrap: nowrap;\n  gap: 20rpx;\n}\n\n.top-btn {\n  flex: 1;\n  min-width: 0;\n  padding: 18rpx 0;\n  border-radius: 999rpx;\n  font-size: 28rpx;\n  /* 覆盖小程序 button 的默认 block+全宽行为，保证在一行内平分 */\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-sizing: border-box;\n  margin: 0;\n  background: linear-gradient(135deg, #22c1c3 0%, #2a91e9 100%);\n  border: none;\n  color: #ffffff;\n}\n\n.top-btn.primary {\n  background: linear-gradient(135deg, #22c1c3 0%, #2a91e9 100%);\n}\n\n.top-btn.ghost {\n  background: linear-gradient(135deg, #22c1c3 0%, #2a91e9 100%);\n}\n\n.form-section {\n  max-width: 702rpx;\n  margin: 0 auto 8rpx;\n  padding: 32rpx 30rpx 30rpx;\n  background: #FFFFF0;\n  border-radius: 24rpx;\n  box-shadow: 0 8rpx 20rpx rgba(15, 23, 42, 0.12);\n}\n\n.section-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #0f172a;\n  margin-bottom: 30rpx;\n  padding-bottom: 20rpx;\n  border-bottom: 3rpx solid rgba(226, 232, 240, 0.9);\n  display: flex;\n  align-items: center;\n}\n\n.form-item {\n  margin-bottom: 30rpx;\n\n  &.half {\n    flex: 1;\n  }\n\n  .label {\n    font-size: 30rpx;\n    color: #333;\n    margin-bottom: 16rpx;\n    display: block;\n    font-weight: 500;\n\n    &.required::before {\n      content: '*';\n      color: #ff4d4f;\n      margin-right: 8rpx;\n      font-weight: bold;\n    }\n  }\n\n  input {\n    width: 100%;\n    height: 80rpx;\n    line-height: 80rpx;\n    padding: 0 24rpx;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    font-size: 28rpx;\n    background: #fafafa;\n    transition: all 0.3s;\n    box-sizing: border-box;\n  }\n\n  // 稍大一点的多行 textarea（如处置等）\n  .textarea-small {\n    min-height: 104rpx !important;  // 固定两行高度\n    max-height: 104rpx !important;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    background: #f9fafb;\n    font-size: 28rpx;\n    color: #333;\n  }\n\n  // 自适应高度的 textarea\n  .textarea-auto {\n    min-height: 104rpx !important;  // 固定两行高度\n    height: 104rpx !important;\n    max-height: 104rpx !important;\n    padding: 12rpx 24rpx !important;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    background: #f9fafb;\n    font-size: 28rpx;\n    color: #333;\n    line-height: 1.4 !important;\n    word-wrap: break-word;\n    word-break: break-all;\n    transition: all 0.3s;\n    box-sizing: border-box;\n    \n    &:focus {\n      border-color: #1890ff;\n      background: #ffffff;\n      box-shadow: 0 0 0 4rpx rgba(24, 144, 255, 0.1);\n    }\n    \n    &::placeholder {\n      color: #999;\n      font-size: 26rpx;\n    }\n    \n    // 内容较长时使用中等字号\n    &.font-medium {\n      font-size: 26rpx !important;\n    }\n    \n    // 内容很长时使用小字号\n    &.font-small {\n      font-size: 24rpx !important;\n      line-height: 1.5 !important;\n    }\n  }\n}\n\n.input-compact {\n  height: 80rpx;\n  line-height: 80rpx;\n  padding: 0 24rpx;\n  border: 2rpx solid #e0e0e0;\n  border-radius: 12rpx;\n  background: #f9fafb;\n  font-size: 28rpx;\n  color: #333;\n  transition: all 0.3s;\n  box-sizing: border-box;\n  \n  &:focus {\n    border-color: #1890ff;\n    background: #ffffff;\n    box-shadow: 0 0 0 4rpx rgba(24, 144, 255, 0.1);\n  }\n  \n  &::placeholder {\n    color: #999;\n    font-size: 26rpx;\n  }\n}\n\n.form-row {\n  display: flex;\n  gap: 24rpx;        // 统一两列之间的间距\n}\n\n.datetime-display {\n  padding: 20rpx;\n  background: #e6f7ff;\n  border: 2rpx solid #91d5ff;\n  border-radius: 12rpx;\n  font-size: 32rpx;\n  color: #1890ff;\n  font-weight: bold;\n  text-align: center;\n  height: 80rpx;  // 统一高度\n  box-sizing: border-box;\n  line-height: 1.6;  // 统一行高\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.gender-selector,\n.identity-selector {\n  display: flex;\n  gap: 20rpx;\n\n  .identity-item {\n    flex: 1;\n    height: 80rpx;  // 统一高度\n    padding: 20rpx;\n    text-align: center;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    font-size: 28rpx;\n    color: #666;\n    background: #fafafa;\n    transition: all 0.3s;\n    font-weight: 500;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-sizing: border-box;\n\n    &.active {\n      border-color: #1890ff;\n      background: #e6f7ff;\n      color: #1890ff;\n      font-weight: bold;\n      transform: scale(1.05);\n    }\n  }\n}\n\n.visit-type-selector {\n  .identity-item {\n    justify-content: center;\n  }\n}\n\n.visit-type-text {\n  font-size: 26rpx;\n}\n\n.gender-selector {\n  display: flex;\n  gap: 20rpx;\n\n  &.compact {\n    flex: 1;\n    min-width: 0;\n  }\n\n  .gender-item {\n    flex: 1;\n    height: 80rpx;  // 统一高度\n    padding: 20rpx;\n    text-align: center;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    font-size: 28rpx;\n    color: #666;\n    background: #fafafa;\n    transition: all 0.3s;\n    font-weight: 500;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-sizing: border-box;\n\n    &.active {\n      border-color: #1890ff;\n      background: #e6f7ff;\n      color: #1890ff;\n      font-weight: bold;\n      transform: scale(1.05);\n    }\n    }\n  }\n\n.gender-age-row {\n  display: flex;\n  gap: 15rpx;\n  align-items: center;\n  width: 100%;\n  justify-content: space-between; // 让年龄输入框贴到右边\n}\n\n.gender-selector.compact {\n  flex: 1; // 性别按钮组占据左侧剩余空间\n}\n\n.age-input {\n  flex: 0 0 120rpx;\n  min-width: 120rpx;\n  padding: 20rpx 16rpx;\n  border: 2rpx solid #e0e0e0;\n  border-radius: 12rpx;\n  font-size: 26rpx;\n  background: #fafafa;\n  text-align: center;\n  box-sizing: border-box;\n  height: 80rpx;\n  \n  &:focus {\n    border-color: #1890ff;\n    background: white;\n  }\n}\n\n// 药材输入包装器\n.drug-input-wrapper {\n  position: relative;\n  width: 100%;\n\n  input {\n    width: 100%;\n    padding: 20rpx 24rpx;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    font-size: 26rpx;\n    background: white;\n    transition: all 0.3s;\n    box-sizing: border-box;\n    height: 80rpx;  // 统一高度\n    line-height: 1.6;  // 统一行高\n\n    &:focus {\n      border-color: #1890ff;\n      box-shadow: 0 0 0 4rpx rgba(24, 144, 255, 0.1);\n    }\n    \n    &::placeholder {\n      font-size: 26rpx;\n      color: #999;\n    }\n  }\n\n  // 药材下拉列表（显示在输入框上方，避免被键盘遮挡）\n  .drug-dropdown {\n    position: absolute;\n    bottom: 100%;\n    left: 0;\n    right: 0;\n    margin-bottom: 8rpx;\n    background: white;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.15);\n    z-index: 1000;\n    max-height: 600rpx;\n    overflow: hidden;\n    \n    .dropdown-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16rpx 20rpx;\n      background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);\n      border-bottom: 1rpx solid #7dd3fc;\n      \n      .dropdown-title {\n        font-size: 26rpx;\n        font-weight: bold;\n        color: #0369a1;\n      }\n      \n      .dropdown-count {\n        font-size: 22rpx;\n        color: #0891b2;\n      }\n    }\n\n    .drug-scroll {\n      max-height: 540rpx;\n    }\n\n    .drug-item {\n      padding: 24rpx 20rpx;\n      border-bottom: 1rpx solid #f0f0f0;\n      transition: background 0.2s;\n\n      &:active {\n        background: #f5f5f5;\n      }\n\n      &:last-child {\n        border-bottom: none;\n      }\n\n      .drug-name {\n        font-size: 26rpx;\n        color: #333;\n        font-weight: 500;\n        margin-bottom: 8rpx;\n      }\n\n      .drug-spec {\n        font-size: 24rpx;\n        color: #999;\n      }\n    }\n  }\n\n  .no-result {\n    position: absolute;\n    bottom: 100%;\n    left: 0;\n    right: 0;\n    margin-bottom: 8rpx;\n    padding: 40rpx 20rpx;\n    background: white;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    text-align: center;\n    font-size: 26rpx;\n    color: #999;\n    box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.1);\n    z-index: 1000;\n  }\n}\n\n// 疾病名称输入包装器\n.disease-input-wrapper {\n  position: relative;\n  width: 100%;\n\n  input {\n    height: 80rpx;  // 统一高度\n    line-height: 1.6;  // 统一行高\n    font-size: 26rpx;\n    padding: 20rpx 24rpx;\n  }\n\n  .disease-dropdown {\n    position: absolute;\n    bottom: 100%;\n    left: 0;\n    right: 0;\n    margin-bottom: 8rpx;\n    background: white;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.15);\n    z-index: 1000;\n    max-height: 400rpx;\n    overflow: hidden;\n\n    .disease-scroll {\n      max-height: 400rpx;\n    }\n\n    .disease-item {\n      padding: 24rpx 20rpx;\n      border-bottom: 1rpx solid #f0f0f0;\n      font-size: 26rpx;\n      color: #333;\n      transition: background 0.2s;\n\n      &:active {\n        background: #e6f7ff;\n      }\n\n      &:last-child {\n        border-bottom: none;\n      }\n    }\n  }\n}\n\n// 处置药材建议 chips\n.drug-chip-list {\n  margin-top: 10rpx;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10rpx;\n}\n.drug-chip {\n  padding: 10rpx 14rpx;\n  background: #f4f7ff;\n  border: 2rpx solid #c7d2fe;\n  color: #334155;\n  border-radius: 999rpx;\n  font-size: 24rpx;\n}\n\n// 受伤地点输入包装器\n.location-input-wrapper {\n  position: relative;\n  width: 100%;\n\n  input {\n    height: 80rpx;\n    line-height: 1.6;\n    font-size: 26rpx;\n    padding: 20rpx 24rpx;\n  }\n\n  .location-dropdown {\n    position: absolute;\n    bottom: 100%;\n    left: 0;\n    right: 0;\n    margin-bottom: 8rpx;\n    background: white;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.15);\n    z-index: 1000;\n    max-height: 400rpx;\n    overflow: hidden;\n  }\n\n  .location-scroll {\n    max-height: 400rpx;\n  }\n\n  .location-item {\n    padding: 24rpx 20rpx;\n    border-bottom: 1rpx solid #f0f0f0;\n    font-size: 26rpx;\n    color: #333;\n    transition: background 0.2s;\n\n    &:active {\n      background: #e6f7ff;\n    }\n\n    &:last-child {\n      border-bottom: none;\n    }\n  }\n}\n\n// 用药信息快速登记版\n.drug-quick-info {\n  margin-top: 20rpx;\n  padding: 0;\n}\n\n// 药材名称大卡片\n.drug-name-card {\n  display: flex;\n  align-items: center;\n  padding: 28rpx 32rpx;\n  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n  border-radius: 20rpx;\n  box-shadow: 0 6rpx 20rpx rgba(251, 191, 36, 0.25);\n  border: 3rpx solid #fbbf24;\n  margin-bottom: 20rpx;\n  .drug-details {\n    flex: 1;\n  }\n  \n  .drug-main-name {\n    font-size: 36rpx;\n    font-weight: bold;\n    color: #78350f;\n    line-height: 1.4;\n    margin-bottom: 8rpx;\n  }\n  \n  .drug-spec-text {\n    font-size: 24rpx;\n    color: #92400e;\n    font-weight: 500;\n  }\n}\n\n// 快速信息栏\n.quick-info-bar {\n  display: flex;\n  gap: 12rpx;\n  margin-bottom: 20rpx;\n  flex-wrap: wrap;\n}\n\n.info-tag {\n  display: flex;\n  align-items: center;\n  padding: 18rpx 22rpx;\n  background: white;\n  border-radius: 16rpx;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);\n  flex: 1;\n  min-width: 0;\n  .tag-text {\n    font-size: 24rpx;\n    font-weight: 600;\n    color: #334155;\n  }\n  \n  &.park-tag {\n    background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);\n    border: 2rpx solid #60a5fa;\n    \n    .tag-text {\n      color: #1e40af;\n    }\n  }\n  \n  &.stock-tag {\n    background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);\n    border: 2rpx solid #34d399;\n    \n    .tag-text {\n      color: #065f46;\n    }\n    \n    &.stock-warning {\n      background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);\n      border: 2rpx solid #f87171;\n      \n      .tag-text {\n        color: #991b1b;\n      }\n    }\n  }\n  \n  &.unit-tag {\n    background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);\n    border: 2rpx solid #818cf8;\n    \n    .tag-text {\n      color: #3730a3;\n    }\n  }\n}\n\n// 数量输入大卡片\n.quantity-card {\n  padding: 28rpx 32rpx;\n  background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%);\n  border-radius: 20rpx;\n  box-shadow: 0 6rpx 20rpx rgba(20, 184, 166, 0.2);\n  border: 3rpx solid #14b8a6;\n  \n  .quantity-label {\n    display: flex;\n    align-items: center;\n    margin-bottom: 20rpx;\n    .label-text {\n      font-size: 28rpx;\n      font-weight: bold;\n      color: #0f766e;\n    }\n    \n    .required-star {\n      color: #dc2626;\n      font-size: 28rpx;\n      margin-left: 6rpx;\n      font-weight: bold;\n    }\n  }\n  \n  .quantity-input-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 16rpx;\n    margin-bottom: 16rpx;\n  }\n  \n  .quantity-input-large {\n    flex: 1;\n    padding: 24rpx 28rpx;\n    background: white;\n    border: 4rpx solid #14b8a6;\n    border-radius: 16rpx;\n    font-size: 44rpx;  // 数量输入框保持大字号\n    font-weight: bold;\n    color: #0f766e;\n    text-align: center;\n    box-shadow: 0 4rpx 12rpx rgba(20, 184, 166, 0.15);\n    height: 100rpx;  // 固定高度\n    line-height: 1.2;  // 行高\n    \n    &:focus {\n      border-color: #0d9488;\n      box-shadow: 0 0 0 4rpx rgba(20, 184, 166, 0.2);\n    }\n  }\n  \n  .quantity-unit-display {\n    padding: 24rpx 28rpx;\n    background: white;\n    border: 4rpx solid #5eead4;\n    border-radius: 16rpx;\n    font-size: 44rpx;  // 单位字号与输入框统一\n    font-weight: bold;\n    color: #14b8a6;\n    min-width: 140rpx;  // 增加最小宽度，确保显示完整\n    text-align: center;\n    box-shadow: 0 4rpx 12rpx rgba(20, 184, 166, 0.15);\n    height: 100rpx;  // 与输入框高度统一\n    line-height: 1.2;  // 行高统一\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n}\n\n.drug-info {\n  margin-top: 16rpx;\n  padding: 16rpx;\n  background: #f6ffed;\n  border-radius: 12rpx;\n  font-size: 24rpx;\n  color: #52c41a;\n\n  .spec,\n  .stock {\n    display: block;\n    margin-bottom: 8rpx;\n  }\n}\n\n.quantity-input {\n  display: flex;\n  align-items: center;\n\n  input {\n    flex: 1;\n    height: 80rpx;  // 统一高度\n    line-height: 1.6;  // 统一行高\n  }\n\n  .unit {\n    margin-left: 16rpx;\n    font-size: 26rpx;  // 统一字号\n    color: #666;\n    font-weight: 500;\n  }\n}\n\n.batch-info {\n  padding: 24rpx;\n  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n  border-radius: 16rpx;\n  border: 2rpx solid #7dd3fc;\n  box-shadow: 0 2rpx 8rpx rgba(14, 165, 233, 0.1);\n  margin-top: 20rpx;\n\n  .batch-item {\n    display: flex;\n    align-items: center;\n    margin-bottom: 14rpx;\n    font-size: 24rpx;\n    \n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    .label {\n      color: #64748b;\n      font-weight: 600;\n      font-size: 24rpx;\n      margin-right: 10rpx;\n    }\n    \n    text {\n      color: #334155;\n      font-size: 24rpx;\n      font-weight: 500;\n    }\n\n    .warning {\n      color: #dc2626;\n      margin-left: 8rpx;\n      font-weight: bold;\n    }\n  }\n}\n\n// 库存不足警告\n.quantity-warning {\n  display: flex;\n  align-items: center;\n  padding: 16rpx 20rpx;\n  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);\n  border-radius: 12rpx;\n  border: 2rpx solid #fca5a5;\n  margin-top: 16rpx;\n  animation: shake 0.5s ease-in-out;\n  .warning-text {\n    color: #dc2626;\n    font-size: 26rpx;\n    font-weight: 600;\n    flex: 1;\n  }\n}\n\n@keyframes shake {\n  0%, 100% { transform: translateX(0); }\n  25% { transform: translateX(-10rpx); }\n  75% { transform: translateX(10rpx); }\n}\n\n// 签名提示\n.signature-info {\n  margin-bottom: 20rpx;\n}\n\n.signature-tip {\n  display: flex;\n  align-items: center;\n  padding: 16rpx 20rpx;\n  background: #e6f7ff;\n  border-left: 4rpx solid #1890ff;\n  border-radius: 8rpx;\n  \n  .tip-text {\n    font-size: 24rpx;\n    color: #0050b3;\n    line-height: 1.6;\n  }\n}\n\n// 签名区域\n.signature-section {\n  padding: 20rpx 0;\n\n  .signature-preview {\n    position: relative;\n    border: 3rpx solid #52c41a;\n    border-radius: 16rpx;\n    padding: 24rpx;\n    background: #f6ffed;\n    \n    .signature-label {\n      font-size: 26rpx;\n      color: #52c41a;\n      font-weight: bold;\n      margin-bottom: 16rpx;\n      display: block;\n    }\n\n    .signature-image {\n      width: 100%;\n      height: 200rpx;\n      border: 2rpx dashed #b7eb8f;\n      border-radius: 12rpx;\n      background: white;\n    }\n    \n    .signature-time {\n      margin-top: 12rpx;\n      font-size: 24rpx;\n      color: #666;\n      text-align: center;\n    }\n\n    .re-sign-btn {\n      margin-top: 20rpx;\n      width: 100%;\n      padding: 20rpx;\n      background: white;\n      color: #1890ff;\n      border: 2rpx solid #1890ff;\n      border-radius: 12rpx;\n      font-size: 28rpx;\n      font-weight: 500;\n    }\n  }\n\n  .sign-btn {\n    width: 100%;\n    padding: 50rpx;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    border-radius: 16rpx;\n    font-size: 34rpx;\n    font-weight: bold;\n    border: 4rpx dashed rgba(255, 255, 255, 0.5);\n    box-shadow: 0 8rpx 24rpx rgba(102, 126, 234, 0.4);\n    \n    &:active {\n      transform: scale(0.98);\n      box-shadow: 0 4rpx 16rpx rgba(102, 126, 234, 0.5);\n    }\n  }\n}\n\n.submit-section {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  display: flex;\n  gap: 20rpx;\n  padding: 16rpx 24rpx 34rpx;\n  background: #FFFFF0;\n  box-shadow: 0 -4rpx 16rpx rgba(15, 23, 42, 0.22);\n  border-top-left-radius: 24rpx;\n  border-top-right-radius: 24rpx;\n  z-index: 100;\n}\n\n.submit-section button {\n  flex: 1;\n  padding: 28rpx;\n  border-radius: 12rpx;\n  font-size: 32rpx;\n  font-weight: bold;\n}\n\n.submit-section .cancel-btn {\n  background: linear-gradient(135deg, #22c1c3 0%, #2a91e9 100%);\n  border: none;\n  color: #ffffff;\n  border-radius: 999rpx;\n}\n\n.submit-section .submit-btn {\n  background: linear-gradient(135deg, #22c1c3 0%, #2a91e9 100%);\n  border: none;\n  color: #ffffff;\n  border-radius: 999rpx;\n}\n\n.continue-option {\n  padding: 20rpx 24rpx 40rpx;\n  margin: 0 auto 8rpx;\n  max-width: 702rpx;\n}\n\n.continue-card {\n  display: flex;\n  align-items: center;\n  padding: 24rpx 28rpx;\n  background: white;\n  border-radius: 16rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n  transition: all 0.3s;\n\n  &:active {\n    transform: scale(0.98);\n    box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.15);\n  }\n}\n\n.continue-checkbox {\n  margin-right: 20rpx;\n  \n  checkbox {\n    transform: scale(1.3);\n  }\n}\n\n.continue-text {\n  flex: 1;\n}\n\n.continue-title {\n  font-size: 30rpx;\n  font-weight: bold;\n  color: #1890ff;\n  margin-bottom: 8rpx;\n}\n\n.continue-desc {\n  font-size: 24rpx;\n  color: #999;\n  line-height: 1.5;\n}\n\n/* 园区选择悬浮窗样式 */\n.location-modal-overlay {\n  position: fixed;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(15, 23, 42, 0.55);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999;\n}\n\n.location-modal {\n  width: 86%;\n  max-width: 720rpx;\n  background: #FFFFF0;\n  border-radius: 28rpx;\n  padding: 30rpx 30rpx 26rpx;\n  box-shadow:\n    0 1rpx 0 rgba(255,255,255,0.9) inset,\n    0 -1rpx 0 rgba(15,23,42,0.06) inset,\n    0 18rpx 40rpx rgba(15, 23, 42, 0.35);\n  border: 1rpx solid rgba(148, 163, 184, 0.35);\n}\n\n.modal-icon-row {\n  display: flex;\n  justify-content: center;\n  margin-bottom: 8rpx;\n}\n\n.modal-icon-circle {\n  width: 72rpx;\n  height: 72rpx;\n  border-radius: 999rpx;\n  background: linear-gradient(135deg, #2563eb 0%, #38bdf8 40%, #e0f2fe 100%);\n  color: #ffffff;\n  font-size: 32rpx;\n  font-weight: 700;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 8rpx 18rpx rgba(37, 99, 235, 0.45);\n  border: 3rpx solid rgba(255,255,255,0.9);\n}\n\n.modal-title {\n  font-size: 32rpx;\n  font-weight: 600;\n  text-align: center;\n  margin: 10rpx 0 6rpx;\n}\n\n.modal-subtitle {\n  font-size: 24rpx;\n  text-align: center;\n  color: #6b7280;\n  margin-bottom: 26rpx;\n  line-height: 1.5;\n}\n\n.modal-location-buttons {\n  display: flex;\n  gap: 20rpx;\n  margin-bottom: 20rpx;\n}\n\n.modal-loc-btn {\n  flex: 1;\n  padding: 20rpx 0;\n  border-radius: 999rpx;\n  border: 2rpx solid #d1d5db;\n  font-size: 28rpx;\n  background: #ffffff;\n  color: #374151;\n  box-shadow: 0 2rpx 6rpx rgba(15, 23, 42, 0.08);\n}\n\n.modal-loc-btn.active {\n  background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);\n  border-color: #2563eb;\n  color: #ffffff;\n  box-shadow: 0 6rpx 14rpx rgba(37, 99, 235, 0.45);\n}\n\n.modal-hint-text {\n  font-size: 22rpx;\n  color: #6b7280;\n  line-height: 1.5;\n  margin-bottom: 18rpx;\n}\n\n.modal-row {\n  display: flex;\n  align-items: center;\n  margin-bottom: 22rpx;\n  font-size: 26rpx;\n  color: #4b5563;\n}\n\n.modal-checkbox-text {\n  margin-left: 12rpx;\n}\n\n.modal-close-btn {\n  width: 100%;\n  padding: 18rpx 0;\n  border-radius: 999rpx;\n  border: 1rpx solid #d1d5db;\n  background: #f9fafb;\n  color: #4b5563;\n  font-size: 28rpx;\n}\n</style>\n","import mod from \"-!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./add.vue?vue&type=style&index=0&id=0904e2e0&lang=scss&scoped=true&\"; export default mod; export * from \"-!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!F:\\\\google下载资料\\\\HBuilderX.4.84.2025110307\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./add.vue?vue&type=style&index=0&id=0904e2e0&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1764631784305\n      var cssReload = require(\"F:/google下载资料/HBuilderX.4.84.2025110307/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}