{"version":3,"sources":["uni-app:///main.js",null,"webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?1fe6","webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?061e","webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?93c8","uni-app:///pages-sub/clinic/add.vue","webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?57b7","webpack:///D:/AK-PMS/pages-sub/clinic/add.vue?e7ad"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","diseaseId","diseaseName","complaint","components","Signature","data","locations","label","value","identityOptions","visitTypeOptions","diseaseTemplates","treatmentTemplates","complaintTemplates","treatmentCautions","hvTriage","diseaseTemplateLib","symptoms","diagnoses","treatments","suggestDrugs","drugSuggestionList","rxDrugNames","form","visitDateTime","name","gender","age","identity","location","visitType","injuryLocation","chiefComplaint","symptom","diagnosis","treatment","drugId","quantity","remark","doctorSign","signTime","showLocationTip","noTipNextTime","currentDateTime","selectedDrug","selectedBatch","availableStock","enablePrescription","prescriptionList","prescriptionNo","currentDate","currentDrug","dosage","frequency","route","usage","frequencyIndex","routeIndex","dosageTemplates","routeOptions","frequencyOptions","drugSearchText","allDrugs","filteredDrugs","showDrugList","diseaseOptions","filteredDiseases","showDiseaseList","filteredDiagnosis","showDiagnosisList","filteredTreatments","showTreatmentList","filteredComplaints","showComplaintList","complaintSelectedMode","complaintFocus","filteredSymptoms","showSymptomList","standardizedSymptoms","symptomBlurTimer","symptomInputTimer","fetchHvSuggestionTimer","diseaseBlurTimer","complaintBlurTimer","diagnosisBlurTimer","diseaseInputTimer","diagnosisInputTimer","ageFocus","allLocations","filteredLocations","showLocationList","showDrugSelector","submitting","continueAfterSubmit","activeFieldId","dateTimeTimerId","userDiseaseTemplates","templateIndex","globalSearchKeyword","computed","currentLocationLabel","locationLocked","complaintFontSizeClass","diagnosisFontSizeClass","currentFrequencyLabel","currentRouteLabel","onLoad","onUnload","clearInterval","clearTimeout","watch","uni","title","content","confirmText","cancelText","confirmColor","success","methods","clearAllRelatedFields","console","initPrescription","onFrequencyChange","onRouteChange","onPrescriptionSwitch","getRealMinUnit","addToPrescription","icon","example","editable","placeholderText","that","drugName","specification","unit","batchId","batchNumber","removeFromPrescription","quickAddToPrescription","duration","selector","onFieldFocus","onDoctorSignChange","restoreUserDiseaseTemplates","buildTemplateIndex","index","disease","source","idx","userIdx","performGlobalSearch","diseases","complaints","match","matchedRecords","key","record","extraComplaints","mergedMap","findBestMatchingRecord","dLower","diagnosisLower","score","inputComplaintLower","inputDiseaseLower","bestScore","bestMatch","smartFillFields","options","preserveComplaint","preserveSymptom","preserveDiagnosis","preserveTreatment","setIdentity","setVisitType","openLocationSelector","itemList","closeLocationTip","handleLocationSelect","updateDateTime","loadAllDrugs","action","pageSize","res","onDrugInputFocus","loadLocationDrugs","stockList","filter","map","_id","minUnit","packUnit","conversionRate","stock","onDrugSearch","genericName","spec","hitTrade","pinyin","selectDrugFromList","onDiseaseFocus","onDiseaseBlur","onDiseaseInput","selectDisease","forceFill","loadTemplatesForDisease","flatMap","autoFillByDisease","arr","pushUnique","onDiagnosisFocus","onDiagnosisInput","selectDiagnosis","text","bestRecord","onComplaintFocus","onComplaintInput","onComplaintBlur","fetchHvSuggestion","payload","code","category","severity","selected","symptomText","onSymptomFocus","onSymptomInput","filterSymptomsByInput","matched","matchedNames","onSymptomBlur","selectSymptom","toggleSymptomTag","analyzeDiseaseFromDiagnosis","keywords","rule","onDiagnosisBlur","diagnosisText","openDiagnosisGuide","selectComplaint","onTreatmentFocus","onTreatmentInput","selectTreatment","appendTreatment","saveCurrentAsTemplate","target","promptSaveTemplate","normalizeText","ensureStockLoaded","isPrescriptionDrug","applySuggestDrugs","list","findDrugByName","onDrugChip","drug","restoreLastLocation","selectLocation","onLocationFocus","onLocationInput","selectLocationFromList","onDrugSelect","id","drugCode","manufacturer","loadBatches","enableFIFO","batches","parkName","openSignature","onSignatureConfirm","handleSubmit","hasValidDrugUsage","submitData","isOutcall","intQuantity","batch","setTimeout","scrollTop","resetForm","formatDate","toggleContinue","goBack","generateDailyReport","today","year","month","day","dateStr","locationName","records","startDate","endDate","useClinicRecords","report","stats","tableData","reportDate","url","fail","formatDailyReport","total","visitor","employee","outcall","existing","count","loc","visitorParts","calculateStats","visitorTotal","employeeTotal","outcallTotal","prepareTableData","doctorName","visitTime","visitorData","employeeData"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,YAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA4H;AAC5H;AACuD;AACL;AACsC;;;AAGxF;AAC0K;AAC1K,gBAAgB,uLAAU;AAC1B,EAAE,yEAAM;AACR,EAAE,0FAAM;AACR,EAAE,mGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,8FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACxEA;AAAA;AAAA;AAAA;AAAmoB,CAAgB,+pBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC2sBvpB;AACA;AACA;AACA;AACA;EACA;EACA,OACA;IAAAC;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,SACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,QACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,SACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,SACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,QACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,SACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,QACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EACA,SACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,UACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EACA,QACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,OACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,EACA;EAEA;EACA,QACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA,GACA;IAAAF;IAAAC;IAAAC;EAAA;AAEA;AAAA,eAEA;EACAC;IACAC;EACA;EACAC;IACA;MACAC,YACA;QAAAC;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACAC,kBACA;QAAAF;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACAE,mBACA;QAAAH;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACA;MACAG;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;MACAC;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;MACA;MACAC;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;MACA;MACAC;QACA,OACA,gBACA,eACA,sBACA;QACA,OACA,gBACA,aACA,aACA;QACA,OACA,WACA,gBACA,mBACA;QACA,OACA,mBACA,WACA;MAEA;MACAC;MACA;MACA;MACAC;QACA,OACA;UACAd;UACAe,WACA,8BACA,gBACA;UACAC,YACA,cACA,cACA;UACAC,aACA,cACA,kBACA;QAEA,GACA;UACAjB;UACAe,WACA,oBACA,cACA;UACAC,YACA,QACA,WACA;UACAC,aACA,mBACA,eACA;QAEA,GACA;UACAjB;UACAe,WACA,sBACA,cACA;UACAC,YACA,QACA,WACA;UACAC,aACA,iBACA,kBACA;QAEA,EACA;QACA,OACA;UACAjB;UACAe,WACA,kBACA,aACA;UACAC,YACA,YACA,SACA;UACAC,aACA,aACA,iBACA;QAEA,GACA;UACAjB;UACAe,WACA,mBACA,SACA;UACAC,YACA,SACA,YACA;UACAC,aACA,aACA,iBACA;QAEA,GACA;UACAjB;UACAe,WACA,gBACA,iBACA;UACAC,YACA,WACA;UACAC,aACA,aACA,cACA;QAEA,EACA;QACA,OACA;UACAjB;UACAe,WACA,iBACA,aACA;UACAC,YACA,WACA;UACAC,aACA,eACA,eACA,oBACA;UACAC;QACA,GACA;UACAlB;UACAe,WACA,oBACA,cACA;UACAC,YACA,WACA;UACAC,aACA,UACA,mBACA,aACA;UACAC;QACA,GACA;UACAlB;UACAe,WACA,sBACA,mBACA;UACAC,YACA,WACA;UACAC,aACA,eACA,eACA;QAEA,EACA;QACA,OACA;UACAjB;UACAe,WACA,kBACA,gBACA;UACAC,YACA,YACA;UACAC,aACA,iBACA,gBACA,iBACA;UACAC;QACA,GACA;UACAlB;UACAe,WACA,iBACA,cACA;UACAC,YACA,UACA;UACAC,aACA,YACA,iBACA;QAEA,GACA;UACAjB;UACAe,WACA,iBACA,iBACA;UACAC,YACA,UACA;UACAC,aACA,iBACA,gBACA;QAEA,EACA;QACA,OACA;UACAjB;UACAe,WACA,yBACA,aACA;UACAC,YACA,OACA;UACAC,aACA,cACA,cACA,kBACA,iBACA;UACAC;QACA,GACA;UACAlB;UACAe,WACA,mBACA,WACA;UACAC,YACA,QACA;UACAC,aACA,iBACA,kBACA;QAEA,EACA;QACA,OACA;UACAjB;UACAe,WACA,iBACA,eACA;UACAC,YACA,YACA;UACAC,aACA,oBACA,eACA,sBACA;UACAC;QACA,GACA;UACAlB;UACAe,WACA,mBACA,WACA;UACAC,YACA,WACA,OACA;UACAC,aACA,eACA,gBACA;QAEA,EACA;QACA,OACA;UACAjB;UACAe,WACA,qBACA,aACA;UACAC,YACA,UACA,OACA;UACAC,aACA,YACA,aACA,qBACA;UACAC;QACA,GACA;UACAlB;UACAe,WACA,gBACA,WACA;UACAC,YACA,QACA;UACAC,aACA,eACA,aACA;QAEA,GACA;UACAjB;UACAe,WACA,6BACA,eACA;UACAC,YACA,aACA;UACAC,aACA,YACA,kBACA;QAEA,EACA;QACA,OACA;UACAjB;UACAe,WACA,sBACA,gBACA;UACAC,YACA,YACA,SACA;UACAC,aACA,aACA,cACA;QAEA,GACA;UACAjB;UACAe,WACA,yBACA,aACA;UACAC,YACA,QACA,SACA;UACAC,aACA,cACA,eACA;QAEA,EACA;QACA,OACA;UACAjB;UACAe,WACA,uBACA,kBACA;UACAC,YACA,SACA,UACA;UACAC,aACA,iBACA,iBACA;QAEA,GACA;UACAjB;UACAe,WACA,cACA,gBACA;UACAC,YACA,WACA;UACAC,aACA,kBACA,gBACA;QAEA,EACA;QAEA;QACA,QACA;UACAjB;UACAe,WACA,sBACA,YACA;UACAC,YACA,UACA,YACA;UACAC,aACA,kBACA,wBACA,8BACA;UACAC;QACA,GACA;UACAlB;UACAe,WACA,gBACA,gBACA;UACAC,YACA,YACA;UACAC,aACA,qBACA,eACA;QAEA,EACA;QAEA;QACA,OACA;UACAjB;UACAe,WACA,gBACA,eACA;UACAC,YACA,cACA;UACAC,aACA,2BACA,sBACA;QAEA,GACA;UACAjB;UACAe,WACA,eACA,iBACA;UACAC,YACA,UACA;UACAC,aACA,uBACA,eACA;QAEA,GACA;UACAjB;UACAe,WACA,oBACA,cACA;UACAC,YACA,WACA;UACAC,aACA,kBACA,eACA;QAEA,EACA;QAEA;QACA,OACA;UACAjB;UACAe,WACA,sBACA,yBACA,oBACA;UACAC,YACA,QACA,UACA;UACAC,aACA,WACA,WACA,YACA;UACAC;QACA,GACA;UACAlB;UACAe,WACA,qBACA,mBACA,gBACA,cACA;UACAC,YACA,QACA,SACA,YACA;UACAC,aACA,WACA,iBACA,aACA,cACA;UACAC;QACA,GACA;UACAlB;UACAe,WACA,oBACA,mBACA,gBACA,gBACA;UACAC,YACA,QACA,SACA,YACA;UACAC,aACA,WACA,WACA,aACA,uBACA;UACAC;QACA,GACA;UACAlB;UACAe,WACA,sBACA,iBACA,mBACA,oBACA,kBACA;UACAC,YACA,QACA,SACA,kBACA;UACAC,aACA,aACA,aACA,iBACA,wBACA,mBACA;UACAC;QACA,EACA;QAEA;QACA,SACA;UACAlB;UACAe,WACA,iBACA,mBACA;UACAC,YACA,aACA;UACAC,aACA,mBACA;QAEA,GACA;UACAjB;UACAe,WACA,kBACA,aACA;UACAC,YACA,cACA,UACA;UACAC,aACA,eACA,uBACA;QAEA,GACA;UACAjB;UACAe,WACA,YACA,qBACA;UACAC,YACA,cACA,SACA;UACAC,aACA,gBACA,kBACA,mBACA;UACAC;QACA,EACA;QAEA;QACA,YACA;UACAlB;UACAe,WACA,WACA,iBACA;UACAC,YACA,SACA;UACAC,aACA,sBACA,eACA;QAEA,GACA;UACAjB;UACAe,WACA,aACA,iBACA;UACAC,YACA,QACA;UACAC,aACA,qBACA,iBACA;QAEA;MAEA;MACA;MACAE,qBACA,+DACA,2DACA,0DACA,uDACA,yDACA,YACA;MACAC;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAhC;QACAiC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;MAEA;MACAC;MAEA;MACAC;MACAC;MAAA;MACAC;MAAA;;MAEA;MACAC;QACAC;QACAC;QACAC;QACAC;MACA;MAEA;MACAC;MACAC;MAEA;MACAC;QACA;QACA;QACA;MACA;MACAC;MACAC;MAEA;MACAC;MACAC;MACAC;MACAC;MAEA;MACAC,iBACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,KACA;MACAC;MACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACA;MACAC;MACAC;MACAC;MAAA;MACAC;MAAA;MACA;MACAC;MACAC;MACAC;MAAA;MACAC;MACAC;MAAA;MACAC;MAAA;MACA;MACAC;MACAC;MACAC;MACA;MACAC;MACAC;MACA;MACAC;MACA;MACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA,uCACA;MACAC;MACAC;MAEAC;MACAC;MACAC;MAAA;;MAEA;MACAC;MAEA;MACAC;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAC;MAEA;MACAC;MACA;MACAC;IACA;EACA;EAEAC;IACAC;MAAA;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;IACA;IAEA;IACAC;MACA;IACA;EACA;EAEAC;IAAA;IACA;IACA;IACA;MACA;IACA;;IAEA;IACA;;IAEA;IACA;;IAEA;IACA;;IAEA;IACA;;IAEA;IACA;EACA;EAEAC;IACA;IACA;MACAC;MACA;IACA;IACA;IACA;MACAC;MACA;IACA;IACA;MACAA;MACA;IACA;IACA;MACAA;MACA;IACA;IACA;MACAA;MACA;IACA;IACA;MACAA;MACA;IACA;IACA;MACAA;MACA;IACA;EACA;EAEAC;IACA;IACA;MAAA;MACA;MACA;;MAEA;MACA;QACA;QACA,qBACA,qBACA,uBACA,yBACA,uBACA;QAEA;UACA;UACA;YACAC;cACAC;cACAC;cACAC;cACAC;cACAC;cACAC;gBACA;kBACA;gBACA;kBACA;kBACA;gBACA;cACA;YACA;UACA;QACA;UACA;UACA;QACA;MACA;IACA;EACA;EAEAC;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA;MACA;MACA;MACA;;MAEA;MACA;;MAEA;MACA;MACA;;MAEA;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MAEAC;IACA;IAEA;IACAC;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA;MACA;MAEA;MACA;IACA;IAEA;IACAC;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;IACA;IAEA;IACAC;MACA;;MAEA;MACA;QACA;MACA;IACA;IAEA;IACAC;MACA;;MAEA;MACA;;MAEA;MACA;QAAA;QACA;UACA;QACA;MACA;;MAEA;MACA;IACA;IAEA;IACAC;MACA;QACAf;UACAC;UACAe;QACA;QACA;MACA;MAEA;QACAhB;UACAC;UACAe;QACA;QACA;MACA;MAEA;QACAhB;UACAC;UACAe;QACA;QACA;MACA;;MAEA;MACA;MACA;;MAEA;MACA;MACA;QACAC;MACA;QACAA;MACA;MAEAjB;QACAC;QACAC;QACAgB;QACAC;QACAb;UACA;YAAA;YACA;YACA;;YAEA;YACA;cACAN;gBACAC;gBACAe;cACA;cACA;YACA;YAEA;;YAEA;YACAI;cACA/F;cACAgG;cACAC;cACAhG;cACAiG;cACAC;cACAC;cACApF;cACAE;cACAD;YACA;;YAEA;YACA8E;YACAA;YACAA;YACAA;YACAA;YACAA;YAEApB;cACAC;cACAe;YACA;UACA;YACAhB;cACAC;cACAe;YACA;UACA;QACA;MACA;IACA;IAEA;IACAU;MAAA;MACA1B;QACAC;QACAC;QACAI;UACA;YACA;YACAN;cACAC;cACAe;YACA;UACA;QACA;MACA;IACA;IAEA;IACAW;MAAA;MACA;MACA;QACA3B;UACAC;UACAe;UACAY;QACA;QACA;QACA;UACA5B;YACA6B;YACAD;UACA;QACA;QACA;MACA;;MAEA;MACA;QACA5B;UACAC;UACAe;UACAY;QACA;QACA;MACA;;MAEA;MACA;QACA5B;UACAC;UACAC;UACAI;YACA;cACA;YACA;UACA;QACA;QACA;MACA;;MAEA;MACA;IACA;IAEAwB;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;QACA;QACA;UACA;QACA;MACA;QACAvB;QACA;MACA;IACA;IAEA;IACAwB;MACA;MACA;;MAEA;MACA;MACA;QACA;QACA;QACA;QACA;UACA;UACA;YACAC;cACAC;cACAhJ;cACAe;cACAC;cACAC;cACAgI;cACAC;YACA;UACA;QACA;MACA;;MAEA;MACA;QACA;QACA;UAAA;UACA;UACA;UACA;UACA;UACA;YACAH;cACAC;cACAhJ;cACAe;cACAC;cACAC;cACAgI;YACA;UACA;QACA;MACA;;MAEA;MACA;QACA;QACA;UACA;UACA;UACA;UACA;UACA;UACA;YACA;YACA;cACAF;gBACAC;gBACAhJ;gBACAe;gBACAC;gBACAC;gBACAgI;gBACAE;cACA;YACA;UACA;QACA;MACA;MAEA;MACA7B;IACA;IAEA;IACA;IACA8B;MACA;MACA;MACA;;MAEA;MACA;QACA;UACAC;UACAC;UACAtI;QACA;MACA;;MAEA;MACA;MACA;;MAEA;MACA;MACA;QACA;QACA;QACA;QACA;UACAuI;QACA;QACA;QACA;UACAA;QACA;QACA;QACA;UACAA;YAAA;UAAA;QACA;QACA;UACAC;UACA;UACA;QACA;MACA;;MAEA;MACA;QAAA;MAAA;MACA;QAAA;UACAC;UACApJ;UACA2I;UACAU;QACA;MAAA;MAEA;MACAF;QACA;UAAA;QAAA;MACA;MACA;;MAEA;MACA;MACA;QACA;QACA;QACA;UACA;UACA;UACA;UACA;UACA;YACA;YACA;YACA;cACA;cACAG;gBACAF;gBACApJ;gBACA2I;gBACAU;kBACAV;kBACAhJ;kBACAe;kBACAC;kBACAC;kBACAgI;gBACA;cACA;YACA;UACA;QACA;MACA;;MAEA;MACA;MACA;QACA;UACAW;QACA;MACA;MACA;MAEA;QAAAP;QAAAC;QAAAtI;MAAA;IACA;IAEA;IACA6I;MACA;MACA;;MAEA;MACA;QACA;MACA;MAAA,2CAEA;QAAA;MAAA;QAAA;UAAA;UACA;;UAEA;UACA;YACA;cACA;cACA;cACA;cACA,0BACAC,6BACAA,mCACAC;YACA;YACA;UACA;;UAEA;UACA;YACA;YACA;YACA;cACAC;YACA,2DACAC;cACAD;YACA;UACA;;UAEA;UACA;YACA;YACA;YACA;cACAA;YACA,uDACAE;cACAF;YACA;UACA;;UAEA;UACA;YACAG;YACAC;UACA;QACA;;QAEA;MAAA;QAAA;MAAA;QAAA;MAAA;MACA;IACA;IAEA;IACAC;MAAA;MACA;MAEA,4BAKAC,QAJAC;QAAAA;QAAA,wBAIAD,QAHAE;QAAAA;QAAA,wBAGAF,QAFAG;QAAAA;QAAA,wBAEAH,QADAI;QAAAA;;MAGA;MACA;QACA;QACA;UACA;QACA;MACA;;MAEA;MACA;QACA;QACA;UACA;QACA;MACA;;MAEA;MACA;QACA;QACA;UACA;QACA;MACA;;MAEA;MACA;QACA;QACA;UACA;QACA;MACA;;MAEA;MACA;QACA;QACA;QACA;UACA;QACA;UACA;QACA;MACA;QACA;MACA;IACA;IAEAC;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MAAA;MACA;QAAA;MAAA;MACAhE;QACAiE;QACA3D;UACA;UACA;UACA;YACA;UACA;QACA;MACA;IACA;IACA;IACA4D;MACA;MACA;QACA;UACAlE;QACA;MACA;IACA;IAEA;IACAmE;MACA;MACA;QACA;UACAnE;QACA;MACA;MACA;IACA;IACAoE;MACA;MACA;MACA;MACA;MACA;MACA;MAEA;MACA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEAzL;kBACA8B;kBACApB;oBACAgL;oBACAhL;sBAAAiL;oBAAA;kBACA;gBACA;cAAA;gBANAC;gBAQA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA/D;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAgE;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBACA;;gBAEA;gBACA;kBACA;kBACA;gBACA;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEA1E;kBAAAC;gBAAA;gBAAA;gBAAA,OAEArH;kBACA8B;kBACApB;oBACAgL;oBACAhL;sBACAwB;sBACAyJ;oBACA;kBACA;gBACA;cAAA;gBATAC;gBAWAxE;gBAEA;kBACA2E,wCACA;kBACA,iCACAC;oBAAA;kBAAA,GACAC;oBAAA;sBACAC;sBACApK;sBACA4G;sBACAyD;sBACAC;sBACAC;sBACAC;oBACA;kBAAA;kBAEAzE;gBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;gBACAT;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAmF;MACA;QACA;QACA;QACA;MACA;MAEA;MACA;MACA;QACA;QACA;QACA;UACA;UACA;UACA;UACA;UACA;YAAA;UAAA;UAEA,iCACAC,iCACAC,0BACAC;QACA;MACA;QACA;QACA;UACA;UACA;UACA;UACA;UACA;UACA;YAAA;UAAA;UAEA,iCACAF,iCACAG,4BACAF,0BACAC;QACA;MACA;IACA;IAEA;IACAE;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;QACA3F;QACA;MACA;;MAEA;MACA,sCACA,uBACA,0BACA,oBACA;MACA;MACA;MACA;;MAEA;MACA;IACA;IAEA4F;MAAA;MACA;MACA;QACA;QACA;UAAA;QAAA;QACA;UACA;QACA;UACA;UACA;YAAA,OACA;cAAA;YAAA;UAAA,EACA;UACA;YACA;UACA;QACA;MACA;;MAEA;MACA;QACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;MACA;QACA7F;MACA;;MAEA;MACA;QACA,yCACA,0BACA,6BACA,uBACA;QACA;QACA;QACA;QAEA;QACA;MACA;MACA;MACA;MACA;QACA;MACA;IACA;IAEA;IACA;IACA8F;MAAA;QAAAC;MAAA;MACA;MACA;QACA/F;QACA;MACA;;MAEA;MACA;;MAEA;MACA;QAAA;MAAA;MACA;QACA;QACA;QACA;UACA4D;UACAC;UACAC;UACAC;QACA;;QAEA;QACA;QACA;QACA;QACA;UACA;QACA;;QAEA;QACA;UACA;QACA;;QAEA;QACA;UACA;QACA;MACA;QACA;QACA;QACA;QACA;QACA;UACA;UACA;YACA;UACA;YACA;UACA;QACA;MACA;IACA;IACA;IACAiC;MAAA;MACA;MACA;MACA,uKACAC;QAAA;MAAA;MACA;MACA;MACA;MACA;IACA;IACA;IACAC;MAAA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;QACAC;UACA;QACA;MACA;MACAC;MACAA;MACA;MACA;MACA;QACA;QACA;QACA;QACA;QACA;UACA;QACA;UACA;UACA;QACA;UACA;QACA;MACA;MACA;IACA;IACA;IACA;IACAC;MACA;MACA,sCACA,uBACA,0BACA,oBACA;MACA;MACA;MACA;;MAEA;MACA;IACA;IACA;IACAC;MAAA;MACA;MACA;QACAtG;MACA;;MAEA;MACA;QACA,yCACA,0BACA,6BACA,uBACA;QACA;QACA;QACA;QAEA;MACA;IACA;IACAuG;MAAA;MACA;MACA,6CACAC;MAAA;MACA;MAAA;MACA;MAAA,CACA;;MAEA;QACA;QACA;UACA5C;UAAA;UACAC;UAAA;UACAC;UAAA;UACAC;QACA;;QAEA;QACA;UACA;UACA;YAAA;UAAA;UACA;YACA;YACA;UACA;YACA;YACA;UACA;QACA;UACA;QACA;;QAEA;QACA;UACA0C;YACA;cACA;YACA;UACA;QACA;MACA;QACA;QACA;QACA;QACA;MACA;MAEA;IACA;IACA;IACAC;MAAA;MACA;MACA;QACA1G;QACA;MACA;MAEA;;MAEA;MACA;QACA;QACA;MACA;;MAEA;MACA;QACA;MACA;;MAEA;MACA;MACA;QACAA;MACA;MACA;QACA,yCACA,0BACA,6BACA,uBACA;QACA;QACA;QACA;;QAEA;QACA;MACA;IACA;IACA2G;MAAA;MACA;;MAEA;MACA;QACA;MACA;;MAEA;MACA;QACA;QACA;MACA;;MAEA;MACA;QACA3G;MACA;MACA;QACA,yCACA,0BACA,6BACA,uBACA;QACA;QACA;QACA;QAEA;MACA;IACA;IAEA4G;MAAA;MACA;MACA;MACA;MACA;QACA;MACA;MACA;MACA;QACA5G;MACA;MACA;QACA;MACA;IACA;IACA6G;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAL;gBAAA,IACAA;kBAAA;kBAAA;gBAAA;gBACA;gBACA;gBACA;gBACA;gBAAA;cAAA;gBAAA;gBAAA;gBAAA,OAIA1N;kBACA8B;kBACApB;oBACAgL;oBACAhL;sBAAA2B;oBAAA;kBACA;gBACA;cAAA;gBANAuJ;gBAQA/D;gBAEAmG,qEAEA;gBACA;kBACA;oBAAA;sBACAC;sBACAnM;sBACAoM;sBACAC;sBACAC;oBACA;kBAAA;;kBAEA;kBACAC;oBAAA;kBAAA;kBACA;oBACA;kBACA;gBACA;kBACA;kBACA;kBACA;oBACA;kBACA;gBACA;gBAEA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAxG;gBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACA;IACAyG;MACA;MACA;QACApH;QACA;MACA;;MAEA;MACA;MACA;QACA;UAAA;YACApF;YACAoM;YACAD;UACA;QAAA;QACA;MACA;QACA;QACA;MACA;IACA;IACA;IACAM;MAAA;MACA;MACA;QACArH;MACA;;MAEA;MACA;QACA;QACA;UACA;UACA;YACA;cAAA;gBACApF;gBACAoM;gBACAD;cACA;YAAA;YACA;UACA;YACA;UACA;UACA;QACA;;QAEA;QACA;MACA;IACA;IACA;IACAO;MACA;MACA;MACA;;MAEA;MACA;QACA;UACA;UACA;YACA;cACAC;gBACA3M;gBACAoM;gBACAD;cACA;cACAS;YACA;UACA;UACA;UACA;QACA;MACA;;MAEA;MACA;QACA;QACA;UACA;UACA;YACA;cACA;cACA;gBACA;kBACAD;oBACA3M;oBACAoM;oBACAD;kBACA;kBACAS;gBACA;cACA;YACA;UACA;UACA;UACA;QACA;MACA;MAEA;MACA;IACA;IACA;IACAC;MAAA;MACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;QACA1H;QACA;MACA;MAEA;MACA;MAEA;QACA;QACA;UACA;QACA;MACA;QACA;QACA;MACA;MAEA;IACA;IACA;IACA2H;MACAvM;MAEA;MACA;MAEA;QACA;QACA;UACA;YACA;UACA;QACA;UACA;QACA;MACA;QACA;QACA;UACA;YAAA;UAAA;UACA;QACA;MACA;IACA;IACA;IACAwM;MACA;MAEA;;MAEA;MACA;MACA;MACA;QAAAC;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA;MACA;MACA;QAAAwF;QAAAxF;MAAA,EACA;;MAEA;MACA;QAAA;QAAA,4CACAyF;UAAA;QAAA;UAAA;YAAA;YACA;cACA;YACA;UACA;QAAA;UAAA;QAAA;UAAA;QAAA;MACA;;MAEA;MACA;IACA;IACAC;MACA;MACA;;MAEA;MACA;MACA;QACA;QACA;QACA;MACA;;MAEA;MACA;MACA;QACA;QACA;MACA;QACA;QACA;MACA;;MAEA;MACA,6CACAC;MAAA;MACA;MAAA;MACA;MAAA,CACA;;MAEA;QACA;QACA;UACA;QACA;QACA;QACA;UACA;YACA;UACA;QACA;QACA;QACA;UACA;YACA;UACA;QACA;MACA;QACA;QACA;QACA;UAAA;UACA;UACA;YACA;YACA;UACA;QACA;MACA;IACA;IACA;IACAC;MAAA;MACA;MACA,sCACA,uBACA,0BACA,oBACA;;MAEA;MACA;;MAEA;MACA;QACA;QACA;QACA;UACA;UACA;QACA;MACA;QACA;QACA/H;UACAC;UACAe;UACAY;QACA;MACA;IACA;IACAoG;MAAA;MACA;MACA;QACAlI;QACA;MACA;MAEA;MACA;;MAEA;MACA;QACA4D;QAAA;QACAC;QACAC;QACAC;MACA;;MAEA;MACA;;MAEA;MACA;QACA;MACA;;MAEA;MACA;MACA;;MAEA;MACA;QACA;QACA;UACA;QACA;MACA;IACA;IACA;IACAoE;MACA;QAAA;QACA;QACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MACA;MACA;QACA;QACA;QACA;MACA;MACA;QAAA;MAAA;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;QACArI;UAAAC;UAAAe;QAAA;QACA;MACA;MAEA;MACA;MACA;MAEA;QACAhB;UAAAC;UAAAe;QAAA;QACA;MACA;;MAEA;MACA;QACA;UACAyB;UACAtH;UACAf;QACA;MACA;MAEA;MAEA;QACAkO;QACAA;MACA;MAEA;QACAA;QACAA;MACA;MAEA;QACAA;QACAA;MACA;;MAEA;MACA;QACAtI;QACA;QACA;QACAA;UAAAC;UAAAe;QAAA;MACA;QACAP;QACAT;UAAAC;UAAAe;QAAA;MACA;IACA;IACA;IACAuH;MAAA;MACA;MACA;MACA;MACA;;MAEA;MACA;QACA;MACA;MAEAvI;QACAC;QACAC;QACAC;QACAC;QACAE;UACA;YACA;UACA;QACA;MACA;IACA;IACA;IACAkI;MACA;QACA;MACA;QACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAGA;IACAC;MACA;MACA;MACA;IACA;IACAC;MAAA;MACA;MACAC;QACA;QACA;QACA;UACA;QACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MACA;QACA;UACA;UACA;UACA;QACA;MACA;MACA;MACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBACA;gBACA;gBAAA;gBAAA,OACA;cAAA;gBACAC;gBAAA,MACAA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA;gBAAA,OAEA;cAAA;gBACA/I;kBAAAC;kBAAAe;gBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;gBAKAhB;kBAAAC;kBAAAe;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAgI;MACA;QACA;QACA;QACA;;QAEA;QACA;QACA;QACA;QACA;UACA;UACA;UACA;UACA;UACAvI;QACA;UACA;UACA;UACA;QACA;;QAEA;QACA;QACA;UACA;QACA;MACA;QACAA;QACA;MACA;IACA;IAEAwI;MACA;;MAEA;MACA;QACAjJ;MACA;QACAS;MACA;;MAEA;MACA;QACAT;UACAC;UACAe;UACAY;QACA;QACA;MACA;IACA;IACA;IACAsH;MACA;MACA;QACA;QACA;MACA;QACA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;QACA;MACA;QACA;UAAA;QAAA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;IACA;IAGAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBACA;gBACA;;gBAEA;gBAAA;gBAEArJ;kBAAAC;gBAAA;gBAAA;gBAAA,OACArH;kBACA8B;kBACApB;oBACAgL;oBACAhL;sBAAAgQ;oBAAA;kBACA;gBACA;cAAA;gBANA9E;gBAQA;kBACA;kBACA,uDACAA;oBACAM;oBACAyE;oBACA7O;oBACA4G;oBACAyD;oBACAC;oBACAC;oBACAuE;kBAAA,EACA;gBACA;kBACA;kBACA,uDACAT;oBACAhE;oBACAC;oBACAC;kBAAA,EACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAxE;gBACA;gBACA,uDACAsI;kBACAhE;kBACAC;kBACAC;gBAAA,EACA;cAAA;gBAAA;gBAEAjF;gBAAA;cAAA;gBAAA;gBAAA,OAIA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEAyJ;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAzJ;kBAAAC;gBAAA;gBAAA;gBAAA;gBAAA,OAEArH;kBACA8B;kBACApB;oBACAgL;oBACAhL;sBACA+B;sBACAP;sBACA4O;oBACA;kBACA;gBACA;cAAA;gBAVAlF;gBAYA;kBACAmF;kBACA;kBACA;oBAAA;kBAAA;gBACA;kBACA;kBACA;kBACAC;kBACA5J;oBACAC;oBACAe;oBACAY;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA5B;kBACAC;kBACAe;gBACA;cAAA;gBAAA;gBAEAhB;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA6J;MACA;IACA;IAEAC;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MAEA;MAEA9J;QACAC;QACAe;QACAY;MACA;IACA;IAEAmI;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MAEA;kBAAA;kBAAA;gBAAA;gBACA/J;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAAA,MAKA;kBAAA;kBAAA;gBAAA;gBACAhB;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAAA,IAGA;kBAAA;kBAAA;gBAAA;gBACAhB;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAhB;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAAA,IAGA;kBAAA;kBAAA;gBAAA;gBACAhB;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAAA,IAGA;kBAAA;kBAAA;gBAAA;gBACAhB;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAhB;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAhB;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAhB;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAhB;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACAhB;kBAAAC;kBAAAe;gBAAA;gBAAA;cAAA;gBAIA;gBACAgJ;gBAAA,KACA;kBAAA;kBAAA;gBAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA,MAEA;kBAAA;kBAAA;gBAAA;gBACAhK;kBACAC;kBACAe;kBACAY;gBACA;gBAAA;cAAA;gBAGAoI;gBAAA;gBAAA;cAAA;gBAEA;gBACA;gBACA;gBACA;gBACA;gBACA;cAAA;gBAIA;gBACAhK;kBAAAC;gBAAA;gBAAA;gBAGA;gBACAgK;kBACAxP;kBACAC;kBACAC;kBACAC;kBACAC;kBACAC;kBAAA;kBACAC;kBACAmP;kBACAlP;kBACAC;kBACA/B;kBACAiC;kBACAC;kBACAG;gBACA,GAEA;gBACA;kBACA;kBACA4O;kBAEAF;oBACA5O;oBAAA;oBACAkO;oBAAA;oBACAlI;oBACAC;oBACAC;oBACAjG;oBACAkG;oBACA4I;oBACAtP;oBAAA;oBACAiK;oBACAC;oBACAC;kBACA;;kBAEA;kBACAgF;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;kBACAA;gBACA;gBAAA;gBAAA,OAEArR;kBACA8B;kBACApB;oBACAgL;oBACAhL;kBACA;gBACA;cAAA;gBANAkL;gBAQA;kBACA;kBACA;kBAEA;oBACA;oBACAxE;sBACAC;sBACAe;sBACAY;oBACA;oBAEAyI;sBACA;sBACA;sBACArK;wBACAsK;wBACA1I;sBACA;oBACA;kBACA;oBACA;oBACA5B;sBACAC;sBACAe;oBACA;oBACAqJ;sBACA;sBACA;sBACArK;oBACA;kBACA;gBACA;kBACAA;oBACAC;oBACAe;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAP;gBACAT;kBACAC;kBACAe;gBACA;cAAA;gBAAA;gBAEA;gBACAhB;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAuK;MACA;MACA;;MAEA;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;QACAzK;QACA;MACA;MACA;QACAA;QACA;MACA;MACA;QACAA;QACA;MACA;MACA;QACAA;QACA;MACA;MACA;QACAA;QACA;MACA;MACA;QACAA;QACA;MACA;IACA;IAEA0K;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;;MAEA;MACA;QACAzK;MACA;QACAS;MACA;MAEAT;QACAC;QACAe;QACAY;MACA;IACA;IAEA8I;MACA1K;IACA;IAEA;IACA2K;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEA3K;kBAAAC;gBAAA;;gBAEA;gBACA2K;gBACAC;gBACAC;gBACAC;gBACAC,+DAEA;gBACAlQ;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBACAkF;gBACAA;kBAAAC;kBAAAe;gBAAA;gBACA;gBACA;gBAAA;cAAA;gBAGAiK,uDAEA;gBACA;gBACAC;gBAAA;gBAAA;gBAAA,OAGAtS;kBACA8B;kBACApB;oBACAgL;oBACAhL;sBACAwB;sBACAqQ;sBACAC;sBACA7G;sBACA8G;oBACA;kBACA;gBACA;cAAA;gBAZA7G;gBAcA;kBACA0G;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAzK;cAAA;gBAAA,MAGAyK;kBAAA;kBAAA;gBAAA;gBACAlL;gBACAA;kBACAC;kBACAe;kBACAY;gBACA;gBAAA;cAAA;gBAIA;gBACA0J;gBACAC,yCAEA;gBACAC;gBAEAxL;;gBAEA;gBACAyL;gBACAzL;kBACA0L;kBACAC;oBACAlL;oBACA;oBACAT;sBACA1G;sBACAgH;wBACAN;0BACAC;0BACAe;wBACA;sBACA;oBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAP;gBACAT;gBACAA;kBACAC;kBACAe;kBACAY;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAgK;MACA;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA;QACAC;QACAC;QACAC;QACAC;MACA;;MAEA;MACAd;QACA;QACA;QACA;QACA;QAEA;UACA;UACA;YAAA;UAAA;UACA;YACAe;UACA;YACAV;cAAAzQ;cAAAoR;YAAA;UACA;QACA;QAEA;UACA;UACA;YAAA;UAAA;UACA;YACA;cACA;gBAAA;cAAA;cACA;gBACAC;cACA;gBACAF;kBAAAvR;kBAAAwR;gBAAA;cACA;YACA;YACAD;UACA;YACAV;cACApJ;cACA0J;cACAtS;gBAAAmB;gBAAAwR;cAAA;YACA;UACA;QACA;UACA;UACA;YAAA;UAAA;UACA;YACAD;UACA;YACAV;cACApJ;cACA0J;YACA;UACA;QACA;MACA;;MAEA;MACA;;MAEA;MACA;QACA;UAAA;QAAA;QACAP;QAEA;QACAC;UACA;YACA;YACA;cAAA;YAAA;YACAa;UACA;YACA;YACAA;UACA;QACA;QACAd;MACA;;MAEA;MACA;QACA;UAAA;QAAA;QACAA;QACA;UAAA;QAAA;QACAA;MACA;;MAEA;MACA;QACA;UAAA;QAAA;QACAA;QACA;UAAA;QAAA;QACAA;MACA;MAEA;IACA;IAEA;IACAe;MACA;QACAR;QACAS;QACAC;QACAC;MACA;MAEAtB;QACA;QACA;QAEA;UACAK;QACA;UACAA;QACA;QAEA;UACAA;QACA;MACA;MAEA;IACA;IAEA;IACAkB;MACA;MACA;MACA;MACA;QACA;QACAC;MACA;QACAjM;MACA;MAEAyK;QACA;QACA,kBACArI,sBACAA,oBACAA,yBACA;QACA;UACAnI;UACAxB;UACA4B;UACA6R;UACAzC;UACAwC;QACA;QAEA;UACAE;QACA;UACAC;QACA;MACA;MAEA;QACAf;QACAC;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACpxIA;AAAA;AAAA;AAAA;AAAkuC,CAAgB,8sCAAG,EAAC,C;;;;;;;;;;;ACAtvC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages-sub/clinic/add.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages-sub/clinic/add.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./add.vue?vue&type=template&id=0904e2e0&scoped=true&\"\nvar renderjs\nimport script from \"./add.vue?vue&type=script&lang=js&\"\nexport * from \"./add.vue?vue&type=script&lang=js&\"\nimport style0 from \"./add.vue?vue&type=style&index=0&id=0904e2e0&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0904e2e0\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages-sub/clinic/add.vue\"\nexport default component.exports","export * from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./add.vue?vue&type=template&id=0904e2e0&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.showComplaintList && _vm.filteredComplaints.length > 0\n  var g1 = _vm.showLocationList && _vm.filteredLocations.length > 0\n  var g2 = _vm.showDiagnosisList && _vm.filteredDiagnosis.length > 0\n  var g3 = g2 ? _vm.filteredDiagnosis.length : null\n  var g4 = _vm.showSymptomList && _vm.filteredSymptoms.length > 0\n  var g5 = _vm.showDiseaseList && _vm.filteredDiseases.length > 0\n  var g6 = _vm.showTreatmentList && _vm.filteredTreatments.length > 0\n  var g7 = _vm.showDrugList && _vm.filteredDrugs.length > 0\n  var g8 = g7 ? _vm.filteredDrugs.length : null\n  var g9 =\n    _vm.showDrugList && _vm.drugSearchText && _vm.filteredDrugs.length === 0\n  var m0 = _vm.selectedDrug ? _vm.getRealMinUnit(_vm.selectedDrug) : null\n  var g10 = _vm.enablePrescription ? _vm.prescriptionList.length : null\n  var g11 = _vm.enablePrescription ? _vm.prescriptionList.length : null\n  var g12 =\n    _vm.enablePrescription && g11 > 0 ? _vm.prescriptionList.length : null\n  var m1 = _vm.selectedBatch\n    ? _vm.formatDate(_vm.selectedBatch.expiryDate)\n    : null\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      _vm.noTipNextTime = !_vm.noTipNextTime\n    }\n    _vm.e1 = function ($event) {\n      _vm.form.gender = \"男\"\n    }\n    _vm.e2 = function ($event) {\n      _vm.form.gender = \"女\"\n    }\n    _vm.e3 = function ($event) {\n      _vm.ageFocus = true\n    }\n    _vm.e4 = function ($event) {\n      _vm.ageFocus = false\n    }\n    _vm.e5 = function ($event) {\n      _vm.showDrugSelector = false\n    }\n    _vm.e6 = function ($event) {\n      _vm.showDrugSelector = false\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        g2: g2,\n        g3: g3,\n        g4: g4,\n        g5: g5,\n        g6: g6,\n        g7: g7,\n        g8: g8,\n        g9: g9,\n        m0: m0,\n        g10: g10,\n        g11: g11,\n        g12: g12,\n        m1: m1,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./add.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./add.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"clinic-add\">\n    <scroll-view\n      class=\"clinic-scroll\"\n      scroll-y\n      :scroll-into-view=\"activeFieldId\"\n    >\n    <!-- 顶部标题 -->\n    <view class=\"page-header\">\n      <view class=\"title\">北京欢乐谷医务室</view>\n      <view class=\"subtitle\">门诊登记表</view>\n    </view>\n\n    <!-- 功能按钮区域：选择园区 + 门诊日报 -->\n    <view class=\"top-actions-card\">\n      <view class=\"top-buttons\">\n        <button class=\"top-btn primary\" @tap=\"openLocationSelector\">\n          {{ locationLocked ? '选择园区' : currentLocationLabel }}\n        </button>\n        <button class=\"top-btn ghost\" @tap=\"generateDailyReport\">门诊日报</button>\n      </view>\n    </view>\n\n    <!-- 园区选择提示弹窗（悬浮窗） -->\n    <view v-if=\"showLocationTip\" class=\"location-modal-overlay\">\n      <view class=\"location-modal\">\n        <view class=\"modal-title\">请选择当前所在园区</view>\n        <view class=\"modal-subtitle\">当前：{{ currentLocationLabel }}，用于统计门诊登记、日报等数据</view>\n\n        <view class=\"modal-location-buttons\">\n          <button class=\"modal-loc-btn\" :class=\"{ active: form.location === 'land_park' }\" @tap=\"handleLocationSelect('land_park')\">陆园</button>\n          <button class=\"modal-loc-btn\" :class=\"{ active: form.location === 'water_park' }\" @tap=\"handleLocationSelect('water_park')\">水园</button>\n        </view>\n\n        <view class=\"modal-hint-text\">后续可随时通过上方“选择园区”按钮切换，不影响已登记记录。</view>\n\n        <view class=\"modal-row\" @tap=\"noTipNextTime = !noTipNextTime\">\n          <checkbox :checked=\"noTipNextTime\" />\n          <text class=\"modal-checkbox-text\">下次不再提醒</text>\n        </view>\n\n        <button class=\"modal-close-btn\" @tap=\"closeLocationTip\">关闭提示</button>\n      </view>\n    </view>\n\n    <view id=\"field-remark\" class=\"form-section\">\n      <!-- 基本信息 -->\n      <view class=\"section-title\">患者基本信息</view>\n      \n      <!-- 就诊日期时间 + 身份 并排 -->\n      <view class=\"form-row\">\n        <view id=\"field-name\" class=\"form-item half\">\n          <view class=\"label required\">就诊日期时间</view>\n          <view class=\"datetime-display\">{{ form.visitDateTime }}</view>\n        </view>\n        <view class=\"form-item half\">\n          <view class=\"label required\">身份</view>\n          <view class=\"identity-selector\">\n            <view \n              v-for=\"idOpt in identityOptions\"\n              :key=\"idOpt.value\"\n              class=\"identity-item\" \n              :class=\"{ active: form.identity === idOpt.value }\"\n              @click=\"setIdentity(idOpt.value)\"\n            >\n              {{ idOpt.label }}\n            </view>\n          </view>\n        </view>\n      </view>\n\n\n      <!-- 姓名 + 性别/年龄 -->\n      <view class=\"form-row\">\n        <view class=\"form-item half\">\n          <view class=\"label required\">姓名</view>\n          <input\n            v-model=\"form.name\"\n            type=\"text\"\n            placeholder=\"选园区后输入姓名\"\n            :disabled=\"locationLocked\"\n            cursor-spacing=\"80\"\n          />\n        </view>\n        <view class=\"form-item half\">\n          <view class=\"label required\">性别 / 年龄</view>\n          <view class=\"gender-age-row\">\n            <view class=\"gender-selector compact\">\n              <view \n                class=\"gender-item\" \n                :class=\"{ active: form.gender === '男' }\"\n                @click=\"form.gender = '男'\"\n              >\n                男\n              </view>\n              <view \n                class=\"gender-item\" \n                :class=\"{ active: form.gender === '女' }\"\n                @click=\"form.gender = '女'\"\n              >\n                女\n              </view>\n            </view>\n            <input\n              v-model.number=\"form.age\"\n              type=\"number\"\n              inputmode=\"numeric\"\n              pattern=\"[0-9]*\"\n              :maxlength=\"3\"\n              :focus=\"ageFocus\"\n              @tap=\"ageFocus = true\"\n              @blur=\"ageFocus = false\"\n              confirm-type=\"done\"\n              placeholder=\"年龄\"\n              class=\"age-input\"\n            />\n          </view>\n        </view>\n      </view>\n\n      <!-- 主诉 -->\n      <view id=\"field-chiefComplaint\" class=\"form-item\">\n        <view class=\"label required\">主诉</view>\n        <view class=\"disease-input-wrapper\">\n          <input\n            v-model=\"form.chiefComplaint\"\n            type=\"text\"\n            placeholder=\"请输入患者自述症状，例如：头部外伤伴头晕\"\n            maxlength=\"100\"\n            class=\"input-uniform\"\n            @focus=\"onComplaintFocus(); onFieldFocus('field-chiefComplaint')\"\n            @input=\"onComplaintInput\"\n            @blur=\"onComplaintBlur\"\n          />\n          <!-- 主诉下拉列表 -->\n          <view v-if=\"showComplaintList && filteredComplaints.length > 0\" class=\"disease-dropdown\">\n            <scroll-view scroll-y class=\"disease-scroll\">\n              <view\n                v-for=\"opt in filteredComplaints\"\n                :key=\"opt.key\"\n                class=\"disease-item\"\n                @click=\"selectComplaint(opt)\"\n              >\n                {{ opt.label }}\n              </view>\n            </scroll-view>\n          </view>\n        </view>\n      </view>\n\n    </view>\n\n    <!-- 就诊信息 -->\n    <view class=\"form-section\">\n      <view class=\"section-title\">就诊信息</view>\n\n      <!-- 是否出诊 + 受伤地点 -->\n      <view class=\"form-row\">\n        <view class=\"form-item half\">\n          <view class=\"label required\">是否出诊</view>\n          <view class=\"identity-selector visit-type-selector\">\n            <view\n              v-for=\"vt in visitTypeOptions\"\n              :key=\"vt.value\"\n              class=\"identity-item\"\n              :class=\"{ active: form.visitType === vt.value }\"\n              @click=\"setVisitType(vt.value)\"\n            >\n              <text class=\"visit-type-text\">{{ vt.label }}</text>\n            </view>\n          </view>\n        </view>\n        <view class=\"form-item half\">\n          <view class=\"label\" :class=\"{ required: form.visitType === 'outcall' }\">受伤地点</view>\n          <view class=\"location-input-wrapper\">\n            <input\n              v-model=\"form.injuryLocation\"\n              type=\"text\"\n              :placeholder=\"form.visitType === 'outcall' ? '请输入受伤地点（必填）' : '例如：机动游戏区、餐饮区（可选）'\"\n              class=\"input-uniform\"\n              @focus=\"onLocationFocus(); onFieldFocus('field-injuryLocation')\"\n              @input=\"onLocationInput\"\n            />\n            <!-- 地点下拉列表 -->\n            <view v-if=\"showLocationList && filteredLocations.length > 0\" class=\"location-dropdown\">\n              <scroll-view scroll-y class=\"location-scroll\">\n                <view\n                  v-for=\"loc in filteredLocations\"\n                  :key=\"loc\"\n                  class=\"location-item\"\n                  @click=\"selectLocationFromList(loc)\"\n                >\n                  {{ loc }}\n                </view>\n              </scroll-view>\n            </view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 诊断 -->\n      <view class=\"form-item\">\n        <view class=\"label required\">诊断</view>\n        <view class=\"label-hint\">医生根据检查做出的专业判断</view>\n        <view class=\"disease-input-wrapper\">\n          <input\n            v-model=\"form.diagnosis\"\n            type=\"text\"\n            placeholder=\"请输入初步诊断结果，例如：轻度头部挫伤\"\n            maxlength=\"100\"\n            class=\"input-uniform\"\n            @focus=\"onDiagnosisFocus(); onFieldFocus('field-diagnosis')\"\n            @input=\"onDiagnosisInput\"\n            @blur=\"onDiagnosisBlur\"\n          />\n          <view v-if=\"showDiagnosisList && filteredDiagnosis.length > 0\" class=\"disease-dropdown\">\n            <scroll-view scroll-y class=\"disease-scroll\">\n              <!-- 模板库参考 -->\n              <view v-if=\"filteredDiagnosis.length > 0\" class=\"diagnosis-section\">\n                <view \n                  v-for=\"it in filteredDiagnosis\" \n                  :key=\"it\"\n                  class=\"disease-item\"\n                  @click=\"selectDiagnosis(it)\"\n                >\n                  {{ it }}\n                </view>\n              </view>\n            </scroll-view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 症状 -->\n      <view id=\"field-symptom\" class=\"form-item\">\n        <view class=\"label\">症状</view>\n        <view class=\"label-hint\">患者表现出的具体症状和体征</view>\n        <view class=\"disease-input-wrapper\">\n          <input\n            v-model=\"form.symptom\"\n            type=\"text\"\n            placeholder=\"例如：头晕、恶心、局部红肿等（可选，可从主诉自动提取）\"\n            maxlength=\"150\"\n            class=\"input-uniform\"\n            @focus=\"onSymptomFocus(); onFieldFocus('field-symptom')\"\n            @input=\"onSymptomInput\"\n            @blur=\"onSymptomBlur\"\n          />\n          <!-- 症状下拉列表 -->\n          <view v-if=\"showSymptomList && filteredSymptoms.length > 0\" class=\"disease-dropdown\">\n            <scroll-view scroll-y class=\"disease-scroll\">\n              <view\n                v-for=\"(symptom, idx) in filteredSymptoms\"\n                :key=\"idx\"\n                class=\"disease-item\"\n                @click=\"selectSymptom(symptom)\"\n              >\n                <text class=\"symptom-name\">{{ symptom.name || symptom }}</text>\n                <text v-if=\"symptom.category\" class=\"symptom-category\">{{ symptom.category }}</text>\n              </view>\n            </scroll-view>\n          </view>\n        </view>\n      </view>\n\n      <!-- 疾病名称（带下拉列表）+ 选择诊断参考按钮 -->\n      <view class=\"form-item\">\n        <view class=\"label required\">疾病名称</view>\n        <view class=\"label-hint\">疾病的大类分类，用于统计分析</view>\n        <view class=\"disease-name-row\">\n          <view class=\"disease-input-wrapper\" style=\"flex: 1;\">\n            <input\n              v-model=\"form.diseaseName\" \n              type=\"text\" \n              placeholder=\"例如：感冒、外伤、中暑等\"\n              @input=\"onDiseaseInput\"\n              @focus=\"onDiseaseFocus(); onFieldFocus('field-diseaseName')\"\n              @blur=\"onDiseaseBlur\"\n              class=\"input-uniform\"\n            />\n            <!-- 疾病下拉列表 -->\n            <view v-if=\"showDiseaseList && filteredDiseases.length > 0\" class=\"disease-dropdown\">\n              <scroll-view scroll-y class=\"disease-scroll\">\n                <view \n                  v-for=\"disease in filteredDiseases\" \n                  :key=\"disease\"\n                  class=\"disease-item\"\n                  @click=\"selectDisease(disease)\"\n                >\n                  {{ disease }}\n                </view>\n              </scroll-view>\n            </view>\n          </view>\n                  </view>\n      </view>\n\n      <!-- 处置 -->\n      <view class=\"form-item\">\n        <view class=\"label required\">处置</view>\n        <view class=\"disease-input-wrapper\">\n          <input\n            v-model=\"form.treatment\"\n            type=\"text\"\n            placeholder=\"请输入处理措施，例如：伤口清洗消毒、冷敷\"\n            maxlength=\"120\"\n            class=\"input-uniform\"\n            @focus=\"onTreatmentFocus(); onFieldFocus('field-treatment')\"\n            @input=\"onTreatmentInput\"\n          />\n          <view v-if=\"showTreatmentList && filteredTreatments.length > 0\" class=\"disease-dropdown\">\n            <scroll-view scroll-y class=\"disease-scroll\">\n              <view \n                v-for=\"it in filteredTreatments\" \n                :key=\"it\"\n                class=\"disease-item\"\n                @click=\"selectTreatment(it)\"\n              >\n                {{ it }}\n              </view>\n            </scroll-view>\n          </view>\n        </view>\n      </view>\n      </view>\n\n    <!-- 用药信息 -->\n    <view class=\"form-section\">\n      <view class=\"section-title\">用药信息（可选）</view>\n\n      <!-- 药材选择 - 只手动输入 -->\n      <view id=\"field-drug\" class=\"form-item\">\n        <view class=\"label\">药材名称</view>\n        <view class=\"drug-input-wrapper\">\n          <input \n            v-model=\"drugSearchText\" \n            type=\"text\" \n            placeholder=\"点击查看所有药材或输入搜索\"\n            @input=\"onDrugSearch\"\n            @focus=\"onDrugInputFocus\"\n            class=\"input-uniform\"\n          />\n          <!-- 下拉列表 -->\n          <view v-if=\"showDrugList && filteredDrugs.length > 0\" class=\"drug-dropdown\">\n            <view class=\"dropdown-header\">\n              <text class=\"dropdown-title\">{{ form.location === 'land_park' ? '陆园' : '水园' }}库存药材</text>\n              <text class=\"dropdown-count\">({{ filteredDrugs.length }}种)</text>\n            </view>\n            <scroll-view scroll-y class=\"drug-scroll\">\n              <view \n                v-for=\"drug in filteredDrugs\" \n                :key=\"drug._id\"\n                class=\"drug-item\"\n                @click=\"selectDrugFromList(drug)\"\n              >\n                <view class=\"drug-name\">{{ drug.name }}</view>\n                <view class=\"drug-spec\">{{ drug.specification }}</view>\n              </view>\n            </scroll-view>\n          </view>\n          <!-- 无结果提示 -->\n          <view v-if=\"showDrugList && drugSearchText && filteredDrugs.length === 0\" class=\"no-result\">\n            未找到匹配的药材\n          </view>\n        </view>\n      </view>\n\n      <!-- 用药信息展示 -->\n      <view v-if=\"selectedDrug\" class=\"drug-quick-info\">\n        <!-- 药材信息单行展示 -->\n        <view class=\"drug-info-row\">\n          <view class=\"drug-name-section\">\n            <text class=\"drug-name-text\">{{ selectedDrug.name }}</text>\n            <text class=\"drug-spec-text\">{{ selectedDrug.specification }}</text>\n          </view>\n          <view class=\"drug-stock-section\">\n            <text class=\"stock-label\">{{ form.location === 'land_park' ? '陆园' : '水园' }}库存：</text>\n            <text class=\"stock-value\" :class=\"{ 'stock-warning': availableStock < 10 }\">{{ availableStock }} {{ selectedDrug.minUnit }}</text>\n          </view>\n        </view>\n      </view>\n\n      <!-- 用药数量和用法输入 -->\n      <view v-if=\"selectedDrug\" class=\"drug-usage-section\">\n        <!-- 用药数量 -->\n        <view class=\"form-row\">\n          <view class=\"form-item half\">\n            <view class=\"label required\">用药数量</view>\n            <view class=\"quantity-input-group\">\n              <input\n                v-model.number=\"form.quantity\"\n                type=\"number\"\n                placeholder=\"数量\"\n                class=\"input-uniform\"\n              />\n              <text class=\"unit-text\">{{ getRealMinUnit(selectedDrug) }}</text>\n            </view>\n            <!-- 库存不足警告 -->\n            <view v-if=\"form.quantity > availableStock\" class=\"quantity-warning\">\n              <text class=\"warning-icon\">⚠️</text>\n              <text class=\"warning-text\">库存不足！当前：{{ availableStock }} {{ selectedDrug.minUnit }}</text>\n            </view>\n          </view>\n          \n          <!-- 单次剂量 -->\n          <view class=\"form-item half\">\n            <view class=\"label\">单次剂量</view>\n            <view class=\"dosage-input-group\">\n              <input\n                v-model=\"currentDrug.dosage\"\n                type=\"text\"\n                placeholder=\"如：1片\"\n                class=\"input-uniform\"\n              />\n            </view>\n          </view>\n        </view>\n\n        <!-- 用药频次和途径 -->\n        <view class=\"form-row\">\n          <view class=\"form-item half\">\n            <view class=\"label\">用药频次</view>\n            <picker mode=\"selector\" :range=\"frequencyOptions\" :value=\"frequencyIndex\" @change=\"onFrequencyChange\">\n              <view class=\"picker-input\">{{ currentFrequencyLabel }}</view>\n            </picker>\n          </view>\n          \n          <view class=\"form-item half\">\n            <view class=\"label\">给药途径</view>\n            <picker mode=\"selector\" :range=\"routeOptions\" :value=\"routeIndex\" @change=\"onRouteChange\">\n              <view class=\"picker-input\">{{ currentRouteLabel }}</view>\n            </picker>\n          </view>\n        </view>\n\n        <!-- 用法说明 -->\n        <view class=\"form-item\">\n          <view class=\"label\">用法说明</view>\n          <input\n            v-model=\"currentDrug.usage\"\n            type=\"text\"\n            placeholder=\"如：饭后服用，多饮水\"\n            class=\"input-uniform\"\n          />\n        </view>\n\n        <!-- 添加到处方按钮 -->\n        <view class=\"add-prescription-action\">\n          <button class=\"add-prescription-btn\" @click=\"addToPrescription\">\n            <text class=\"btn-icon\">➕</text>\n            <text class=\"btn-text\">加入处方</text>\n          </button>\n        </view>\n      </view>\n\n      <!-- 开具处方开关 -->\n      <view class=\"form-item\">\n        <view class=\"label-row\">\n          <view class=\"label\">开具处方</view>\n          <switch \n            :checked=\"enablePrescription\" \n            @change=\"onPrescriptionSwitch\"\n            color=\"#1890ff\"\n          />\n        </view>\n      </view>\n\n      <!-- 处方（符合国家规定格式） -->\n      <view v-if=\"enablePrescription\" class=\"prescription-section\">\n        <!-- 医院信息头部 -->\n        <view class=\"prescription-hospital-header\">\n          <view class=\"hospital-logo\">🏥</view>\n          <view class=\"hospital-info\">\n            <text class=\"hospital-name\">北京欢乐谷医务室</text>\n            <text class=\"hospital-subtitle\">Beijing Happy Valley Medical Office</text>\n          </view>\n        </view>\n        \n        <!-- 处方标题 -->\n        <view class=\"prescription-title-section\">\n          <text class=\"prescription-main-title\">门诊处方笺</text>\n          <text class=\"prescription-type-badge\">普通处方</text>\n        </view>\n        \n        <!-- 处方编号和日�� -->\n        <view class=\"prescription-meta-info\">\n          <view class=\"meta-item\">\n            <text class=\"meta-label\">处方编号：</text>\n            <text class=\"meta-value\">{{ prescriptionNo }}</text>\n          </view>\n          <view class=\"meta-item\">\n            <text class=\"meta-label\">开具日期：</text>\n            <text class=\"meta-value\">{{ currentDate }}</text>\n          </view>\n        </view>\n        \n        <!-- 患者信息卡片 -->\n        <view class=\"prescription-patient-card\">\n          <view class=\"patient-info-row\">\n            <view class=\"patient-info-item\">\n              <text class=\"info-label\">姓名</text>\n              <text class=\"info-value\">{{ form.name || '___' }}</text>\n            </view>\n            <view class=\"patient-info-item\">\n              <text class=\"info-label\">性别</text>\n              <text class=\"info-value\">{{ form.gender || '___' }}</text>\n            </view>\n            <view class=\"patient-info-item\">\n              <text class=\"info-label\">年龄</text>\n              <text class=\"info-value\">{{ form.age || '___' }}岁</text>\n            </view>\n            <view class=\"patient-info-item\">\n              <text class=\"info-label\">身份</text>\n              <text class=\"info-value\">{{ form.identity || '___' }}</text>\n            </view>\n          </view>\n          <view class=\"patient-diagnosis-row\">\n            <text class=\"diagnosis-label\">临床诊断：</text>\n            <text class=\"diagnosis-value\">{{ form.diagnosis || '___' }}</text>\n          </view>\n        </view>\n        \n        <!-- Rp 标记和药品列表 -->\n        <view class=\"prescription-body\">\n          <view class=\"prescription-rp-header\">\n            <text class=\"rp-symbol\">Rp:</text>\n          </view>\n          \n          <!-- 药品列表 -->\n          <view class=\"prescription-drugs-list\">\n            <view v-if=\"prescriptionList.length === 0\" class=\"drugs-empty\">\n              <text class=\"empty-icon\">💊</text>\n              <text class=\"empty-text\">暂无处方药品</text>\n              <text class=\"empty-hint\">请在上方选择药品并添加到处方</text>\n            </view>\n            \n            <view \n              v-for=\"(item, index) in prescriptionList\" \n              :key=\"index\"\n              class=\"prescription-drug-item\"\n            >\n              <!-- 药品名称和规格（合并显示） -->\n              <view class=\"drug-item-header\">\n                <view class=\"drug-name-spec\">\n                  <text class=\"drug-name\">{{ item.drugName }}</text>\n                  <text v-if=\"item.specification\" class=\"drug-spec\">（{{ item.specification }}）</text>\n                  <text class=\"drug-quantity\">{{ item.dosage || item.quantity + item.unit }}</text>\n                </view>\n                <view class=\"drug-actions\">\n                  <text class=\"action-btn delete\" @click=\"removeFromPrescription(index)\">删除</text>\n                </view>\n              </view>\n              \n              <!-- 用法用量（简洁格式） -->\n              <view class=\"drug-usage-row\">\n                <text class=\"usage-label\">用法：</text>\n                <text class=\"usage-value\">{{ item.dosage || '' }} {{ item.route || '' }} {{ item.frequency || '' }}</text>\n              </view>\n            </view>\n          </view>\n          \n          <!-- 处方统计 -->\n          <view v-if=\"prescriptionList.length > 0\" class=\"prescription-summary\">\n            <text class=\"summary-text\">共 {{ prescriptionList.length }} 种药品</text>\n          </view>\n          \n          <view class=\"prescription-blank-line\">\n            <text class=\"blank-text\">————————— 以下空白 —————————</text>\n          </view>\n        </view>\n        \n        <!-- 处方底部签名区 -->\n        <view class=\"prescription-footer-section\">\n          <view class=\"footer-row\">\n            <view class=\"footer-item\">\n              <text class=\"footer-label\">医师签名：</text>\n              <view class=\"signature-placeholder\">\n                <text class=\"placeholder-text\">（见下方电子签名）</text>\n              </view>\n            </view>\n          </view>\n        </view>\n        \n        <!-- 处方说明 -->\n        <view class=\"prescription-notes\">\n          <view class=\"note-title\">📌 处方说明</view>\n          <view class=\"note-item\">\n            <text class=\"note-bullet\">•</text>\n            <text class=\"note-text\">本处方仅供医务室内部使用，请妥善保管</text>\n          </view>\n          <view class=\"note-item\">\n            <text class=\"note-bullet\">•</text>\n            <text class=\"note-text\">药品数量使用最小单位（片、粒、支等）</text>\n          </view>\n          <view class=\"note-item\">\n            <text class=\"note-bullet\">•</text>\n            <text class=\"note-text\">请按医嘱用药，如有不适请及时就诊</text>\n          </view>\n        </view>\n      </view>\n\n      <!-- 批次信息（自动FIFO） -->\n      <view v-if=\"selectedBatch\" class=\"batch-info\">\n        <view class=\"batch-item\">\n          <text class=\"label\">批次号：</text>\n          <text>{{ selectedBatch.batch }}</text>\n        </view>\n        <view class=\"batch-item\">\n          <text class=\"label\">有效期：</text>\n          <text>{{ formatDate(selectedBatch.expiryDate) }}</text>\n          <text v-if=\"selectedBatch.daysToExpiry <= 60\" class=\"warning\">\n            （{{ selectedBatch.daysToExpiry }}天后到期）\n          </text>\n        </view>\n        <view class=\"batch-item\">\n          <text class=\"label\">剩余库存：</text>\n          <text>{{ selectedBatch.quantity }} {{ selectedDrug.minUnit }}</text>\n        </view>\n      </view>\n    </view>\n\n    <!-- 备注 -->\n    <view class=\"form-section\">\n      <view class=\"section-title\">备注</view>\n      <view class=\"form-item\">\n        <input\n          v-model=\"form.remark\"\n          type=\"text\"\n          placeholder=\"其他说明或建议（可选）\"\n          maxlength=\"200\"\n          class=\"input-uniform\"\n        />\n      </view>\n    </view>\n\n    <!-- 接诊医生签名 -->\n    <view class=\"form-section\">\n      <view class=\"section-title\">接诊医生签名</view>\n        <view class=\"signature-info\">\n          <view class=\"signature-tip\">\n          <text class=\"tip-text\">请医生在下方签名确认本次就诊信息</text>\n        </view>\n      </view>\n      <view class=\"signature-section\">\n        <view class=\"signature-label-row\">\n          <view class=\"signature-label\">医生签名</view>\n          <text class=\"required\">*</text>\n        </view>\n        <Signature\n          v-model=\"form.doctorSign\"\n          title=\"医生签名\"\n          @change=\"onDoctorSignChange\"\n        />\n        <view v-if=\"form.signTime\" class=\"signature-time\">\n          签名时间：{{ form.signTime }}\n        </view>\n      </view>\n    </view>\n\n    <!-- 继续登记选项 -->\n    <view class=\"continue-option\">\n      <view class=\"continue-card\" @click=\"toggleContinue\">\n        <view class=\"continue-checkbox\">\n          <checkbox :checked=\"continueAfterSubmit\" />\n        </view>\n        <view class=\"continue-text\">\n          <view class=\"continue-title\">连续登记模式</view>\n          <view class=\"continue-desc\">提交后自动清空表单，继续登记下一位患者</view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 药材选择器 -->\n    <drug-selector\n      v-if=\"showDrugSelector\"\n      @select=\"onDrugSelect\"\n      @close=\"showDrugSelector = false\"\n    />\n\n    </scroll-view>\n\n    <!-- 提交按钮 -->\n    <view class=\"submit-section\">\n      <button class=\"cancel-btn\" @click=\"goBack\">取消</button>\n      <button class=\"submit-btn\" :loading=\"submitting\" @click=\"handleSubmit\">\n        保存\n      </button>\n    </view>\n\n    <!-- 继续登记选项 -->\n    <view class=\"continue-option\">\n      <view class=\"continue-card\" @click=\"toggleContinue\">\n        <view class=\"continue-checkbox\">\n          <checkbox :checked=\"continueAfterSubmit\" />\n        </view>\n        <view class=\"continue-text\">\n          <view class=\"continue-title\">连续登记模式</view>\n          <view class=\"continue-desc\">提交后自动清空表单，继续登记下一位患者</view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 药材选择器 -->\n    <drug-selector\n      v-if=\"showDrugSelector\"\n      @select=\"onDrugSelect\"\n      @close=\"showDrugSelector = false\"\n    />\n\n  </view>\n</template>\n\n<script>\nimport Signature from '@/components/signature/index.vue';\n\n// 欢乐谷主诉-关键词映射库（前端专用，用于主诉下拉联想）\n// 说明：\n// - key 为医生可能输入的关键词（疾病名/症状/场景词）\n// - value 为若干主诉模板，每条包含疾病场景与规范主诉句子\nconst hvComplaintKeywordIndex = {\n  // 外伤类 TR-01 皮肤擦伤/挫伤\n  '擦伤': [\n    { diseaseId: 'TR-01', diseaseName: '皮肤擦伤/挫伤', complaint: '摔倒后膝盖擦伤、疼痛' },\n    { diseaseId: 'TR-01', diseaseName: '皮肤擦伤/挫伤', complaint: '碰撞后手臂蹭破皮、红肿' },\n    { diseaseId: 'TR-01', diseaseName: '皮肤擦伤/挫伤', complaint: '被游乐设施擦伤、轻微出血' },\n    { diseaseId: 'TR-01', diseaseName: '皮肤擦伤/挫伤', complaint: '摔倒后多处擦伤、疼痛' }\n  ],\n  '挫伤': [\n    { diseaseId: 'TR-01', diseaseName: '皮肤擦伤/挫伤', complaint: '摔倒后膝盖擦伤、疼痛' },\n    { diseaseId: 'TR-01', diseaseName: '皮肤擦伤/挫伤', complaint: '碰撞后手臂蹭破皮、红肿' }\n  ],\n\n  // 外伤类 TR-02 关节扭伤\n  '扭伤': [\n    { diseaseId: 'TR-02', diseaseName: '关节扭伤', complaint: '崴脚后脚踝疼痛、肿胀' },\n    { diseaseId: 'TR-02', diseaseName: '关节扭伤', complaint: '跑步摔倒后手腕扭伤、活动受限' },\n    { diseaseId: 'TR-02', diseaseName: '关节扭伤', complaint: '跳跃后膝关节扭伤、不能承重' },\n    { diseaseId: 'TR-02', diseaseName: '关节扭伤', complaint: '手腕扭伤、疼痛、活动困难' }\n  ],\n  '崴脚': [\n    { diseaseId: 'TR-02', diseaseName: '关节扭伤', complaint: '崴脚后脚踝疼痛、肿胀' }\n  ],\n\n  // 外伤类 TR-03 头部轻微外伤\n  '头部外伤': [\n    { diseaseId: 'TR-03', diseaseName: '头部轻微外伤', complaint: '撞到头后头痛、头晕' },\n    { diseaseId: 'TR-03', diseaseName: '头部轻微外伤', complaint: '头部撞伤、起包、恶心' },\n    { diseaseId: 'TR-03', diseaseName: '头部轻微外伤', complaint: '头部碰伤、头痛想吐' },\n    { diseaseId: 'TR-03', diseaseName: '头部轻微外伤', complaint: '头部外伤后头晕、注意力不集中' }\n  ],\n\n  // 外伤类 TR-04 可疑骨折\n  '骨折': [\n    { diseaseId: 'TR-04', diseaseName: '可疑骨折', complaint: '摔倒后手腕畸形、剧痛' },\n    { diseaseId: 'TR-04', diseaseName: '可疑骨折', complaint: '腿部撞击后肿胀变形、不能动' },\n    { diseaseId: 'TR-04', diseaseName: '可疑骨折', complaint: '高处跌落脚踝剧痛、畸形' },\n    { diseaseId: 'TR-04', diseaseName: '可疑骨折', complaint: '手指挤压后畸形、活动异常' }\n  ],\n\n  // 环境类 EN-01 轻度中暑\n  '中暑': [\n    { diseaseId: 'EN-01', diseaseName: '轻度中暑', complaint: '太阳下排队后头晕、口渴、乏力' },\n    { diseaseId: 'EN-01', diseaseName: '轻度中暑', complaint: '天气热感觉头晕、恶心、出汗多' },\n    { diseaseId: 'EN-01', diseaseName: '轻度中暑', complaint: '长时间暴晒后头痛、乏力、口渴' },\n    { diseaseId: 'EN-01', diseaseName: '轻度中暑', complaint: '热天游玩后头晕、心慌、想吐' }\n  ],\n  '暴晒': [\n    { diseaseId: 'EN-01', diseaseName: '轻度中暑', complaint: '长时间暴晒后头痛、乏力、口渴' },\n    { diseaseId: 'EN-02', diseaseName: '热痉挛/热衰竭', complaint: '暴晒后大量出汗、头晕、肌肉痉挛' }\n  ],\n\n  // 环境类 EN-02 热痉挛/热衰竭\n  '热痉挛': [\n    { diseaseId: 'EN-02', diseaseName: '热痉挛/热衰竭', complaint: '高温下活动后头晕、恶心、肌肉抽筋' },\n    { diseaseId: 'EN-02', diseaseName: '热痉挛/热衰竭', complaint: '热天跑步后乏力、头晕、小腿抽筋' },\n    { diseaseId: 'EN-02', diseaseName: '热痉挛/热衰竭', complaint: '暴晒后大量出汗、头晕、肌肉痉挛' },\n    { diseaseId: 'EN-02', diseaseName: '热痉挛/热衰竭', complaint: '高温环境头晕、呕吐、全身无力' }\n  ],\n\n  // 环境类 EN-03 日光性皮炎\n  '晒伤': [\n    { diseaseId: 'EN-03', diseaseName: '日光性皮炎', complaint: '晒伤后皮肤发红、疼痛、灼热感' },\n    { diseaseId: 'EN-03', diseaseName: '日光性皮炎', complaint: '暴晒后皮肤红肿、刺痛、痒' },\n    { diseaseId: 'EN-03', diseaseName: '日光性皮炎', complaint: '晒后皮肤起红斑、脱皮、疼痛' },\n    { diseaseId: 'EN-03', diseaseName: '日光性皮炎', complaint: '太阳晒后皮肤发红起泡、灼痛' }\n  ],\n\n  // 环境类 EN-04 蚊虫叮咬过敏\n  '蚊虫叮咬': [\n    { diseaseId: 'EN-04', diseaseName: '蚊虫叮咬过敏', complaint: '被蚊子咬后红肿、瘙痒' },\n    { diseaseId: 'EN-04', diseaseName: '蚊虫叮咬过敏', complaint: '虫咬后起大包、很痒' },\n    { diseaseId: 'EN-04', diseaseName: '蚊虫叮咬过敏', complaint: '蚊虫叮咬处红肿热痛' },\n    { diseaseId: 'EN-04', diseaseName: '蚊虫叮咬过敏', complaint: '虫咬后皮疹、瘙痒难忍' }\n  ],\n\n  // 消化 GI-01 急性胃肠炎\n  '腹泻': [\n    { diseaseId: 'GI-01', diseaseName: '急性胃肠炎', complaint: '吃坏肚子后呕吐、腹泻、腹痛' },\n    { diseaseId: 'GI-01', diseaseName: '急性胃肠炎', complaint: '进食后恶心呕吐、拉肚子' },\n    { diseaseId: 'GI-01', diseaseName: '急性胃肠炎', complaint: '呕吐腹泻、肚子绞痛、发热' },\n    { diseaseId: 'GI-01', diseaseName: '急性胃肠炎', complaint: '恶心、拉肚子、肚子咕咕叫' }\n  ],\n\n  // 消化 GI-02 功能性消化不良\n  '消化不良': [\n    { diseaseId: 'GI-02', diseaseName: '功能性消化不良', complaint: '吃太多后胃胀、反酸、不舒服' },\n    { diseaseId: 'GI-02', diseaseName: '功能性消化不良', complaint: '饭后胃痛、饱胀感、嗳气' },\n    { diseaseId: 'GI-02', diseaseName: '功能性消化不良', complaint: '胃部不适、食欲不振、腹胀' },\n    { diseaseId: 'GI-02', diseaseName: '功能性消化不良', complaint: '吃东西后胃疼、反酸烧心' }\n  ],\n\n  // 神经 NS-01 晕动病\n  '晕动病': [\n    { diseaseId: 'NS-01', diseaseName: '晕动病', complaint: '坐旋转项目后头晕、恶心、想吐' },\n    { diseaseId: 'NS-01', diseaseName: '晕动病', complaint: '玩游乐设施后头晕、出冷汗、心慌' },\n    { diseaseId: 'NS-01', diseaseName: '晕动病', complaint: '晕车样感觉、头晕恶心、脸色苍白' },\n    { diseaseId: 'NS-01', diseaseName: '晕动病', complaint: '旋转后眩晕、呕吐、乏力' }\n  ],\n  '眩晕': [\n    { diseaseId: 'NS-01', diseaseName: '晕动病', complaint: '旋转后眩晕、呕吐、乏力' },\n    { diseaseId: 'VR-01', diseaseName: '游乐设施后眩晕', complaint: '旋转项目后眩晕、恶心' },\n    { diseaseId: 'VR-02', diseaseName: '前庭性眩晕', complaint: '天旋地转的眩晕、伴呕吐' }\n  ],\n\n  // 神经 NS-02 过度惊吓反应\n  '惊吓': [\n    { diseaseId: 'NS-02', diseaseName: '过度惊吓反应', complaint: '鬼屋出来后心慌、手抖、害怕' },\n    { diseaseId: 'NS-02', diseaseName: '过度惊吓反应', complaint: '受惊吓后心慌、头晕、出汗' },\n    { diseaseId: 'NS-02', diseaseName: '过度惊吓反应', complaint: '惊吓后心跳很快、紧张不安' },\n    { diseaseId: 'NS-02', diseaseName: '过度惊吓反应', complaint: '恐怖项目后恐惧、失眠、噩梦' }\n  ],\n\n  // 心理 PS-01 儿童分离焦虑\n  '走失': [\n    { diseaseId: 'PS-01', diseaseName: '儿童分离焦虑', complaint: '小孩与父母走散后哭闹、害怕' },\n    { diseaseId: 'PS-01', diseaseName: '儿童分离焦虑', complaint: '儿童找不到家长、焦虑哭闹' },\n    { diseaseId: 'PS-01', diseaseName: '儿童分离焦虑', complaint: '孩子分离后恐慌、不肯离开' },\n    { diseaseId: 'PS-01', diseaseName: '儿童分离焦虑', complaint: '儿童焦虑、紧抓不放、哭泣' }\n  ],\n\n  // 心理 PS-02 过度换气综合征\n  '过度换气': [\n    { diseaseId: 'PS-02', diseaseName: '过度换气综合征', complaint: '紧张后呼吸急促、手脚发麻' },\n    { diseaseId: 'PS-02', diseaseName: '过度换气综合征', complaint: '焦虑发作呼吸快、头晕、手麻' },\n    { diseaseId: 'PS-02', diseaseName: '过度换气综合征', complaint: '恐慌时喘不过气、手抽筋' },\n    { diseaseId: 'PS-02', diseaseName: '过度换气综合征', complaint: '呼吸过快、胸口闷、嘴唇发麻' }\n  ],\n\n  // VR-01 游乐设施后眩晕\n  '过山车': [\n    { diseaseId: 'VR-01', diseaseName: '游乐设施后眩晕', complaint: '玩过山车后头晕、站不稳' },\n    { diseaseId: 'MS-01', diseaseName: '颈部挥鞭样损伤', complaint: '坐过山车后脖子痛、僵硬' }\n  ],\n  '游乐设施': [\n    { diseaseId: 'VR-01', diseaseName: '游乐设施后眩晕', complaint: '游乐设施后头昏、平衡差' },\n    { diseaseId: 'MS-01', diseaseName: '颈部挥鞭样损伤', complaint: '游乐设施后颈部酸痛、头晕' }\n  ],\n\n  // VR-02 前庭性眩晕 & VR-03 耳石症\n  '前庭性眩晕': [\n    { diseaseId: 'VR-02', diseaseName: '前庭性眩晕', complaint: '天旋地转的眩晕、伴呕吐' },\n    { diseaseId: 'VR-02', diseaseName: '前庭性眩晕', complaint: '眩晕感觉房子在转、恶心' },\n    { diseaseId: 'VR-02', diseaseName: '前庭性眩晕', complaint: '剧烈眩晕、必须闭眼躺下' },\n    { diseaseId: 'VR-02', diseaseName: '前庭性眩晕', complaint: '旋转性眩晕、伴耳鸣' }\n  ],\n  '耳石症': [\n    { diseaseId: 'VR-03', diseaseName: '耳石症', complaint: '转头时突发眩晕、几秒钟就好' },\n    { diseaseId: 'VR-03', diseaseName: '耳石症', complaint: '起床翻身时短暂天旋地转' },\n    { diseaseId: 'VR-03', diseaseName: '耳石症', complaint: '头位变化时剧烈眩晕、不敢动' },\n    { diseaseId: 'VR-03', diseaseName: '耳石症', complaint: '特定姿势时眩晕发作' }\n  ],\n\n  // GY-01/02/03 痛经\n  '痛经': [\n    { diseaseId: 'GY-01', diseaseName: '轻度痛经', complaint: '来月经肚子隐痛、腰酸' },\n    { diseaseId: 'GY-01', diseaseName: '轻度痛经', complaint: '经期小腹坠痛、乏力' },\n    { diseaseId: 'GY-02', diseaseName: '中度痛经', complaint: '痛经明显、影响游玩' },\n    { diseaseId: 'GY-03', diseaseName: '重度痛经', complaint: '痛经剧痛、出冷汗、想吐' }\n  ],\n\n  // MT-01/02/03 低血糖\n  '低血糖': [\n    { diseaseId: 'MT-01', diseaseName: '轻度低血糖', complaint: '心慌手抖、出冷汗、饥饿感' },\n    { diseaseId: 'MT-01', diseaseName: '轻度低血糖', complaint: '头晕心慌、手抖乏力' },\n    { diseaseId: 'MT-01', diseaseName: '轻度低血糖', complaint: '游玩久了心慌、出汗、饿' },\n    { diseaseId: 'MT-02', diseaseName: '中重度低血糖', complaint: '低血糖意识模糊、反应迟钝' },\n    { diseaseId: 'MT-03', diseaseName: '低血糖昏迷', complaint: '低血糖昏迷、意识丧失' }\n  ]\n};\n\nexport default {\n  components: {\n    Signature\n  },\n  data() {\n    return {\n      locations: [\n        { label: '陆园', value: 'land_park' },\n        { label: '水园', value: 'water_park' }\n      ],\n      identityOptions: [\n        { label: '游客', value: '游客' },\n        { label: '员工', value: '员工' }\n      ],\n      visitTypeOptions: [\n        { label: '否', value: 'clinic' },\n        { label: '是', value: 'outcall' }\n      ],\n      // 疾病→诊断与处置模板\n      diseaseTemplates: {\n        '扭伤': ['踝关节扭伤','腕关节扭伤','膝关节扭伤','肩关节扭伤','颈部肌肉拉伤','腰部肌筋膜拉伤','外侧副韧带拉伤'],\n        '擦伤': ['皮肤表浅擦伤','肘部擦伤','膝部擦伤','手掌擦伤','面部擦伤','小腿擦伤','躯干擦伤'],\n        '烫伤': ['Ⅰ度热烫伤','手部轻度烫伤','前臂轻度烫伤','躯干轻度烫伤','热液烫伤（表浅）','蒸汽烫伤（表浅）'],\n        '磕伤': ['软组织挫伤','头皮挫伤','膝部挫伤','前臂挫伤','小腿挫伤','肩部挫伤','足背挫伤'],\n        '冻伤': ['末端轻度冻伤','面部轻度冻伤','手指冻伤（表浅）','耳廓冻伤（表浅）','足趾冻伤（表浅）'],\n        '腹泻': ['急性胃肠炎','受凉所致腹泻','饮食不洁所致腹泻','功能性腹泻','旅游者腹泻'],\n        '头晕': ['体位性低血压','中暑轻型后遗症','疲劳性头晕','低血糖相关头晕','颈源性头晕可能'],\n        '头痛': ['紧张性头痛','外伤后轻度头痛','偏头痛样头痛（既往史）','感冒相关头痛','鼻窦炎相关头痛可能'],\n        '感冒': ['上呼吸道感染（轻）','风寒感冒','暑湿感冒','咽喉炎伴感冒','腺样体样症状可能'],\n        '脱臼': ['手指小关节脱位（已复位）','肩关节轻度半脱位（建议转诊）','髌骨半脱位可能'],\n        '骨折': ['疑似骨折（建议影像学检查）','手指末节疑似骨折','前臂疑似骨折','锁骨疑似骨折'],\n        '过敏': ['荨麻疹样皮疹','接触性皮炎','虫咬后过敏反应','花粉过敏样反应','食物相关过敏可能'],\n        '痛经': ['原发性痛经','寒凝血瘀型痛经','气滞血瘀型痛经'],\n        '测血压': ['血压偏高待复测','血压偏低伴轻度头晕','血压正常记录观察'],\n        '其他': ['一般外伤处理','非特异性不适，建议观察','情绪紧张相关不适']\n      },\n      treatmentTemplates: {\n        '扭伤': ['冷敷+弹性绷带加压包扎','制动抬高24-48h','必要时外固定并转诊','48小时后热敷功能锻炼'],\n        '擦伤': ['清创冲洗（盐水/3%双氧水）','碘伏消毒+无菌敷贴','必要时外用湿润烧伤膏','换药观察渗出感染'],\n        '烫伤': ['冷水冲洗15-20分钟','碘伏/湿润烧伤膏外用','无菌敷贴覆盖','避免刺破水疱并观察'],\n        '磕伤': ['局部冷敷+弹力绷带','碘伏消毒处理','必要时观察肿胀变化','超过48小时改热敷促进吸收'],\n        '冻伤': ['温水复温（37-40℃）','干燥保暖与保护','避免摩擦与再次受冷','必要时外用保护性敷贴'],\n        '腹泻': ['口服补液/葡萄糖粉剂一次','饮食清淡+观察','必要时解痉止泻','注意补盐与复诊提示'],\n        '头晕': ['测血压、观察休息','口服葡萄糖粉剂一次','必要时对症处理','避免剧烈运动与久站'],\n        '头痛': ['对症止痛（布洛芬一次）','补液与休息','观察诱因与复诊建议','避免强光久屏使用'],\n        '感冒': ['藿香正气水一次','对症退热镇痛（布洛芬一次）','多饮水休息','含服草珊瑚/板蓝根冲剂'],\n        '脱臼': ['制动固定+冷敷','建议影像学及专科处理','避免自行反复活动'],\n        '骨折': ['制动固定+冷敷','立即转诊影像学检查','必要时止痛处理'],\n        '过敏': ['口服氯雷他定一次','外用红肿冷敷','观察呼吸道症状','避免继续接触可疑过敏原'],\n        '痛经': ['热敷腹部、休息','必要时对症解痉','注意保暖与规律作息'],\n        '测血压': ['复测并记录','异常者建议随访或转诊','生活方式指导'],\n        '其他': ['对症观察+健康教育','必要时随访']\n      },\n      // 主诉（症状）模板\n      complaintTemplates: {\n        '扭伤': '扭伤后局部疼痛肿胀，活动受限',\n        '擦伤': '皮肤表浅擦伤，轻度渗血/疼痛',\n        '烫伤': '热液/蒸汽烫伤，局部红肿灼痛',\n        '磕伤': '碰撞致局部疼痛肿胀',\n        '冻伤': '受寒后局部麻木疼痛，皮肤颜色改变',\n        '腹泻': '近一天腹泻多次，伴轻度腹痛/乏力',\n        '头晕': '阵发性头晕，伴乏力/站立不稳',\n        '头痛': '持续性头痛，紧张诱发明显',\n        '感冒': '咳嗽流涕咽痛，乏力/低热',\n        '脱臼': '外伤后关节畸形疼痛，活动受限',\n        '骨折': '外伤后局部肿胀疼痛，活动受限',\n        '过敏': '全身/局部皮疹瘙痒，接触史阳性',\n        '痛经': '经期下腹阵发性疼痛',\n        '测血压': '测血压复查，无明显不适',\n        '中暑': '户外暴晒后头晕乏力出汗增多',\n        '咽喉痛': '咽部疼痛，吞咽不适',\n        '皮疹': '皮疹伴瘙痒，抓挠后加重',\n        '牙痛': '患牙疼痛，冷热刺激明显',\n        '关节痛': '关节活动痛，活动后加重'\n      },\n      // 注意事项/复诊提示（按疾病自动附加到处置）\n      treatmentCautions: {\n        '腹泻': [\n          '补液：小口频饮，注意补盐',\n          '清淡饮食，避免油腻辛辣',\n          '48小时未缓解或伴高热/血便请及时复诊'\n        ],\n        '头晕': [\n          '休息，避免久站/剧烈运动',\n          '监测血压与症状变化',\n          '症状持续或加重请复诊'\n        ],\n        '头痛': [\n          '注意休息与补水',\n          '减少长时间屏幕与强光刺激',\n          '频繁发作或伴呕吐/视物模糊请复诊'\n        ],\n        '感冒': [\n          '多饮水休息，注意保暖与口罩礼仪',\n          '对症用药后观察',\n          '发热＞38.5℃或持续超过3天请复诊'\n        ]\n      },\n      hvTriage: null,\n      // 结构化疾病模板库：每个疾病下多条主诉，每条主诉有独立的症状/诊断/处置\n      // 后续可以扩展 drugs 字段\n      diseaseTemplateLib: {\n        '感冒': [\n          {\n            complaint: '咳嗽流涕咽痛，伴乏力低热',\n            symptoms: [\n              '近1～2日出现咳嗽、流涕、咽痛，体温不高于38.5℃',\n              '伴轻度乏力，无明显呼吸困难'\n            ],\n            diagnoses: [\n              '上呼吸道感染（轻型）',\n              '病毒性上呼吸道感染可能'\n            ],\n            treatments: [\n              '多饮水休息，注意保暖',\n              '口服对症药物（如退热镇痛药）',\n              '观察体温及症状变化，必要时复诊'\n            ]\n          },\n          {\n            complaint: '受凉后出现流涕咳嗽、咽痛，伴头痛乏力',\n            symptoms: [\n              '受凉后出现流涕、咳嗽、咽痛约1日',\n              '伴头痛乏力，无胸闷气促'\n            ],\n            diagnoses: [\n              '风寒感冒',\n              '急性上呼吸道感染'\n            ],\n            treatments: [\n              '口服感冒药物一次，注意用药间隔',\n              '注意保暖，减少户外暴露',\n              '嘱如体温持续升高或症状加重及时就诊'\n            ]\n          },\n          {\n            complaint: '游玩途中出现流涕、喷嚏、轻度咳嗽，伴乏力',\n            symptoms: [\n              '游玩途中出现流涕、喷嚏，偶有轻度咳嗽',\n              '体温基本正常或轻度升高'\n            ],\n            diagnoses: [\n              '普通感冒',\n              '上呼吸道感染待排'\n            ],\n            treatments: [\n              '暂时减少剧烈项目，多饮温水',\n              '根据需要给予含片或口服感冒药',\n              '嘱观察症状，如发热明显或精神状态差需就诊'\n            ]\n          }\n        ],\n        '扭伤': [\n          {\n            complaint: '行走时不慎扭伤踝关节，局部肿胀疼痛，活动受限',\n            symptoms: [\n              '踝关节局部肿胀疼痛，活动受限',\n              '皮肤完整，无明显畸形'\n            ],\n            diagnoses: [\n              '踝关节软组织扭伤',\n              '韧带拉伤可能'\n            ],\n            treatments: [\n              '24小时内局部冷敷',\n              '弹力绷带加压包扎，减少负重',\n              '抬高患肢，必要时转诊影像学检查'\n            ]\n          },\n          {\n            complaint: '运动时扭伤膝关节，行走困难',\n            symptoms: [\n              '膝关节局部肿胀疼痛，行走时加重',\n              '关节活动受限'\n            ],\n            diagnoses: [\n              '膝关节扭伤',\n              '内侧副韧带拉伤可能'\n            ],\n            treatments: [\n              '局部冷敷、制动休息',\n              '建议影像学检查，必要时转诊',\n              '避免剧烈运动及负重行走'\n            ]\n          },\n          {\n            complaint: '玩项目时不慎扭伤腕关节，局部疼痛肿胀',\n            symptoms: [\n              '腕关节局部压痛、轻度肿胀',\n              '活动时疼痛加重，静息时稍缓解'\n            ],\n            diagnoses: [\n              '腕关节软组织扭伤'\n            ],\n            treatments: [\n              '局部冷敷，抬高患肢',\n              '弹力绷带适度加压固定',\n              '嘱避免提重物，如疼痛明显或活动受限加重及时复诊'\n            ]\n          }\n        ],\n        '擦伤': [\n          {\n            complaint: '玩耍时摔倒致膝部皮肤擦伤，伴轻度渗血疼痛',\n            symptoms: [\n              '膝部皮肤表浅擦伤，少量渗血',\n              '局部疼痛，无明显肿胀'\n            ],\n            diagnoses: [\n              '膝部皮肤表浅擦伤'\n            ],\n            treatments: [\n              '清水/生理盐水冲洗创面',\n              '碘伏消毒后无菌敷贴覆盖',\n              '交代保持创面清洁干燥，观察感染迹象'\n            ],\n            suggestDrugs: ['碘伏', '无菌敷贴', '海诺创可贴']\n          },\n          {\n            complaint: '活动时摔倒致手掌擦伤，局部疼痛',\n            symptoms: [\n              '手掌皮肤表浅擦伤，少量渗血或渗液',\n              '局部疼痛，活动基本自如'\n            ],\n            diagnoses: [\n              '手掌皮肤表浅擦伤'\n            ],\n            treatments: [\n              '冲洗清洁创面',\n              '碘伏消毒后覆以创可贴或无菌敷贴',\n              '嘱避免频繁摩擦及浸水'\n            ],\n            suggestDrugs: ['碘伏', '海诺创可贴']\n          },\n          {\n            complaint: '滑倒致肘部擦伤，局部疼痛伴少量渗血',\n            symptoms: [\n              '肘部局部表浅皮肤擦伤，少量渗血或结痂',\n              '关节活动基本自如，可有轻微牵拉痛'\n            ],\n            diagnoses: [\n              '肘部皮肤表浅擦伤'\n            ],\n            treatments: [\n              '生理盐水或清水冲洗创面',\n              '碘伏消毒后敷贴无菌敷料',\n              '嘱保持伤口清洁干燥，避免剧烈活动'\n            ]\n          }\n        ],\n        '烫伤': [\n          {\n            complaint: '被热饮不慎泼洒致手部局部红肿灼痛',\n            symptoms: [\n              '手背/手掌局部皮肤潮红、水肿',\n              '疼痛明显，无大疱或少量小疱'\n            ],\n            diagnoses: [\n              '手部表浅Ⅰ度热烫伤'\n            ],\n            treatments: [\n              '流动冷水冲洗15～20分钟',\n              '外用湿润烧伤膏或同类药物',\n              '无菌敷料覆盖，嘱避免刺破水疱'\n            ],\n            suggestDrugs: ['湿润烧伤膏', '无菌敷贴']\n          },\n          {\n            complaint: '接触热汤/蒸汽后前臂烫伤，局部红肿疼痛',\n            symptoms: [\n              '前臂局部皮肤潮红，轻度水肿',\n              '疼痛明显，部分可见小疱'\n            ],\n            diagnoses: [\n              '前臂表浅热烫伤'\n            ],\n            treatments: [\n              '及时冷水冲洗降温',\n              '局部外用烧伤药物并覆盖敷料',\n              '交代观察感染迹象，如红肿加重及时复诊'\n            ]\n          },\n          {\n            complaint: '不慎接触热锅边缘致手指局部烫伤',\n            symptoms: [\n              '手指局部皮肤潮红或轻度水疱',\n              '局部灼痛明显，活动基本不受限'\n            ],\n            diagnoses: [\n              '手指轻度热烫伤'\n            ],\n            treatments: [\n              '冷水冲洗患处10～15分钟',\n              '外用湿润烧伤膏或同类药物',\n              '避免刺破水疱，注意保持患处清洁'\n            ]\n          }\n        ],\n        '中暑': [\n          {\n            complaint: '户外排队久站后出现头晕乏力出汗增多',\n            symptoms: [\n              '在高温环境中活动后出现头晕、乏力、出汗增多',\n              '皮肤潮红或湿冷，口渴'\n            ],\n            diagnoses: [\n              '中暑轻型'\n            ],\n            treatments: [\n              '转移至阴凉通风处休息',\n              '口服补液或葡萄糖溶液',\n              '物理降温（冷敷额头、颈部等）',\n              '观察症状变化，如加重及时转诊'\n            ],\n            suggestDrugs: ['藿香正气水', '葡萄糖粉剂']\n          },\n          {\n            complaint: '在阳光下玩耍后感到头痛、恶心、全身乏力',\n            symptoms: [\n              '户外暴晒后出现头痛、恶心、乏力',\n              '部分伴有轻度心悸'\n            ],\n            diagnoses: [\n              '中暑样反应'\n            ],\n            treatments: [\n              '立即脱离高温环境，卧床休息',\n              '口服补液，必要时给予对症药物',\n              '嘱家属/同伴观察，如出现意识改变立即送医'\n            ]\n          }\n        ],\n        '腹泻': [\n          {\n            complaint: '进食冷饮或不洁食物后出现腹泻，多次稀便',\n            symptoms: [\n              '近1日多次稀便，伴轻度腹痛',\n              '无明显高热或严重脱水表现'\n            ],\n            diagnoses: [\n              '急性胃肠炎（轻型）'\n            ],\n            treatments: [\n              '口服补液盐/葡萄糖溶液，小口多次',\n              '暂避油腻辛辣及生冷饮食',\n              '观察体温及大便次数，症状加重时及时就诊'\n            ],\n            suggestDrugs: ['诺氟沙星胶囊', '藿香正气水']\n          },\n          {\n            complaint: '游玩期间出现腹泻伴轻度腹痛乏力',\n            symptoms: [\n              '反复稀便，腹部隐痛或阵发性腹痛',\n              '伴乏力，食欲下降'\n            ],\n            diagnoses: [\n              '功能性腹泻可能',\n              '消化不良'\n            ],\n            treatments: [\n              '建议口服补液，注意休息',\n              '清淡饮食，避免刺激性食物',\n              '如出现血便、高热等需尽快就诊'\n            ]\n          }\n        ],\n        '过敏': [\n          {\n            complaint: '接触不明物后出现全身皮疹瘙痒',\n            symptoms: [\n              '全身或局部出现红色丘疹/风团样皮疹',\n              '瘙痒明显，无呼吸困难'\n            ],\n            diagnoses: [\n              '荨麻疹样皮疹',\n              '过敏反应'\n            ],\n            treatments: [\n              '口服抗组胺药一次',\n              '局部可外用止痒药物',\n              '避免继续接触可疑过敏原，观察症状变化'\n            ],\n            suggestDrugs: ['氯雷他定片（开瑞坦）']\n          },\n          {\n            complaint: '虫咬后局部红肿瘙痒不适',\n            symptoms: [\n              '局部红肿、皮疹，瘙痒明显',\n              '一般全身情况尚可'\n            ],\n            diagnoses: [\n              '虫咬性皮炎'\n            ],\n            treatments: [\n              '局部冷敷或外用止痒药膏',\n              '必要时口服抗过敏药',\n              '嘱避免搔抓，观察有无加重或全身反应'\n            ]\n          },\n          {\n            complaint: '食用某种食物后出现口唇轻度肿胀瘙痒',\n            symptoms: [\n              '食用可疑食物后短时间内出现口周或口唇轻度肿胀、瘙痒',\n              '无明显呼吸困难或胸闷气促'\n            ],\n            diagnoses: [\n              '食物相关轻度过敏反应'\n            ],\n            treatments: [\n              '口服抗组胺药一次',\n              '暂避可疑食物，嘱观察症状变化',\n              '如出现呼吸困难、胸闷或全身症状需立即就医'\n            ]\n          }\n        ],\n        '头晕': [\n          {\n            complaint: '在园区内长时间排队后出现头晕乏力',\n            symptoms: [\n              '长时间站立或排队后感到头晕、眼前发黑',\n              '伴轻度乏力，平卧休息后好转'\n            ],\n            diagnoses: [\n              '体位性低血压可能',\n              '疲劳相关头晕'\n            ],\n            treatments: [\n              '协助平卧或半卧休息',\n              '口服葡萄糖溶液或温水',\n              '嘱缓慢起身，短期内避免剧烈项目'\n            ]\n          },\n          {\n            complaint: '天气炎热时活动后出现头晕伴出汗乏力',\n            symptoms: [\n              '在高温环境下活动后出现头晕、乏力、大量出汗',\n              '皮肤潮红或湿冷，口渴'\n            ],\n            diagnoses: [\n              '中暑轻型',\n              '高温相关不适'\n            ],\n            treatments: [\n              '转移至阴凉通风处休息',\n              '口服补液盐或葡萄糖溶液',\n              '适当物理降温，观察症状变化'\n            ]\n          }\n        ],\n        '头痛': [\n          {\n            complaint: '久看手机或屏幕后出现头痛、眼胀',\n            symptoms: [\n              '长时间使用电子屏幕后出现额部或双侧头痛',\n              '伴眼胀、颈部酸痛，休息后可缓解'\n            ],\n            diagnoses: [\n              '紧张性头痛',\n              '视疲劳相关头痛'\n            ],\n            treatments: [\n              '建议暂时远离屏幕，闭目休息',\n              '根据需要口服对症止痛药一次',\n              '注意补水与颈肩放松练习'\n            ]\n          },\n          {\n            complaint: '户外活动后出现搏动性头痛，伴轻度恶心',\n            symptoms: [\n              '一侧或双侧搏动样头痛',\n              '可伴恶心、对强光和噪声敏感'\n            ],\n            diagnoses: [\n              '偏头痛样头痛可能'\n            ],\n            treatments: [\n              '安排在安静、光线柔和环境休息',\n              '根据情况口服止痛药物一次',\n              '如反复发作或伴有神经系统症状建议进一步检查'\n            ]\n          }\n        ],\n\n        // 低血糖相关\n        '低血糖': [\n          {\n            complaint: '空腹游玩后出现心慌出汗手抖',\n            symptoms: [\n              '长时间未进食后出现心慌、出冷汗、手抖',\n              '可伴轻度头晕、乏力'\n            ],\n            diagnoses: [\n              '低血糖样反应',\n              '空腹相关低血糖可能'\n            ],\n            treatments: [\n              '立即口服含糖饮料或葡萄糖溶液',\n              '短期观察症状变化，缓解后继续补充少量主食',\n              '提醒避免长时间空腹进行高强度活动，如症状不缓解建议就医'\n            ],\n            suggestDrugs: ['葡萄糖粉剂']\n          },\n          {\n            complaint: '测血糖结果偏低，伴头晕乏力',\n            symptoms: [\n              '血糖监测结果低于正常范围',\n              '伴有乏力、头晕、出汗等不适'\n            ],\n            diagnoses: [\n              '低血糖发作（轻型）'\n            ],\n            treatments: [\n              '立即补充糖分，口服葡萄糖或含糖饮料',\n              '复测血糖并观察症状变化',\n              '有糖尿病等基础疾病者建议回原随访医院评估用药'\n            ]\n          }\n        ],\n\n        // 发作/癫痫/晕厥相关\n        '发作': [\n          {\n            complaint: '既往有癫痫史，本次在园区内出现抽搐发作',\n            symptoms: [\n              '突发意识障碍，伴四肢抽动',\n              '发作后短暂嗜睡或意识模糊'\n            ],\n            diagnoses: [\n              '癫痫发作（既往癫痫史）'\n            ],\n            treatments: [\n              '发作期注意头偏向一侧，防止误吸，勿强行按压肢体',\n              '发作停止后侧卧位休息，保持呼吸道通畅',\n              '建议尽快联系家属并由神经专科进一步评估'\n            ]\n          },\n          {\n            complaint: '无明确既往史，本次突发抽搐样发作伴短暂意识丧失',\n            symptoms: [\n              '短暂意识障碍或意识丧失',\n              '四肢不自主抽动，事后记忆不清'\n            ],\n            diagnoses: [\n              '癫痫样发作待排'\n            ],\n            treatments: [\n              '发作期注意安全保护，防止跌落伤及头面部',\n              '发作后注意生命体征监测',\n              '建议尽快转诊神经专科完善检查'\n            ]\n          },\n          {\n            complaint: '短暂晕倒后自行苏醒，无持续神经功能缺损',\n            symptoms: [\n              '突发短暂意识丧失，倒地后很快清醒',\n              '事后可伴轻度乏力或头晕'\n            ],\n            diagnoses: [\n              '不明原因晕厥待排'\n            ],\n            treatments: [\n              '平卧抬高下肢，监测血压和心率',\n              '建议行心电图及相关检查',\n              '如反复发作或伴胸痛气促等症状应尽快就医'\n            ]\n          }\n        ],\n\n        // 痛经类\n        '痛经': [\n          {\n            complaint: '来月经肚子隐痛、腰酸',\n            symptoms: [\n              '经期下腹部隐痛或胀痛，可放射至腰骶部',\n              '伴腰酸、乏力，疼痛程度较轻，不影响日常活动',\n              '月经量正常或略多，无血块或血块较少'\n            ],\n            diagnoses: [\n              '轻度痛经',\n              '原发性痛经可能'\n            ],\n            treatments: [\n              '热敷腹部、休息',\n              '必要时对症解痉',\n              '注意保暖与规律作息'\n            ],\n            suggestDrugs: ['布洛芬缓释胶囊']\n          },\n          {\n            complaint: '经期小腹坠痛、乏力',\n            symptoms: [\n              '经期下腹部坠痛或胀痛，疼痛程度中等',\n              '伴乏力、腰酸，可能影响部分活动',\n              '月经量正常，可有少量血块',\n              '无恶心、呕吐等严重症状'\n            ],\n            diagnoses: [\n              '中度痛经',\n              '原发性痛经',\n              '寒凝血瘀型痛经可能'\n            ],\n            treatments: [\n              '热敷腹部、休息',\n              '口服解痉止痛药（如布洛芬）',\n              '注意保暖，避免受凉',\n              '规律作息，避免过度劳累'\n            ],\n            suggestDrugs: ['布洛芬缓释胶囊', '元胡止痛片']\n          },\n          {\n            complaint: '痛经明显、影响游玩',\n            symptoms: [\n              '经期下腹部明显疼痛，疼痛程度较重',\n              '疼痛影响正常活动，可能需要休息',\n              '可伴腰酸、乏力、情绪不佳',\n              '月经量正常或略多，可有血块'\n            ],\n            diagnoses: [\n              '中度痛经',\n              '原发性痛经',\n              '气滞血瘀型痛经可能'\n            ],\n            treatments: [\n              '热敷腹部、休息',\n              '口服解痉止痛药',\n              '注意保暖与规律作息',\n              '如疼痛持续或加重，建议妇科门诊进一步检查'\n            ],\n            suggestDrugs: ['布洛芬缓释胶囊', '元胡止痛片']\n          },\n          {\n            complaint: '痛经剧痛、出冷汗、想吐',\n            symptoms: [\n              '经期下腹部剧烈疼痛，呈痉挛性或持续性',\n              '疼痛难以忍受，严重影响活动',\n              '伴出冷汗、面色苍白、恶心、想吐',\n              '可伴头晕、乏力，甚至需要卧床休息',\n              '月经量正常或略多，血块可能较多'\n            ],\n            diagnoses: [\n              '重度痛经',\n              '原发性痛经',\n              '继发性痛经待排（建议妇科检查）'\n            ],\n            treatments: [\n              '立即休息，平卧休息',\n              '热敷腹部，注意保暖',\n              '口服解痉止痛药（如布洛芬）',\n              '如症状严重或持续不缓解，建议转诊妇科专科',\n              '建议完善妇科检查，排除器质性疾病'\n            ],\n            suggestDrugs: ['布洛芬缓释胶囊', '元胡止痛片']\n          }\n        ],\n\n        // 测量/监测类\n        '测量监测': [\n          {\n            complaint: '因自觉不适前来测量血压',\n            symptoms: [\n              '主诉头晕、心慌或乏力等症状',\n              '血压监测结果在正常范围或略有波动'\n            ],\n            diagnoses: [\n              '血压监测（结果正常）'\n            ],\n            treatments: [\n              '记录血压结果，建议保持良好作息',\n              '如反复出现不适或血压明显波动，建议门诊随访'\n            ]\n          },\n          {\n            complaint: '因头晕来测血压，结果偏高',\n            symptoms: [\n              '血压监测结果偏高，伴轻度不适',\n              '可有头晕、头胀或耳鸣'\n            ],\n            diagnoses: [\n              '血压监测（结果偏高）',\n              '血压偏高待复测'\n            ],\n            treatments: [\n              '建议安静休息后复测血压',\n              '如多次测量均偏高，建议至门诊进一步评估',\n              '注意饮食和作息管理'\n            ]\n          },\n          {\n            complaint: '因乏力、心慌等不适来测血糖',\n            symptoms: [\n              '血糖监测结果偏低',\n              '伴有乏力、头晕、手抖等低血糖相关症状'\n            ],\n            diagnoses: [\n              '血糖监测（结果偏低）',\n              '低血糖样反应'\n            ],\n            treatments: [\n              '口服含糖饮料或葡萄糖溶液',\n              '短期内避免再次空腹高强度活动',\n              '如症状不缓解或反复发作应尽快就医'\n            ],\n            suggestDrugs: ['葡萄糖粉剂']\n          }\n        ],\n\n        // 劳损/慢性疼痛（主要面向员工）\n        '劳损/慢性疼痛': [\n          {\n            complaint: '长时间站立或弯腰后出现腰背酸痛',\n            symptoms: [\n              '腰背部酸胀不适',\n              '活动后疼痛加重，休息后可缓解'\n            ],\n            diagnoses: [\n              '腰背肌筋膜炎'\n            ],\n            treatments: [\n              '减少久坐久站，适当活动和拉伸腰背肌肉',\n              '可外用止痛贴等对症处理',\n              '如疼痛持续加重或伴下肢放射痛建议进一步检查'\n            ]\n          },\n          {\n            complaint: '长期伏案或低头工作后颈肩部酸痛不适',\n            symptoms: [\n              '颈肩部肌肉紧张酸痛',\n              '久坐或保持同一姿势后症状加重'\n            ],\n            diagnoses: [\n              '颈椎病可能'\n            ],\n            treatments: [\n              '注意工作姿势，每小时起身活动颈肩部',\n              '可行颈肩放松训练及局部热敷',\n              '如伴上肢放射痛或麻木应尽快就医'\n            ]\n          }\n        ]\n      },\n      // 常用药材（口服/外用一次）\n      drugSuggestionList: [\n        '棉签','碘伏','海诺创可贴','云南白药创可贴','一次性乳胶手套','纱布块','3%过氧化氢消毒液',\n        '余氯试纸','葡萄糖粉剂','利多卡因气雾剂','消旋山莨菪碱片','甲氧氯普胺片','诺氟沙星胶囊',\n        '维U颠茄铝胶囊','草珊瑚含片','氯芬黄敏片','布洛芬缓释胶囊','多潘立酮片','速效救心丸',\n        '脱敏胶带','盐水清洗液','一次性吸氧管','氧气袋','红霉素眼膏','左氧氟沙星滴眼液',\n        '藿香正气水','板蓝根颗粒','无菌敷贴','外科口罩','湿润烧伤膏','氯雷他定片（开瑞坦）',\n        '金士康和盐水清洗液'\n      ],\n      rxDrugNames: ['诺氟沙星胶囊', '速效救心丸', '布洛芬缓释胶囊', '多潘立酮片', '甲氧氯普胺片'],\n      form: {\n        visitDateTime: '',\n        name: '',\n        gender: '男',\n        age: null,\n        identity: '游客',\n        location: '',\n        visitType: 'clinic',\n        injuryLocation: '',\n        chiefComplaint: '',\n        symptom: '',\n        diseaseName: '',\n        diagnosis: '',\n        treatment: '',\n        drugId: '',\n        quantity: null,\n        remark: '',\n        doctorSign: '',\n        signTime: ''\n      },\n      showLocationTip: true, // 控制园区提示弹框是否显示\n      noTipNextTime: false,  // 下次不再提醒\n      currentDateTime: '',\n      selectedDrug: null,\n      selectedBatch: null,\n      availableStock: 0,\n      \n      // 处方功能开关\n      enablePrescription: false,\n      \n      // 处方列表\n      prescriptionList: [],\n      prescriptionNo: '', // 处方编号\n      currentDate: '', // 当前日期\n      \n      // 当前正在编辑的药品信息\n      currentDrug: {\n        dosage: '',\n        frequency: '',\n        route: '',\n        usage: ''\n      },\n      \n      // 用法用量选择器索引\n      frequencyIndex: 0,\n      routeIndex: 0,\n      \n      // 用法用量模板\n      dosageTemplates: {\n        '口服': ['0.5g', '1g', '10ml', '20ml', '适量'],\n        '外用': ['适量', '少量', '薄层涂抹'],\n        '含服': ['1片', '适量']\n      },\n      routeOptions: ['口服', '外用', '含服', '舌下含服', '涂擦患处', '肌肉注射', '静脉注射'],\n      frequencyOptions: ['即刻', '每日3次', '每日2次', '每日1次', '每8小时1次', '每12小时1次', '必要时', '睡前', '每日3-4次', '隔日1次'],\n      \n      // 药材搜索相关\n      drugSearchText: '',\n      allDrugs: [],\n      filteredDrugs: [],\n      showDrugList: false,\n      \n      // 疾病名称下拉列表（标准疾病名称）\n      diseaseOptions: [\n        '扭伤',\n        '擦伤',\n        '烫伤',\n        '磕伤',\n        '冻伤',\n        '腹泻',\n        '头晕',\n        '头痛',\n        '感冒',\n        '脱臼',\n        '骨折',\n        '过敏',\n        '痛经',\n        '测血压',\n        '其他'\n      ],\n      filteredDiseases: [],\n      showDiseaseList: false,\n      // 诊断/处置下拉\n      filteredDiagnosis: [],\n      showDiagnosisList: false,\n      filteredTreatments: [],\n      showTreatmentList: false,\n      // 主诉下拉\n      filteredComplaints: [],\n      showComplaintList: false,\n      complaintSelectedMode: false,  // 主诉是否已选择（自由编辑模式）\n      complaintFocus: false,  // 控制主诉输入框聚焦\n      // 症状相关\n      filteredSymptoms: [],\n      showSymptomList: false,\n      standardizedSymptoms: [],  // 从主诉标准化提取的症状列表\n      symptomBlurTimer: null,\n      symptomInputTimer: null,  // 症状输入防抖计时器\n      fetchHvSuggestionTimer: null,  // 获取诊断建议防抖计时器\n      // 下拉隐藏延迟计时器\n      diseaseBlurTimer: null,\n      complaintBlurTimer: null,\n      diagnosisBlurTimer: null,\n      // 输入防抖计时器\n      diseaseInputTimer: null,\n      diagnosisInputTimer: null,\n      // 年龄输入焦点（用于强制弹出数字键盘）\n      ageFocus: false,\n      // 园区常用地点词库（来自园区运营文件与现场点位）\n      allLocations: [\n        // 大区\n        '欢乐时光区','甜品王国区','香格里拉区','失落玛雅区','爱琴港区','峡湾深林区',\n        // 典型点位/场所\n        '欢乐广场','星闪舞台','旱喷泉','环道','树屋打卡点','情人廊','外广场','停车场','闸口','水公园闸口','大剧院正门',\n        // 乐园入口/屏幕\n        '香格里拉大屏幕','二期舞台屏幕','太空盒子外屏幕','海洋馆小舞台','奇幻海洋馆',\n        // 餐饮/店铺/项目口\n        '乐迪历险记门口','超飞主题餐厅','克罗索斯餐厅','家庭过山车入口','玛雅天灾入口',\n        // 糖果摊位\n        '甜蜜蜜','牛角包','太阳',\n        // 大型景观/设备标识\n        '水晶神翼大山','音乐过山车提升段','雪域金翅提升段','大剧院'\n      ],\n      filteredLocations: [],\n      showLocationList: false,\n      \n      showDrugSelector: false,\n      submitting: false,\n      continueAfterSubmit: true,  // 默认开启连续登记\n\n      // 当前聚焦字段的容器 id，用于配合 scroll-view 的 scroll-into-view，让输入框始终滚到键盘上方\n      activeFieldId: '',\n\n      // 定时器 ID：用于更新就诊时间，页面卸载时清理\n      dateTimeTimerId: null,\n\n      // 用户自定义疾病模板（本地持久化），按疾病名分组\n      // 结构示例：\n      // {\n      //   '扭伤': {\n      //      complaints: [ '行走时不慎扭伤踝关节，局部肿胀疼痛，活动受限', ... ],\n      //      diagnosis: [ '软组织扭伤（待进一步检查）', ... ],\n      //      treatments: [ '局部冷敷', '弹力绷带加压包扎', ... ]\n      //   },\n      //   ...\n      // }\n      userDiseaseTemplates: {},\n\n      // 多框搜索统一索引：汇总所有模板为 [{disease, complaint, diagnoses[], treatments[], symptoms[], source}]\n      templateIndex: [],\n      // 全局搜索关键词（用于跨字段联动）\n      globalSearchKeyword: ''\n    };\n  },\n\n  computed: {\n    currentLocationLabel() {\n      const loc = this.form?.location\n      if (loc === 'land_park') return '陆园'\n      if (loc === 'water_park') return '水园'\n      return '未选择'\n    },\n\n    // 未选择合法园区时，锁定表单核心输入\n    locationLocked() {\n      const loc = this.form?.location\n      return !loc || (loc !== 'land_park' && loc !== 'water_park')\n    },\n    \n    // 根据主诉内容长度动态调整字号\n    complaintFontSizeClass() {\n      const length = (this.form.chiefComplaint || '').length;\n      if (length > 50) return 'font-small';\n      if (length > 30) return 'font-medium';\n      return '';\n    },\n    \n    // 根据诊断内容长度动态调整字号\n    diagnosisFontSizeClass() {\n      const length = (this.form.diagnosis || '').length;\n      if (length > 50) return 'font-small';\n      if (length > 30) return 'font-medium';\n      return '';\n    },\n    \n    // 当前选择的用药频次标签\n    currentFrequencyLabel() {\n      return this.frequencyOptions[this.frequencyIndex] || '请选择';\n    },\n    \n    // 当前选择的给药途径标签\n    currentRouteLabel() {\n      return this.routeOptions[this.routeIndex] || '请选择';\n    }\n  },\n\n  onLoad() {\n    this.updateDateTime();\n    // 每分钟更新一次时间，并记录定时器 ID，便于卸载时清理\n    this.dateTimeTimerId = setInterval(() => {\n      this.updateDateTime();\n    }, 60000);\n    \n    // 初始化处方编号和日期\n    this.initPrescription();\n    \n    // 恢复上次选择的园区\n    this.restoreLastLocation();\n    \n    // 恢复用户自定义疾病模板\n    this.restoreUserDiseaseTemplates();\n\n    // 构建多框搜索统一索引\n    this.buildTemplateIndex();\n\n    // 加载药材列表\n    this.loadAllDrugs();\n  },\n\n  onUnload() {\n    // 页面卸载时清理定时器，避免多次进入页面产生重复计时\n    if (this.dateTimeTimerId) {\n      clearInterval(this.dateTimeTimerId);\n      this.dateTimeTimerId = null;\n    }\n    // 清理防抖计时器\n    if (this.symptomInputTimer) {\n      clearTimeout(this.symptomInputTimer);\n      this.symptomInputTimer = null;\n    }\n    if (this.fetchHvSuggestionTimer) {\n      clearTimeout(this.fetchHvSuggestionTimer);\n      this.fetchHvSuggestionTimer = null;\n    }\n    if (this.diseaseInputTimer) {\n      clearTimeout(this.diseaseInputTimer);\n      this.diseaseInputTimer = null;\n    }\n    if (this.diagnosisInputTimer) {\n      clearTimeout(this.diagnosisInputTimer);\n      this.diagnosisInputTimer = null;\n    }\n    if (this.complaintInputTimer) {\n      clearTimeout(this.complaintInputTimer);\n      this.complaintInputTimer = null;\n    }\n    if (this.complaintFocusTimer) {\n      clearTimeout(this.complaintFocusTimer);\n      this.complaintFocusTimer = null;\n    }\n  },\n\n  watch: {\n    // 监听主诉字段变化，清空时联动清空所有相关字段\n    'form.chiefComplaint'(newVal, oldVal) {\n      const newComplaint = (newVal || '').trim();\n      const oldComplaint = (oldVal || '').trim();\n      \n      // 从有内容变为空\n      if (oldComplaint && !newComplaint) {\n        // 检查是否有已填写的相关字段\n        const hasRelatedData = \n          this.form.symptom || \n          this.form.diagnosis || \n          this.form.diseaseName || \n          this.form.treatment || \n          this.prescriptionList.length > 0;\n        \n        if (hasRelatedData) {\n          // 延迟执行，避免与输入事件冲突\n          this.$nextTick(() => {\n            uni.showModal({\n              title: '清空确认',\n              content: '清空主诉将同时清空症状、诊断、疾病名称、处置和处方等相关信息，是否继续？',\n              confirmText: '确认清空',\n              cancelText: '取消',\n              confirmColor: '#dc2626',\n              success: (res) => {\n                if (res.confirm) {\n                  this.clearAllRelatedFields();\n                } else {\n                  // 恢复主诉内容\n                  this.form.chiefComplaint = oldComplaint;\n                }\n              }\n            });\n          });\n        } else {\n          // 没有相关数据，直接清空\n          this.clearAllRelatedFields();\n        }\n      }\n    }\n  },\n\n  methods: {\n    // ✨ 清空所有相关字段（主诉清空时调用）\n    clearAllRelatedFields() {\n      // 1. 清空就诊信息相关字段\n      this.form.symptom = '';           // 症状\n      this.form.diagnosis = '';         // 诊断\n      this.form.diseaseName = '';       // 疾病名称\n      this.form.treatment = '';         // 处置\n      \n      // 2. 清空用药信息\n      this.selectedDrug = null;         // 选中的药材\n      this.form.drugId = '';            // 药材ID\n      this.form.quantity = null;        // 用药数量\n      this.drugSearchText = '';         // 药材搜索文本\n      \n      // 3. 清空处方列表\n      this.prescriptionList = [];       // 处方列表\n      \n      // 4. 清空辅助数据\n      this.standardizedSymptoms = [];   // 标准化症状\n      this.hvTriage = null;             // 分诊建议\n      \n      // 5. 重置模式\n      this.complaintSelectedMode = false;\n      \n      // 6. 关闭所有下拉列表\n      this.showSymptomList = false;\n      this.showDiagnosisList = false;\n      this.showDiseaseList = false;\n      this.showTreatmentList = false;\n      this.showDrugList = false;\n      this.showComplaintList = false;\n      \n      console.log('[clinic/add] 已清空主诉及所有相关字段');\n    },\n    \n    // 初始化处方信息\n    initPrescription() {\n      // 生成处方编号：格式 年份-流水号（如2025-0001）\n      const now = new Date();\n      const year = now.getFullYear();\n      const month = (now.getMonth() + 1).toString().padStart(2, '0');\n      const day = now.getDate().toString().padStart(2, '0');\n      \n      // 使用时间戳的后4位作为流水号（简化版，实际应该从数据库获取）\n      const timestamp = Date.now();\n      const serialNo = (timestamp % 10000).toString().padStart(4, '0');\n      \n      this.prescriptionNo = `${year}-${serialNo}`;\n      this.currentDate = `${year}年${month}月${day}日`;\n    },\n    \n    // 用药频次选择器变化\n    onFrequencyChange(e) {\n      this.frequencyIndex = e.detail.value;\n      this.currentDrug.frequency = this.frequencyOptions[this.frequencyIndex];\n    },\n    \n    // 给药途径选择器变化\n    onRouteChange(e) {\n      this.routeIndex = e.detail.value;\n      this.currentDrug.route = this.routeOptions[this.routeIndex];\n    },\n    \n    // 处方开关切换\n    onPrescriptionSwitch(e) {\n      this.enablePrescription = e.detail.value;\n      \n      // 如果开启处方，初始化处方信息\n      if (this.enablePrescription && !this.prescriptionNo) {\n        this.initPrescription();\n      }\n    },\n    \n    // 从药品规格中提取真正的最小单位\n    getRealMinUnit(drug) {\n      const spec = drug.specification || '';\n      \n      // 常见的最小单位\n      const minUnits = ['片', '粒', '丸', '支', '袋', '包'];\n      \n      // 从规格中查找最小单位\n      for (const unit of minUnits) {\n        if (spec.includes(unit)) {\n          return unit;\n        }\n      }\n      \n      // 如果规格中没有找到，返回原始的minUnit\n      return drug.minUnit;\n    },\n    \n    // 添加到处方\n    addToPrescription() {\n      if (!this.selectedDrug) {\n        uni.showToast({\n          title: '请先选择药材',\n          icon: 'none'\n        });\n        return;\n      }\n      \n      if (!this.form.quantity || this.form.quantity <= 0) {\n        uni.showToast({\n          title: '请输入有效数量',\n          icon: 'none'\n        });\n        return;\n      }\n      \n      if (this.form.quantity > this.availableStock) {\n        uni.showToast({\n          title: '库存不足',\n          icon: 'none'\n        });\n        return;\n      }\n      \n      // 弹出用法用量输入框\n      const that = this;\n      const drugName = this.selectedDrug.name;\n      \n      // 根据药品类型提供示例\n      let example = '0.5g 口服 每日3次';\n      if (drugName.includes('风油精') || drugName.includes('外用')) {\n        example = '适量 外用 每日3-4次';\n      } else if (drugName.includes('水') || drugName.includes('液')) {\n        example = '10ml 口服 每日2次';\n      }\n      \n      uni.showModal({\n        title: '填写用法用量',\n        content: `格式：剂量 途径 频次\\n示例：${example}\\n\\n剂量：0.5g、10ml、适量等\\n途径：口服、外用、含服等\\n频次：每日3次、必要时等`,\n        editable: true,\n        placeholderText: example,\n        success: (res) => {\n          if (res.confirm && res.content) {\n            // 解析用法用量\n            const usageText = res.content.trim();\n            \n            // 过滤掉格式说明文本（如果用户没有修改直接确认）\n            if (usageText.includes('格式') || usageText.includes('示例') || usageText.includes('剂量：') || usageText.includes('途径：') || usageText.includes('频次：')) {\n              uni.showToast({\n                title: '请填写实际用法用量',\n                icon: 'none'\n              });\n              return;\n            }\n            \n            const parts = usageText.split(/\\s+/); // 用空格分割\n            \n            // 添加到处方列表\n            that.prescriptionList.push({\n              drugId: that.selectedDrug._id,\n              drugName: that.selectedDrug.name,\n              specification: that.selectedDrug.specification,\n              quantity: that.form.quantity,\n              unit: that.getRealMinUnit(that.selectedDrug),\n              batchId: that.selectedBatch?._id,\n              batchNumber: that.selectedBatch?.batch,\n              dosage: parts[0] || '',\n              route: parts[1] || '',\n              frequency: parts.slice(2).join(' ') || '' // 频次可能有多个词\n            });\n            \n            // 清空当前选择\n            that.drugSearchText = '';\n            that.selectedDrug = null;\n            that.selectedBatch = null;\n            that.availableStock = 0;\n            that.form.quantity = null;\n            that.showDrugList = false;\n            \n            uni.showToast({\n              title: '已加入处方',\n              icon: 'success'\n            });\n          } else if (res.confirm) {\n            uni.showToast({\n              title: '请填写用法用量',\n              icon: 'none'\n            });\n          }\n        }\n      });\n    },\n    \n    // 从处方中移除\n    removeFromPrescription(index) {\n      uni.showModal({\n        title: '确认删除',\n        content: '确定要从处方中移除这味药吗？',\n        success: (res) => {\n          if (res.confirm) {\n            this.prescriptionList.splice(index, 1);\n            uni.showToast({\n              title: '已移除',\n              icon: 'success'\n            });\n          }\n        }\n      });\n    },\n    \n    // 快速添加到处方（从药材选择区域）\n    quickAddToPrescription() {\n      // 如果没有选择药材，提示用户先选择\n      if (!this.selectedDrug) {\n        uni.showToast({\n          title: '请先选择药材',\n          icon: 'none',\n          duration: 2000\n        });\n        // 滚动到药材选择区域\n        this.$nextTick(() => {\n          uni.pageScrollTo({\n            selector: '#field-drug',\n            duration: 300\n          });\n        });\n        return;\n      }\n      \n      // 如果没有输入数量，提示用户输入\n      if (!this.form.quantity || this.form.quantity <= 0) {\n        uni.showToast({\n          title: '请先输入用药数量',\n          icon: 'none',\n          duration: 2000\n        });\n        return;\n      }\n      \n      // 检查库存\n      if (this.form.quantity > this.availableStock) {\n        uni.showModal({\n          title: '库存不足',\n          content: `当前库存：${this.availableStock} ${this.getRealMinUnit(this.selectedDrug)}，是否仍要添加？`,\n          success: (res) => {\n            if (res.confirm) {\n              this.addToPrescription();\n            }\n          }\n        });\n        return;\n      }\n      \n      // 直接调用添加到处方方法\n      this.addToPrescription();\n    },\n    \n    onFieldFocus(id) {\n      this.activeFieldId = id;\n    },\n    // 医生签名组件回调\n    onDoctorSignChange(value) {\n      // value 为签名图片的云文件ID或Base64，由 Signature 组件约定\n      this.form.doctorSign = value;\n      // 同时记录签名时间，便于在页面显示“签名时间”\n      const now = new Date();\n      const y = now.getFullYear();\n      const m = (now.getMonth() + 1).toString().padStart(2, '0');\n      const d = now.getDate().toString().padStart(2, '0');\n      const hh = now.getHours().toString().padStart(2, '0');\n      const mm = now.getMinutes().toString().padStart(2, '0');\n      const ss = now.getSeconds().toString().padStart(2, '0');\n      this.form.signTime = `${y}-${m}-${d} ${hh}:${mm}:${ss}`;\n    },\n\n    // 恢复用户自定义疾病模板（本地存储）\n    restoreUserDiseaseTemplates() {\n      try {\n        const stored = uni.getStorageSync('clinic_user_disease_templates');\n        if (stored && typeof stored === 'object') {\n          this.userDiseaseTemplates = stored;\n        }\n      } catch (e) {\n        console.error('恢复用户疾病模板失败:', e);\n        this.userDiseaseTemplates = {};\n      }\n    },\n\n    // 构建多框搜索统一索引：汇总系统模板、结构化模板、用户自定义模板\n    buildTemplateIndex() {\n      const index = [];\n      const maxIndexSize = 1000; // 限制索引最大数量，避免内存和性能问题\n\n      // 1) 结构化模板库 diseaseTemplateLib\n      const diseaseKeys = Object.keys(this.diseaseTemplateLib || {});\n      for (let i = 0; i < diseaseKeys.length && index.length < maxIndexSize; i++) {\n        const disease = diseaseKeys[i];\n        const list = this.diseaseTemplateLib[disease] || [];\n        const maxListSize = Math.min(list.length, 50); // 每个疾病最多50条模板\n        for (let j = 0; j < maxListSize && index.length < maxIndexSize; j++) {\n          const tpl = list[j];\n          if (tpl && tpl.complaint) {\n            index.push({\n              disease,\n              complaint: tpl.complaint,\n              symptoms: tpl.symptoms || [],\n              diagnoses: tpl.diagnoses || [],\n              treatments: tpl.treatments || [],\n              source: 'structured',\n              idx: j\n            });\n          }\n        }\n      }\n\n      // 2) 旧版模板：complaintTemplates + diseaseTemplates + treatmentTemplates\n      if (index.length < maxIndexSize) {\n        const complaintKeys = Object.keys(this.complaintTemplates || {});\n        for (let i = 0; i < complaintKeys.length && index.length < maxIndexSize; i++) {\n          const disease = complaintKeys[i];\n        const complaint = this.complaintTemplates[disease];\n        const diagnoses = this.diseaseTemplates?.[disease] || [];\n        const treatments = this.treatmentTemplates?.[disease] || [];\n        if (complaint) {\n          index.push({\n            disease,\n            complaint,\n            symptoms: [],\n            diagnoses,\n            treatments,\n            source: 'legacy'\n          });\n        }\n        }\n      }\n\n      // 3) 用户自定义模板 userDiseaseTemplates\n      if (index.length < maxIndexSize) {\n        const userKeys = Object.keys(this.userDiseaseTemplates || {});\n        for (let i = 0; i < userKeys.length && index.length < maxIndexSize; i++) {\n          const disease = userKeys[i];\n        const userTpl = this.userDiseaseTemplates[disease];\n          if (!userTpl) continue;\n          const complaints = userTpl.complaints || [];\n          const maxComplaints = Math.min(complaints.length, 20); // 每个疾病最多20条用户模板\n          for (let j = 0; j < maxComplaints && index.length < maxIndexSize; j++) {\n            const complaint = complaints[j];\n          if (complaint) {\n            index.push({\n              disease,\n              complaint,\n              symptoms: [],\n              diagnoses: userTpl.diagnosis || [],\n              treatments: userTpl.treatments || [],\n              source: 'user',\n                userIdx: j\n            });\n          }\n          }\n        }\n      }\n\n      this.templateIndex = index;\n      console.log(`构建模板索引完成，共 ${index.length} 条记录`);\n    },\n\n    // 全局搜索：多条件并列搜索(AND逻辑)，同时匹配疾病/主诉/诊断三个关键词\n    // 并结合 hvComplaintKeywordIndex 做主诉关键词→多主诉模板联想\n    performGlobalSearch(diseaseKw, complaintKw, diagnosisKw) {\n      const dKw = (diseaseKw || '').trim().toLowerCase();\n      const cKw = (complaintKw || '').trim().toLowerCase();\n      const dgKw = (diagnosisKw || '').trim().toLowerCase();\n\n      // 如果三个关键词都为空，返回所有疾病和空列表\n      if (!dKw && !cKw && !dgKw) {\n        return {\n          diseases: this.diseaseOptions,\n          complaints: [],\n          diagnoses: []\n        };\n      }\n\n      // 性能优化：限制搜索范围，避免遍历过多数据\n      const maxSearchCount = 500; // 最多搜索500条记录\n      const searchIndex = this.templateIndex.slice(0, maxSearchCount);\n\n      // 多条件并列过滤：同时满足所有非空关键词（基于结构化模板索引）\n      const matchedRecords = [];\n      for (let i = 0; i < searchIndex.length; i++) {\n        const rec = searchIndex[i];\n        let match = true;\n        // 疾病关键词匹配\n        if (dKw) {\n          match = match && rec.disease && rec.disease.toLowerCase().includes(dKw);\n        }\n        // 主诉关键词匹配\n        if (cKw) {\n          match = match && rec.complaint && rec.complaint.toLowerCase().includes(cKw);\n        }\n        // 诊断关键词匹配\n        if (dgKw) {\n          match = match && (rec.diagnoses || []).some(d => d && d.toLowerCase().includes(dgKw));\n        }\n        if (match) {\n          matchedRecords.push(rec);\n          // 限制结果数量，找到足够的结果就停止\n          if (matchedRecords.length >= 50) break;\n        }\n      }\n\n      // 提取匹配的疾病、主诉、诊断（去重）\n      const diseases = Array.from(new Set(matchedRecords.map(r => r.disease)));\n      const baseComplaints = matchedRecords.map((r, idx) => ({\n        key: `${r.disease}_${idx}`,\n        label: r.complaint,\n        disease: r.disease,\n        record: r\n      }));\n\n      const diagSet = new Set();\n      matchedRecords.forEach(r => {\n        (r.diagnoses || []).forEach(d => diagSet.add(d));\n      });\n      const diagnoses = Array.from(diagSet);\n\n      // 基于主诉关键词，追加 hvComplaintKeywordIndex 中的主诉模板（限制数量）\n      const extraComplaints = [];\n      if (cKw) {\n        const keywordKeys = Object.keys(hvComplaintKeywordIndex || {});\n        const maxKeywords = Math.min(keywordKeys.length, 20); // 最多检查20个关键词\n        for (let i = 0; i < maxKeywords && extraComplaints.length < 20; i++) {\n          const key = keywordKeys[i];\n          const k = (key || '').toLowerCase();\n          // 关键词双向包含：\"中暑\" / \"扭伤\" / \"晕动病\" 等\n          if (!k) continue;\n          if (k.includes(cKw) || cKw.includes(k)) {\n            const items = hvComplaintKeywordIndex[key] || [];\n            const maxItems = Math.min(items.length, 5); // 每个关键词最多5条\n            for (let j = 0; j < maxItems && extraComplaints.length < 20; j++) {\n              const item = items[j];\n              extraComplaints.push({\n                key: `hv_${key}_${j}`,\n                label: item.complaint,\n                disease: item.diseaseName,\n                record: {\n                  disease: item.diseaseName,\n                  complaint: item.complaint,\n                  symptoms: [],\n                  diagnoses: [item.diseaseName],\n                  treatments: [],\n                  source: 'hv_keyword'\n                }\n            });\n          }\n          }\n        }\n      }\n\n      // 合并去重（按 complaint 文本去重）\n      const mergedMap = new Map();\n      [...baseComplaints, ...extraComplaints].forEach(c => {\n        if (!mergedMap.has(c.label)) {\n          mergedMap.set(c.label, c);\n        }\n      });\n      const complaints = Array.from(mergedMap.values());\n\n      return { diseases, complaints, diagnoses };\n    },\n\n    // 查找最匹配的模板记录（基于多个字段同时匹配）\n    findBestMatchingRecord(diagnosis, complaint, diseaseName) {\n      let bestMatch = null;\n      let bestScore = 0;\n      \n      // 如果所有参数都为空，返回null\n      if (!diagnosis && !complaint && !diseaseName) {\n        return null;\n      }\n      \n      for (const record of this.templateIndex) {\n        let score = 0;\n        \n        // 诊断匹配度（权重最高）\n        if (diagnosis && record.diagnoses && record.diagnoses.length) {\n          const diagnosisMatch = record.diagnoses.some(d => {\n            if (!d) return false;\n            const dLower = d.toLowerCase();\n            const diagnosisLower = diagnosis.toLowerCase();\n            return d === diagnosis || \n                   dLower === diagnosisLower ||\n                   dLower.includes(diagnosisLower) || \n                   diagnosisLower.includes(dLower);\n          });\n          if (diagnosisMatch) score += 5; // 诊断匹配权重最高\n        }\n        \n        // 主诉匹配度\n        if (complaint && record.complaint) {\n          const complaintLower = (record.complaint || '').toLowerCase();\n          const inputComplaintLower = complaint.toLowerCase();\n          if (complaintLower === inputComplaintLower) {\n            score += 4; // 完全匹配\n          } else if (complaintLower.includes(inputComplaintLower) || \n                     inputComplaintLower.includes(complaintLower)) {\n            score += 2; // 部分匹配\n          }\n        }\n        \n        // 疾病名称匹配度\n        if (diseaseName && record.disease) {\n          const diseaseLower = (record.disease || '').toLowerCase();\n          const inputDiseaseLower = diseaseName.toLowerCase();\n          if (diseaseLower === inputDiseaseLower) {\n            score += 3; // 完全匹配\n          } else if (diseaseLower.includes(inputDiseaseLower) || \n                     inputDiseaseLower.includes(diseaseLower)) {\n            score += 1; // 部分匹配\n          }\n        }\n        \n        // 选择得分最高的记录\n        if (score > bestScore) {\n          bestScore = score;\n          bestMatch = record;\n        }\n      }\n      \n      // 只有得分大于0的记录才返回（至少有一个字段匹配）\n      return bestScore > 0 ? bestMatch : null;\n    },\n\n    // 智能填充字段：只填充空白字段，保留用户已输入的内容\n    smartFillFields(record, options = {}) {\n      if (!record) return;\n      \n      const {\n        preserveComplaint = false,  // 是否保留主诉\n        preserveSymptom = false,    // 是否保留症状\n        preserveDiagnosis = false,  // 是否保留诊断\n        preserveTreatment = false    // 是否保留处置\n      } = options;\n      \n      // 主诉：如果为空或允许覆盖，则填充\n      if (!preserveComplaint) {\n        const currentComplaint = (this.form.chiefComplaint || '').trim();\n        if (!currentComplaint && record.complaint) {\n          this.form.chiefComplaint = record.complaint;\n        }\n      }\n      \n      // 症状：如果为空或允许覆盖，则填充\n      if (!preserveSymptom) {\n        const currentSymptom = (this.form.symptom || '').trim();\n        if (!currentSymptom && record.symptoms && record.symptoms.length) {\n          this.form.symptom = record.symptoms.join('；');\n        }\n      }\n      \n      // 诊断：如果为空或允许覆盖，则填充\n      if (!preserveDiagnosis) {\n        const currentDiagnosis = (this.form.diagnosis || '').trim();\n        if (!currentDiagnosis && record.diagnoses && record.diagnoses.length) {\n          this.form.diagnosis = record.diagnoses.join('；');\n        }\n      }\n      \n      // 处置：如果为空或允许覆盖，则填充\n      if (!preserveTreatment) {\n        const currentTreatment = (this.form.treatment || '').trim();\n        if (!currentTreatment && record.treatments && record.treatments.length) {\n          this.form.treatment = record.treatments.join('；');\n        }\n      }\n      \n      // 疾病名称：始终更新（用于分类），但基于诊断分析\n      if (record.diagnoses && record.diagnoses.length) {\n        const mainDiagnosis = record.diagnoses[0];\n        const analyzedDisease = this.analyzeDiseaseFromDiagnosis(mainDiagnosis);\n        if (analyzedDisease) {\n          this.form.diseaseName = analyzedDisease;\n        } else if (record.disease) {\n          this.form.diseaseName = record.disease;\n        }\n      } else if (record.disease) {\n        this.form.diseaseName = record.disease;\n      }\n    },\n\n    setIdentity(val) {\n      if (!this.form) return\n      this.form.identity = val\n    },\n    setVisitType(val) {\n      if (!this.form) return\n      this.form.visitType = val\n    },\n    openLocationSelector() {\n      const itemList = this.locations.map(l => l.label)\n      uni.showActionSheet({\n        itemList,\n        success: (res) => {\n          const idx = res.tapIndex\n          const target = this.locations[idx]\n          if (target) {\n            this.selectLocation(target.value)\n          }\n        }\n      })\n    },\n    // 关闭园区提示弹框\n    closeLocationTip() {\n      this.showLocationTip = false\n      try {\n        if (this.noTipNextTime) {\n          uni.setStorageSync('clinic_location_tip_closed', true)\n        }\n      } catch (e) {}\n    },\n\n    // 从弹框中选择园区\n    handleLocationSelect(location) {\n      this.selectLocation(location)\n      try {\n        if (this.noTipNextTime) {\n          uni.setStorageSync('clinic_location_tip_closed', true)\n        }\n      } catch (e) {}\n      this.showLocationTip = false\n    },\n    updateDateTime() {\n      const now = new Date();\n      const year = now.getFullYear();\n      const month = String(now.getMonth() + 1).padStart(2, '0');\n      const day = String(now.getDate()).padStart(2, '0');\n      const hours = String(now.getHours()).padStart(2, '0');\n      const minutes = String(now.getMinutes()).padStart(2, '0');\n      \n      this.currentDateTime = `${year}-${month}-${day} ${hours}:${minutes}`;\n      this.form.visitDateTime = `${year}-${month}-${day} ${hours}:${minutes}`;\n    },\n\n    // 加载所有药材\n    async loadAllDrugs() {\n      try {\n        const res = await wx.cloud.callFunction({\n          name: 'drugManage',\n          data: {\n            action: 'getList',\n            data: { pageSize: 1000 }\n          }\n        });\n\n        if (res.result.success) {\n          this.allDrugs = res.result.data.list || [];\n        }\n      } catch (err) {\n        console.error('加载药材列表失败:', err);\n      }\n    },\n\n    // 药材输入框获得焦点\n    async onDrugInputFocus() {\n      this.showDrugList = true;\n      \n      // 如果没有输入内容，显示当前园区的所有药材\n      if (!this.drugSearchText || this.drugSearchText.trim() === '') {\n        // 没有输入内容，显示所有药材\n        this.filteredDrugs = this.allDrugs;\n      } else {\n        this.onDrugSearch();\n      }\n    },\n\n    // 加载当前园区的药材\n    async loadLocationDrugs() {\n      try {\n        uni.showLoading({ title: '加载药材...' });\n        \n        const res = await wx.cloud.callFunction({\n          name: 'stockManage',\n          data: {\n            action: 'getStockList',\n            data: {\n              location: this.form.location,\n              pageSize: 1000\n            }\n          }\n        });\n        \n        uni.hideLoading();\n\n        if (res.result.success) {\n          const stockList = res.result.data.list || [];\n          // 过滤出有库存的药材\n          this.filteredDrugs = stockList\n            .filter(item => item.quantity > 0)\n            .map(item => ({\n              _id: item.drugId,\n              name: item.drugName || item.name,\n              specification: item.specification || item.spec,\n              minUnit: item.minUnit || item.unit,\n              packUnit: item.packUnit || item.unit,\n              conversionRate: item.conversionRate || 1,\n              stock: item.quantity\n            }));\n          \n          console.log(`加载了${this.filteredDrugs.length}种药材`);\n        } else {\n          // 如果获取失败，显示所有药材\n          this.filteredDrugs = this.allDrugs.slice(0, 50);\n        }\n      } catch (err) {\n        console.error('加载园区药材失败:', err);\n        uni.hideLoading();\n        // 失败时显示所有药材\n        this.filteredDrugs = this.allDrugs.slice(0, 50);\n      }\n    },\n\n    // 药材搜索\n    onDrugSearch() {\n      if (!this.drugSearchText || this.drugSearchText.trim() === '') {\n        // 没有搜索内容时，加载当前园区药材\n        this.loadLocationDrugs();\n        return;\n      }\n\n      const keyword = this.drugSearchText.toLowerCase();\n      // 从当前园区的药材中搜索\n      if (this.filteredDrugs.length > 0 && !this.drugSearchText) {\n        // 已经加载了园区药材，在其中搜索\n        const currentList = [...this.filteredDrugs];\n        this.filteredDrugs = currentList.filter(drug => {\n          const name = (drug.name || '').toLowerCase();\n          const genericName = (drug.genericName || '').toLowerCase();\n          const spec = (drug.specification || '').toLowerCase();\n          const tradeNames = Array.isArray(drug.tradeNames) ? drug.tradeNames : [];\n          const hitTrade = tradeNames.some(t => (t || '').toLowerCase().includes(keyword));\n\n          return name.includes(keyword) ||\n                 genericName.includes(keyword) ||\n                 spec.includes(keyword) ||\n                 hitTrade;\n        });\n      } else {\n        // 从所有药材中搜索\n        this.filteredDrugs = this.allDrugs.filter(drug => {\n          const name = (drug.name || '').toLowerCase();\n          const genericName = (drug.genericName || '').toLowerCase();\n          const pinyin = (drug.pinyin || '').toLowerCase();\n          const spec = (drug.specification || drug.spec || '').toLowerCase();\n          const tradeNames = Array.isArray(drug.tradeNames) ? drug.tradeNames : [];\n          const hitTrade = tradeNames.some(t => (t || '').toLowerCase().includes(keyword));\n\n          return name.includes(keyword) ||\n                 genericName.includes(keyword) ||\n                 pinyin.includes(keyword) ||\n                 spec.includes(keyword) ||\n                 hitTrade;\n        }).slice(0, 30); // 最多显示30个结果\n      }\n    },\n\n    // 从列表选择药材\n    selectDrugFromList(drug) {\n      this.drugSearchText = drug.name;\n      this.onDrugSelect(drug);\n      this.showDrugList = false;\n    },\n\n    // 疾病名称获得焦点：显示下拉列表\n    onDiseaseFocus() {\n      // 清除失焦隐藏计时器\n      if (this.diseaseBlurTimer) {\n        clearTimeout(this.diseaseBlurTimer);\n        this.diseaseBlurTimer = null;\n      }\n      \n      // 触发全局搜索，基于所有三个框的关键词\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n      \n      // 显示下拉（即使为空也显示，会显示所有疾病）\n      this.showDiseaseList = this.filteredDiseases.length > 0;\n    },\n    \n    onDiseaseBlur() {\n      const text = (this.form.diseaseName || '').trim();\n      if (text) {\n        // 1）先按疾病大类精确匹配\n        const hasDisease = this.templateIndex.some(r => r.disease === text);\n        if (hasDisease) {\n          this.selectDisease(text);\n        } else {\n          // 2）再按标准诊断名匹配\n          const diagRecord = this.templateIndex.find(r =>\n            (r.diagnoses || []).some(d => d === text)\n          );\n          if (diagRecord) {\n            this.selectDiagnosis(text);\n          }\n        }\n      }\n\n      // 延迟隐藏下拉，给点击事件留时间\n      this.diseaseBlurTimer = setTimeout(() => {\n        this.showDiseaseList = false;\n      }, 200);\n    },\n    \n    // 疾病名称输入：触发全局搜索并联动主诉/诊断下拉（添加防抖）\n    onDiseaseInput() {\n      // 清除之前的计时器\n      if (this.diseaseInputTimer) {\n        clearTimeout(this.diseaseInputTimer);\n      }\n      \n      // 防抖处理，延迟200ms执行\n      this.diseaseInputTimer = setTimeout(() => {\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n\n      this.showDiseaseList = this.filteredDiseases.length > 0;\n      // 主诉和诊断下拉在用户聚焦时才显示，这里只更新数据\n      }, 200);\n      // 如果当前输入的疾病名称与某个疾病完全匹配，则自动按该疾病刷新联动字段\n      const kw = (this.form.diseaseName || '').trim();\n      if (kw && this.filteredDiseases.includes(kw)) {\n        this.selectDisease(kw);\n      }\n    },\n\n    // 选择疾病：自动填充主诉/诊断/处置（默认强制填充，保证反向联动）\n    // options.forceFill=true 时，无论当前字段是否已有内容，都用模板覆盖\n    selectDisease(disease, options = { forceFill: true }) {\n      // 清除失焦隐藏计时器\n      if (this.diseaseBlurTimer) {\n        clearTimeout(this.diseaseBlurTimer);\n        this.diseaseBlurTimer = null;\n      }\n      \n      // 选择后关闭下拉\n      this.showDiseaseList = false;\n\n      // 查找该疾病的第一条模板记录（使用最佳匹配）\n      const record = this.templateIndex.find(r => r.disease === disease);\n      if (record) {\n        const force = options?.forceFill === true;\n        // 智能填充：默认强制覆盖，满足“先选疾病反向自动填充”需求\n        this.smartFillFields(record, {\n          preserveComplaint: !force && !!(this.form.chiefComplaint && this.form.chiefComplaint.trim()),\n          preserveSymptom: !force && !!(this.form.symptom && this.form.symptom.trim()),\n          preserveDiagnosis: !force && !!(this.form.diagnosis && this.form.diagnosis.trim()),\n          preserveTreatment: !force && !!(this.form.treatment && this.form.treatment.trim())\n        });\n        \n        // 如果模板记录里缺少部分字段，兜底再用疾病模板填充缺失项\n        const needComplaint = !this.form.chiefComplaint;\n        const needDiagnosis = !this.form.diagnosis;\n        const needTreatment = !this.form.treatment;\n        if (needComplaint || needDiagnosis || needTreatment) {\n          this.autoFillByDisease(disease);\n        }\n        \n        // 确保疾病名称使用标准名称\n        if (this.diseaseOptions.includes(disease)) {\n          this.form.diseaseName = disease;\n        }\n        \n        // 自动选择推荐用药\n        if (Array.isArray(record.suggestDrugs) && record.suggestDrugs.length) {\n          this.applySuggestDrugs(record.suggestDrugs);\n        }\n      } else {\n        // 回退到旧逻辑（如果找不到结构化模板）\n        this.loadTemplatesForDisease(disease);\n        this.autoFillByDisease(disease);\n        // 确保疾病名称使用标准名称\n        if (!this.diseaseOptions.includes(this.form.diseaseName)) {\n          const analyzedDisease = this.analyzeDiseaseFromDiagnosis(this.form.diagnosis || this.form.diseaseName);\n          if (analyzedDisease) {\n            this.form.diseaseName = analyzedDisease;\n          } else {\n            this.form.diseaseName = '其他';\n          }\n        }\n      }\n    },\n    // 依据疾病载入诊断与处置模板\n    loadTemplatesForDisease(disease) {\n      const baseDiag = this.diseaseTemplates?.[disease] || [];\n      // 合并结构化模板中的诊断\n      const structDiag = (this.diseaseTemplateLib?.[disease] || [])\n        .flatMap(t => t.diagnoses || []);\n      const diag = Array.from(new Set([...(baseDiag || []), ...structDiag]));\n      const treat = this.treatmentTemplates?.[disease] || [];\n      this.filteredDiagnosis = diag;\n      this.filteredTreatments = treat;\n    },\n    // 自动按疾病填入主诉/诊断/处置（可编辑）\n    autoFillByDisease(disease) {\n      const complaint = this.complaintTemplates?.[disease];\n      const diagList = this.diseaseTemplates?.[disease] || [];\n      const diag = diagList[0];\n      const treats = (this.treatmentTemplates?.[disease] || []).slice(0, 2);\n      // 附加注意事项/复诊提示\n      const cautions = this.treatmentCautions?.[disease] || [];\n      const merged = [];\n      const pushUnique = (arr) => {\n        arr.forEach(t => {\n          if (t && !merged.includes(t)) merged.push(t);\n        });\n      };\n      pushUnique(treats);\n      pushUnique(cautions);\n      // 每次选择疾病时，都用模板覆盖联动字段，保证重新选择疾病也会刷新\n      if (complaint) this.form.chiefComplaint = complaint;\n      if (diag) {\n        // 初步诊断使用模板中的完整诊断组合\n        this.form.diagnosis = diagList.length ? diagList.join('；') : diag;\n        // 从诊断中分析提取标准疾病名称（确保使用标准名称归类）\n        const analyzedDisease = this.analyzeDiseaseFromDiagnosis(this.form.diagnosis);\n        if (analyzedDisease) {\n          this.form.diseaseName = analyzedDisease;\n        } else if (this.diseaseOptions.includes(disease)) {\n          // 如果疾病名称本身是标准名称，直接使用\n          this.form.diseaseName = disease;\n        } else {\n          this.form.diseaseName = '其他';\n        }\n      }\n      if (merged.length) this.form.treatment = merged.join('；');\n    },\n    // 诊断输入与选择\n    // 诊断获得焦点：显示下拉列表\n    onDiagnosisFocus() {\n      // 触发全局搜索，基于所有三个框的关键词\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n      \n      // 显示下拉（即使为空也显示，基于其他框的关键词）\n      this.showDiagnosisList = this.filteredDiagnosis.length > 0;\n    },\n    // 诊断输入（添加防抖）\n    onDiagnosisInput() {\n      // 清除之前的计时器\n      if (this.diagnosisInputTimer) {\n        clearTimeout(this.diagnosisInputTimer);\n      }\n      \n      // 防抖处理，延迟200ms执行\n      this.diagnosisInputTimer = setTimeout(() => {\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n\n      this.showDiagnosisList = this.filteredDiagnosis.length > 0;\n      }, 200);\n    },\n    selectDiagnosis(text) {\n      // 查找最匹配的模板记录（考虑当前已输入的字段）\n      const bestRecord = this.findBestMatchingRecord(\n        text,  // 选择的诊断\n        this.form.chiefComplaint,  // 当前主诉\n        this.form.diseaseName      // 当前疾病名称\n      );\n\n      if (bestRecord) {\n        // 智能填充：只填充空白字段，保留用户已输入的内容\n        this.smartFillFields(bestRecord, {\n          preserveComplaint: !!(this.form.chiefComplaint && this.form.chiefComplaint.trim()),  // 如果主诉已输入，保留\n          preserveSymptom: !!(this.form.symptom && this.form.symptom.trim()),           // 如果症状已输入，保留\n          preserveDiagnosis: false,  // 诊断字段用新选择的替换\n          preserveTreatment: !!(this.form.treatment && this.form.treatment.trim())        // 如果处置已输入，保留\n        });\n        \n        // 确保诊断字段使用选择的诊断（如果模板中有完整诊断组合，使用组合；否则使用选择的诊断）\n        if (bestRecord.diagnoses && bestRecord.diagnoses.length) {\n          // 检查选择的诊断是否在模板的诊断列表中\n          const hasExactMatch = bestRecord.diagnoses.some(d => d === text);\n          if (hasExactMatch) {\n            // 如果完全匹配，使用模板的完整诊断组合\n            this.form.diagnosis = bestRecord.diagnoses.join('；');\n          } else {\n            // 否则使用选择的诊断\n            this.form.diagnosis = text;\n          }\n        } else {\n          this.form.diagnosis = text;\n        }\n        \n        // 自动选择推荐用药\n        if (Array.isArray(bestRecord.suggestDrugs) && bestRecord.suggestDrugs.length) {\n          bestRecord.suggestDrugs.forEach(name => {\n            if (name) {\n              this.onDrugChip(name);\n            }\n          });\n        }\n      } else {\n        // 如果没有找到匹配记录，只更新诊断和疾病名称\n        this.form.diagnosis = text;\n        const analyzedDisease = this.analyzeDiseaseFromDiagnosis(text);\n        this.form.diseaseName = analyzedDisease || '其他';\n      }\n\n      this.showDiagnosisList = false;\n    },\n    // 主诉获得焦点：根据编辑模式决定是否触发搜索\n    onComplaintFocus() {\n      // 清除失焦隐藏计时器\n      if (this.complaintBlurTimer) {\n        clearTimeout(this.complaintBlurTimer);\n        this.complaintBlurTimer = null;\n      }\n      \n      const currentComplaint = (this.form.chiefComplaint || '').trim();\n      \n      // 情况1：自由编辑模式（已选择过） → 不触发搜索，不显示下拉\n      if (this.complaintSelectedMode && currentComplaint) {\n        this.showComplaintList = false;\n        return;\n      }\n      \n      // 情况2：输入框为空 → 重置为搜索模式，基于其他框的关键词显示联动结果\n      if (!currentComplaint) {\n        this.complaintSelectedMode = false;\n      }\n      \n      // 情况3：搜索模式 → 触发全局搜索（基于AND逻辑）并显示下拉\n      // 使用防抖避免频繁调用\n      if (this.complaintFocusTimer) {\n        clearTimeout(this.complaintFocusTimer);\n      }\n      this.complaintFocusTimer = setTimeout(() => {\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n      \n      // 即使主诉框为空，只要有其他框的关键词，也显示联动结果\n      this.showComplaintList = this.filteredComplaints.length > 0;\n      }, 150);\n    },\n    onComplaintInput() {\n      const currentComplaint = (this.form.chiefComplaint || '').trim();\n      \n      // 如果内容被清空，重置为搜索模式\n      if (!currentComplaint) {\n        this.complaintSelectedMode = false;\n      }\n      \n      // 如果已选择主诉（自由编辑模式），不显示下拉\n      if (this.complaintSelectedMode && currentComplaint) {\n        this.showComplaintList = false;\n        return;\n      }\n      \n      // 搜索模式：执行全局搜索并显示下拉（添加防抖）\n      if (this.complaintInputTimer) {\n        clearTimeout(this.complaintInputTimer);\n      }\n      this.complaintInputTimer = setTimeout(() => {\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      this.filteredDiseases = result.diseases;\n      this.filteredComplaints = result.complaints;\n      this.filteredDiagnosis = result.diagnoses;\n\n      this.showComplaintList = this.filteredComplaints.length > 0;\n      }, 200);\n    },\n    \n    onComplaintBlur() {\n      // 失焦时重置聚焦状态\n      this.complaintFocus = false;\n      // 延迟隐藏下拉，给点击事件留时间\n      this.complaintBlurTimer = setTimeout(() => {\n        this.showComplaintList = false;\n      }, 200);\n      // 主诉编辑完成后，根据最新主诉获取系统诊断建议（防抖处理）\n      if (this.fetchHvSuggestionTimer) {\n        clearTimeout(this.fetchHvSuggestionTimer);\n      }\n      this.fetchHvSuggestionTimer = setTimeout(() => {\n      this.fetchHvSuggestion();\n      }, 300);\n    },\n    async fetchHvSuggestion() {\n      const text = (this.form.chiefComplaint || '').trim();\n      if (!text) {\n        this.hvTriage = null;\n        this.standardizedSymptoms = [];\n        // 主诉为空时，清空症状以保持一致\n        this.form.symptom = '';\n        return;\n      }\n      try {\n        const res = await wx.cloud.callFunction({\n          name: 'clinicRecords',\n          data: {\n            action: 'suggestHvDiagnosis',\n            data: { chiefComplaint: text }\n          }\n        });\n\n        console.log('[clinic/add] fetchHvSuggestion result:', res);\n\n        const payload = res.result && res.result.success ? res.result.data : null;\n\n        // 提取标准化症状\n        if (payload && payload.standardized && payload.standardized.details) {\n          this.standardizedSymptoms = payload.standardized.details.map(detail => ({\n            code: detail.code,\n            name: detail.standardName || detail.name,\n            category: detail.category,\n            severity: detail.severity || 1,\n            selected: false\n          }));\n          \n          // 根据主诉自动更新症状，保持与主诉一致（用分号连接标准化症状）\n          const symptomText = this.standardizedSymptoms.map(s => s.name).join('；');\n          if (symptomText) {\n            this.form.symptom = symptomText;\n          }\n        } else {\n          this.standardizedSymptoms = [];\n          // 如果没有标准化症状，使用主诉内容作为症状\n          if (text) {\n            this.form.symptom = text;\n          }\n        }\n\n        this.hvTriage = payload.triage || null;\n      } catch (e) {\n        console.error('获取标准化症状失败:', e);\n        this.hvTriage = null;\n        this.standardizedSymptoms = [];\n      }\n    },\n    // 症状输入框获得焦点\n    onSymptomFocus() {\n      // 清除失焦隐藏计时器\n      if (this.symptomBlurTimer) {\n        clearTimeout(this.symptomBlurTimer);\n        this.symptomBlurTimer = null;\n      }\n      \n      // 如果症状框为空，显示标准化症状建议\n      const currentSymptom = (this.form.symptom || '').trim();\n      if (!currentSymptom && this.standardizedSymptoms.length > 0) {\n        this.filteredSymptoms = this.standardizedSymptoms.map(s => ({\n          name: s.name,\n          category: s.category,\n          code: s.code\n        }));\n        this.showSymptomList = true;\n      } else if (currentSymptom) {\n        // 基于输入内容过滤症状建议\n        this.filterSymptomsByInput(currentSymptom);\n      }\n    },\n    // 症状输入（添加防抖）\n    onSymptomInput() {\n      // 清除之前的计时器\n      if (this.symptomInputTimer) {\n        clearTimeout(this.symptomInputTimer);\n      }\n      \n      // 防抖处理，延迟300ms执行\n      this.symptomInputTimer = setTimeout(() => {\n        const text = (this.form.symptom || '').trim();\n        if (!text) {\n          // 如果清空，显示标准化症状\n          if (this.standardizedSymptoms.length > 0) {\n            this.filteredSymptoms = this.standardizedSymptoms.map(s => ({\n              name: s.name,\n              category: s.category,\n              code: s.code\n            }));\n            this.showSymptomList = true;\n          } else {\n            this.showSymptomList = false;\n          }\n          return;\n        }\n        \n        // 基于输入内容过滤\n        this.filterSymptomsByInput(text);\n      }, 300);\n    },\n    // 根据输入内容过滤症状（优化性能）\n    filterSymptomsByInput(text) {\n      const lowerText = text.toLowerCase();\n      const matched = [];\n      const matchedNames = new Set(); // 用于去重\n      \n      // 1. 从标准化症状中匹配（限制数量）\n      if (this.standardizedSymptoms && this.standardizedSymptoms.length > 0) {\n        for (let i = 0; i < Math.min(this.standardizedSymptoms.length, 50); i++) {\n          const s = this.standardizedSymptoms[i];\n          if (s.name && s.name.toLowerCase().includes(lowerText)) {\n            if (!matchedNames.has(s.name)) {\n              matched.push({\n                name: s.name,\n                category: s.category,\n                code: s.code\n              });\n              matchedNames.add(s.name);\n            }\n          }\n          // 如果已经找到足够的匹配项，提前退出\n          if (matched.length >= 20) break;\n        }\n      }\n      \n      // 2. 从模板索引中提取症状建议（限制遍历数量）\n      if (this.templateIndex && this.templateIndex.length > 0 && matched.length < 20) {\n        const maxIndex = Math.min(this.templateIndex.length, 100); // 最多遍历100条模板\n        for (let i = 0; i < maxIndex; i++) {\n          const rec = this.templateIndex[i];\n          if (rec.symptoms && Array.isArray(rec.symptoms)) {\n            for (let j = 0; j < rec.symptoms.length && matched.length < 20; j++) {\n              const symptom = rec.symptoms[j];\n              if (symptom && typeof symptom === 'string' && symptom.toLowerCase().includes(lowerText)) {\n                if (!matchedNames.has(symptom)) {\n                  matched.push({\n                    name: symptom,\n                    category: '',\n                    code: ''\n                  });\n                  matchedNames.add(symptom);\n                }\n              }\n            }\n          }\n          // 如果已经找到足够的匹配项，提前退出\n          if (matched.length >= 20) break;\n        }\n      }\n      \n      this.filteredSymptoms = matched.slice(0, 20); // 限制最多20条\n      this.showSymptomList = matched.length > 0;\n    },\n    // 症状失焦\n    onSymptomBlur() {\n      // 延迟隐藏下拉，给点击事件留时间\n      this.symptomBlurTimer = setTimeout(() => {\n        this.showSymptomList = false;\n      }, 200);\n    },\n    // 选择症状\n    selectSymptom(symptom) {\n      // 清除失焦隐藏计时器\n      if (this.symptomBlurTimer) {\n        clearTimeout(this.symptomBlurTimer);\n        this.symptomBlurTimer = null;\n      }\n      \n      const currentSymptom = (this.form.symptom || '').trim();\n      const symptomName = typeof symptom === 'string' ? symptom : (symptom.name || '');\n      \n      if (currentSymptom) {\n        // 如果已有内容，追加（用分号分隔）\n        if (!currentSymptom.includes(symptomName)) {\n          this.form.symptom = `${currentSymptom}；${symptomName}`;\n        }\n      } else {\n        // 如果为空，直接填入\n        this.form.symptom = symptomName;\n      }\n      \n      this.showSymptomList = false;\n    },\n    // 切换症状标签（添加到/从症状框移除）\n    toggleSymptomTag(symptom) {\n      symptom.selected = !symptom.selected;\n      \n      const currentSymptom = (this.form.symptom || '').trim();\n      const symptomName = symptom.name;\n      \n      if (symptom.selected) {\n        // 添加到症状框\n        if (currentSymptom) {\n          if (!currentSymptom.includes(symptomName)) {\n            this.form.symptom = `${currentSymptom}；${symptomName}`;\n          }\n        } else {\n          this.form.symptom = symptomName;\n        }\n      } else {\n        // 从症状框移除\n        if (currentSymptom.includes(symptomName)) {\n          const parts = currentSymptom.split('；').filter(s => s.trim() !== symptomName);\n          this.form.symptom = parts.join('；');\n        }\n      }\n    },\n    // 从诊断文本中分析提取标准疾病名称\n    analyzeDiseaseFromDiagnosis(diagnosisText) {\n      if (!diagnosisText) return null;\n      \n      const text = diagnosisText.toLowerCase();\n      \n      // 疾病名称匹配规则（按优先级排序，包含常见医学诊断术语）\n      const diseaseRules = [\n        // 扭伤类\n        { keywords: ['扭伤', '崴', '扭到', '关节扭伤', '脚踝扭伤', '手腕扭伤', '踝关节扭伤', '腕关节扭伤', '软组织扭伤'], disease: '扭伤' },\n        // 擦伤类\n        { keywords: ['擦伤', '蹭破', '擦破', '皮肤擦伤', '挫伤', '表皮擦伤', '浅表擦伤'], disease: '擦伤' },\n        // 烫伤类\n        { keywords: ['烫伤', '烧伤', '灼伤', '烫到', '热烧伤', '化学烧伤'], disease: '烫伤' },\n        // 磕伤类\n        { keywords: ['磕伤', '磕到', '撞伤', '碰伤', '磕碰', '撞击伤', '碰撞伤'], disease: '磕伤' },\n        // 冻伤类\n        { keywords: ['冻伤', '冻到', '冻疮', '冻僵'], disease: '冻伤' },\n        // 腹泻类（包含胃肠炎等）\n        { keywords: ['腹泻', '拉肚子', '拉稀', '泻', '急性胃肠炎', '胃肠炎', '肠胃炎', '肠炎', '急性肠炎', '细菌性肠炎', '病毒性肠炎', '消化不良', '胃肠功能紊乱'], disease: '腹泻' },\n        // 头晕类\n        { keywords: ['头晕', '头昏', '眩晕', '晕', '眼前发黑', '体位性低血压', '低血糖', '贫血性头晕'], disease: '头晕' },\n        // 头痛类\n        { keywords: ['头痛', '头疼', '头部不适', '头胀', '偏头痛', '紧张性头痛', '血管性头痛'], disease: '头痛' },\n        // 感冒类\n        { keywords: ['感冒', '着凉', '受凉', '风寒', '上呼吸道感染', '上感', '普通感冒', '病毒性感冒'], disease: '感冒' },\n        // 脱臼类\n        { keywords: ['脱臼', '脱位', '关节脱位', '肩关节脱位', '肘关节脱位'], disease: '脱臼' },\n        // 骨折类\n        { keywords: ['骨折', '骨裂', '断骨', '闭合性骨折', '开放性骨折', '不完全骨折'], disease: '骨折' },\n        // 过敏类\n        { keywords: ['过敏', '过敏性', '过敏反应', '过敏性皮炎', '过敏性鼻炎', '荨麻疹', '湿疹'], disease: '过敏' },\n        // 痛经类\n        { keywords: ['痛经', '经期疼痛', '月经痛', '原发性痛经', '继发性痛经'], disease: '痛经' },\n        // 测血压类\n        { keywords: ['测血压', '血压', '量血压', '血压监测', '血压检查', '血压测量'], disease: '测血压' }\n      ];\n      \n      // 按优先级匹配\n      for (const rule of diseaseRules) {\n        for (const keyword of rule.keywords) {\n          if (text.includes(keyword.toLowerCase())) {\n            return rule.disease;\n          }\n        }\n      }\n      \n      // 如果没有匹配到，返回 null，保持原值或使用\"其他\"\n      return null;\n    },\n    onDiagnosisBlur() {\n      // 诊断输入框失焦时，关闭下拉列表\n      this.showDiagnosisList = false;\n      \n      // 根据诊断自动更新处置，保持与诊断一致\n      const diagnosisText = (this.form.diagnosis || '').trim();\n      if (!diagnosisText) {\n        // 诊断为空时，清空处置以保持一致\n        this.form.treatment = '';\n        return;\n      }\n      \n      // 从诊断中分析提取标准疾病名称（强制更新，确保使用标准名称）\n      const analyzedDisease = this.analyzeDiseaseFromDiagnosis(diagnosisText);\n      if (analyzedDisease) {\n        // 如果分析出标准疾病名称，直接更新（确保使用标准名称归类）\n        this.form.diseaseName = analyzedDisease;\n      } else {\n        // 如果无法分析出标准疾病名称，设置为\"其他\"\n        this.form.diseaseName = '其他';\n      }\n      \n      // 使用最佳匹配逻辑查找最准确的模板记录\n      const bestRecord = this.findBestMatchingRecord(\n        diagnosisText,  // 当前诊断\n        this.form.chiefComplaint,  // 当前主诉\n        this.form.diseaseName      // 当前疾病名称\n      );\n      \n      if (bestRecord && bestRecord.treatments && bestRecord.treatments.length) {\n        // 找到匹配的模板记录，智能填充处置（如果处置为空）\n        if (!this.form.treatment || !this.form.treatment.trim()) {\n          this.form.treatment = bestRecord.treatments.join('；');\n        }\n        // 如果主诉为空，也可以填充主诉（确保字段关联）\n        if (!this.form.chiefComplaint || !this.form.chiefComplaint.trim()) {\n          if (bestRecord.complaint) {\n            this.form.chiefComplaint = bestRecord.complaint;\n          }\n        }\n        // 如果症状为空，也可以填充症状\n        if (!this.form.symptom || !this.form.symptom.trim()) {\n          if (bestRecord.symptoms && bestRecord.symptoms.length) {\n            this.form.symptom = bestRecord.symptoms.join('；');\n          }\n        }\n      } else {\n        // 如果没有找到完整匹配，尝试根据疾病名称查找处置模板\n        const diseaseName = (this.form.diseaseName || '').trim();\n        if (diseaseName && (!this.form.treatment || !this.form.treatment.trim())) {\n          const treatments = this.treatmentTemplates?.[diseaseName] || [];\n          if (treatments.length > 0) {\n            // 使用前两个处置模板\n            this.form.treatment = treatments.slice(0, 2).join('；');\n          }\n        }\n      }\n    },\n    // 打开诊断参考指南\n    openDiagnosisGuide() {\n      // 添加模板库匹配的诊断\n      const result = this.performGlobalSearch(\n        this.form.diseaseName,\n        this.form.chiefComplaint,\n        this.form.diagnosis\n      );\n      \n      // 更新过滤列表\n      this.filteredDiagnosis = result.diagnoses;\n      \n      // 4. 显示诊断下拉列表\n      if (this.filteredDiagnosis.length > 0) {\n        this.showDiagnosisList = true;\n        // 聚焦到诊断输入框，触发下拉显示\n        this.$nextTick(() => {\n          // 触发诊断输入框的焦点事件，显示下拉列表\n          this.onDiagnosisFocus();\n        });\n      } else {\n        // 如果没有可用的诊断选项，提示用户\n        uni.showToast({\n          title: '请输入疾病名称或主诉以查看诊断参考',\n          icon: 'none',\n          duration: 2000\n        });\n      }\n    },\n    selectComplaint(opt) {\n      // 清除失焦隐藏计时器\n      if (this.complaintBlurTimer) {\n        clearTimeout(this.complaintBlurTimer);\n        this.complaintBlurTimer = null;\n      }\n      \n      if (!opt || !opt.record) return;\n      const rec = opt.record;\n\n      // 智能填充：只填充空白字段，保留用户已输入的内容\n      this.smartFillFields(rec, {\n        preserveComplaint: false,  // 主诉用新选择的替换\n        preserveSymptom: !!(this.form.symptom && this.form.symptom.trim()),\n        preserveDiagnosis: !!(this.form.diagnosis && this.form.diagnosis.trim()),\n        preserveTreatment: !!(this.form.treatment && this.form.treatment.trim())\n      });\n      \n      // 确保主诉字段使用选择的主诉\n      this.form.chiefComplaint = rec.complaint;\n      \n      // 自动选择推荐用药\n      if (Array.isArray(rec.suggestDrugs) && rec.suggestDrugs.length) {\n        this.applySuggestDrugs(rec.suggestDrugs);\n      }\n\n      // 进入自由编辑模式\n      this.complaintSelectedMode = true;\n      this.showComplaintList = false;\n      \n      // 自动聚焦到主诉输入框，方便立即编辑\n      this.$nextTick(() => {\n        this.complaintFocus = false;\n        this.$nextTick(() => {\n          this.complaintFocus = true;\n        });\n      });\n    },\n    // 处置输入与选择\n    onTreatmentFocus() {\n      if (!this.form.treatment || this.form.treatment.trim() === '') {\n        const src = this.treatmentTemplates?.[this.form.diseaseName] || [];\n        this.filteredTreatments = src;\n        this.showTreatmentList = src.length > 0;\n      }\n    },\n    onTreatmentInput() {\n      const src = this.treatmentTemplates?.[this.form.diseaseName] || [];\n      const text = (this.form.treatment || '').trim().toLowerCase();\n      if (!text) {\n        this.filteredTreatments = src;\n        this.showTreatmentList = src.length > 0;\n        return;\n      }\n      this.filteredTreatments = src.filter(s => s.toLowerCase().includes(text));\n      this.showTreatmentList = this.filteredTreatments.length > 0;\n    },\n    selectTreatment(text) {\n      this.form.treatment = text;\n      this.showTreatmentList = false;\n    },\n    appendTreatment(token) {\n      const base = (this.form.treatment || '').trim();\n      this.form.treatment = base ? `${base}；${token}` : token;\n    },\n    // 将当前输入内容保存为自定义模板（全局搜索使用）\n    saveCurrentAsTemplate() {\n      const disease = (this.form.diseaseName || '').trim();\n      if (!disease) {\n        uni.showToast({ title: '请先选择疾病名称', icon: 'none' });\n        return;\n      }\n\n      const complaint = (this.form.chiefComplaint || '').trim();\n      const diagnosis = (this.form.diagnosis || '').trim();\n      const treatment = (this.form.treatment || '').trim();\n\n      if (!complaint && !diagnosis && !treatment) {\n        uni.showToast({ title: '请输入主诉/诊断/处置后再保存', icon: 'none' });\n        return;\n      }\n\n      // 直接更新 userDiseaseTemplates\n      if (!this.userDiseaseTemplates[disease]) {\n        this.userDiseaseTemplates[disease] = {\n          complaints: [],\n          diagnosis: [],\n          treatments: []\n        };\n      }\n\n      const target = this.userDiseaseTemplates[disease];\n\n      if (complaint && !target.complaints.includes(complaint)) {\n        target.complaints.unshift(complaint);\n        target.complaints = target.complaints.slice(0, 20);\n      }\n\n      if (diagnosis && !target.diagnosis.includes(diagnosis)) {\n        target.diagnosis.unshift(diagnosis);\n        target.diagnosis = target.diagnosis.slice(0, 20);\n      }\n\n      if (treatment && !target.treatments.includes(treatment)) {\n        target.treatments.unshift(treatment);\n        target.treatments = target.treatments.slice(0, 20);\n      }\n\n      // 持久化到本地\n      try {\n        uni.setStorageSync('userDiseaseTemplates', this.userDiseaseTemplates);\n        // 重新构建模板索引，包含新保存的模板\n        this.buildTemplateIndex();\n        uni.showToast({ title: '模板已保存', icon: 'success' });\n      } catch (e) {\n        console.error('保存模板失败:', e);\n        uni.showToast({ title: '保存失败', icon: 'none' });\n      }\n    },\n    // 提交后提示保存模板\n    promptSaveTemplate() {\n      const disease = (this.form.diseaseName || '').trim();\n      const complaint = (this.form.chiefComplaint || '').trim();\n      const diagnosis = (this.form.diagnosis || '').trim();\n      const treatment = (this.form.treatment || '').trim();\n\n      // 必须有疾病名和至少一项内容\n      if (!disease || (!complaint && !diagnosis && !treatment)) {\n        return;\n      }\n\n      uni.showModal({\n        title: '保存为模板',\n        content: '是否将当前主诉、诊断、处置保存为自定义模板？下次可快速调用',\n        confirmText: '保存',\n        cancelText: '跳过',\n        success: (res) => {\n          if (res.confirm) {\n            this.saveCurrentAsTemplate();\n          }\n        }\n      });\n    },\n    // —— 药材标签：与园区库存联动 —— //\n    normalizeText(text) {\n      try {\n        return String(text || '').toLowerCase().replace(/\\\\s+/g, '');\n      } catch (e) {\n        return '';\n      }\n    },\n    async ensureStockLoaded() {\n      if (!this.filteredDrugs || this.filteredDrugs.length === 0) {\n        try {\n          await this.loadLocationDrugs();\n        } catch (e) {}\n      }\n    },\n    isPrescriptionDrug(name) {\n      const n = (name || '').trim();\n      if (!n) return false;\n      return (this.rxDrugNames || []).includes(n);\n    },\n    applySuggestDrugs(list) {\n      if (!Array.isArray(list) || !list.length) return;\n      list.forEach(name => {\n        const n = (name || '').trim();\n        if (!n) return;\n        if (this.isPrescriptionDrug(n)) {\n          this.appendTreatment(`${n}（处方药，需开具处方单，在陆园/水园药房发药）`);\n        } else {\n          this.onDrugChip(n);\n        }\n      });\n    },\n    findDrugByName(name) {\n      const target = this.normalizeText(name);\n      const inList = (list) => {\n        return (list || []).find(d => {\n          const n1 = this.normalizeText(d.name || d.drugName);\n          const n2 = this.normalizeText(d.specification || d.spec);\n          return n1.includes(target) || target.includes(n1) || n2.includes(target);\n        });\n      };\n      let found = inList(this.filteredDrugs);\n      if (!found) found = inList(this.allDrugs);\n      return found;\n    },\n    async onDrugChip(name) {\n      // 1) 先附加“（一次）”到处置文本\n      this.appendTreatment(`${name}（一次）`);\n      // 2) 加载当前园区库存，并尝试选中对应药材\n      await this.ensureStockLoaded();\n      const drug = this.findDrugByName(name);\n      if (drug && drug._id) {\n        try {\n          await this.onDrugSelect(drug);\n          uni.showToast({ title: `已选中药材：${drug.name}`, icon: 'none' });\n        } catch (e) {\n          // 选中失败不影响处置文本\n        }\n      } else {\n        uni.showToast({ title: '当前园区暂无该药库存', icon: 'none' });\n      }\n    },\n\n    // 恢复上次选择的园区\n    restoreLastLocation() {\n      try {\n        const lastLocation = uni.getStorageSync('clinic_last_location');\n        const tipClosed = uni.getStorageSync('clinic_location_tip_closed');\n        const isValidLocation = lastLocation === 'land_park' || lastLocation === 'water_park';\n\n        // 规则：\n        // 1）默认不选园区，每次进入都弹窗；\n        // 2）只有当用户勾选了“下次不再提醒”并关闭弹窗时，才记住园区且下次不再弹窗；\n        // 3）此时才在进入页面时自动带出上次园区。\n        if (tipClosed && isValidLocation) {\n          // 用户明确选择了不再提醒，并有合法园区记录\n          this.form.location = lastLocation;\n          this.showLocationTip = false;\n          const locationName = lastLocation === 'land_park' ? '陆园' : '水园';\n          console.log(`已按上次记录自动选择园区: ${locationName}`);\n        } else {\n          // 其余情况：不自动选园区，始终弹出提示\n          this.form.location = '';\n          this.showLocationTip = true;\n        }\n        \n        // 恢复连续登记模式设置\n        const continueMode = uni.getStorageSync('clinic_continue_mode');\n        if (continueMode !== undefined && continueMode !== null) {\n          this.continueAfterSubmit = continueMode;\n        }\n      } catch (err) {\n        console.error('恢复园区选择失败:', err);\n        this.form.location = '';\n      }\n    },\n\n    selectLocation(location) {\n      this.form.location = location;\n      \n      // 保存到本地存储，记忆用户选择\n      try {\n        uni.setStorageSync('clinic_last_location', location);\n      } catch (err) {\n        console.error('保存园区选择失败:', err);\n      }\n      \n      // 切换园区后重新加载批次\n      if (this.selectedDrug) {\n        uni.showToast({\n          title: `已切换到${location === 'land_park' ? '陆园' : '水园'}`,\n          icon: 'none',\n          duration: 1500\n        });\n        this.loadBatches();\n      }\n    },\n    // 地点输入框：获得焦点\n    onLocationFocus() {\n      const text = (this.form.injuryLocation || '').trim().toLowerCase();\n      if (!text) {\n        // 展示全部常用地点\n        this.filteredLocations = Array.from(new Set(this.allLocations));\n      } else {\n        this.onLocationInput();\n      }\n      this.showLocationList = true;\n    },\n    // 地点输入：过滤\n    onLocationInput() {\n      const text = (this.form.injuryLocation || '').trim().toLowerCase();\n      const src = Array.from(new Set(this.allLocations));\n      if (!text) {\n        this.filteredLocations = src;\n      } else {\n        this.filteredLocations = src.filter(name => name.toLowerCase().includes(text));\n      }\n      this.showLocationList = true;\n    },\n    // 选择地点\n    selectLocationFromList(name) {\n      this.form.injuryLocation = name;\n      this.showLocationList = false;\n    },\n\n\n    async onDrugSelect(drug) {\n      // 先设置基本信息\n      this.form.drugId = drug._id;\n      this.showDrugSelector = false;\n      \n      // 从药材档案获取完整信息\n      try {\n        uni.showLoading({ title: '加载药材信息...' });\n        const res = await wx.cloud.callFunction({\n          name: 'drugManage',\n          data: {\n            action: 'getDetail',\n            data: { id: drug._id }\n          }\n        });\n        \n        if (res.result.success && res.result.data) {\n          // 使用完整的药材信息\n          this.selectedDrug = {\n            ...res.result.data,\n            _id: res.result.data._id,\n            drugCode: res.result.data.drugCode || res.result.data.code || '',\n            name: res.result.data.name,\n            specification: res.result.data.specification || res.result.data.spec || '',\n            minUnit: res.result.data.minUnit || res.result.data.unit || '个',\n            packUnit: res.result.data.packUnit || res.result.data.unit || '盒',\n            conversionRate: res.result.data.conversionRate || 1,\n            manufacturer: res.result.data.manufacturer || ''\n          };\n        } else {\n          // 如果获取失败，使用传入的drug数据\n          this.selectedDrug = {\n            ...drug,\n            minUnit: drug.minUnit || drug.unit || '个',\n            packUnit: drug.packUnit || drug.unit || '盒',\n            conversionRate: drug.conversionRate || 1\n          };\n        }\n      } catch (err) {\n        console.error('获取药材详情失败:', err);\n        // 使用传入的drug数据\n        this.selectedDrug = {\n          ...drug,\n          minUnit: drug.minUnit || drug.unit || '个',\n          packUnit: drug.packUnit || drug.unit || '盒',\n          conversionRate: drug.conversionRate || 1\n        };\n      } finally {\n        uni.hideLoading();\n      }\n      \n      // 加载该园区的批次和库存\n      await this.loadBatches();\n    },\n\n    async loadBatches() {\n      uni.showLoading({ title: '加载库存...' });\n      try {\n        const res = await wx.cloud.callFunction({\n          name: 'stockManage',\n          data: {\n            action: 'getBatchesByDrugId',\n            data: {\n              drugId: this.form.drugId,\n              location: this.form.location,\n              enableFIFO: true\n            }\n          }\n        });\n\n        if (res.result.success && res.result.data.length > 0) {\n          const batches = res.result.data;\n          this.selectedBatch = batches[0];\n          this.availableStock = batches.reduce((sum, b) => sum + b.quantity, 0);\n        } else {\n          this.selectedBatch = null;\n          this.availableStock = 0;\n          const parkName = this.form.location === 'land_park' ? '陆园' : '水园';\n          uni.showToast({\n            title: `${parkName}该药材库存不足`,\n            icon: 'none',\n            duration: 2000\n          });\n        }\n      } catch (err) {\n        uni.showToast({\n          title: '加载库存失败',\n          icon: 'none'\n        });\n      } finally {\n        uni.hideLoading();\n      }\n    },\n\n    openSignature() {\n      this.showSignature = true;\n    },\n\n    onSignatureConfirm(signatureData) {\n      this.form.doctorSign = signatureData;\n      \n      // 记录签名时间\n      const now = new Date();\n      const year = now.getFullYear();\n      const month = String(now.getMonth() + 1).padStart(2, '0');\n      const day = String(now.getDate()).padStart(2, '0');\n      const hours = String(now.getHours()).padStart(2, '0');\n      const minutes = String(now.getMinutes()).padStart(2, '0');\n      this.form.signTime = `${year}-${month}-${day} ${hours}:${minutes}`;\n      \n      this.showSignature = false;\n      \n      uni.showToast({\n        title: '签名成功',\n        icon: 'success',\n        duration: 1500\n      });\n    },\n\n    async handleSubmit() {\n      // 必须先选择就诊园区\n      if (!this.form.location || (this.form.location !== 'land_park' && this.form.location !== 'water_park')) {\n        uni.showToast({ title: '请选择就诊园区', icon: 'none' });\n        return;\n      }\n\n      // 表单验证\n      if (!this.form.name || this.form.name.trim() === '') {\n        uni.showToast({ title: '请输入患者姓名', icon: 'none' });\n        return;\n      }\n      if (!this.form.gender) {\n        uni.showToast({ title: '请选择性别', icon: 'none' });\n        return;\n      }\n      if (!this.form.age || this.form.age <= 0) {\n        uni.showToast({ title: '请输入有效的年龄', icon: 'none' });\n        return;\n      }\n      if (!this.form.identity) {\n        uni.showToast({ title: '请选择身份', icon: 'none' });\n        return;\n      }\n      if (!this.form.visitType) {\n        uni.showToast({ title: '请选择接诊类型', icon: 'none' });\n        return;\n      }\n      if (this.form.visitType === 'outcall' && (!this.form.injuryLocation || this.form.injuryLocation.trim() === '')) {\n        uni.showToast({ title: '出诊时需填写受伤地点', icon: 'none' });\n        return;\n      }\n      if (!this.form.chiefComplaint || this.form.chiefComplaint.trim() === '') {\n        uni.showToast({ title: '请输入主诉', icon: 'none' });\n        return;\n      }\n      if (!this.form.diseaseName || this.form.diseaseName.trim() === '') {\n        uni.showToast({ title: '请输入疾病名称', icon: 'none' });\n        return;\n      }\n      if (!this.form.diagnosis || this.form.diagnosis.trim() === '') {\n        uni.showToast({ title: '请输入诊断', icon: 'none' });\n        return;\n      }\n      if (!this.form.treatment || this.form.treatment.trim() === '') {\n        uni.showToast({ title: '请输入处置措施', icon: 'none' });\n        return;\n      }\n\n      // 用药信息为选填：仅当选择了药材且数量>0时，才视为用药登记\n      let hasValidDrugUsage = false;\n      if (this.selectedDrug) {\n        if (this.form.quantity && this.form.quantity > 0) {\n          // 验证库存（园区使用最小单位，直接比较）\n          if (this.form.quantity > this.availableStock) {\n            uni.showToast({\n              title: `库存不足，最多${this.availableStock}${this.selectedDrug.minUnit}`,\n              icon: 'none',\n              duration: 3000\n            });\n            return;\n          }\n          hasValidDrugUsage = true;\n        } else {\n          // 选择了药材但未填写有效数量，视为本次不登记用药，清空用药相关状态\n          this.form.drugId = '';\n          this.form.quantity = null;\n          this.selectedDrug = null;\n          this.selectedBatch = null;\n          this.availableStock = 0;\n        }\n      }\n\n      this.submitting = true;\n      uni.showLoading({ title: '保存中...' });\n\n      try {\n        // 准备数据\n        const submitData = {\n          visitDateTime: this.form.visitDateTime,\n          name: this.form.name.trim(),\n          gender: this.form.gender,\n          age: this.form.age,\n          identity: this.form.identity,\n          location: this.form.location,  // 园区（陆园/水园）\n          visitType: this.form.visitType,\n          isOutcall: this.form.visitType === 'outcall',\n          injuryLocation: this.form.injuryLocation.trim(),\n          chiefComplaint: this.form.chiefComplaint.trim(),\n          diseaseName: this.form.diseaseName.trim(),\n          diagnosis: this.form.diagnosis.trim(),\n          treatment: this.form.treatment.trim(),\n          remark: this.form.remark.trim()\n        };\n\n        // 如果有有效用药信息，云函数会从对应园区扣减库存\n        if (hasValidDrugUsage && this.selectedDrug && this.form.quantity) {\n          // 确保数量是整数，避免小数\n          const intQuantity = Math.floor(this.form.quantity);\n          \n          submitData.drugInfo = {\n            drugId: this.form.drugId,  // 系统内部ID（主键）\n            drugCode: this.selectedDrug.drugCode || this.selectedDrug.code || '',  // 药材代码（业务编码）\n              drugName: this.selectedDrug.name,\n              specification: this.selectedDrug.specification,\n            unit: this.selectedDrug.minUnit,\n            quantity: intQuantity,\n              batchId: this.selectedBatch._id,\n            batch: this.selectedBatch.batch,\n            location: this.form.location,  // 关联园区\n              minUnit: this.selectedDrug.minUnit,\n              packUnit: this.selectedDrug.packUnit,\n            conversionRate: this.selectedDrug.conversionRate\n          };\n          \n          // 兼容旧字段\n          submitData.drugId = this.form.drugId;  // 系统内部ID（主键）\n          submitData.drugCode = this.selectedDrug.drugCode || this.selectedDrug.code || '';  // 药材代码（业务编码）\n          submitData.drugName = this.selectedDrug.name;\n          submitData.specification = this.selectedDrug.specification;\n          submitData.batchId = this.selectedBatch._id;\n          submitData.quantityMin = intQuantity;\n          submitData.minUnit = this.selectedDrug.minUnit;\n          submitData.packUnit = this.selectedDrug.packUnit;\n          submitData.conversionRate = this.selectedDrug.conversionRate;\n          submitData.patient = this.form.name.trim();\n          submitData.symptom = (this.form.symptom || this.form.chiefComplaint || '').trim();\n        }\n\n        const res = await wx.cloud.callFunction({\n          name: 'clinicRecords',\n          data: {\n            action: 'add',\n            data: submitData\n          }\n        });\n\n        if (res.result.success) {\n          // 提示保存为模板\n          this.promptSaveTemplate();\n          \n          if (this.continueAfterSubmit) {\n            // 连续登记模式：立即清空表单\n          uni.showToast({\n              title: '登记成功，可继续登记',\n              icon: 'success',\n              duration: 2000\n          });\n\n            setTimeout(() => {\n            this.resetForm();\n              // 滚动到顶部\n              uni.pageScrollTo({\n                scrollTop: 0,\n                duration: 300\n              });\n            }, 800);\n          } else {\n            // 返回列表\n            uni.showToast({\n              title: '登记成功',\n              icon: 'success'\n            });\n            setTimeout(() => {\n              // 确保离开页面前也重置一次，避免热更新或返回后残留\n              this.resetForm();\n              uni.navigateBack();\n            }, 1500);\n          }\n        } else {\n          uni.showToast({\n            title: res.result.error || '登记失败',\n            icon: 'none'\n          });\n        }\n      } catch (err) {\n        console.error('登记失败:', err);\n        uni.showToast({\n          title: '登记失败',\n          icon: 'none'\n        });\n      } finally {\n        this.submitting = false;\n        uni.hideLoading();\n      }\n    },\n\n    resetForm() {\n      // 保留当前园区选择，其他信息全部重置\n      const currentLocation = this.form.location || '';\n\n      // 更新时间（就诊时间始终为当前时间）\n      this.updateDateTime();\n\n      // 逐字段重置，避免整体替换对象可能带来的响应式问题\n      this.form.name = '';\n      this.form.gender = '男';\n      this.form.age = null;\n      this.form.identity = '游客';\n      this.form.location = currentLocation; // 保留园区选择\n      this.form.visitType = 'clinic';\n      this.form.injuryLocation = '';\n      this.form.chiefComplaint = '';\n      this.form.symptom = '';\n      this.standardizedSymptoms = [];\n      this.form.diseaseName = '';\n      this.form.diagnosis = '';\n      this.form.treatment = '';\n      this.form.drugId = '';\n      this.form.quantity = null;\n      this.form.remark = '';\n      this.form.doctorSign = '';\n      this.form.signTime = '';\n\n      // 用药与库存相关状态\n      this.selectedDrug = null;\n      this.selectedBatch = null;\n      this.availableStock = 0;\n      this.convertedQuantity = null;\n      this.drugSearchText = '';\n      this.filteredDrugs = [];\n      this.showDrugList = false;\n\n      // 疾病/模板/下拉相关状态\n      this.filteredDiseases = [];\n      this.showDiseaseList = false;\n      this.filteredDiagnosis = [];\n      this.showDiagnosisList = false;\n      this.filteredTreatments = [];\n      this.showTreatmentList = false;\n      this.filteredComplaints = [];\n      this.showComplaintList = false;\n      this.complaintSelectedMode = false; // 重置主诉编辑模式\n      // 症状相关状态\n      this.filteredSymptoms = [];\n      this.showSymptomList = false;\n      this.standardizedSymptoms = [];\n      // 清理计时器\n      if (this.symptomInputTimer) {\n        clearTimeout(this.symptomInputTimer);\n        this.symptomInputTimer = null;\n      }\n      if (this.fetchHvSuggestionTimer) {\n        clearTimeout(this.fetchHvSuggestionTimer);\n        this.fetchHvSuggestionTimer = null;\n      }\n      if (this.diseaseInputTimer) {\n        clearTimeout(this.diseaseInputTimer);\n        this.diseaseInputTimer = null;\n      }\n      if (this.diagnosisInputTimer) {\n        clearTimeout(this.diagnosisInputTimer);\n        this.diagnosisInputTimer = null;\n      }\n      if (this.complaintInputTimer) {\n        clearTimeout(this.complaintInputTimer);\n        this.complaintInputTimer = null;\n      }\n      if (this.complaintFocusTimer) {\n        clearTimeout(this.complaintFocusTimer);\n        this.complaintFocusTimer = null;\n      }\n    },\n\n    formatDate(dateStr) {\n      if (!dateStr) return '';\n      const date = new Date(dateStr);\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      return `${year}-${month}-${day}`;\n    },\n\n    // 切换连续登记模式\n    toggleContinue() {\n      this.continueAfterSubmit = !this.continueAfterSubmit;\n      \n      // 保存用户偏好\n      try {\n        uni.setStorageSync('clinic_continue_mode', this.continueAfterSubmit);\n      } catch (err) {\n        console.error('保存连续登记设置失败:', err);\n      }\n      \n      uni.showToast({\n        title: this.continueAfterSubmit ? '已开启连续登记' : '已关闭连续登记',\n        icon: 'none',\n        duration: 1500\n      });\n    },\n\n    goBack() {\n      uni.navigateBack();\n    },\n\n    // 生成日报\n    async generateDailyReport() {\n      try {\n        uni.showLoading({ title: '生成中...' });\n\n        // 获取当前日期和园区\n        const today = new Date();\n        const year = today.getFullYear();\n        const month = String(today.getMonth() + 1).padStart(2, '0');\n        const day = String(today.getDate()).padStart(2, '0');\n        const dateStr = `${year}-${month}-${day}`;\n\n        // 必须先选择就诊园区\n        const location = this.form.location;\n        if (!location || (location !== 'land_park' && location !== 'water_park')) {\n          uni.hideLoading();\n          uni.showToast({ title: '请选择就诊园区', icon: 'none' });\n          // 如有需要，可同时弹出园区选择提示\n          this.showLocationTip = true;\n          return;\n        }\n        const locationName = location === 'land_park' ? '陆园' : '水园';\n\n        // 查询当日的所有门诊记录\n        // 查询 clinic_records 集合（完整门诊登记信息）\n        let records = [];\n        try {\n          // 使用 clinicRecords 云函数查询完整的门诊登记记录\n          const res = await wx.cloud.callFunction({\n            name: 'clinicRecords',\n            data: {\n              action: 'list',\n              data: {\n                location: location,\n                startDate: dateStr,\n                endDate: dateStr,\n                pageSize: 1000,\n                useClinicRecords: true  // 查询完整的门诊登记记录\n              }\n            }\n          });\n\n          if (res.result && res.result.success && res.result.data && res.result.data.list) {\n            records = res.result.data.list;\n          }\n        } catch (err) {\n          console.error('查询门诊记录失败:', err);\n        }\n\n        if (records.length === 0) {\n          uni.hideLoading();\n          uni.showToast({\n            title: '当日无门诊记录',\n            icon: 'none',\n            duration: 2000\n          });\n          return;\n        }\n\n        // 生成文档和统计信息\n        const report = this.formatDailyReport(records, dateStr, locationName);\n        const stats = this.calculateStats(records);\n        \n        // 准备详细的表格数据\n        const tableData = this.prepareTableData(records);\n\n        uni.hideLoading();\n\n        // 跳转到日报显示页面\n        const reportDate = `${year}年${month}月${day}日`;\n        uni.navigateTo({\n          url: `/pages-sub/report/daily?content=${encodeURIComponent(report)}&date=${encodeURIComponent(reportDate)}&location=${encodeURIComponent(locationName)}&stats=${encodeURIComponent(JSON.stringify(stats))}&tableData=${encodeURIComponent(JSON.stringify(tableData))}`,\n          fail: (err) => {\n            console.error('跳转失败:', err);\n            // 如果跳转失败，复制到剪贴板\n            uni.setClipboardData({\n              data: report,\n              success: () => {\n                uni.showToast({\n                  title: '已复制到剪贴板',\n                  icon: 'success'\n                });\n              }\n            });\n          }\n        });\n      } catch (err) {\n        console.error('生成日报失败:', err);\n        uni.hideLoading();\n        uni.showToast({\n          title: '生成失败：' + (err.message || '未知错误'),\n          icon: 'none',\n          duration: 3000\n        });\n      }\n    },\n\n    // 格式化日报\n    formatDailyReport(records, dateStr, locationName) {\n      // 解析日期\n      const date = new Date(dateStr);\n      const year = date.getFullYear();\n      const month = date.getMonth() + 1;\n      const day = date.getDate();\n      const dateFormatted = `${year}年${month}月${day}日`;\n\n      // 统计信息\n      const stats = {\n        total: records.length,\n        visitor: [],\n        employee: [],\n        outcall: []\n      };\n\n      // 按身份和疾病分类统计\n      records.forEach(record => {\n        const identity = record.identity || '游客';\n        const diseaseName = record.diseaseName || '未知';\n        const injuryLocation = record.injuryLocation || '';\n        const isOutcall = record.isOutcall || record.visitType === 'outcall';\n\n        if (isOutcall && injuryLocation) {\n          // 统计出诊\n          const existing = stats.outcall.find(item => item.location === injuryLocation);\n          if (existing) {\n            existing.count++;\n          } else {\n            stats.outcall.push({ location: injuryLocation, count: 1 });\n          }\n        }\n\n        if (identity === '游客') {\n          // 游客统计\n          const existing = stats.visitor.find(item => item.disease === diseaseName);\n          if (existing) {\n            if (injuryLocation && injuryLocation.trim()) {\n              const loc = existing.locations.find(l => l.name === injuryLocation);\n              if (loc) {\n                loc.count++;\n              } else {\n                existing.locations.push({ name: injuryLocation, count: 1 });\n              }\n            }\n            existing.total++;\n          } else {\n            stats.visitor.push({\n              disease: diseaseName,\n              total: 1,\n              locations: (injuryLocation && injuryLocation.trim()) ? [{ name: injuryLocation, count: 1 }] : []\n            });\n          }\n        } else if (identity === '员工') {\n          // 员工统计\n          const existing = stats.employee.find(item => item.disease === diseaseName);\n          if (existing) {\n            existing.total++;\n          } else {\n            stats.employee.push({\n              disease: diseaseName,\n              total: 1\n            });\n          }\n        }\n      });\n\n      // 生成文档内容\n      let report = `${dateFormatted}欢乐谷医务室（${locationName}）当日接诊${stats.total}人。\\n`;\n\n      // 游客统计\n      if (stats.visitor.length > 0) {\n        const visitorTotal = stats.visitor.reduce((sum, item) => sum + item.total, 0);\n        report += `游客${visitorTotal}人：`;\n        \n        const visitorParts = [];\n        stats.visitor.forEach(item => {\n          if (item.locations && item.locations.length > 0) {\n            // 有地点的疾病：疾病X人（地点1X人，地点2X人）\n            const locationParts = item.locations.map(loc => `${loc.name}${loc.count}人`);\n            visitorParts.push(`${item.disease}${item.total}人（${locationParts.join('，')}）`);\n          } else {\n            // 无地点的疾病：疾病X人\n            visitorParts.push(`${item.disease}${item.total}人`);\n          }\n        });\n        report += visitorParts.join('，') + '。\\n';\n      }\n\n      // 员工统计\n      if (stats.employee.length > 0) {\n        const employeeTotal = stats.employee.reduce((sum, item) => sum + item.total, 0);\n        report += `员工${employeeTotal}人：`;\n        const employeeParts = stats.employee.map(item => `${item.disease}${item.total}人`);\n        report += employeeParts.join('，') + '。\\n';\n      }\n\n      // 出诊统计\n      if (stats.outcall.length > 0) {\n        const outcallTotal = stats.outcall.reduce((sum, item) => sum + item.count, 0);\n        report += `出诊${outcallTotal}次：`;\n        const outcallParts = stats.outcall.map(item => `${item.location}${item.count}次`);\n        report += outcallParts.join('，') + '。\\n';\n      }\n\n      return report.trim();\n    },\n\n    // 计算统计信息\n    calculateStats(records) {\n      const stats = {\n        total: records.length,\n        visitorTotal: 0,\n        employeeTotal: 0,\n        outcallTotal: 0\n      };\n\n      records.forEach(record => {\n        const identity = record.identity || '游客';\n        const isOutcall = record.isOutcall || record.visitType === 'outcall';\n\n        if (identity === '游客') {\n          stats.visitorTotal++;\n        } else if (identity === '员工') {\n          stats.employeeTotal++;\n        }\n\n        if (isOutcall) {\n          stats.outcallTotal++;\n        }\n      });\n\n      return stats;\n    },\n\n    // 准备表格数据\n    prepareTableData(records) {\n      const visitorData = [];\n      const employeeData = [];\n      let doctorName = '';\n      try {\n        const userInfo = uni.getStorageSync('userInfo');\n        doctorName = userInfo?.name || '';\n      } catch (err) {\n        console.error('获取用户信息失败:', err);\n      }\n\n      records.forEach(record => {\n        const identity = record.identity || '游客';\n        const diseaseName =\n          record.diseaseName ||\n          record.diagnosis ||\n          record.chiefComplaint ||\n          '未知';\n        const data = {\n          name: record.name || '',\n          diseaseName,\n          location: record.injuryLocation || '',\n          visitTime: record.visitDateTime || record.createTime || '',\n          isOutcall: record.isOutcall || record.visitType === 'outcall',\n          doctorName: doctorName\n        };\n\n        if (identity === '游客') {\n          visitorData.push(data);\n        } else if (identity === '员工') {\n          employeeData.push(data);\n        }\n      });\n\n      return {\n        visitor: visitorData,\n        employee: employeeData\n      };\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.clinic-add {\n  min-height: 100vh;\n  // 使用与首页/门诊首页一致的蓝色渐变背景\n  background: linear-gradient(180deg, #00c9ff 0%, #00a0ff 35%, #e5e7eb 100%);\n  padding: 24rpx 24rpx 40rpx;\n}\n\n.clinic-scroll {\n  box-sizing: border-box;\n  padding-bottom: 120rpx; // 预留空间避免被底部固定按钮遮挡\n}\n\n// 顶部标题\n.page-header {\n  // 顶部标题卡片：象牙白圆角卡片，宽度与首页 header-card 对齐\n  max-width: 702rpx;\n  margin: 0 auto 8rpx;\n  padding: 40rpx 30rpx;\n  background: #FFFFF0;\n  border-radius: 22rpx;\n  text-align: center;\n  box-shadow:\n    0 1rpx 0 rgba(255, 255, 255, 0.9) inset,\n    0 -1rpx 0 rgba(15, 23, 42, 0.06) inset,\n    0 18rpx 40rpx rgba(15, 23, 42, 0.14);\n\n  .title {\n    font-size: 44rpx;\n    font-weight: bold;\n    color: #0f172a;\n    margin-bottom: 16rpx;\n    letter-spacing: 2rpx;\n  }\n\n  .subtitle {\n    font-size: 36rpx;\n    font-weight: bold;\n    color: #111827;\n    margin-bottom: 16rpx;\n    padding: 16rpx 0;\n    border-bottom: 4rpx solid rgba(59, 130, 246, 0.6);\n    display: inline-block;\n  }\n}\n\n.top-actions-card {\n  margin: 0 0 12rpx 0;\n  padding: 16rpx 18rpx 18rpx;\n  background: #FFFFF0;\n  border-radius: 24rpx;\n  box-shadow: 0 8rpx 20rpx rgba(15, 23, 42, 0.14);\n}\n\n.top-buttons {\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n  justify-content: center;\n  flex-wrap: nowrap;\n  gap: 20rpx;\n}\n\n.top-btn {\n  flex: 1;\n  min-width: 0;\n  padding: 18rpx 0;\n  border-radius: 999rpx;\n  font-size: 28rpx;\n  /* 覆盖小程序 button 的默认 block+全宽行为，保证在一行内平分 */\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-sizing: border-box;\n  margin: 0;\n  background: linear-gradient(135deg, #22c1c3 0%, #2a91e9 100%);\n  border: none;\n  color: #ffffff;\n}\n\n.top-btn.primary {\n  background: linear-gradient(135deg, #22c1c3 0%, #2a91e9 100%);\n}\n\n.top-btn.ghost {\n  background: linear-gradient(135deg, #22c1c3 0%, #2a91e9 100%);\n}\n\n.form-section {\n  max-width: 702rpx;\n  margin: 0 auto 8rpx;\n  padding: 32rpx 30rpx 30rpx;\n  background: #FFFFF0;\n  border-radius: 24rpx;\n  box-shadow: 0 8rpx 20rpx rgba(15, 23, 42, 0.12);\n}\n\n.section-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #0f172a;\n  margin-bottom: 30rpx;\n  padding-bottom: 20rpx;\n  border-bottom: 3rpx solid rgba(226, 232, 240, 0.9);\n  display: flex;\n  align-items: center;\n}\n\n.form-item {\n  margin-bottom: 30rpx;\n\n  &.half {\n    flex: 1;\n  }\n\n  .label {\n    font-size: 30rpx;\n    color: #333;\n    margin-bottom: 16rpx;\n    display: block;\n    font-weight: 500;\n\n    &.required::before {\n      content: '*';\n      color: #ff4d4f;\n      margin-right: 8rpx;\n      font-weight: bold;\n    }\n  }\n\n  input {\n    width: 100%;\n    height: 80rpx;\n    line-height: 80rpx;\n    padding: 0 24rpx;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    font-size: 28rpx;\n    background: #fafafa;\n    transition: all 0.3s;\n    box-sizing: border-box;\n  }\n\n  // 稍大一点的多行 textarea（如处置等）\n  .textarea-small {\n    min-height: 104rpx !important;  // 固定两行高度\n    max-height: 104rpx !important;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    background: #f9fafb;\n    font-size: 28rpx;\n    color: #333;\n  }\n\n  // 自适应高度的 textarea\n  .textarea-auto {\n    min-height: 104rpx !important;  // 固定两行高度\n    height: 104rpx !important;\n    max-height: 104rpx !important;\n    padding: 12rpx 24rpx !important;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    background: #f9fafb;\n    font-size: 28rpx;\n    color: #333;\n    line-height: 1.4 !important;\n    word-wrap: break-word;\n    word-break: break-all;\n    transition: all 0.3s;\n    box-sizing: border-box;\n    \n    &:focus {\n      border-color: #1890ff;\n      background: #ffffff;\n      box-shadow: 0 0 0 4rpx rgba(24, 144, 255, 0.1);\n    }\n    \n    &::placeholder {\n      color: #999;\n      font-size: 26rpx;\n    }\n    \n    // 内容较长时使用中等字号\n    &.font-medium {\n      font-size: 26rpx !important;\n    }\n    \n    // 内容很长时使用小字号\n    &.font-small {\n      font-size: 24rpx !important;\n      line-height: 1.5 !important;\n    }\n  }\n}\n\n.input-compact {\n  height: 80rpx;\n  line-height: 80rpx;\n  padding: 0 24rpx;\n  border: 2rpx solid #e0e0e0;\n  border-radius: 12rpx;\n  background: #f9fafb;\n  font-size: 28rpx;\n  color: #333;\n  transition: all 0.3s;\n  box-sizing: border-box;\n  \n  &:focus {\n    border-color: #1890ff;\n    background: #ffffff;\n    box-shadow: 0 0 0 4rpx rgba(24, 144, 255, 0.1);\n  }\n  \n  &::placeholder {\n    color: #999;\n    font-size: 26rpx;\n  }\n}\n\n.form-row {\n  display: flex;\n  gap: 24rpx;        // 统一两列之间的间距\n}\n\n.datetime-display {\n  padding: 20rpx;\n  background: #e6f7ff;\n  border: 2rpx solid #91d5ff;\n  border-radius: 12rpx;\n  font-size: 32rpx;\n  color: #1890ff;\n  font-weight: bold;\n  text-align: center;\n  height: 80rpx;  // 统一高度\n  box-sizing: border-box;\n  line-height: 1.6;  // 统一行高\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.gender-selector,\n.identity-selector {\n  display: flex;\n  gap: 20rpx;\n\n  .identity-item {\n    flex: 1;\n    height: 80rpx;  // 统一高度\n    padding: 20rpx;\n    text-align: center;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    font-size: 28rpx;\n    color: #666;\n    background: #fafafa;\n    transition: all 0.3s;\n    font-weight: 500;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-sizing: border-box;\n\n    &.active {\n      border-color: #1890ff;\n      background: #e6f7ff;\n      color: #1890ff;\n      font-weight: bold;\n      transform: scale(1.05);\n    }\n  }\n}\n\n.visit-type-selector {\n  .identity-item {\n    justify-content: center;\n  }\n}\n\n.visit-type-text {\n  font-size: 26rpx;\n}\n\n.gender-selector {\n  display: flex;\n  gap: 20rpx;\n\n  &.compact {\n    flex: 1;\n    min-width: 0;\n  }\n\n  .gender-item {\n    flex: 1;\n    height: 80rpx;  // 统一高度\n    padding: 20rpx;\n    text-align: center;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    font-size: 28rpx;\n    color: #666;\n    background: #fafafa;\n    transition: all 0.3s;\n    font-weight: 500;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-sizing: border-box;\n\n    &.active {\n      border-color: #1890ff;\n      background: #e6f7ff;\n      color: #1890ff;\n      font-weight: bold;\n      transform: scale(1.05);\n    }\n    }\n  }\n\n.gender-age-row {\n  display: flex;\n  gap: 15rpx;\n  align-items: center;\n  width: 100%;\n  justify-content: space-between; // 让年龄输入框贴到右边\n}\n\n.gender-selector.compact {\n  flex: 1; // 性别按钮组占据左侧剩余空间\n}\n\n.age-input {\n  flex: 0 0 120rpx;\n  min-width: 120rpx;\n  padding: 20rpx 16rpx;\n  border: 2rpx solid #e0e0e0;\n  border-radius: 12rpx;\n  font-size: 26rpx;\n  background: #fafafa;\n  text-align: center;\n  box-sizing: border-box;\n  height: 80rpx;\n  \n  &:focus {\n    border-color: #1890ff;\n    background: white;\n  }\n}\n\n// 药材输入包装器\n.drug-input-wrapper {\n  position: relative;\n  width: 100%;\n\n  input {\n    width: 100%;\n    padding: 20rpx 24rpx;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    font-size: 26rpx;\n    background: white;\n    transition: all 0.3s;\n    box-sizing: border-box;\n    height: 80rpx;  // 统一高度\n    line-height: 1.6;  // 统一行高\n\n    &:focus {\n      border-color: #1890ff;\n      box-shadow: 0 0 0 4rpx rgba(24, 144, 255, 0.1);\n    }\n    \n    &::placeholder {\n      font-size: 26rpx;\n      color: #999;\n    }\n  }\n\n  // 药材下拉列表（显示在输入框上方，避免被键盘遮挡）\n  .drug-dropdown {\n    position: absolute;\n    bottom: 100%;\n    left: 0;\n    right: 0;\n    margin-bottom: 8rpx;\n    background: white;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.15);\n    z-index: 1000;\n    max-height: 600rpx;\n    overflow: hidden;\n    \n    .dropdown-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 16rpx 20rpx;\n      background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);\n      border-bottom: 1rpx solid #7dd3fc;\n      \n      .dropdown-title {\n        font-size: 26rpx;\n        font-weight: bold;\n        color: #0369a1;\n      }\n      \n      .dropdown-count {\n        font-size: 22rpx;\n        color: #0891b2;\n      }\n    }\n\n    .drug-scroll {\n      max-height: 540rpx;\n    }\n\n    .drug-item {\n      padding: 24rpx 20rpx;\n      border-bottom: 1rpx solid #f0f0f0;\n      transition: background 0.2s;\n\n      &:active {\n        background: #f5f5f5;\n      }\n\n      &:last-child {\n        border-bottom: none;\n      }\n\n      .drug-name {\n        font-size: 26rpx;\n        color: #333;\n        font-weight: 500;\n        margin-bottom: 8rpx;\n      }\n\n      .drug-spec {\n        font-size: 24rpx;\n        color: #999;\n      }\n    }\n  }\n\n  .no-result {\n    position: absolute;\n    bottom: 100%;\n    left: 0;\n    right: 0;\n    margin-bottom: 8rpx;\n    padding: 40rpx 20rpx;\n    background: white;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    text-align: center;\n    font-size: 26rpx;\n    color: #999;\n    box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.1);\n    z-index: 1000;\n  }\n}\n\n// 疾病名称输入包装器\n// 疾病名称行（输入框 + 按钮在同一行）\n.disease-name-row {\n  display: flex;\n  align-items: flex-start;\n  gap: 12rpx;\n  width: 100%;\n}\n\n\n.disease-input-wrapper {\n  position: relative;\n  width: 100%;\n\n  input {\n    width: 100%;\n    box-sizing: border-box;\n    height: 80rpx;  // 统一高度\n    line-height: 1.6;  // 统一行高\n    font-size: 26rpx;\n    padding: 20rpx 24rpx;\n  }\n\n  .disease-dropdown {\n    position: absolute;\n    bottom: 100%;\n    left: 0;\n    right: 0;\n    margin-bottom: 8rpx;\n    background: white;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.15);\n    z-index: 1000;\n    max-height: 400rpx;\n    overflow: hidden;\n\n    .disease-scroll {\n      max-height: 400rpx;\n    }\n\n    .disease-item {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 24rpx 20rpx;\n      border-bottom: 1rpx solid #f0f0f0;\n      \n      &.hidden {\n        display: none;\n      }\n      font-size: 26rpx;\n      color: #333;\n      transition: background 0.2s;\n      \n      .symptom-name {\n        flex: 1;\n      }\n      \n      .symptom-category {\n        font-size: 22rpx;\n        color: #94a3b8;\n        margin-left: 12rpx;\n      }\n\n      &:active {\n        background: #e6f7ff;\n      }\n\n      &:last-child {\n        border-bottom: none;\n      }\n    }\n    \n    .diagnosis-section {\n      .section-divider {\n        padding: 16rpx 20rpx 12rpx;\n        background: #f8fafc;\n        border-bottom: 1rpx solid #e2e8f0;\n        \n        .section-title {\n          font-size: 22rpx;\n          color: #64748b;\n          font-weight: 600;\n        }\n      }\n    }\n  }\n  \n  // 症状标签区域\n  .symptom-tags {\n    margin-top: 16rpx;\n    padding: 16rpx;\n    background: #f8fafc;\n    border-radius: 12rpx;\n    border: 1rpx solid #e2e8f0;\n    \n    .tags-label {\n      font-size: 24rpx;\n      color: #64748b;\n      margin-bottom: 12rpx;\n      font-weight: 500;\n    }\n    \n    .tags-container {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 12rpx;\n    }\n    \n    .symptom-tag {\n      display: inline-flex;\n      align-items: center;\n      padding: 8rpx 16rpx;\n      background: #ffffff;\n      border: 2rpx solid #cbd5e1;\n      border-radius: 20rpx;\n      font-size: 24rpx;\n      color: #475569;\n      transition: all 0.2s;\n      \n      &.active {\n        background: #e0f2fe;\n        border-color: #0ea5e9;\n        color: #0369a1;\n      }\n      \n      .severity-badge {\n        margin-left: 8rpx;\n        padding: 2rpx 8rpx;\n        border-radius: 8rpx;\n        font-size: 20rpx;\n        font-weight: 600;\n        \n        &.severity-1 {\n          background: #dcfce7;\n          color: #16a34a;\n        }\n        \n        &.severity-2 {\n          background: #fef3c7;\n          color: #d97706;\n        }\n        \n        &.severity-3 {\n          background: #fee2e2;\n          color: #dc2626;\n        }\n        \n        &.severity-4 {\n          background: #fce7f3;\n          color: #be185d;\n        }\n      }\n      \n      &:active {\n        transform: scale(0.95);\n      }\n    }\n  }\n}\n\n// 处置药材建议 chips\n.drug-chip-list {\n  margin-top: 10rpx;\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10rpx;\n}\n.drug-chip {\n  padding: 10rpx 14rpx;\n  background: #f4f7ff;\n  border: 2rpx solid #c7d2fe;\n  color: #334155;\n  border-radius: 999rpx;\n  font-size: 24rpx;\n}\n\n// 受伤地点输入包装器\n.location-input-wrapper {\n  position: relative;\n  width: 100%;\n\n  input {\n    height: 80rpx;\n    line-height: 1.6;\n    font-size: 26rpx;\n    padding: 20rpx 24rpx;\n  }\n\n  .location-dropdown {\n    position: absolute;\n    bottom: 100%;\n    left: 0;\n    right: 0;\n    margin-bottom: 8rpx;\n    background: white;\n    border: 2rpx solid #e0e0e0;\n    border-radius: 12rpx;\n    box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.15);\n    z-index: 1000;\n    max-height: 400rpx;\n    overflow: hidden;\n  }\n\n  .location-scroll {\n    max-height: 400rpx;\n  }\n\n  .location-item {\n    padding: 24rpx 20rpx;\n    border-bottom: 1rpx solid #f0f0f0;\n    font-size: 26rpx;\n    color: #333;\n    transition: background 0.2s;\n\n    &:active {\n      background: #e6f7ff;\n    }\n\n    &:last-child {\n      border-bottom: none;\n    }\n  }\n}\n\n// 用药信息展示\n.drug-quick-info {\n  margin-top: 16rpx;\n  margin-bottom: 16rpx;\n}\n\n// 药材信息单行展示\n.drug-info-row {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 16rpx 20rpx;\n  background: #f9fafb;\n  border-radius: 12rpx;\n  border: 2rpx solid #e0e0e0;\n  gap: 16rpx;\n  \n  .drug-name-section {\n    flex: 1;\n    min-width: 0;\n    \n    .drug-name-text {\n      font-size: 28rpx;\n      font-weight: 600;\n      color: #333;\n      display: block;\n      margin-bottom: 4rpx;\n    }\n    \n    .drug-spec-text {\n      font-size: 24rpx;\n      color: #666;\n      display: block;\n    }\n  }\n  \n  .drug-stock-section {\n    display: flex;\n    align-items: center;\n    white-space: nowrap;\n    \n    .stock-label {\n      font-size: 24rpx;\n      color: #666;\n      margin-right: 4rpx;\n    }\n    \n    .stock-value {\n      font-size: 26rpx;\n      font-weight: 600;\n      color: #52c41a;\n      \n      &.stock-warning {\n        color: #dc2626;\n      }\n    }\n  }\n}\n\n// 单行表单项（标签、输入框、单位在同一行）\n.form-item-inline {\n  display: flex;\n  align-items: center;\n  gap: 12rpx;\n  margin-bottom: 24rpx;\n  flex-wrap: wrap;\n  \n  .label {\n    font-size: 28rpx;\n    color: #333;\n    font-weight: 500;\n    white-space: nowrap;\n    \n    &.required::before {\n      content: '*';\n      color: #dc2626;\n      margin-right: 4rpx;\n      font-weight: bold;\n    }\n  }\n  \n  .quantity-input-inline {\n    flex: 1;\n    min-width: 200rpx;\n    background: #ffffff !important;\n  }\n  \n  .unit-label {\n    padding: 20rpx 24rpx;\n    background: #e8e8e8;\n    border: 2rpx solid #d0d0d0;\n    border-radius: 12rpx;\n    font-size: 26rpx;\n    font-weight: 600;\n    color: #555;\n    min-width: 80rpx;\n    text-align: center;\n    height: 80rpx;\n    box-sizing: border-box;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  \n  .add-to-prescription-btn {\n    padding: 20rpx 28rpx;\n    background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);\n    border-radius: 12rpx;\n    display: flex;\n    align-items: center;\n    gap: 6rpx;\n    cursor: pointer;\n    transition: all 0.3s;\n    box-shadow: 0 4rpx 12rpx rgba(24, 144, 255, 0.3);\n    \n    &:active {\n      transform: scale(0.95);\n      box-shadow: 0 2rpx 8rpx rgba(24, 144, 255, 0.2);\n    }\n    \n    .btn-icon {\n      font-size: 32rpx;\n      font-weight: bold;\n      color: #ffffff;\n    }\n    \n    .btn-text {\n      font-size: 26rpx;\n      font-weight: 600;\n      color: #ffffff;\n      white-space: nowrap;\n    }\n  }\n  \n  .quantity-warning-inline {\n    width: 100%;\n    margin-top: 8rpx;\n    padding: 12rpx 16rpx;\n    background: #fff5f5;\n    border-radius: 8rpx;\n    border: 1rpx solid #fca5a5;\n    display: flex;\n    align-items: center;\n    gap: 8rpx;\n    \n    .warning-text {\n      font-size: 24rpx;\n      color: #dc2626;\n      flex: 1;\n    }\n  }\n}\n\n// 开关行样式\n.label-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  width: 100%;\n  \n  .label {\n    font-size: 28rpx;\n    color: #333;\n    font-weight: 500;\n  }\n}\n\n// 处方区域（符合国家规定格式）\n.prescription-section {\n  margin-top: 24rpx;\n  padding: 0;\n  background: #ffffff;\n  border: 3rpx solid #333;\n  border-radius: 0;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n}\n\n// 医院信息\n.prescription-hospital {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 24rpx 24rpx;\n  border-bottom: 2rpx solid #333;\n  background: #f5f5f5;\n  \n  .hospital-name {\n    font-size: 36rpx;\n    font-weight: bold;\n    color: #000;\n    letter-spacing: 2rpx;\n  }\n}\n\n// 处方头部信息\n.prescription-header-info {\n  border-bottom: 2rpx solid #333;\n  padding: 20rpx 24rpx;\n  padding-bottom: 20rpx;\n  margin-bottom: 0;\n}\n\n.prescription-title-row {\n  text-align: center;\n  margin-bottom: 12rpx;\n  \n  .prescription-title {\n    font-size: 40rpx;\n    font-weight: bold;\n    color: #000;\n    letter-spacing: 8rpx;\n  }\n}\n\n.prescription-no-row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 16rpx;\n  \n  .prescription-no {\n    font-size: 24rpx;\n    color: #666;\n  }\n}\n\n.prescription-patient-info {\n  display: flex;\n  gap: 24rpx;\n  margin-bottom: 12rpx;\n  \n  .patient-item {\n    display: flex;\n    align-items: center;\n    \n    .patient-label {\n      font-size: 26rpx;\n      color: #333;\n    }\n    \n    .patient-value {\n      font-size: 26rpx;\n      color: #000;\n      font-weight: 500;\n      min-width: 80rpx;\n    }\n  }\n}\n\n.prescription-diagnosis {\n  display: flex;\n  align-items: center;\n  \n  .diagnosis-label {\n    font-size: 26rpx;\n    color: #333;\n    white-space: nowrap;\n  }\n  \n  .diagnosis-value {\n    font-size: 26rpx;\n    color: #000;\n    font-weight: 500;\n    flex: 1;\n  }\n}\n\n// Rp标记和药品列表 - 医疗处方样式\n.prescription-body {\n  min-height: 300rpx;\n  padding: 24rpx;\n  border: 2rpx solid #333;\n  background: #fff;\n  margin-top: 20rpx;\n}\n\n// 处方头部操作区域 - 医疗处方样式\n.prescription-header-actions {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 20rpx;\n  padding-bottom: 12rpx;\n  border-bottom: 1rpx solid #e0e0e0;\n}\n\n.rp-mark {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #000;\n  font-family: 'Times New Roman', serif;\n  letter-spacing: 2rpx;\n}\n\n// 添加处方按钮（在处方区域）- 医疗处方样式\n.add-prescription-btn {\n  display: flex;\n  align-items: center;\n  gap: 6rpx;\n  padding: 10rpx 20rpx;\n  background: #1890ff;\n  border: 1rpx solid #096dd9;\n  border-radius: 4rpx;\n  color: #ffffff;\n  font-size: 24rpx;\n  white-space: nowrap;\n  transition: all 0.2s;\n  box-shadow: 0 2rpx 4rpx rgba(24, 144, 255, 0.2);\n  \n  .btn-icon {\n    font-size: 26rpx;\n    font-weight: bold;\n  }\n  \n  .btn-text {\n    font-size: 24rpx;\n    font-weight: 500;\n  }\n  \n  &:active {\n    background: #096dd9;\n    transform: scale(0.98);\n    box-shadow: 0 1rpx 2rpx rgba(24, 144, 255, 0.3);\n  }\n}\n\n// 处方表格 - 传统医疗处方样式\n.prescription-table {\n  border: 2rpx solid #333;\n  border-radius: 0;\n  overflow: hidden;\n  margin-bottom: 20rpx;\n  background: #fff;\n}\n\n// 表头 - 医疗处方表头样式\n.table-header {\n  display: flex;\n  background: #f0f0f0;\n  border-bottom: 2rpx solid #333;\n  font-weight: 700;\n  font-size: 26rpx;\n  color: #000;\n  \n  view {\n    padding: 20rpx 10rpx;\n    text-align: center;\n    border-right: 1rpx solid #333;\n    word-break: keep-all;\n    \n    &:last-child {\n      border-right: none;\n    }\n  }\n}\n\n// 表格空状态 - 医疗处方样式\n.table-empty {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-height: 120rpx;\n  padding: 40rpx 20rpx;\n  border-bottom: 2rpx solid #333;\n  \n  .empty-text {\n    font-size: 26rpx;\n    color: #999;\n    text-align: center;\n    line-height: 1.6;\n  }\n}\n\n// 表格行 - 医疗处方行样式\n.table-row {\n  display: flex;\n  border-bottom: 1rpx solid #333;\n  font-size: 26rpx;\n  color: #000;\n  background: #fff;\n  min-height: 60rpx;\n  \n  &:last-child {\n    border-bottom: 2rpx solid #333;\n  }\n  \n  &:nth-child(even) {\n    background: #fafafa;\n  }\n  \n  view {\n    padding: 18rpx 10rpx;\n    border-right: 1rpx solid #333;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    word-break: break-all;\n    \n    &:last-child {\n      border-right: none;\n    }\n  }\n}\n\n// 列宽定义 - 优化列宽比例\n.col-no {\n  width: 60rpx;\n  flex-shrink: 0;\n  justify-content: center;\n  font-weight: 600;\n}\n\n.col-name {\n  width: 220rpx;\n  flex-shrink: 0;\n  font-weight: 600;\n  justify-content: flex-start;\n  text-align: left;\n  padding-left: 16rpx;\n  padding-right: 8rpx;\n}\n\n.col-spec {\n  width: 160rpx;\n  flex-shrink: 0;\n  font-size: 24rpx;\n  color: #333;\n  justify-content: center;\n  text-align: center;\n}\n\n.col-quantity {\n  width: 100rpx;\n  flex-shrink: 0;\n  justify-content: center;\n  font-weight: 600;\n  font-size: 26rpx;\n}\n\n.col-usage {\n  flex: 1;\n  min-width: 240rpx;\n  font-size: 24rpx;\n  line-height: 1.6;\n  justify-content: flex-start;\n  text-align: left;\n  padding-left: 16rpx;\n  padding-right: 16rpx;\n}\n\n.col-action {\n  width: 120rpx;\n  flex-shrink: 0;\n  justify-content: center;\n}\n\n// 删除按钮 - 医疗处方样式\n.delete-btn {\n  padding: 6rpx 12rpx;\n  background: #fff;\n  border: 1rpx solid #ff4d4f;\n  border-radius: 4rpx;\n  transition: all 0.2s;\n  cursor: pointer;\n  \n  &:active {\n    background: #fff1f0;\n    border-color: #cf1322;\n    transform: scale(0.95);\n  }\n  \n  .delete-text {\n    font-size: 22rpx;\n    color: #ff4d4f;\n    font-weight: 500;\n  }\n}\n\n// \"以下空白\"分隔线 - 医疗处方样式\n.prescription-blank-line {\n  text-align: center;\n  padding: 20rpx 0;\n  border-top: 1rpx dashed #999;\n  margin-top: 10rpx;\n  \n  .blank-text {\n    font-size: 24rpx;\n    color: #666;\n    letter-spacing: 4rpx;\n    font-weight: 400;\n  }\n}\n\n// 处方底部签名区 - 医疗处方样式\n.prescription-footer {\n  padding: 24rpx;\n  border: 2rpx solid #333;\n  border-top: none;\n  background: #fff;\n  \n  .footer-signature {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 20rpx;\n    \n    .footer-label {\n      font-size: 28rpx;\n      color: #000;\n      white-space: nowrap;\n      font-weight: 500;\n    }\n    \n    .footer-value {\n      font-size: 26rpx;\n      color: #000;\n      min-width: 180rpx;\n      border-bottom: 2rpx solid #333;\n      padding-bottom: 6rpx;\n      text-align: center;\n      font-weight: 500;\n    }\n    \n    .footer-date {\n      font-size: 26rpx;\n      color: #000;\n      font-weight: 500;\n    }\n  }\n}\n\n// 处方备注 - 医疗处方样式\n.prescription-note {\n  padding: 20rpx 24rpx;\n  background: #f5f5f5;\n  border: 2rpx solid #333;\n  border-top: none;\n  display: flex;\n  flex-direction: column;\n  gap: 10rpx;\n  \n  .note-text {\n    font-size: 24rpx;\n    color: #666;\n    text-align: left;\n    line-height: 1.8;\n    font-weight: 400;\n  }\n}\n\n// 库存不足警告样式\n.quantity-warning {\n  margin-top: 12rpx;\n  padding: 12rpx 16rpx;\n  background: #fff5f5;\n  border-radius: 8rpx;\n  border: 1rpx solid #fca5a5;\n  display: flex;\n  align-items: center;\n  gap: 8rpx;\n  \n  .warning-text {\n    font-size: 24rpx;\n    color: #dc2626;\n    flex: 1;\n  }\n}\n\n.drug-info {\n  margin-top: 16rpx;\n  padding: 16rpx;\n  background: #f6ffed;\n  border-radius: 12rpx;\n  font-size: 24rpx;\n  color: #52c41a;\n\n  .spec,\n  .stock {\n    display: block;\n    margin-bottom: 8rpx;\n  }\n}\n\n.quantity-input {\n  display: flex;\n  align-items: center;\n\n  input {\n    flex: 1;\n    height: 80rpx;  // 统一高度\n    line-height: 1.6;  // 统一行高\n  }\n\n  .unit {\n    margin-left: 16rpx;\n    font-size: 26rpx;  // 统一字号\n    color: #666;\n    font-weight: 500;\n  }\n}\n\n.batch-info {\n  padding: 24rpx;\n  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n  border-radius: 16rpx;\n  border: 2rpx solid #7dd3fc;\n  box-shadow: 0 2rpx 8rpx rgba(14, 165, 233, 0.1);\n  margin-top: 20rpx;\n\n  .batch-item {\n    display: flex;\n    align-items: center;\n    margin-bottom: 14rpx;\n    font-size: 24rpx;\n    \n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    .label {\n      color: #64748b;\n      font-weight: 600;\n      font-size: 24rpx;\n      margin-right: 10rpx;\n    }\n    \n    text {\n      color: #334155;\n      font-size: 24rpx;\n      font-weight: 500;\n    }\n\n    .warning {\n      color: #dc2626;\n      margin-left: 8rpx;\n      font-weight: bold;\n    }\n  }\n}\n\n// 库存不足警告\n.quantity-warning {\n  display: flex;\n  align-items: center;\n  padding: 16rpx 20rpx;\n  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);\n  border-radius: 12rpx;\n  border: 2rpx solid #fca5a5;\n  margin-top: 16rpx;\n  animation: shake 0.5s ease-in-out;\n  .warning-text {\n    color: #dc2626;\n    font-size: 26rpx;\n    font-weight: 600;\n    flex: 1;\n  }\n}\n\n@keyframes shake {\n  0%, 100% { transform: translateX(0); }\n  25% { transform: translateX(-10rpx); }\n  75% { transform: translateX(10rpx); }\n}\n\n// 签名提示\n.signature-info {\n  margin-bottom: 20rpx;\n}\n\n.signature-tip {\n  display: flex;\n  align-items: center;\n  padding: 16rpx 20rpx;\n  background: #e6f7ff;\n  border-left: 4rpx solid #1890ff;\n  border-radius: 8rpx;\n  \n  .tip-text {\n    font-size: 24rpx;\n    color: #0050b3;\n    line-height: 1.6;\n  }\n}\n\n// 签名区域\n.signature-section {\n  padding: 20rpx 0;\n\n  .signature-preview {\n    position: relative;\n    border: 3rpx solid #52c41a;\n    border-radius: 16rpx;\n    padding: 24rpx;\n    background: #f6ffed;\n    \n    .signature-label {\n      font-size: 26rpx;\n      color: #52c41a;\n      font-weight: bold;\n      margin-bottom: 16rpx;\n      display: block;\n    }\n\n    .signature-image {\n      width: 100%;\n      height: 200rpx;\n      border: 2rpx dashed #b7eb8f;\n      border-radius: 12rpx;\n      background: white;\n    }\n    \n    .signature-time {\n      margin-top: 12rpx;\n      font-size: 24rpx;\n      color: #666;\n      text-align: center;\n    }\n\n    .re-sign-btn {\n      margin-top: 20rpx;\n      width: 100%;\n      padding: 20rpx;\n      background: white;\n      color: #1890ff;\n      border: 2rpx solid #1890ff;\n      border-radius: 12rpx;\n      font-size: 28rpx;\n      font-weight: 500;\n    }\n  }\n\n  .sign-btn {\n    width: 100%;\n    padding: 50rpx;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    border-radius: 16rpx;\n    font-size: 34rpx;\n    font-weight: bold;\n    border: 4rpx dashed rgba(255, 255, 255, 0.5);\n    box-shadow: 0 8rpx 24rpx rgba(102, 126, 234, 0.4);\n    \n    &:active {\n      transform: scale(0.98);\n      box-shadow: 0 4rpx 16rpx rgba(102, 126, 234, 0.5);\n    }\n  }\n}\n\n.submit-section {\n  position: fixed;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  display: flex;\n  gap: 20rpx;\n  padding: 16rpx 24rpx 34rpx;\n  background: #FFFFF0;\n  box-shadow: 0 -4rpx 16rpx rgba(15, 23, 42, 0.22);\n  border-top-left-radius: 24rpx;\n  border-top-right-radius: 24rpx;\n  z-index: 100;\n}\n\n.submit-section button {\n  flex: 1;\n  padding: 28rpx;\n  border-radius: 12rpx;\n  font-size: 32rpx;\n  font-weight: bold;\n}\n\n.submit-section .cancel-btn {\n  background: linear-gradient(135deg, #22c1c3 0%, #2a91e9 100%);\n  border: none;\n  color: #ffffff;\n  border-radius: 999rpx;\n}\n\n.submit-section .submit-btn {\n  background: linear-gradient(135deg, #22c1c3 0%, #2a91e9 100%);\n  border: none;\n  color: #ffffff;\n  border-radius: 999rpx;\n}\n\n.continue-option {\n  padding: 20rpx 24rpx 40rpx;\n  margin: 0 auto 8rpx;\n  max-width: 702rpx;\n}\n\n.continue-card {\n  display: flex;\n  align-items: center;\n  padding: 24rpx 28rpx;\n  background: white;\n  border-radius: 16rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n  transition: all 0.3s;\n\n  &:active {\n    transform: scale(0.98);\n    box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.15);\n  }\n}\n\n.continue-checkbox {\n  margin-right: 20rpx;\n  \n  checkbox {\n    transform: scale(1.3);\n  }\n}\n\n.continue-text {\n  flex: 1;\n}\n\n.continue-title {\n  font-size: 30rpx;\n  font-weight: bold;\n  color: #1890ff;\n  margin-bottom: 8rpx;\n}\n\n.continue-desc {\n  font-size: 24rpx;\n  color: #999;\n  line-height: 1.5;\n}\n\n/* 园区选择悬浮窗样式 */\n.location-modal-overlay {\n  position: fixed;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(15, 23, 42, 0.55);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999;\n}\n\n.location-modal {\n  width: 86%;\n  max-width: 720rpx;\n  background: #FFFFF0;\n  border-radius: 28rpx;\n  padding: 30rpx 30rpx 26rpx;\n  box-shadow:\n    0 1rpx 0 rgba(255,255,255,0.9) inset,\n    0 -1rpx 0 rgba(15,23,42,0.06) inset,\n    0 18rpx 40rpx rgba(15, 23, 42, 0.35);\n  border: 1rpx solid rgba(148, 163, 184, 0.35);\n}\n\n\n.modal-title {\n  font-size: 32rpx;\n  font-weight: 600;\n  text-align: center;\n  margin: 10rpx 0 6rpx;\n}\n\n.modal-subtitle {\n  font-size: 24rpx;\n  text-align: center;\n  color: #6b7280;\n  margin-bottom: 26rpx;\n  line-height: 1.5;\n}\n\n.modal-location-buttons {\n  display: flex;\n  gap: 20rpx;\n  margin-bottom: 20rpx;\n}\n\n.modal-loc-btn {\n  flex: 1;\n  padding: 20rpx 0;\n  border-radius: 999rpx;\n  border: 2rpx solid #d1d5db;\n  font-size: 28rpx;\n  background: #ffffff;\n  color: #374151;\n  box-shadow: 0 2rpx 6rpx rgba(15, 23, 42, 0.08);\n}\n\n.modal-loc-btn.active {\n  background: linear-gradient(135deg, #2563eb 0%, #4f46e5 100%);\n  border-color: #2563eb;\n  color: #ffffff;\n  box-shadow: 0 6rpx 14rpx rgba(37, 99, 235, 0.45);\n}\n\n.modal-hint-text {\n  font-size: 22rpx;\n  color: #6b7280;\n  line-height: 1.5;\n  margin-bottom: 18rpx;\n}\n\n.modal-row {\n  display: flex;\n  align-items: center;\n  margin-bottom: 22rpx;\n  font-size: 26rpx;\n  color: #4b5563;\n}\n\n.modal-checkbox-text {\n  margin-left: 12rpx;\n}\n\n.modal-close-btn {\n  width: 100%;\n  padding: 18rpx 0;\n  border-radius: 999rpx;\n  border: 1rpx solid #d1d5db;\n  background: #f9fafb;\n  color: #4b5563;\n  font-size: 28rpx;\n}\n\n/* ==================== 新版处方样式（符合医疗规范） ==================== */\n\n// 医院信息头部\n.prescription-hospital-header {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 24rpx 20rpx;\n  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n  border-bottom: 3rpx solid #000;\n  gap: 16rpx;\n  \n  .hospital-logo {\n    font-size: 48rpx;\n  }\n  \n  .hospital-info {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    \n    .hospital-name {\n      font-size: 36rpx;\n      font-weight: bold;\n      color: #000;\n      letter-spacing: 2rpx;\n      margin-bottom: 4rpx;\n    }\n    \n    .hospital-subtitle {\n      font-size: 20rpx;\n      color: #666;\n      letter-spacing: 1rpx;\n    }\n  }\n}\n\n// 处方标题区域\n.prescription-title-section {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20rpx;\n  background: #fff;\n  border-bottom: 2rpx solid #000;\n  gap: 16rpx;\n  \n  .prescription-main-title {\n    font-size: 40rpx;\n    font-weight: bold;\n    color: #000;\n    letter-spacing: 8rpx;\n  }\n  \n  .prescription-type-badge {\n    padding: 6rpx 16rpx;\n    background: #fef3c7;\n    border: 2rpx solid #f59e0b;\n    border-radius: 6rpx;\n    font-size: 22rpx;\n    color: #92400e;\n    font-weight: 600;\n  }\n}\n\n// 处方元信息（编号、日期）\n.prescription-meta-info {\n  display: flex;\n  justify-content: space-between;\n  padding: 16rpx 24rpx;\n  background: #fafafa;\n  border-bottom: 2rpx solid #000;\n  \n  .meta-item {\n    display: flex;\n    align-items: center;\n    \n    .meta-label {\n      font-size: 24rpx;\n      color: #666;\n      font-weight: 500;\n    }\n    \n    .meta-value {\n      font-size: 24rpx;\n      color: #000;\n      font-weight: 600;\n      margin-left: 4rpx;\n    }\n  }\n}\n\n// 患者信息卡片\n.prescription-patient-card {\n  padding: 20rpx 24rpx;\n  background: #fff;\n  border-bottom: 2rpx solid #000;\n  \n  .patient-info-row {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 20rpx;\n    margin-bottom: 12rpx;\n    \n    .patient-info-item {\n      display: flex;\n      align-items: center;\n      \n      .info-label {\n        font-size: 26rpx;\n        color: #666;\n        margin-right: 8rpx;\n      }\n      \n      .info-value {\n        font-size: 26rpx;\n        color: #000;\n        font-weight: 600;\n        min-width: 60rpx;\n      }\n    }\n  }\n  \n  .patient-diagnosis-row {\n    display: flex;\n    align-items: flex-start;\n    \n    .diagnosis-label {\n      font-size: 26rpx;\n      color: #666;\n      white-space: nowrap;\n      margin-right: 8rpx;\n    }\n    \n    .diagnosis-value {\n      font-size: 26rpx;\n      color: #000;\n      font-weight: 600;\n      flex: 1;\n      line-height: 1.5;\n    }\n  }\n}\n\n// 处方主体区域\n.prescription-body {\n  padding: 24rpx;\n  background: #fff;\n  min-height: 300rpx;\n  \n  .prescription-drugs-header {\n    display: flex;\n    align-items: center;\n    gap: 12rpx;\n    margin-bottom: 20rpx;\n    padding-bottom: 12rpx;\n    border-bottom: 2rpx dashed #ccc;\n    \n    .rp-symbol {\n      font-size: 40rpx;\n      font-weight: bold;\n      color: #000;\n      font-family: 'Times New Roman', serif;\n    }\n    \n    .drugs-title {\n      font-size: 28rpx;\n      font-weight: 600;\n      color: #333;\n    }\n  }\n  \n  .prescription-drugs-list {\n    .drugs-empty {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      padding: 60rpx 20rpx;\n      \n      .empty-icon {\n        font-size: 64rpx;\n        margin-bottom: 16rpx;\n      }\n      \n      .empty-text {\n        font-size: 28rpx;\n        color: #999;\n        margin-bottom: 8rpx;\n      }\n      \n      .empty-hint {\n        font-size: 24rpx;\n        color: #bbb;\n        text-align: center;\n        line-height: 1.5;\n      }\n    }\n    \n    .prescription-drug-item {\n      padding: 16rpx 0;\n      border-bottom: 1rpx solid #e5e5e5;\n      \n      &:last-child {\n        border-bottom: none;\n      }\n      \n      .drug-item-header {\n        display: flex;\n        align-items: flex-start;\n        gap: 12rpx;\n        margin-bottom: 8rpx;\n        \n        .drug-number {\n          font-size: 26rpx;\n          font-weight: 600;\n          color: #666;\n          min-width: 40rpx;\n        }\n        \n        .drug-main-info {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          gap: 4rpx;\n          \n          .drug-name {\n            font-size: 28rpx;\n            font-weight: 600;\n            color: #000;\n            line-height: 1.4;\n          }\n          \n          .drug-spec {\n            font-size: 24rpx;\n            color: #666;\n          }\n        }\n        \n        .drug-quantity {\n          display: flex;\n          align-items: baseline;\n          gap: 4rpx;\n          white-space: nowrap;\n          \n          .quantity-value {\n            font-size: 28rpx;\n            font-weight: bold;\n            color: #000;\n          }\n          \n          .quantity-unit {\n            font-size: 24rpx;\n            color: #666;\n          }\n        }\n        \n        .drug-actions {\n          display: flex;\n          align-items: center;\n          \n          .action-btn {\n            padding: 6rpx 12rpx;\n            border-radius: 6rpx;\n            font-size: 22rpx;\n            font-weight: 500;\n            transition: all 0.2s;\n            \n            &.delete {\n              color: #ef4444;\n              background: #fef2f2;\n              border: 1rpx solid #fca5a5;\n              \n              &:active {\n                background: #fee2e2;\n                transform: scale(0.95);\n              }\n            }\n          }\n        }\n      }\n      \n      .drug-item-usage {\n        display: flex;\n        align-items: flex-start;\n        padding-left: 52rpx;\n        \n        .usage-label {\n          font-size: 24rpx;\n          color: #666;\n          white-space: nowrap;\n          margin-right: 8rpx;\n        }\n        \n        .usage-text {\n          font-size: 24rpx;\n          color: #333;\n          line-height: 1.5;\n          flex: 1;\n        }\n      }\n    }\n  }\n  \n  .prescription-summary {\n    margin-top: 20rpx;\n    padding-top: 16rpx;\n    border-top: 2rpx dashed #ccc;\n    text-align: right;\n    \n    .summary-text {\n      font-size: 26rpx;\n      color: #666;\n      font-weight: 500;\n    }\n  }\n}\n\n// 处方底部签名区\n.prescription-footer-section {\n  padding: 24rpx;\n  background: #fafafa;\n  border-top: 2rpx solid #000;\n  \n  .footer-row {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 16rpx;\n    \n    &:last-child {\n      margin-bottom: 0;\n    }\n    \n    .footer-item {\n      flex: 1;\n      display: flex;\n      align-items: center;\n      \n      &:not(:last-child) {\n        margin-right: 20rpx;\n      }\n      \n      .footer-label {\n        font-size: 24rpx;\n        color: #333;\n        white-space: nowrap;\n        margin-right: 8rpx;\n      }\n      \n      .signature-placeholder {\n        flex: 1;\n        border-bottom: 2rpx solid #000;\n        padding-bottom: 4rpx;\n        text-align: center;\n        \n        .placeholder-text {\n          font-size: 22rpx;\n          color: #999;\n        }\n      }\n    }\n  }\n}\n\n// 处方说明\n.prescription-notes {\n  padding: 20rpx 24rpx;\n  background: #fffbeb;\n  border-top: 2rpx dashed #f59e0b;\n  \n  .note-title {\n    font-size: 26rpx;\n    font-weight: 600;\n    color: #92400e;\n    margin-bottom: 12rpx;\n  }\n  \n  .note-item {\n    display: flex;\n    align-items: flex-start;\n    margin-bottom: 8rpx;\n    \n    &:last-child {\n      margin-bottom: 0;\n    }\n    \n    .note-bullet {\n      font-size: 24rpx;\n      color: #f59e0b;\n      margin-right: 8rpx;\n      line-height: 1.5;\n    }\n    \n    .note-text {\n      font-size: 24rpx;\n      color: #78350f;\n      line-height: 1.5;\n      flex: 1;\n    }\n  }\n}\n\n// 用药使用区域样式\n.drug-usage-section {\n  margin-top: 20rpx;\n  padding: 20rpx;\n  background: #f9fafb;\n  border-radius: 12rpx;\n  border: 2rpx solid #e5e7eb;\n}\n\n.quantity-input-group {\n  display: flex;\n  align-items: center;\n  gap: 8rpx;\n  \n  input {\n    flex: 1;\n  }\n  \n  .unit-text {\n    font-size: 26rpx;\n    color: #666;\n    font-weight: 600;\n    white-space: nowrap;\n  }\n}\n\n.dosage-input-group {\n  display: flex;\n  align-items: center;\n  \n  input {\n    flex: 1;\n  }\n}\n\n.picker-input {\n  width: 100%;\n  height: 80rpx;\n  line-height: 80rpx;\n  padding: 0 24rpx;\n  border: 2rpx solid #e0e0e0;\n  border-radius: 12rpx;\n  font-size: 28rpx;\n  background: #fafafa;\n  color: #333;\n  box-sizing: border-box;\n}\n\n.add-prescription-action {\n  margin-top: 20rpx;\n  display: flex;\n  justify-content: center;\n  \n  .add-prescription-btn {\n    padding: 16rpx 40rpx;\n    background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    border-radius: 12rpx;\n    display: flex;\n    align-items: center;\n    gap: 8rpx;\n    box-shadow: 0 4rpx 12rpx rgba(16, 185, 129, 0.3);\n    transition: all 0.3s;\n    \n    &:active {\n      transform: scale(0.95);\n      box-shadow: 0 2rpx 8rpx rgba(16, 185, 129, 0.2);\n    }\n    \n    .btn-icon {\n      font-size: 32rpx;\n      color: #fff;\n      font-weight: bold;\n    }\n    \n    .btn-text {\n      font-size: 28rpx;\n      color: #fff;\n      font-weight: 600;\n    }\n  }\n}\n\n// 药品快速信息展示\n.drug-quick-info {\n  margin-top: 16rpx;\n  padding: 16rpx 20rpx;\n  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);\n  border-radius: 12rpx;\n  border: 2rpx solid #86efac;\n  \n  .drug-info-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    gap: 16rpx;\n    \n    .drug-name-section {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      gap: 4rpx;\n      \n      .drug-name-text {\n        font-size: 28rpx;\n        font-weight: 600;\n        color: #065f46;\n      }\n      \n      .drug-spec-text {\n        font-size: 24rpx;\n        color: #047857;\n      }\n    }\n    \n    .drug-stock-section {\n      display: flex;\n      align-items: baseline;\n      white-space: nowrap;\n      \n      .stock-label {\n        font-size: 24rpx;\n        color: #047857;\n        margin-right: 4rpx;\n      }\n      \n      .stock-value {\n        font-size: 28rpx;\n        font-weight: bold;\n        color: #10b981;\n        \n        &.stock-warning {\n          color: #dc2626;\n        }\n      }\n    }\n  }\n}\n\n</style>","import mod from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./add.vue?vue&type=style&index=0&id=0904e2e0&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./add.vue?vue&type=style&index=0&id=0904e2e0&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1766565979883\n      var cssReload = require(\"D:/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}