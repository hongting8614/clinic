{"version":3,"sources":["uni-app:///main.js","webpack:///D:/AK-PMS/pages-sub/out/add.vue?bfda","webpack:///D:/AK-PMS/pages-sub/out/add.vue?1fdb","webpack:///D:/AK-PMS/pages-sub/out/add.vue?584b","webpack:///D:/AK-PMS/pages-sub/out/add.vue?b312","uni-app:///pages-sub/out/add.vue","webpack:///D:/AK-PMS/pages-sub/out/add.vue?a576","webpack:///D:/AK-PMS/pages-sub/out/add.vue?f76b"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","components","Signature","BatchSelector","data","recordNo","currentTime","currentDate","dispenser","remark","locationIndex","locations","label","value","currentLocation","requestAreaIndex","requestAreas","currentRequestArea","drugList","dispenserSign","onLoad","uni","onShow","console","selectedDrugs","drugId","drugCode","drugName","specification","spec","unit","manufacturer","isHighValue","isEmergency","batch","batchId","expireDate","productionDate","stockQuantity","price","quantity","conversionRate","minUnit","isNearExpiry","methods","initPage","onLocationChange","onRequestAreaChange","goSelectDrug","url","buildSpecification","deleteDrug","onBatchSelect","item","validateQuantity","title","icon","onQuantityInput","clearTimeout","onQuantityBlur","duration","clearAllocation","autoAllocateBatch","name","action","requiredQuantity","location","result","allocations","allocation","daysToExpire","content","success","saveDraft","userInfo","locationName","fromLocation","fromLocationName","toLocation","toLocationName","requestLocation","requestLocationName","dispenserId","dispenserSignTime","items","status","setTimeout","submitReview"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,YAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA4H;AAC5H;AACuD;AACL;AACsC;;;AAGxF;AAC0K;AAC1K,gBAAgB,uLAAU;AAC1B,EAAE,yEAAM;AACR,EAAE,0FAAM;AACR,EAAE,mGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,8FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,iMAEN;AACP,KAAK;AACL;AACA,aAAa,kLAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC1FA;AAAA;AAAA;AAAA;AAAmoB,CAAgB,+pBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;AC4PvpB;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA,eAEA;EACAC;IACAC;IACAC;EACA;EAEAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC,YACA;QAAAC;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACA;MACAC;QAAAF;QAAAC;MAAA;MACAE;MACAC,eACA;QAAAJ;QAAAC;MAAA;MACA;MACA;QAAAD;QAAAC;MAAA,GACA;QAAAD;QAAAC;MAAA,EACA;MACAI;QAAAL;QAAAC;MAAA;MACAK;MACAC;IACA;EACA;EAEAC;IACA;IACA;IACA;IACAC;IACA;IACA;EACA;EAEAC;IAAA;IACA;IACA;IAEA;MACAC;MACAA;;MAEA;MACAC;QACAD;QACAA;QACAA;QACAA;QAEA;UAAA;QAAA;QACA;UACA;UACA;UACAA;UAEA;YACAE;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACA;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACA;YACAC;YACAC;YACAC;UACA;QACA;MACA;MAEApB;;MAEA;MACAF;IACA;EACA;EAEAuB;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;IACA;IAEAC;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA3B;QAAA4B;MAAA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;IACA;IAEA;IACAC;MACA;MACA;MACAC;MACAA;MACAA;MACAA;MACAA;MACAA;IACA;IAEA;IACAC;MACA;MACA;MACA;MACA;MACA;QACAD;QACA;MACA;MACA;QACAA;QACAhC;UACAkC;UACAC;QACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;MACA;;MAEA;MACA;QACAC;MACA;;MAEA;MACA;QACA;UACA;UACA;QACA;MACA;IACA;IAEA;IACAC;MACA;;MAEA;MACA;MACA;QACAtC;UACAkC;UACAC;UACAI;QACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MAEA;MACA;MACA;MAEAxC;QACAkC;QACAC;QACAI;MACA;IACA;IAEA;IACAE;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAT;gBAAA,IAEAA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAAA,MAGA;kBAAA;kBAAA;gBAAA;gBACA;gBA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","file":"pages-sub/out/add.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages-sub/out/add.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./add.vue?vue&type=template&id=017bfd6a&scoped=true&\"\nvar renderjs\nimport script from \"./add.vue?vue&type=script&lang=js&\"\nexport * from \"./add.vue?vue&type=script&lang=js&\"\nimport style0 from \"./add.vue?vue&type=style&index=0&id=017bfd6a&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"017bfd6a\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages-sub/out/add.vue\"\nexport default component.exports","export * from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./add.vue?vue&type=template&id=017bfd6a&scoped=true&\"","var components\ntry {\n  components = {\n    batchSelector: function () {\n      return import(\n        /* webpackChunkName: \"components/batch-selector/index\" */ \"@/components/batch-selector/index.vue\"\n      )\n    },\n    signature: function () {\n      return import(\n        /* webpackChunkName: \"components/signature/index\" */ \"@/components/signature/index.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. æ’æŸ¥ç»„ä»¶åç§°æ‹¼å†™æ˜¯å¦æ­£ç¡®\")\n    console.error(\n      \"2. æ’æŸ¥ç»„ä»¶æ˜¯å¦ç¬¦åˆ easycom è§„èŒƒï¼Œæ–‡æ¡£ï¼šhttps://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. è‹¥ç»„ä»¶ä¸ç¬¦åˆ easycom è§„èŒƒï¼Œéœ€æ‰‹åŠ¨å¼•å…¥ï¼Œå¹¶åœ¨ components ä¸­æ³¨å†Œè¯¥ç»„ä»¶\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.drugList.length\n  var l0 = _vm.__map(_vm.drugList, function (item, index) {\n    var $orig = _vm.__get_orig(item)\n    var g1 = item.batchAllocation && item.batchAllocation.length > 0\n    var a0 =\n      !g1 && !item.batch\n        ? {\n            name: item.drugName,\n            specification: item.specification || item.spec,\n            unit: item.unit,\n          }\n        : null\n    var g2 =\n      item.quantity && item.conversionRate && item.conversionRate > 1\n        ? (item.quantity * item.conversionRate).toFixed(2)\n        : null\n    var g3 =\n      item.isHighValue && item.quantity && item.price\n        ? (item.quantity * item.price).toFixed(2)\n        : null\n    return {\n      $orig: $orig,\n      g1: g1,\n      a0: a0,\n      g2: g2,\n      g3: g3,\n    }\n  })\n  var g4 = _vm.drugList.length\n  if (!_vm._isMounted) {\n    _vm.e0 = function (batch, index) {\n      var args = [],\n        len = arguments.length - 2\n      while (len-- > 0) args[len] = arguments[len + 2]\n\n      var _temp = args[args.length - 1].currentTarget.dataset,\n        _temp2 = _temp.eventParams || _temp[\"event-params\"],\n        index = _temp2.index\n      var _temp, _temp2\n      return _vm.onBatchSelect(index, batch)\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        l0: l0,\n        g4: g4,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./add.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./add.vue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"page\">\n\t\t<!-- é¡µé¢å¤´éƒ¨ï¼šä¸å…¥åº“å•ä¿æŒä¸€è‡´é£æ ¼ -->\n\t\t<view class=\"page-header\">\n\t\t\t<view class=\"header-content\">\n\t\t\t\t<text class=\"header-title\">è¯æå‡ºåº“</text>\n\t\t\t\t<text class=\"header-subtitle\">å‡ºåº“æ—¥æœŸï¼š{{ currentDate }}</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ï¼šå¯¹é½å…¥åº“å•å¸ƒå±€ -->\n\t\t<view class=\"info-card\">\n\t\t\t<view class=\"info-row\">\n\t\t\t\t<view class=\"info-item\">\n\t\t\t\t\t<text class=\"label\">å•å·ï¼š</text>\n\t\t\t\t\t<text class=\"value\">{{ recordNo || 'è‡ªåŠ¨ç”Ÿæˆ' }}</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"info-item\">\n\t\t\t\t\t<text class=\"label\">å‘æ”¾äººï¼š</text>\n\t\t\t\t\t<text class=\"value\">{{ dispenser }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"info-row\">\n\t\t\t\t<view class=\"info-item\">\n\t\t\t\t\t<text class=\"label\">å‡ºåº“åˆ°å›­åŒºï¼š<text class=\"required\">*</text></text>\n\t\t\t\t\t<picker \n\t\t\t\t\t\t:range=\"locations\" \n\t\t\t\t\t\trange-key=\"label\"\n\t\t\t\t\t\t:value=\"locationIndex\"\n\t\t\t\t\t\t@change=\"onLocationChange\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<view class=\"picker-input\">\n\t\t\t\t\t\t\t<text class=\"value\">{{ currentLocation.label }}</text>\n\t\t\t\t\t\t\t<text class=\"picker-arrow\">â€º</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</picker>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"info-item\">\n\t\t\t\t\t<text class=\"label\">å›­åŒºè¯·é¢†ï¼š</text>\n\t\t\t\t\t<picker \n\t\t\t\t\t\t:range=\"requestAreas\" \n\t\t\t\t\t\trange-key=\"label\"\n\t\t\t\t\t\t:value=\"requestAreaIndex\"\n\t\t\t\t\t\t@change=\"onRequestAreaChange\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<view class=\"picker-input\">\n\t\t\t\t\t\t\t<text class=\"value\">{{ currentRequestArea.label }}</text>\n\t\t\t\t\t\t\t<text class=\"picker-arrow\">â€º</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</picker>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"info-row\">\n\t\t\t\t<view class=\"info-item full\">\n\t\t\t\t\t<text class=\"label\">å¤‡æ³¨</text>\n\t\t\t\t\t<input \n\t\t\t\t\t\tclass=\"input-value\" \n\t\t\t\t\t\tv-model=\"remark\" \n\t\t\t\t\t\tplaceholder=\"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰\"\n\t\t\t\t\t\tplaceholder-class=\"placeholder\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- è¯ææ˜ç»† -->\n\t\t<view class=\"form-section\">\n\t\t\t<view class=\"section-title\">\n\t\t\t\tè¯ææ˜ç»†\n\t\t\t\t<text class=\"section-count\">({{ drugList.length }}ç§)</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- æ·»åŠ è¯ææŒ‰é’® -->\n\t\t\t<view class=\"action-buttons\">\n\t\t\t\t<view class=\"add-drug-btn\" @click=\"goSelectDrug\">\n\t\t\t\t\t<text class=\"btn-icon\">â•</text>\n\t\t\t\t\t<text class=\"btn-text\">æ·»åŠ è¯æ</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- è¯æåˆ—è¡¨ -->\n\t\t\t<view class=\"drug-list\">\n\t\t\t\t<view \n\t\t\t\t\tv-for=\"(item, index) in drugList\" \n\t\t\t\t\t:key=\"index\" \n\t\t\t\t\tclass=\"drug-item\"\n\t\t\t\t>\n\t\t\t\t\t<!-- è¯æå¤´éƒ¨ -->\n\t\t\t\t\t<view class=\"drug-header\">\n\t\t\t\t\t\t<view class=\"drug-title-row\">\n\t\t\t\t\t\t\t<view class=\"drug-badges\">\n\t\t\t\t\t\t\t\t<text v-if=\"item.isHighValue\" class=\"badge high-value\">é«˜å€¼</text>\n\t\t\t\t\t\t\t\t<text v-if=\"item.isEmergency\" class=\"badge emergency\">æ€¥æ•‘</text>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<text class=\"drug-name\">{{ item.drugName }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"drug-delete\" @click=\"deleteDrug(index)\">åˆ é™¤</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- è§„æ ¼å•ä½åˆå¹¶ä¸€è¡Œ -->\n\t\t\t\t\t<view class=\"drug-spec-row\">\n\t\t\t\t\t\t<text class=\"spec-icon\">ğŸ“¦</text>\n\t\t\t\t\t\t<text class=\"spec-text\">{{ item.specification || item.spec }}</text>\n\t\t\t\t\t\t<text class=\"spec-divider\">Â·</text>\n\t\t\t\t\t\t<text class=\"unit-text\">å•ä½: {{ item.unit }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- è¯æä»£ç ï¼ˆå¦‚æœ‰ï¼‰ -->\n\t\t\t\t\t<view v-if=\"item.drugCode\" class=\"drug-code-row\">\n\t\t\t\t\t\t<text class=\"code-icon\">ğŸ·ï¸</text>\n\t\t\t\t\t\t<text class=\"code-text\">ä»£ç : {{ item.drugCode }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- è°ƒè¯•ä¿¡æ¯ï¼šæ˜¾ç¤ºdrugId -->\n\t\t\t\t\t<view class=\"drug-debug-row\" style=\"font-size: 20rpx; color: #999; padding: 5rpx 0;\">\n\t\t\t\t\t\t<text>ğŸ” drugId: {{ item.drugId || 'âŒ æ— ' }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<view class=\"drug-input-section\">\n\t\t\t\t\t<!-- FIFOè‡ªåŠ¨åˆ†é…ç»“æœå±•ç¤º -->\n\t\t\t\t\t<view v-if=\"item.batchAllocation && item.batchAllocation.length > 0\" class=\"batch-allocation-result\">\n\t\t\t\t\t\t<view class=\"allocation-header\">\n\t\t\t\t\t\t\t<text class=\"allocation-title\">âœ… å·²è‡ªåŠ¨åˆ†é… {{ item.batchCount }} ä¸ªæ‰¹æ¬¡</text>\n\t\t\t\t\t\t\t<text v-if=\"item.hasNearExpiry\" class=\"near-expiry-tag\">âš ï¸ å«è¿‘æ•ˆæœŸ</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view class=\"allocation-list\">\n\t\t\t\t\t\t\t<view \n\t\t\t\t\t\t\t\tv-for=\"(batch, bIndex) in item.batchAllocation\" \n\t\t\t\t\t\t\t\t:key=\"bIndex\"\n\t\t\t\t\t\t\t\tclass=\"allocation-item\"\n\t\t\t\t\t\t\t\t:class=\"{ 'near-expiry': batch.isNearExpiry }\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<view class=\"allocation-row\">\n\t\t\t\t\t\t\t\t\t<text class=\"allocation-label\">æ‰¹å·ï¼š</text>\n\t\t\t\t\t\t\t\t\t<text class=\"allocation-value\">{{ batch.batch }}</text>\n\t\t\t\t\t\t\t\t\t<text class=\"allocation-quantity\">{{ batch.quantity }} {{ item.unit }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<view class=\"allocation-row\">\n\t\t\t\t\t\t\t\t\t<text class=\"allocation-label\">æœ‰æ•ˆæœŸï¼š</text>\n\t\t\t\t\t\t\t\t\t<text class=\"allocation-value\" :class=\"{ 'text-warning': batch.isNearExpiry }\">\n\t\t\t\t\t\t\t\t\t\t{{ batch.expireDate }}\n\t\t\t\t\t\t\t\t\t\t<text v-if=\"batch.isNearExpiry\" class=\"days-hint\">({{ batch.daysToExpire }}å¤©ååˆ°æœŸ)</text>\n\t\t\t\t\t\t\t\t\t</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<view class=\"allocation-actions\">\n\t\t\t\t\t\t\t<text class=\"action-btn\" @tap=\"clearAllocation(index)\">ğŸ”„ é‡æ–°åˆ†é…</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- æ‰¹æ¬¡ä¿¡æ¯ï¼ˆæ‰‹åŠ¨é€‰ä¸­å•ä¸ªæ‰¹æ¬¡ï¼‰ -->\n\t\t\t\t\t<view v-else-if=\"item.batch\" class=\"batch-info-selected\">\n\t\t\t\t\t\t<view class=\"batch-info-row\">\n\t\t\t\t\t\t\t<text class=\"batch-label\">æ‰¹å·ï¼š</text>\n\t\t\t\t\t\t\t<text class=\"batch-value\">{{ item.batch }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"batch-info-row\">\n\t\t\t\t\t\t\t<text class=\"batch-label\">â° æœ‰æ•ˆæœŸï¼š</text>\n\t\t\t\t\t\t\t<text class=\"batch-value\">{{ item.expireDate }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"batch-info-row\">\n\t\t\t\t\t\t\t<text class=\"batch-label\">ğŸ“Š åº“å­˜ï¼š</text>\n\t\t\t\t\t\t\t<text class=\"batch-value\">{{ item.stockQuantity }} {{ item.unit }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- æ‰¹æ¬¡é€‰æ‹©æŒ‰é’®ï¼ˆæœªé€‰ä¸­æ—¶æ˜¾ç¤ºï¼‰ -->\n\t\t\t\t\t<view v-else class=\"batch-select-row\">\n\t\t\t\t\t\t<batch-selector\n\t\t\t\t\t\t\tbutton-text=\"ğŸ” æ‰‹åŠ¨é€‰æ‹©æ‰¹æ¬¡\"\n\t\t\t\t\t\t\tbutton-type=\"info\"\n\t\t\t\t\t\t\tbutton-size=\"small\"\n\t\t\t\t\t\t\t:drug-id=\"item.drugId\"\n\t\t\t\t\t\t\t:drug-info=\"{ name: item.drugName, specification: item.specification || item.spec, unit: item.unit }\"\n\t\t\t\t\t\t\t:show-location-filter=\"false\"\n\t\t\t\t\t\t\t:default-location=\"'drug_storage'\"\n\t\t\t\t\t\t\t:enable-f-i-f-o=\"true\"\n\t\t\t\t\t\t\t@select=\"(batch) => onBatchSelect(index, batch)\"\n\t\t\t\t\t\t></batch-selector>\n\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- å‡ºåº“æ•°é‡ -->\n\t\t\t\t\t\t<view class=\"input-row\">\n\t\t\t\t\t\t\t<text class=\"input-label\">å‡ºåº“æ•°é‡ *</text>\n\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\tclass=\"input-field\" \n\t\t\t\t\t\t\t\tv-model.number=\"item.quantity\" \n\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t:placeholder=\"`æœ€å¤š${item.stockQuantity || 0}`\"\n\t\t\t\t\t\t\t\t@blur=\"onQuantityBlur(index)\"\n\t\t\t\t\t\t\t\t@input=\"onQuantityInput(index)\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<text class=\"input-unit\">{{ item.unit }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- è‡ªåŠ¨åˆ†é…æŒ‰é’® -->\n\t\t\t\t\t\t<view v-if=\"item.quantity && item.quantity > 0 && !item.batchAllocation\" class=\"auto-allocate-hint\">\n\t\t\t\t\t\t\t<text class=\"hint-icon\">ğŸ’¡</text>\n\t\t\t\t\t\t\t<text class=\"hint-text\">è¾“å…¥æ•°é‡åè‡ªåŠ¨FIFOåˆ†é…æ‰¹æ¬¡</text>\n\t\t\t\t\t\t\t<text class=\"action-link\" @tap=\"autoAllocateBatch(index)\">ç«‹å³åˆ†é…</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\n\t\t\t\t\t<!-- å•ä½è½¬æ¢æç¤º -->\n\t\t\t\t\t<view v-if=\"item.quantity && item.conversionRate && item.conversionRate > 1\" class=\"convert-hint\">\n\t\t\t\t\t\t<text class=\"hint-icon\">ğŸ”„</text>\n\t\t\t\t\t\t<text class=\"hint-text\">\n\t\t\t\t\t\t\tå°†è½¬æ¢ä¸º {{ (item.quantity * item.conversionRate).toFixed(2) }} {{ item.minUnit }} å­˜å…¥{{ currentLocation.label }}\n\t\t\t\t\t\t</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<!-- é«˜å€¼è¯æé‡‘é¢æç¤º -->\n\t\t\t\t\t\t<view v-if=\"item.isHighValue && item.quantity && item.price\" class=\"amount-hint\">\n\t\t\t\t\t\t\t<text class=\"amount-label\">é‡‘é¢ï¼š</text>\n\t\t\t\t\t\t\t<text class=\"amount-value\">Â¥{{ (item.quantity * item.price).toFixed(2) }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- ç©ºçŠ¶æ€ -->\n\t\t\t\t<view v-if=\"drugList.length === 0\" class=\"empty-hint\">\n\t\t\t<text>ğŸ’Š æš‚æ— è¯æï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ </text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- ç­¾ååŒºåŸŸ -->\n\t\t<view class=\"form-section\">\n\t\t\t<view class=\"section-title\">å‘æ”¾äººç­¾å *</view>\n\t\t\t<signature \n\t\t\t\tv-model=\"dispenserSign\"\n\t\t\t\ttitle=\"å‘æ”¾äººç­¾å\"\n\t\t\t></signature>\n\t\t</view>\n\t\t\n\t\t<!-- åº•éƒ¨æŒ‰é’® -->\n\t\t<view class=\"bottom-actions\">\n\t\t\t<view class=\"bottom-btn btn-secondary\" @click=\"saveDraft\">\n\t\t\t\t<text>ä¿å­˜è‰ç¨¿</text>\n\t\t\t</view>\n\t\t\t<view class=\"bottom-btn btn-primary\" @click=\"submitReview\">\n\t\t\t\t<text>æäº¤å¤æ ¸</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport Signature from '@/components/signature/index.vue'\nimport BatchSelector from '@/components/batch-selector/index.vue'\nimport Common from '@/utils/common.js'\n\nexport default {\n\tcomponents: {\n\t\tSignature,\n\t\tBatchSelector\n\t},\n\t\n\tdata() {\n\t\treturn {\n\t\t\trecordNo: '',\n\t\t\tcurrentTime: '',\n\t\t\tcurrentDate: '',\n\t\t\tdispenser: '',\n\t\t\tremark: '',\n\t\t\tlocationIndex: 0,\n\t\t\tlocations: [\n\t\t\t\t{ label: 'é™†å›­', value: 'land_park' },\n\t\t\t\t{ label: 'æ°´å›­', value: 'water_park' }\n\t\t\t],\n\t\t\t// å½“å‰é€‰æ‹©çš„å‘å¾€å›­åŒºï¼ˆç›®çš„åœ°ï¼‰ï¼Œæ€»åº“å›ºå®šä¸º drug_storage\n\t\t\tcurrentLocation: { label: 'é™†å›­', value: 'land_park' },\n\t\t\trequestAreaIndex: 0,\n\t\t\trequestAreas: [\n\t\t\t\t{ label: 'ä¸é€‰æ‹©', value: '' },\n\t\t\t\t// ä»¥ä¸‹ç¤ºä¾‹è¡¨ç¤ºé¡¹ç›®/éƒ¨é—¨ç­‰éåŒ»åŠ¡å•ä½ï¼Œè¯·æ ¹æ®å®é™…éœ€è¦è°ƒæ•´\n\t\t\t\t{ label: 'é™†å›­é¡¹ç›®ç»„', value: 'land_project' },\n\t\t\t\t{ label: 'æ°´å›­é¡¹ç›®ç»„', value: 'water_project' }\n\t\t\t],\n\t\t\tcurrentRequestArea: { label: 'ä¸é€‰æ‹©', value: '' },\n\t\t\tdrugList: [],\n\t\t\tdispenserSign: ''\n\t\t}\n\t},\n\t\n\tonLoad(options) {\n\t\t// æ¸…ç©ºä¸Šæ¬¡çš„è¯ææ˜ç»†\n\t\tthis.drugList = []\n\t\t// æ¸…ç©ºå¯èƒ½æ®‹ç•™çš„ç¼“å­˜\n\t\tuni.removeStorageSync('selectedDrugsForOut')\n\t\t// åˆå§‹åŒ–é¡µé¢\n\t\tthis.initPage()\n\t},\n\t\n\tonShow() {\n\t\t// ä»é€‰æ‹©è¯æé¡µé¢è¿”å›æ—¶ï¼Œæ¥æ”¶é€‰ä¸­çš„è¯ææ•°æ®\n\t\tconst selectedDrugs = uni.getStorageSync('selectedDrugsForOut')\n\t\t\n\t\tif (selectedDrugs && selectedDrugs.length > 0) {\n\t\t\tconsole.log('=== å‡ºåº“é¡µé¢ onShow ===')\n\t\t\tconsole.log('ä»ç¼“å­˜è¯»å–çš„è¯ææ•°é‡:', selectedDrugs.length)\n\t\t\t\n\t\t\t// åˆå¹¶æ–°é€‰æ‹©çš„è¯æï¼Œé¿å…é‡å¤\n\t\t\tselectedDrugs.forEach((drug, index) => {\n\t\t\t\tconsole.log(`è¯æ${index + 1}:`, drug.name || drug.drugName)\n\t\t\t\tconsole.log(`  - drug._id: ${drug._id}`)\n\t\t\t\tconsole.log(`  - drug.drugId: ${drug.drugId || 'æ— '}`)\n\t\t\t\tconsole.log(`  - å®Œæ•´æ•°æ®:`, drug)\n\t\t\t\n\t\t\tconst exists = this.drugList.find(item => item.drugId === drug.drugId)\n\t\t\tif (!exists) {\n\t\t\t\t// åˆå§‹åŒ–è¯ææ•°æ®ç»“æ„\n\t\t\t\tconst finalDrugId = drug._id || drug.drugId\n\t\t\t\tconsole.log(`  - æœ€ç»ˆä½¿ç”¨çš„ drugId: ${finalDrugId}`)\n\t\t\t\t\n\t\t\t\tthis.drugList.push({\n\t\t\t\t\tdrugId: finalDrugId,\n\t\t\t\t\tdrugCode: drug.drugCode || '',\n\t\t\t\t\tdrugName: drug.name || drug.drugName,\n\t\t\t\t\tspecification: drug.specification || drug.spec || '',\n\t\t\t\t\tspec: drug.specification || drug.spec || '',\n\t\t\t\t\tunit: drug.unit || '',\n\t\t\t\t\tmanufacturer: drug.manufacturer || '',\n\t\t\t\t\tisHighValue: drug.isHighValue || false,\n\t\t\t\t\tisEmergency: drug.isEmergency || false,\n\t\t\t\t\t// æ‰¹æ¬¡ç›¸å…³ä¿¡æ¯ï¼ˆä½¿ç”¨ä»é€‰æ‹©è¯æé¡µé¢ä¼ æ¥çš„æ•°æ®ï¼‰\n\t\t\t\t\tbatch: drug.batch || '',\n\t\t\t\t\tbatchId: drug.batchId || '',\n\t\t\t\t\texpireDate: drug.expireDate || '',\n\t\t\t\t\tproductionDate: drug.productionDate || '',\n\t\t\t\t\tstockQuantity: drug.stockQuantity || 0,\n\t\t\t\t\tprice: drug.price || 0,\n\t\t\t\t\tquantity: '',\n\t\t\t\t\t// å•ä½è½¬æ¢ä¿¡æ¯\n\t\t\t\t\tconversionRate: drug.conversionRate || 1,\n\t\t\t\t\tminUnit: drug.minUnit || drug.unit || '',\n\t\t\t\t\tisNearExpiry: drug.isNearExpiry || false\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t\t\n\t\tconsole.log('å½“å‰è¯æåˆ—è¡¨:', this.drugList)\n\t\t\n\t\t// æ¸…é™¤ç¼“å­˜\n\t\tuni.removeStorageSync('selectedDrugsForOut')\n\t}\n},\n\t\n\tmethods: {\n\t\tinitPage() {\n\t\t\t// ç”Ÿæˆå‡ºåº“å•å·\n\t\t\tthis.recordNo = Common.generateRecordNo('CK')\n\t\t\t// å½“å‰æ—¶é—´ä¸æ—¥æœŸ\n\t\t\tconst now = new Date()\n\t\t\tthis.currentTime = Common.formatDate(now, 'YYYY-MM-DD HH:mm')\n\t\t\tthis.currentDate = Common.formatDate(now, 'YYYY-MM-DD')\n\t\t\t// è·å–å½“å‰ç”¨æˆ·\n\t\t\tconst userInfo = uni.getStorageSync('userInfo')\n\t\t\tthis.dispenser = userInfo?.name || 'æœªç™»å½•'\n\t\t},\n\t\t\n\t\tonLocationChange(e) {\n\t\t\tthis.locationIndex = e.detail.value\n\t\t\tthis.currentLocation = this.locations[this.locationIndex]\n\t\t},\n\t\t\n\t\tonRequestAreaChange(e) {\n\t\t\tthis.requestAreaIndex = e.detail.value\n\t\t\tthis.currentRequestArea = this.requestAreas[this.requestAreaIndex]\n\t\t},\n\t\t\n\t\t// é€‰æ‹©è¯æï¼ˆä¿æŒåŸæœ‰é€»è¾‘å ä½ï¼‰\n\t\tgoSelectDrug() {\n\t\t\t// è¿™é‡Œå¤ç”¨åŸæ¥è·³è½¬é€‰æ‹©è¯æé¡µé¢çš„é€»è¾‘\n\t\t\tuni.navigateTo({ url: '/pages-sub/out/select-drug' })\n\t\t},\n\t\t// æ„å»ºå¸¦åŒ…è£…å•ä½çš„å®Œæ•´è§„æ ¼ï¼Œä¾›äº‘å‡½æ•°è§£æã€‚å¦‚ï¼š10mlÃ—9æ”¯/ç›’\n\t\tbuildSpecification(drug) {\n\t\t\tconst base = drug.specification || drug.spec || ''\n\t\t\tif (!base) return ''\n\t\t\tif (base.includes('/') || base.includes('ï¼')) return base\n\t\t\tif (drug.unit) return `${base}/${drug.unit}`\n\t\t\treturn base\n\t\t},\n\t\t\n\t\t// åˆ é™¤ä¸€è¡Œè¯æ\n\t\tdeleteDrug(index) {\n\t\t\tthis.drugList.splice(index, 1)\n\t\t},\n\t\t\n\t\t// æ‰¹æ¬¡é€‰æ‹©å›è°ƒ\n\t\tonBatchSelect(index, batch) {\n\t\t\tconst item = this.drugList[index]\n\t\t\tif (!item) return\n\t\t\titem.batch = batch.batch\n\t\t\titem.batchId = batch._id\n\t\t\titem.expireDate = batch.expireDate\n\t\t\titem.stockQuantity = batch.quantity\n\t\t\titem.price = batch.price || item.price || 0\n\t\t\titem.isNearExpiry = batch.isNearExpiry || false\n\t\t},\n\t\t\n\t\t// æ ¡éªŒæ•°é‡ä¸èƒ½è¶…è¿‡åº“å­˜\n\t\tvalidateQuantity(index) {\n\t\t\tconst item = this.drugList[index]\n\t\t\tif (!item) return\n\t\t\tconst max = Number(item.stockQuantity || 0)\n\t\t\tconst val = Number(item.quantity || 0)\n\t\t\tif (val <= 0 || !Number.isFinite(val)) {\n\t\t\t\titem.quantity = ''\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (val > max) {\n\t\t\t\titem.quantity = max\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: 'æ•°é‡ä¸èƒ½è¶…è¿‡åº“å­˜',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t\n\t\t// æ•°é‡è¾“å…¥äº‹ä»¶ï¼ˆå®æ—¶è§¦å‘ï¼‰\n\t\tonQuantityInput(index) {\n\t\t\tconst item = this.drugList[index]\n\t\t\tif (!item) return\n\t\t\t\n\t\t\t// æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨\n\t\t\tif (this.quantityInputTimer) {\n\t\t\t\tclearTimeout(this.quantityInputTimer)\n\t\t\t}\n\t\t\t\n\t\t\t// é˜²æŠ–å¤„ç†ï¼Œ500msåè‡ªåŠ¨è§¦å‘åˆ†é…\n\t\t\tthis.quantityInputTimer = setTimeout(() => {\n\t\t\t\tif (item.quantity && item.quantity > 0 && !item.batchAllocation) {\n\t\t\t\t\t// è‡ªåŠ¨è§¦å‘FIFOåˆ†é…\n\t\t\t\t\tthis.autoAllocateBatch(index)\n\t\t\t\t}\n\t\t\t}, 500)\n\t\t},\n\t\t\n\t\t// æ•°é‡å¤±ç„¦äº‹ä»¶\n\t\tonQuantityBlur(index) {\n\t\t\tthis.validateQuantity(index)\n\t\t\t\n\t\t\t// å¦‚æœè¿˜æ²¡æœ‰åˆ†é…æ‰¹æ¬¡ï¼Œæç¤ºç”¨æˆ·\n\t\t\tconst item = this.drugList[index]\n\t\t\tif (item && item.quantity > 0 && !item.batchAllocation && !item.batch) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: 'è¯·ç‚¹å‡»\"ç«‹å³åˆ†é…\"æŒ‰é’®åˆ†é…æ‰¹æ¬¡',\n\t\t\t\t\ticon: 'none',\n\t\t\t\t\tduration: 2000\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t\n\t\t// æ¸…é™¤åˆ†é…ç»“æœ\n\t\tclearAllocation(index) {\n\t\t\tconst item = this.drugList[index]\n\t\t\tif (!item) return\n\t\t\t\n\t\t\tthis.$set(item, 'batchAllocation', [])\n\t\t\tthis.$set(item, 'batchCount', 0)\n\t\t\tthis.$set(item, 'hasNearExpiry', false)\n\t\t\t\n\t\t\tuni.showToast({\n\t\t\t\ttitle: 'å·²æ¸…é™¤åˆ†é…ç»“æœ',\n\t\t\t\ticon: 'success',\n\t\t\t\tduration: 1000\n\t\t\t})\n\t\t},\n\t\t\n\t\t// FIFOè‡ªåŠ¨åˆ†é…æ‰¹æ¬¡ â­ ä½¿ç”¨æ—§æ–¹æ¡ˆï¼ˆæ€§èƒ½æ›´ä¼˜ï¼‰\n\t\tasync autoAllocateBatch(index) {\n\t\t\tconst item = this.drugList[index]\n\t\t\t\n\t\t\tif (!item) return\n\t\t\t\n\t\t\t// å¦‚æœæ•°é‡ä¸ºç©ºæˆ–æ— æ•ˆï¼Œæ¸…ç©ºåˆ†é…ç»“æœ\n\t\t\tif (!item.quantity || item.quantity <= 0) {\n\t\t\t\tthis.$set(item, 'batchAllocation', [])\n\t\t\t\tthis.$set(item, 'batchCount', 0)\n\t\t\t\tthis.$set(item, 'hasNearExpiry', false)\n\t\t\t\treturn\n\t\t\t}\n\t\t\t\n\t\t\t// æ£€æŸ¥drugId\n\t\t\tif (!item.drugId) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: 'è¯æIDç¼ºå¤±ï¼Œæ— æ³•åˆ†é…æ‰¹æ¬¡',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\t\t\t\n\t\t\tuni.showLoading({ title: 'åˆ†é…æ‰¹æ¬¡ä¸­...' })\n\t\t\t\n\t\t\ttry {\n\t\t\t\t// â­ ä½¿ç”¨æ—§æ–¹æ¡ˆï¼šallocateBatchesFIFOï¼ˆæ€§èƒ½æµ‹è¯•ç»“æœï¼š536ms vs 829msï¼‰\n\t\t\t\tconst result = await wx.cloud.callFunction({\n\t\t\t\t\tname: 'stockManage',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taction: 'allocateBatchesFIFO',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tdrugId: item.drugId,\n\t\t\t\t\t\t\trequiredQuantity: item.quantity,\n\t\t\t\t\t\t\tlocation: 'drug_storage'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\tconsole.log('ğŸ”´ æ—§æ–¹æ¡ˆåˆ†é…ç»“æœ:', result.result)\n\t\t\t\t\n\t\t\t\tif (result.result.success) {\n\t\t\t\t\tconst allocations = result.result.data.allocations || []\n\t\t\t\t\t\n\t\t\t\t\tif (allocations.length === 0) {\n\t\t\t\t\t\tthrow new Error('åº“å­˜ä¸è¶³ï¼Œæ— æ³•åˆ†é…æ‰¹æ¬¡')\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// è½¬æ¢ä¸ºå‰ç«¯æ˜¾ç¤ºæ ¼å¼\n\t\t\t\t\tconst allocation = allocations.map(alloc => ({\n\t\t\t\t\t\tbatchId: alloc.batchId,\n\t\t\t\t\t\tbatch: alloc.batch,\n\t\t\t\t\t\texpireDate: alloc.expireDate,\n\t\t\t\t\t\tquantity: alloc.quantity,\n\t\t\t\t\t\tstockQuantity: alloc.stockQuantity,\n\t\t\t\t\t\tisNearExpiry: alloc.isNearExpiry || false,\n\t\t\t\t\t\tdaysToExpire: alloc.daysToExpiry || alloc.daysToExpire\n\t\t\t\t\t}))\n\t\t\t\t\t\n\t\t\t\t\t// ä¿å­˜åˆ†é…ç»“æœ\n\t\t\t\t\tthis.$set(item, 'batchAllocation', allocation)\n\t\t\t\t\tthis.$set(item, 'batchCount', allocation.length)\n\t\t\t\t\tthis.$set(item, 'hasNearExpiry', allocation.some(b => b.isNearExpiry))\n\t\t\t\t\t\n\t\t\t\t\t// è¿‘æ•ˆæœŸæç¤º\n\t\t\t\t\tif (item.hasNearExpiry) {\n\t\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\t\ttitle: 'è¿‘æ•ˆæœŸæç¤º',\n\t\t\t\t\t\t\tcontent: `${item.drugName} åŒ…å«è¿‘æ•ˆæœŸæ‰¹æ¬¡ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ`,\n\t\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\t\tif (!res.confirm) {\n\t\t\t\t\t\t\t\t\titem.quantity = ''\n\t\t\t\t\t\t\t\t\tthis.$set(item, 'batchAllocation', [])\n\t\t\t\t\t\t\t\t\tthis.$set(item, 'batchCount', 0)\n\t\t\t\t\t\t\t\t\tthis.$set(item, 'hasNearExpiry', false)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: `âœ… å·²åˆ†é… ${allocation.length} ä¸ªæ‰¹æ¬¡`,\n\t\t\t\t\t\t\ticon: 'success',\n\t\t\t\t\t\t\tduration: 1500\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(result.result.message || 'åˆ†é…å¤±è´¥')\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('æ‰¹æ¬¡åˆ†é…å¤±è´¥:', err)\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: err.message || 'åˆ†é…å¤±è´¥',\n\t\t\t\t\ticon: 'none',\n\t\t\t\t\tduration: 2000\n\t\t\t\t})\n\t\t\t\tthis.$set(item, 'batchAllocation', [])\n\t\t\t} finally {\n\t\t\t\tuni.hideLoading()\n\t\t\t}\n\t\t},\n\t\t\n\t\t// ä¿å­˜è‰ç¨¿\n\t\tasync saveDraft() {\n\t\t\tif (this.drugList.length === 0) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: 'è¯·å…ˆæ·»åŠ è¯æ',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\treturn\n\t\t\t}\n\t\t\t\n\t\t\tuni.showLoading({ title: 'ä¿å­˜ä¸­...' })\n\t\t\ttry {\n\t\t\t\tconst userInfo = uni.getStorageSync('userInfo')\n\t\t\t\tconst result = await this.$api.callFunction('outRecords', {\n\t\t\t\t\taction: 'create',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\trecordNo: this.recordNo,\n\t\t\t\t\t\t// æ€»åº“ä½ç½®å›ºå®šä¸º drug_storage\n\t\t\t\t\t\tlocation: 'drug_storage',\n\t\t\t\t\t\tlocationName: 'æ€»åº“',\n\t\t\t\t\t\tfromLocation: 'drug_storage',\n\t\t\t\t\t\tfromLocationName: 'æ€»åº“',\n\t\t\t\t\t\t// å‡ºåº“åˆ°çš„å›­åŒº/åº“ä½\n\t\t\t\t\t\ttoLocation: this.currentLocation.value,\n\t\t\t\t\t\ttoLocationName: this.currentLocation.label,\n\t\t\t\t\t\trequestLocation: this.currentRequestArea.value,\n\t\t\t\t\t\trequestLocationName: this.currentRequestArea.label,\n\t\t\t\t\t\tdispenser: this.dispenser,\n\t\t\t\t\t\tdispenserId: userInfo?._id || '',\n\t\t\t\t\t\tdispenserSign: '',\n\t\t\t\t\t\tdispenserSignTime: '',\n\t\t\t\t\t\tremark: this.remark,\n\t\t\t\t\t\titems: this.drugList.map(drug => ({\n\t\t\t\t\t\t\tdrugId: drug.drugId,\n\t\t\t\t\t\t\tdrugCode: drug.drugCode || '',\n\t\t\t\t\t\t\tdrugName: drug.drugName,\n\t\t\t\t\t\t\tspecification: this.buildSpecification(drug),\n\t\t\t\t\t\t\tunit: drug.unit,\n\t\t\t\t\t\t\tmanufacturer: drug.manufacturer,\n\t\t\t\t\t\t\tbatch: drug.batch,\n\t\t\t\t\t\t\tbatchId: drug.batchId,\n\t\t\t\t\t\t\texpireDate: drug.expireDate,\n\t\t\t\t\t\t\tquantity: drug.quantity,\n\t\t\t\t\t\t\tprice: drug.price || 0,\n\t\t\t\t\t\t\tisHighValue: drug.isHighValue || false,\n\t\t\t\t\t\t\tisEmergency: drug.isEmergency || false\n\t\t\t\t\t\t})),\n\t\t\t\t\t\tstatus: 'draft'\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tuni.hideLoading()\n\t\t\t\tif (result.success) {\n\t\t\t\t\tuni.showToast({ title: 'ä¿å­˜æˆåŠŸ', icon: 'success' })\n\t\t\t\t\tsetTimeout(() => { uni.navigateBack() }, 1500)\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(result.message || 'ä¿å­˜å¤±è´¥')\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('ä¿å­˜å¤±è´¥:', err)\n\t\t\t\tuni.hideLoading()\n\t\t\t\tuni.showToast({ title: err.message || 'ä¿å­˜å¤±è´¥', icon: 'none' })\n\t\t\t}\n\t\t},\n\t\t\n\t\t// æäº¤å¤æ ¸\n\t\tasync submitReview() {\n\t\t\tif (!this.dispenserSign) {\n\t\t\t\tuni.showToast({ title: 'è¯·å…ˆå®Œæˆå‘æ”¾äººç­¾å', icon: 'none' })\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (this.drugList.length === 0) {\n\t\t\t\tuni.showToast({ title: 'è¯·å…ˆæ·»åŠ è¯æ', icon: 'none' })\n\t\t\t\treturn\n\t\t\t}\n\t\t\t\n\t\t\tuni.showLoading({ title: 'æäº¤ä¸­...' })\n\t\t\ttry {\n\t\t\t\tconst userInfo = uni.getStorageSync('userInfo')\n\t\t\t\tconst result = await this.$api.callFunction('outRecords', {\n\t\t\t\t\taction: 'create',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\trecordNo: this.recordNo,\n\t\t\t\t\t\t// æ€»åº“ä½ç½®å›ºå®šä¸º drug_storage\n\t\t\t\t\t\tlocation: 'drug_storage',\n\t\t\t\t\t\tlocationName: 'æ€»åº“',\n\t\t\t\t\t\tfromLocation: 'drug_storage',\n\t\t\t\t\t\tfromLocationName: 'æ€»åº“',\n\t\t\t\t\t\t// å‡ºåº“åˆ°çš„å›­åŒº/åº“ä½\n\t\t\t\t\t\ttoLocation: this.currentLocation.value,\n\t\t\t\t\t\ttoLocationName: this.currentLocation.label,\n\t\t\t\t\t\trequestLocation: this.currentRequestArea.value,\n\t\t\t\t\t\trequestLocationName: this.currentRequestArea.label,\n\t\t\t\t\t\tdispenser: this.dispenser,\n\t\t\t\t\t\tdispenserId: userInfo?._id || '',\n\t\t\t\t\t\tdispenserSign: this.dispenserSign,\n\t\t\t\t\t\tdispenserSignTime: new Date(),\n\t\t\t\t\t\tremark: this.remark,\n\t\t\t\t\t\titems: this.drugList.map(drug => ({\n\t\t\t\t\t\t\tdrugId: drug.drugId,\n\t\t\t\t\t\t\tdrugCode: drug.drugCode || '',\n\t\t\t\t\t\t\tdrugName: drug.drugName,\n\t\t\t\t\t\t\tspecification: this.buildSpecification(drug),\n\t\t\t\t\t\t\tunit: drug.unit,\n\t\t\t\t\t\t\tmanufacturer: drug.manufacturer,\n\t\t\t\t\t\t\tbatch: drug.batch,\n\t\t\t\t\t\t\tbatchId: drug.batchId,\n\t\t\t\t\t\t\texpireDate: drug.expireDate,\n\t\t\t\t\t\t\tquantity: drug.quantity,\n\t\t\t\t\t\t\tprice: drug.price || 0,\n\t\t\t\t\t\t\tisHighValue: drug.isHighValue || false,\n\t\t\t\t\t\t\tisEmergency: drug.isEmergency || false\n\t\t\t\t\t\t})),\n\t\t\t\t\t\tstatus: 'pending_review'\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tuni.hideLoading()\n\t\t\t\tif (result.success) {\n\t\t\t\t\tuni.showToast({ title: 'æäº¤æˆåŠŸ', icon: 'success' })\n\t\t\t\t\tsetTimeout(() => { uni.navigateBack() }, 1500)\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(result.message || 'æäº¤å¤±è´¥')\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('æäº¤å¤±è´¥:', err)\n\t\t\t\tuni.hideLoading()\n\t\t\t\tuni.showToast({ title: err.message || 'æäº¤å¤±è´¥', icon: 'none' })\n\t\t\t}\n \t\t}\n\t}\n}\n\n</script>\n\n<style lang=\"scss\" scoped>\n\t.page {\n\tmin-height: 100vh;\n\t/* ä¸å…¥åº“æ–°å»ºé¡µä¸€è‡´çš„è“è‰²æ¸å˜èƒŒæ™¯ */\n\tbackground: linear-gradient(180deg, #00c9ff 0%, #00a0ff 35%, #e5e7eb 100%);\n\tpadding: 24rpx 24rpx 180rpx; // ä¸ºåº•éƒ¨å›ºå®šæŒ‰é’®ç•™å‡ºç©ºé—´\n}\n\n// é¡µé¢å¤´éƒ¨ï¼š702rpx è±¡ç‰™ç™½å¡ç‰‡\n.page-header {\n\tmax-width: 702rpx;\n\tmargin: 10rpx auto 8rpx;\n\tpadding: 30rpx 26rpx 26rpx;\n\tbackground: #FFFFF0;\n\tborder-radius: 22rpx;\n\tbox-shadow:\n\t\t0 1rpx 0 rgba(255, 255, 255, 0.9) inset,\n\t\t0 -1rpx 0 rgba(15, 23, 42, 0.06) inset,\n\t\t0 18rpx 40rpx rgba(15, 23, 42, 0.14);\n\t\n\t.header-content {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tgap: 8rpx;\n\t\t\n\t\t.header-title {\n\t\t\tfont-size: 40rpx;\n\t\t\tfont-weight: bold;\n\t\t\tcolor: #111827;\n\t\t}\n\t\t\n\t\t.header-subtitle {\n\t\t\tfont-size: 24rpx;\n\t\t\tcolor: #4b5563;\n\t\t}\n\t}\n}\n\n// åŸºæœ¬ä¿¡æ¯å¡ç‰‡ï¼šè±¡ç‰™ç™½å¡ç‰‡ï¼Œ702rpx è½¨é“\n.info-card {\n\tmax-width: 702rpx;\n\tmargin: 0 auto 8rpx;\n\tpadding: 26rpx 26rpx 24rpx;\n\tbackground: #FFFFF0;\n\tborder-radius: 22rpx;\n\tbox-shadow: 0 8rpx 20rpx rgba(15, 23, 42, 0.12);\n}\n\n// è¯ææ˜ç»†ä¸ç­¾åç­‰è¡¨å•æ¿å—\n.form-section {\n\tmax-width: 702rpx;\n\tmargin: 0 auto 8rpx;\n\tpadding: 26rpx 26rpx 24rpx;\n\tbackground-color: #FFFFF0;\n\tborder-radius: 22rpx;\n\tbox-shadow: 0 8rpx 20rpx rgba(15, 23, 42, 0.12);\n}\n\n.section-title {\n\tfont-size: 32rpx;\n\tfont-weight: bold;\n\tcolor: #111827;\n\tmargin-bottom: 25rpx;\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.section-count {\n\tfont-size: 26rpx;\n\tcolor: #999999;\n\tmargin-left: 10rpx;\n\tfont-weight: normal;\n}\n\n.form-item {\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 20rpx 0;\n\tborder-bottom: 1px solid #F8F8F8;\n}\n\n.form-item:last-child {\n\tborder-bottom: none;\n}\n\n.form-label {\n\tfont-size: 28rpx;\n\tcolor: #333333;\n\tflex: 1;\n}\n\n.form-value {\n\tfont-size: 28rpx;\n\tcolor: #333333;\n\tflex: 1;\n}\n\n.picker-input {\n\tfont-size: 28rpx;\n\tcolor: #333333;\n\tdisplay: inline-flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tbackground-color: #ffffff;\n\tborder-radius: 999rpx;\n\tpadding: 6rpx 20rpx;\n\tbox-shadow: 0 2rpx 6rpx rgba(0, 0, 0, 0.04);\n\tmax-width: 100%;\n}\n\n.picker-arrow {\n\tfont-size: 32rpx;\n\tcolor: #999999;\n}\n\n.action-buttons {\n\tdisplay: flex;\n\tgap: 15rpx;\n\tmargin-bottom: 25rpx;\n}\n\n.add-drug-btn {\n\tbackground: linear-gradient(135deg, #00c9ff 0%, #00a0ff 100%);\n\tcolor: #ffffff;\n\tpadding: 22rpx 40rpx;\n\tborder-radius: 999rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tgap: 12rpx;\n\tbox-shadow: 0 6rpx 16rpx rgba(0, 160, 255, 0.25);\n\t\n\t.btn-icon {\n\t\tfont-size: 32rpx;\n\t}\n\t\n\t.btn-text {\n\t\tfont-size: 28rpx;\n\t\tfont-weight: 500;\n\t}\n}\n\n.drug-list {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8rpx;\n}\n\n.drug-item {\n\tbackground-color: #FFFFF0;\n\tpadding: 25rpx;\n\tborder-radius: 18rpx;\n\tposition: relative;\n}\n\n.high-value-badge {\n\tposition: absolute;\n\ttop: -8rpx;\n\tright: 20rpx;\n\tbackground-color: #FF9800;\n\tcolor: #FFFFFF;\n\tfont-size: 20rpx;\n\tpadding: 4rpx 15rpx;\n\tborder-radius: 15rpx;\n\tz-index: 10;\n}\n\n.drug-header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: flex-start;\n\tmargin-bottom: 12rpx;\n}\n\n.drug-title-row {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 12rpx;\n\tflex: 1;\n}\n\n.drug-badges {\n\tdisplay: flex;\n\tgap: 8rpx;\n\tflex-shrink: 0;\n\t\n\t.badge {\n\t\tfont-size: 20rpx;\n\t\tpadding: 4rpx 12rpx;\n\t\tborder-radius: 8rpx;\n\t\tfont-weight: 500;\n\t\t\n\t\t&.high-value {\n\t\t\tbackground: #FFF3E0;\n\t\t\tcolor: #FF9800;\n\t\t}\n\t\t\n\t\t&.emergency {\n\t\t\tbackground: #FFEBEE;\n\t\t\tcolor: #F44336;\n\t\t}\n\t}\n}\n\n.drug-name {\n\tfont-size: 30rpx;\n\tfont-weight: bold;\n\tcolor: #333333;\n\tflex: 1;\n}\n\n.drug-delete {\n\tfont-size: 26rpx;\n\tcolor: #FF6B6B;\n\tpadding: 8rpx 15rpx;\n}\n\n// è§„æ ¼å•ä½åˆå¹¶è¡Œ\n.drug-spec-row {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8rpx;\n\tmargin-bottom: 10rpx;\n\tpadding: 10rpx 15rpx;\n\tbackground: #FFFFFF;\n\tborder-radius: 10rpx;\n\t\n\t.spec-icon {\n\t\tfont-size: 28rpx;\n\t}\n\t\n\t.spec-text {\n\t\tfont-size: 26rpx;\n\t\tcolor: #333333;\n\t\tfont-weight: 500;\n\t}\n\t\n\t.spec-divider {\n\t\tfont-size: 24rpx;\n\t\tcolor: #CCCCCC;\n\t\tmargin: 0 4rpx;\n\t}\n\t\n\t.unit-text {\n\t\tfont-size: 24rpx;\n\t\tcolor: #666666;\n\t}\n}\n\n// è¯æä»£ç è¡Œ\n.drug-code-row {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8rpx;\n\tmargin-bottom: 15rpx;\n\tpadding: 8rpx 15rpx;\n\tbackground: #F5F7FA;\n\tborder-radius: 8rpx;\n\t\n\t.code-icon {\n\t\tfont-size: 24rpx;\n\t}\n\t\n\t.code-text {\n\t\tfont-size: 24rpx;\n\t\tcolor: #666666;\n\t}\n}\n\n.drug-info {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8rpx;\n\tmargin-bottom: 20rpx;\n\tpadding-bottom: 20rpx;\n\tborder-bottom: 1px solid #E0E0E0;\n}\n\n.info-row {\n\tdisplay: flex;\n\tgap: 20rpx;\n\tmargin-bottom: 20rpx;\n\t\n\t&:last-child {\n\t\tmargin-bottom: 0;\n\t}\n\t\n\t.info-item {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 12rpx;\n\t\t\n\t\t&.full {\n\t\t\tflex: 1 1 100%;\n\t\t}\n\t\t\n\t\t.label {\n\t\t\tfont-size: 22rpx;\n\t\t\tcolor: #9ca3af;\n\t\t\tfont-weight: 400;\n\t\t}\n\t\t\n\t\t.value {\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor: #111827;\n\t\t\tfont-weight: 500;\n\t\t}\n\t\t\n\t\t.input-value {\n\t\t\tflex: 1;\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor: #323233;\n\t\t\tborder-radius: 999rpx;\n\t\t\tpadding: 10rpx 20rpx;\n\t\t\tbackground-color: #ffffff;\n\t\t\tbox-shadow: 0 2rpx 6rpx rgba(0, 0, 0, 0.04);\n\t\t\tborder: none;\n\t\t}\n\t}\n}\n\n.drug-input-section {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 20rpx;\n}\n\n.input-row {\n\tdisplay: flex;\n\talign-items: center;\n}\n\n.input-label {\n\tfont-size: 26rpx;\n\tcolor: #666666;\n\tmin-width: 160rpx;\n}\n\n.input-field {\n\tflex: 1;\n\tbackground-color: #FFFFFF;\n\tpadding: 15rpx 20rpx;\n\tborder-radius: 10rpx;\n\tfont-size: 26rpx;\n}\n\n.input-unit {\n\tfont-size: 24rpx;\n\tcolor: #999999;\n\tmargin-left: 10rpx;\n\tmin-width: 50rpx;\n}\n\n// æ‰¹æ¬¡é€‰æ‹©è¡Œ\n.batch-select-row {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8rpx;\n\tmargin-bottom: 15rpx;\n}\n\n.batch-quick-info {\n\tfont-size: 22rpx;\n\tcolor: #666;\n\tpadding-left: 10rpx;\n}\n\n// æ‰¹æ¬¡ä¿¡æ¯ç´§å‡‘æ˜¾ç¤ºï¼ˆæ—§æ ·å¼ï¼Œä¿ç•™ï¼‰\n.batch-info-compact {\n\tbackground: linear-gradient(135deg, #E8F5E9 0%, #F1F8F4 100%);\n\tpadding: 15rpx 20rpx;\n\tborder-radius: 12rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 10rpx;\n\tmargin-bottom: 15rpx;\n\t\n\t.batch-icon {\n\t\tfont-size: 24rpx;\n\t\tflex-shrink: 0;\n\t}\n\t\n\t.batch-text {\n\t\tfont-size: 24rpx;\n\t\tcolor: #333333;\n\t\tflex: 1;\n\t}\n}\n\n// å·²é€‰æ‰¹æ¬¡ä¿¡æ¯æ˜¾ç¤ºï¼ˆæ–°æ ·å¼ï¼‰\n.batch-info-selected {\n\tbackground: linear-gradient(135deg, #E3F2FD 0%, #F1F8FF 100%);\n\tpadding: 20rpx;\n\tborder-radius: 12rpx;\n\tmargin-bottom: 15rpx;\n\tborder-left: 4rpx solid #2196F3;\n}\n\n.batch-info-row {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin-bottom: 8rpx;\n\t\n\t&:last-child {\n\t\tmargin-bottom: 0;\n\t}\n}\n\n.batch-label {\n\tfont-size: 24rpx;\n\tcolor: #666;\n\tmin-width: 140rpx;\n}\n\n.batch-value {\n\tfont-size: 26rpx;\n\tcolor: #333;\n\tfont-weight: 500;\n}\n\n.text-warning {\n\tcolor: #FF9800 !important;\n\tfont-weight: bold;\n}\n\n// ä¿ç•™æ—§æ ·å¼ä»¥å…¼å®¹\n.batch-info-display {\n\tbackground-color: #E8F5E9;\n\tpadding: 15rpx 20rpx;\n\tborder-radius: 10rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8rpx;\n}\n\n.batch-detail-row {\n\tdisplay: flex;\n\tfont-size: 24rpx;\n}\n\n.batch-label {\n\tcolor: #666666;\n\tmin-width: 100rpx;\n}\n\n.batch-value {\n\tcolor: #333333;\n\tflex: 1;\n}\n\n// å•ä½è½¬æ¢æç¤º\n.convert-hint {\n\tbackground: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);\n\tpadding: 16rpx 20rpx;\n\tborder-radius: 12rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tmargin-top: 12rpx;\n\tborder-left: 4rpx solid #2196F3;\n\t\n\t.hint-icon {\n\t\tfont-size: 24rpx;\n\t\tmargin-right: 10rpx;\n\t}\n\t\n\t.hint-text {\n\t\tfont-size: 24rpx;\n\t\tcolor: #1976D2;\n\t\tline-height: 1.6;\n\t\tflex: 1;\n\t}\n}\n\n.amount-hint {\n\tbackground-color: #FFF3E0;\n\tpadding: 15rpx 20rpx;\n\tborder-radius: 10rpx;\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-top: 12rpx;\n}\n\n.amount-label {\n\tfont-size: 26rpx;\n\tcolor: #666666;\n}\n\n.amount-value {\n\tfont-size: 30rpx;\n\tfont-weight: bold;\n\tcolor: #FF9800;\n}\n\n.empty-hint {\n\ttext-align: center;\n\tpadding: 60rpx 0;\n\tfont-size: 26rpx;\n\tcolor: #999999;\n}\n\n.bottom-actions {\n\tposition: fixed;\n\tbottom: 0;\n\tleft: 0;\n\tright: 0;\n\tbackground-color: #FFFFFF;\n\tpadding: 20rpx 30rpx 26rpx;\n\tdisplay: flex;\n\tgap: 20rpx;\n\tbox-shadow: 0 -2rpx 14rpx rgba(15, 23, 42, 0.12);\n\tz-index: 100;\n}\n\n.bottom-btn {\n\tflex: 1;\n\tpadding: 24rpx;\n\tborder-radius: 999rpx;\n\ttext-align: center;\n\tfont-size: 28rpx;\n\tfont-weight: 500;\n\t\n\t&.btn-primary {\n\t\tbackground: linear-gradient(135deg, #00c9ff 0%, #00a0ff 100%);\n\t\tcolor: #ffffff;\n\t\tbox-shadow: 0 6rpx 16rpx rgba(0, 160, 255, 0.25);\n\t}\n\t\n\t&.btn-secondary {\n\t\tbackground: linear-gradient(135deg, #00c9ff 0%, #00a0ff 100%);\n\t\tcolor: #ffffff;\n\t\tborder: none;\n\t\tbox-shadow: 0 6rpx 16rpx rgba(0, 160, 255, 0.25);\n\t}\n}\n\n// FIFOæ‰¹æ¬¡åˆ†é…ç»“æœæ ·å¼ â­ æ–°å¢\n.batch-allocation-result {\n\tbackground: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);\n\tborder-radius: 12rpx;\n\tpadding: 20rpx;\n\tmargin-bottom: 15rpx;\n\tborder-left: 4rpx solid #0EA5E9;\n}\n\n.allocation-header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-bottom: 15rpx;\n\tpadding-bottom: 12rpx;\n\tborder-bottom: 1rpx solid #BAE6FD;\n}\n\n.allocation-title {\n\tfont-size: 26rpx;\n\tfont-weight: bold;\n\tcolor: #0369A1;\n\tflex: 1;\n}\n\n.near-expiry-tag {\n\tfont-size: 22rpx;\n\tcolor: #EA580C;\n\tbackground-color: #FFF7ED;\n\tpadding: 4rpx 12rpx;\n\tborder-radius: 12rpx;\n\tborder: 1rpx solid #FDBA74;\n}\n\n.allocation-list {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12rpx;\n\tmargin-bottom: 15rpx;\n}\n\n.allocation-item {\n\tbackground-color: #FFFFFF;\n\tborder-radius: 10rpx;\n\tpadding: 15rpx;\n\tborder: 1rpx solid #E0F2FE;\n\t\n\t&.near-expiry {\n\t\tbackground: linear-gradient(135deg, #FFF7ED 0%, #FFEDD5 100%);\n\t\tborder-color: #FED7AA;\n\t}\n}\n\n.allocation-row {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin-bottom: 8rpx;\n\tfont-size: 24rpx;\n\t\n\t&:last-child {\n\t\tmargin-bottom: 0;\n\t}\n}\n\n.allocation-label {\n\tcolor: #6B7280;\n\tmin-width: 100rpx;\n}\n\n.allocation-value {\n\tcolor: #111827;\n\tfont-weight: 500;\n\tflex: 1;\n\t\n\t&.text-warning {\n\t\tcolor: #EA580C;\n\t}\n}\n\n.allocation-quantity {\n\tfont-size: 26rpx;\n\tfont-weight: bold;\n\tcolor: #0369A1;\n\tbackground-color: #E0F2FE;\n\tpadding: 4rpx 12rpx;\n\tborder-radius: 8rpx;\n\tmargin-left: 10rpx;\n}\n\n.days-hint {\n\tfont-size: 20rpx;\n\tcolor: #DC2626;\n\tbackground-color: #FEE2E2;\n\tpadding: 2rpx 8rpx;\n\tborder-radius: 10rpx;\n\tmargin-left: 8rpx;\n}\n\n.allocation-actions {\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\tpadding-top: 12rpx;\n\tborder-top: 1rpx solid #E0F2FE;\n}\n\n.action-btn {\n\tfont-size: 24rpx;\n\tcolor: #0369A1;\n\tbackground-color: #FFFFFF;\n\tpadding: 8rpx 20rpx;\n\tborder-radius: 20rpx;\n\tborder: 1rpx solid #BAE6FD;\n}\n\n// è‡ªåŠ¨åˆ†é…æç¤º\n.auto-allocate-hint {\n\tdisplay: flex;\n\talign-items: center;\n\tbackground: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);\n\tpadding: 12rpx 16rpx;\n\tborder-radius: 8rpx;\n\tmargin-top: 12rpx;\n\tborder-left: 3rpx solid #F59E0B;\n\t\n\t.hint-icon {\n\t\tfont-size: 24rpx;\n\t\tmargin-right: 8rpx;\n\t}\n\t\n\t.hint-text {\n\t\tfont-size: 22rpx;\n\t\tcolor: #92400E;\n\t\tflex: 1;\n\t}\n\t\n\t.action-link {\n\t\tfont-size: 24rpx;\n\t\tcolor: #0369A1;\n\t\tfont-weight: bold;\n\t\tpadding: 4rpx 12rpx;\n\t\tbackground-color: #FFFFFF;\n\t\tborder-radius: 12rpx;\n\t\tmargin-left: 10rpx;\n\t}\n}\n\n.batch-allocation {\n\tmargin-top: 20rpx;\n\tbackground: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);\n\tborder-radius: 12rpx;\n\tpadding: 20rpx;\n\tborder-left: 4rpx solid #0EA5E9;\n}\n\n.allocation-title {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin-bottom: 15rpx;\n\tpadding-bottom: 12rpx;\n\tborder-bottom: 1rpx solid #BAE6FD;\n\t\n\t.title-icon {\n\t\tfont-size: 28rpx;\n\t\tmargin-right: 8rpx;\n\t}\n\t\n\t.title-text {\n\t\tfont-size: 26rpx;\n\t\tfont-weight: bold;\n\t\tcolor: #0369A1;\n\t\tflex: 1;\n\t}\n\t\n\t.batch-count {\n\t\tfont-size: 22rpx;\n\t\tcolor: #0284C7;\n\t\tbackground-color: #FFFFFF;\n\t\tpadding: 4rpx 12rpx;\n\t\tborder-radius: 20rpx;\n\t}\n}\n\n.allocation-item {\n\tbackground-color: #FFFFFF;\n\tborder-radius: 10rpx;\n\tpadding: 15rpx;\n\tmargin-bottom: 12rpx;\n\tborder: 1rpx solid #E0F2FE;\n\t\n\t&:last-child {\n\t\tmargin-bottom: 0;\n\t}\n\t\n\t&.near-expiry {\n\t\tbackground: linear-gradient(135deg, #FFF7ED 0%, #FFEDD5 100%);\n\t\tborder-color: #FED7AA;\n\t}\n}\n\n.alloc-header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-bottom: 10rpx;\n\tpadding-bottom: 8rpx;\n\tborder-bottom: 1rpx dashed #E5E7EB;\n}\n\n.alloc-batch-label {\n\tfont-size: 24rpx;\n\tfont-weight: bold;\n\tcolor: #0369A1;\n}\n\n.expiry-badge {\n\tfont-size: 20rpx;\n\tcolor: #EA580C;\n\tbackground-color: #FFF7ED;\n\tpadding: 4rpx 10rpx;\n\tborder-radius: 12rpx;\n\tborder: 1rpx solid #FDBA74;\n}\n\n.alloc-row {\n\tdisplay: flex;\n\talign-items: center;\n\tmargin-bottom: 6rpx;\n\tfont-size: 24rpx;\n\t\n\t&:last-child {\n\t\tmargin-bottom: 0;\n\t}\n}\n\n.alloc-label {\n\tcolor: #6B7280;\n\tmin-width: 100rpx;\n}\n\n.alloc-value {\n\tcolor: #111827;\n\tfont-weight: 500;\n\tflex: 1;\n\t\n\t&.text-warning {\n\t\tcolor: #EA580C;\n\t\tfont-weight: bold;\n\t}\n}\n\n.alloc-stock {\n\tfont-size: 22rpx;\n\tcolor: #9CA3AF;\n\tmargin-left: 8rpx;\n}\n\n.days-badge {\n\tfont-size: 20rpx;\n\tcolor: #DC2626;\n\tbackground-color: #FEE2E2;\n\tpadding: 2rpx 8rpx;\n\tborder-radius: 10rpx;\n\tmargin-left: 8rpx;\n}\n\n.near-expiry-tip {\n\tdisplay: flex;\n\talign-items: center;\n\tbackground: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);\n\tpadding: 12rpx 16rpx;\n\tborder-radius: 8rpx;\n\tmargin-top: 12rpx;\n\tborder-left: 3rpx solid #F59E0B;\n\t\n\t.tip-icon {\n\t\tfont-size: 24rpx;\n\t\tmargin-right: 8rpx;\n\t}\n\t\n\t.tip-text {\n\t\tfont-size: 22rpx;\n\t\tcolor: #92400E;\n\t\tflex: 1;\n\t}\n}\n</style>\n\n","import mod from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./add.vue?vue&type=style&index=0&id=017bfd6a&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./add.vue?vue&type=style&index=0&id=017bfd6a&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1767327913742\n      var cssReload = require(\"D:/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}