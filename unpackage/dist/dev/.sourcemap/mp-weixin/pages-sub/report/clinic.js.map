{"version":3,"sources":["uni-app:///main.js","webpack:///D:/AK-PMS/pages-sub/report/clinic.vue?2040","webpack:///D:/AK-PMS/pages-sub/report/clinic.vue?482a","webpack:///D:/AK-PMS/pages-sub/report/clinic.vue?bc34","webpack:///D:/AK-PMS/pages-sub/report/clinic.vue?f338","uni-app:///pages-sub/report/clinic.vue","webpack:///D:/AK-PMS/pages-sub/report/clinic.vue?9082","webpack:///D:/AK-PMS/pages-sub/report/clinic.vue?c21a"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","name","data","loading","records","filters","startDate","endDate","location","locationOptions","locationIndex","userInfo","computed","reportTitle","land_park","water_park","currentLocationLabel","onLoad","methods","initDefaultDate","onStartDateChange","onEndDateChange","onLocationChange","resetFilters","fetchRecords","payload","patient","page","pageSize","useClinicRecords","action","res","list","r","doctorName","console","uni","title","icon","openExportOptions","itemList","success","buildExportPayload","printUser","exportExcel","mask","fileList","urlRes","fileUrl","exportPDF","filename","parts","downloadAndSaveLocal","fs","url","tempFilePath","filePath","fileType","showMenu","fail","content","showCancel","confirmText","formatDateTime","str","d","renderDrugInfo"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+H;AAC/H;AAC0D;AACL;AACsC;;;AAG3F;AAC0K;AAC1K,gBAAgB,uLAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,6FAAM;AACR,EAAE,sGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,iGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AAAsoB,CAAgB,kqBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCqI1pB;EACAC;EACAC;IACA;MACAC;MACAC;MACAC;QACAC;QACAC;QACAN;QACAO;MACA;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACAC;MACA;QACAC;QACAC;MACA;MACA;MACA;QACA;MACA;MACA;IACA;IACAC;MACA;IACA;EACA;EACAC;IACA;IACA;EACA;EACAC;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;MACA;MACA,kDACA,wDACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBAAA;gBAEAC;kBACAjB;kBACAF;kBACAC;kBACAmB;kBACAC;kBACAC;kBACAC;gBACA;gBAAA;gBAAA,OACAjC;kBACAK;kBACAC;oBACA4B;oBACA5B;kBACA;gBACA;cAAA;gBANA6B;gBAOAC;gBACA;kBAAA;kBAAA,uCACAC;oBACAC;kBAAA;gBAAA,CACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAC;gBACAC;kBAAAC;kBAAAC;gBAAA;cAAA;gBAAA;gBAEA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAC;MAAA;MACA;QACAH;UAAAC;UAAAC;QAAA;QACA;MACA;MACAF;QACAI;QACAC;UACA;YACA;UACA;YACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACA;QACApC;QACAC;QACAN;QACAO;QACAmC;MACA;IACA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAR;kBAAAC;kBAAAQ;gBAAA;gBACApB;gBAAA;gBAAA,OACA;kBACAK;kBACA5B;gBACA;cAAA;gBAHA6B;gBAIAK;gBAAA,MACAL;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA,OACAnC;kBAAAkD;gBAAA;cAAA;gBAAAC;gBACAC;gBACA;kBACA;gBACA;kBACAZ;oBAAAC;oBAAAC;kBAAA;gBACA;gBAAA;gBAAA;cAAA;gBAEAF;kBAAAC;kBAAAC;gBAAA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAF;gBACAD;gBACAC;kBAAAC;kBAAAC;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAW;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAb;kBAAAC;kBAAAQ;gBAAA;gBACApB;gBAAA;gBAAA,OACA;kBACAK;kBACA5B;gBACA;cAAA;gBAHA6B;gBAIAK;gBAAA,MACAL;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA,OACAnC;kBAAAkD;gBAAA;cAAA;gBAAAC;gBACAC;gBACAE;gBACA;kBACAC;kBACAD;gBACA;gBACA;kBACA;gBACA;kBACAd;oBAAAC;oBAAAC;kBAAA;gBACA;gBAAA;gBAAA;cAAA;gBAEAF;kBAAAC;kBAAAC;gBAAA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAF;gBACAD;gBACAC;kBAAAC;kBAAAC;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACAc;MACA;MACA;MACA;MACA;QACAC;MACA;MACAjB;QACAkB;QACAb;UACA;YACAY;cACAE;cACAC;cACAf;gBACA;gBACA;gBACA;gBACA7C;kBACA4D;kBACAC;kBACAC;kBACAC;oBACAvB;sBACAC;sBACAuB;sBACAC;sBACAC;oBACA;kBACA;gBACA;cACA;cACAH;gBACAvB;kBAAAC;kBAAAC;gBAAA;cACA;YACA;UACA;YACAF;cAAAC;cAAAC;YAAA;UACA;QACA;QACAqB;UACAvB;YAAAC;YAAAC;UAAA;QACA;MACA;IACA;IACAyB;MACA;MAEA;MACA;QACA;QACA;QACA;UACA;UACAC;QACA;UACA;UACAA;QACA;QACAC;MACA;QACAA;MACA;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACxYA;AAAA;AAAA;AAAA;AAAquC,CAAgB,itCAAG,EAAC,C;;;;;;;;;;;ACAzvC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages-sub/report/clinic.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages-sub/report/clinic.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./clinic.vue?vue&type=template&id=0f40b62d&scoped=true&\"\nvar renderjs\nimport script from \"./clinic.vue?vue&type=script&lang=js&\"\nexport * from \"./clinic.vue?vue&type=script&lang=js&\"\nimport style0 from \"./clinic.vue?vue&type=style&index=0&id=0f40b62d&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0f40b62d\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages-sub/report/clinic.vue\"\nexport default component.exports","export * from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./clinic.vue?vue&type=template&id=0f40b62d&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.records.length\n  var l0 = g0\n    ? _vm.__map(_vm.records, function (item, index) {\n        var $orig = _vm.__get_orig(item)\n        var m0 = _vm.formatDateTime(item.visitDateTime || item.createTime)\n        var m1 = _vm.renderDrugInfo(item)\n        var m2 = m1 ? _vm.renderDrugInfo(item) : null\n        return {\n          $orig: $orig,\n          m0: m0,\n          m1: m1,\n          m2: m2,\n        }\n      })\n    : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./clinic.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./clinic.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"container\">\n    <!-- È°∂ÈÉ®Ê†áÈ¢ò -->\n    <view class=\"page-header\">\n      <view class=\"page-header-inner\">\n        <text class=\"page-title\">{{ reportTitle }}</text>\n      </view>\n    </view>\n\n    <!-- Á≠õÈÄâÂå∫Âüü -->\n    <view class=\"filter-card\">\n      <view class=\"filter-row\">\n        <view class=\"filter-item\">\n          <text class=\"label\">ÂºÄÂßãÊó•Êúü</text>\n          <picker mode=\"date\" :value=\"filters.startDate\" @change=\"onStartDateChange\">\n            <view class=\"picker-text\">{{ filters.startDate || 'ËØ∑ÈÄâÊã©' }}</view>\n          </picker>\n        </view>\n        <view class=\"filter-item\">\n          <text class=\"label\">ÁªìÊùüÊó•Êúü</text>\n          <picker mode=\"date\" :value=\"filters.endDate\" @change=\"onEndDateChange\">\n            <view class=\"picker-text\">{{ filters.endDate || 'ËØ∑ÈÄâÊã©' }}</view>\n          </picker>\n        </view>\n      </view>\n\n      <view class=\"filter-row\">\n        <view class=\"filter-item\">\n          <text class=\"label\">ÂßìÂêç</text>\n          <input\n            class=\"input\"\n            v-model.trim=\"filters.name\"\n            placeholder=\"ËæìÂÖ•ÂßìÂêçÔºåÊîØÊåÅÊ®°Á≥äÊü•ËØ¢\"\n            @confirm=\"fetchRecords\"\n          />\n        </view>\n        <view class=\"filter-item\">\n          <text class=\"label\">Âõ≠Âå∫</text>\n          <picker mode=\"selector\" :range=\"locationOptions\" :value=\"locationIndex\" @change=\"onLocationChange\">\n            <view class=\"picker-text\">{{ currentLocationLabel }}</view>\n          </picker>\n        </view>\n      </view>\n\n      <view class=\"filter-actions\">\n        <button class=\"btn ghost\" @tap=\"resetFilters\">ÈáçÁΩÆ</button>\n        <button class=\"btn primary\" @tap=\"fetchRecords\">Êü•ËØ¢</button>\n        <button class=\"btn export\" @tap=\"openExportOptions\">ÂØºÂá∫ ‚ñæ</button>\n      </view>\n    </view>\n\n    <!-- ÁªìÊûúÂàóË°®ÔºöÂç°ÁâáÂºèÈó®ËØäËÆ∞ÂΩï -->\n    <view class=\"list-section\">\n      <view v-if=\"records.length\" class=\"record-list\">\n        <view\n          class=\"record-card\"\n          v-for=\"(item, index) in records\"\n          :key=\"index\"\n        >\n          <!-- È°∂ÈÉ®ÔºöÊó∂Èó¥ + Âõ≠Âå∫ -->\n          <view class=\"record-header\">\n            <text class=\"record-time\">{{ formatDateTime(item.visitDateTime || item.createTime) }}</text>\n            <view class=\"record-location-wrap\" v-if=\"item.location\">\n              <text class=\"record-location\">{{ item.location === 'land_park' ? 'ÈôÜÂõ≠' : (item.location === 'water_park' ? 'Ê∞¥Âõ≠' : '‰∏çÈôêÂõ≠Âå∫') }}</text>\n            </view>\n          </view>\n\n          <!-- ÂßìÂêç + Ë∫´‰ªΩ / Á±ªÂûã‰ø°ÊÅØ -->\n          <view class=\"record-main-row\">\n            <view class=\"record-main-left\">\n              <text class=\"record-name\">{{ item.name || '-' }}</text>\n              <text class=\"record-sub\" v-if=\"item.gender || item.age\">\n                {{ item.gender || '' }}<text v-if=\"item.gender && item.age\"> ¬∑ </text>{{ item.age ? item.age + 'Â≤Å' : '' }}\n              </text>\n            </view>\n            <view class=\"record-main-right\">\n              <text class=\"record-tag\" v-if=\"item.identity\">{{ item.identity }}</text>\n              <text class=\"record-tag type\" v-if=\"item.isOutcall || item.visitType\">\n                {{ (item.isOutcall || item.visitType === 'outcall') ? 'Âá∫ËØä' : 'Èó®ËØä' }}\n              </text>\n            </view>\n          </view>\n\n          <!-- ‰∏ªËØâ -->\n          <view class=\"record-field\" v-if=\"item.chiefComplaint\">\n            <text class=\"field-label\">‰∏ªËØâ</text>\n            <text class=\"field-value\">{{ item.chiefComplaint }}</text>\n          </view>\n\n          <!-- ËØäÊñ≠ -->\n          <view class=\"record-field\" v-if=\"item.diagnosis\">\n            <text class=\"field-label\">ËØäÊñ≠</text>\n            <text class=\"field-value\">{{ item.diagnosis }}</text>\n          </view>\n\n          <!-- Âá∫ËØäÂú∞ÁÇπÔºà‰ªÖÂá∫ËØäËÆ∞ÂΩïÊòæÁ§∫Ôºâ -->\n          <view\n            class=\"record-field\"\n            v-if=\"(item.isOutcall || item.visitType === 'outcall') && item.injuryLocation\"\n          >\n            <text class=\"field-label\">Âá∫ËØäÂú∞ÁÇπ</text>\n            <text class=\"field-value\">{{ item.injuryLocation }}</text>\n          </view>\n\n          <!-- Áî®ËçØ / Â§ÑÁΩÆ‰ø°ÊÅØ -->\n          <view class=\"record-field\" v-if=\"renderDrugInfo(item)\">\n            <text class=\"field-label\">Áî®ËçØ</text>\n            <text class=\"field-value\">{{ renderDrugInfo(item) }}</text>\n          </view>\n\n          <!-- Â§áÊ≥® -->\n          <view class=\"record-field\" v-if=\"item.remark\">\n            <text class=\"field-label\">Â§áÊ≥®</text>\n            <text class=\"field-value\">{{ item.remark }}</text>\n          </view>\n\n          <!-- ÂåªÁîü -->\n          <view class=\"record-footer\">\n            <text class=\"field-label\">ÂåªÁîü</text>\n            <text class=\"field-value\">{{ item.doctorName || '-' }}</text>\n          </view>\n        </view>\n      </view>\n      <view v-else class=\"empty-state\">\n        <text class=\"empty-icon\">üìã</text>\n        <text class=\"empty-text\">ÊöÇÊó†Èó®ËØäËÆ∞ÂΩï</text>\n        <text class=\"empty-hint\">ËØ∑ÈÄâÊã©ÂßìÂêç / Âõ≠Âå∫ / Êó∂Èó¥ÊÆµÂêéÁÇπÂáªÊü•ËØ¢</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  name: 'ClinicReport',\n  data() {\n    return {\n      loading: false,\n      records: [],\n      filters: {\n        startDate: '',\n        endDate: '',\n        name: '',\n        location: 'all'\n      },\n      locationOptions: ['ÂÖ®ÈÉ®Âõ≠Âå∫', 'ÈôÜÂõ≠', 'Ê∞¥Âõ≠'],\n      locationIndex: 0,\n      userInfo: uni.getStorageSync('userInfo') || {}\n    }\n  },\n  computed: {\n    reportTitle() {\n      const locMap = {\n        land_park: 'ÈôÜÂõ≠',\n        water_park: 'Ê∞¥Âõ≠'\n      }\n      const locText = locMap[this.filters.location]\n      if (locText) {\n        return `Âåó‰∫¨Ê¨¢‰πêË∞∑ÂåªÂä°ÂÆ§Ôºà${locText}ÔºâÈó®ËØäÁôªËÆ∞Ë°®`\n      }\n      return 'Âåó‰∫¨Ê¨¢‰πêË∞∑ÂåªÂä°ÂÆ§Èó®ËØäÁôªËÆ∞Ë°®'\n    },\n    currentLocationLabel() {\n      return this.locationOptions[this.locationIndex] || 'ÂÖ®ÈÉ®Âõ≠Âå∫'\n    }\n  },\n  onLoad() {\n    this.initDefaultDate()\n    this.fetchRecords()\n  },\n  methods: {\n    initDefaultDate() {\n      const today = new Date()\n      const y = today.getFullYear()\n      const m = String(today.getMonth() + 1).padStart(2, '0')\n      const d = String(today.getDate()).padStart(2, '0')\n      const dateStr = `${y}-${m}-${d}`\n      this.filters.startDate = dateStr\n      this.filters.endDate = dateStr\n    },\n    onStartDateChange(e) {\n      this.filters.startDate = e.detail.value\n    },\n    onEndDateChange(e) {\n      this.filters.endDate = e.detail.value\n    },\n    onLocationChange(e) {\n      const idx = Number(e.detail.value) || 0\n      this.locationIndex = idx\n      if (idx === 0) this.filters.location = 'all'\n      else if (idx === 1) this.filters.location = 'land_park'\n      else this.filters.location = 'water_park'\n    },\n    resetFilters() {\n      this.initDefaultDate()\n      this.filters.name = ''\n      this.filters.location = 'all'\n      this.locationIndex = 0\n      this.fetchRecords()\n    },\n    async fetchRecords() {\n      this.loading = true\n      try {\n        const payload = {\n          location: this.filters.location === 'all' ? '' : this.filters.location,\n          startDate: this.filters.startDate,\n          endDate: this.filters.endDate,\n          patient: this.filters.name || '',\n          page: 1,\n          pageSize: 1000,\n          useClinicRecords: true\n        }\n        const res = await wx.cloud.callFunction({\n          name: 'clinicRecords',\n          data: {\n            action: 'list',\n            data: payload\n          }\n        })\n        const list = res?.result?.data?.list || []\n        this.records = list.map(r => ({\n          ...r,\n          doctorName: this.userInfo?.name || ''\n        }))\n      } catch (err) {\n        console.error('Âä†ËΩΩÈó®ËØäÊä•Ë°®Â§±Ë¥•:', err)\n        uni.showToast({ title: 'Âä†ËΩΩÂ§±Ë¥•', icon: 'none' })\n      } finally {\n        this.loading = false\n      }\n    },\n    openExportOptions() {\n      if (!this.records.length) {\n        uni.showToast({ title: 'ÊöÇÊó†Êï∞ÊçÆÂèØÂØºÂá∫', icon: 'none' })\n        return\n      }\n      uni.showActionSheet({\n        itemList: ['ÂØºÂá∫‰∏∫ Excel', 'ÂØºÂá∫‰∏∫ PDF'],\n        success: (res) => {\n          if (res.tapIndex === 0) {\n            this.exportExcel()\n          } else if (res.tapIndex === 1) {\n            this.exportPDF()\n          }\n        }\n      })\n    },\n    buildExportPayload() {\n      return {\n        startDate: this.filters.startDate,\n        endDate: this.filters.endDate,\n        name: this.filters.name || '',\n        location: this.filters.location,\n        printUser: this.userInfo?.name || ''\n      }\n    },\n    async exportExcel() {\n      try {\n        uni.showLoading({ title: 'ÁîüÊàêExcel...', mask: true })\n        const payload = this.buildExportPayload()\n        const res = await this.$api.callFunction('reports', {\n          action: 'exportClinicExcel',\n          data: payload\n        })\n        uni.hideLoading()\n        if (res?.success && res.fileID && res.filename) {\n          const urlRes = await wx.cloud.getTempFileURL({ fileList: [res.fileID] })\n          const fileUrl = urlRes?.fileList?.[0]?.tempFileURL\n          if (fileUrl) {\n            this.downloadAndSaveLocal(fileUrl, res.filename, 'Excel')\n          } else {\n            uni.showToast({ title: 'Ëé∑Âèñ‰∏ãËΩΩÈìæÊé•Â§±Ë¥•', icon: 'none' })\n          }\n        } else {\n          uni.showToast({ title: 'ÁîüÊàêExcelÂ§±Ë¥•', icon: 'none' })\n        }\n      } catch (err) {\n        uni.hideLoading()\n        console.error('ÂØºÂá∫ExcelÂ§±Ë¥•:', err)\n        uni.showToast({ title: 'ÂØºÂá∫Â§±Ë¥•', icon: 'none' })\n      }\n    },\n    async exportPDF() {\n      try {\n        uni.showLoading({ title: 'ÁîüÊàêPDF...', mask: true })\n        const payload = this.buildExportPayload()\n        const res = await this.$api.callFunction('reports', {\n          action: 'exportClinicPDF',\n          data: payload\n        })\n        uni.hideLoading()\n        if (res?.success && res.fileID) {\n          const urlRes = await wx.cloud.getTempFileURL({ fileList: [res.fileID] })\n          const fileUrl = urlRes?.fileList?.[0]?.tempFileURL\n          let filename = ''\n          if (res.fileID) {\n            const parts = res.fileID.split('/')\n            filename = parts[parts.length - 1] || `clinic_report_${Date.now()}.pdf`\n          }\n          if (fileUrl) {\n            this.downloadAndSaveLocal(fileUrl, filename, 'PDF')\n          } else {\n            uni.showToast({ title: 'Ëé∑Âèñ‰∏ãËΩΩÈìæÊé•Â§±Ë¥•', icon: 'none' })\n          }\n        } else {\n          uni.showToast({ title: 'ÁîüÊàêPDFÂ§±Ë¥•', icon: 'none' })\n        }\n      } catch (err) {\n        uni.hideLoading()\n        console.error('ÂØºÂá∫PDFÂ§±Ë¥•:', err)\n        uni.showToast({ title: 'ÂØºÂá∫Â§±Ë¥•', icon: 'none' })\n      }\n    },\n    downloadAndSaveLocal(fileUrl, filename, fileType) {\n      const fs = wx.getFileSystemManager()\n      const folder = `${wx.env.USER_DATA_PATH}`\n      const savePath = `${folder}/${filename}`\n      try {\n        fs.mkdirSync(folder, true)\n      } catch (e) {}\n      uni.downloadFile({\n        url: fileUrl,\n        success: (res) => {\n          if (res.statusCode === 200) {\n            fs.saveFile({\n              tempFilePath: res.tempFilePath,\n              filePath: savePath,\n              success: () => {\n                const lower = (filename || '').toLowerCase()\n                let fileTypeExt = 'xlsx'\n                if (lower.endsWith('.pdf')) fileTypeExt = 'pdf'\n                wx.openDocument({\n                  filePath: savePath,\n                  fileType: fileTypeExt,\n                  showMenu: true,\n                  fail: () => {\n                    uni.showModal({\n                      title: `${fileType}Êñá‰ª∂Â∑≤‰øùÂ≠ò`,\n                      content: `Êñá‰ª∂Â∑≤‰øùÂ≠òÂà∞ÔºöÂæÆ‰ø°-Êàë-ÊúçÂä°-Â∞èÁ®ãÂ∫è-ÊàëÁöÑÊñá‰ª∂/${filename}\\n\\nËØ∑ÂâçÂæÄÂæÆ‰ø°-Êàë-ÊúçÂä°-Â∞èÁ®ãÂ∫è-ÊàëÁöÑÊñá‰ª∂ Êü•Áúã„ÄÅÂàÜ‰∫´ÊàñÂØºÂá∫„ÄÇ`,\n                      showCancel: false,\n                      confirmText: 'Áü•ÈÅì‰∫Ü'\n                    })\n                  }\n                })\n              },\n              fail: () => {\n                uni.showToast({ title: '‰øùÂ≠òÂ§±Ë¥•', icon: 'none' })\n              }\n            })\n          } else {\n            uni.showToast({ title: '‰∏ãËΩΩÂ§±Ë¥•', icon: 'none' })\n          }\n        },\n        fail: () => {\n          uni.showToast({ title: 'Êñá‰ª∂‰∏ãËΩΩÂ§±Ë¥•', icon: 'none' })\n        }\n      })\n    },\n    formatDateTime(date) {\n      if (!date) return ''\n\n      let d\n      if (typeof date === 'string') {\n        let str = date.trim()\n        // ÂÖºÂÆπ \"yyyy-MM-dd HH:mm\" / \"yyyy-MM-dd\" ËøôÁ±ªÂú® iOS ‰∏äÊó†Ê≥ïÁõ¥Êé•Ëß£ÊûêÁöÑÊ†ºÂºè\n        if (/^\\d{4}-\\d{2}-\\d{2}\\s\\d{2}:\\d{2}$/.test(str)) {\n          // ËΩ¨‰∏∫ iOS ÊîØÊåÅÁöÑ \"yyyy/MM/dd HH:mm:ss\"\n          str = str.replace(/-/g, '/') + ':00'\n        } else if (/^\\d{4}-\\d{2}-\\d{2}$/.test(str)) {\n          // ‰ªÖÊó•ÊúüÔºö\"yyyy/MM/dd\"\n          str = str.replace(/-/g, '/')\n        }\n        d = new Date(str)\n      } else {\n        d = new Date(date)\n      }\n\n      if (Number.isNaN(d.getTime())) return ''\n      const y = d.getFullYear()\n      const m = String(d.getMonth() + 1).padStart(2, '0')\n      const day = String(d.getDate()).padStart(2, '0')\n      const hh = String(d.getHours()).padStart(2, '0')\n      const mm = String(d.getMinutes()).padStart(2, '0')\n      return `${y}-${m}-${day} ${hh}:${mm}`\n    },\n    renderDrugInfo(item) {\n      if (!item || !item.drugName) return ''\n      const quantity = item.quantityMin || item.quantity || ''\n      const unit = item.minUnit || item.unit || ''\n      return `${item.drugName}${quantity ? ' ' + quantity : ''}${unit}`\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  min-height: 100vh;\n  // ‰ΩøÁî®‰∏éÈ¶ñÈ°µ/Èó®ËØäÈ¶ñÈ°µ‰∏ÄËá¥ÁöÑËìùËâ≤Ê∏êÂèòËÉåÊôØ\n  background: linear-gradient(180deg, #00c9ff 0%, #00a0ff 35%, #e5e7eb 100%);\n  padding-bottom: 140rpx;\n}\n\n.page-header {\n  // È°∂ÈÉ®Ê†áÈ¢òÂç°ÁâáÔºöË±°ÁâôÁôΩÂúÜËßíÂç°ÁâáÔºåÂÆΩÂ∫¶‰∏éÈ¶ñÈ°µ header-card ÂØπÈΩê\n  max-width: 702rpx;\n  margin: 24rpx auto 8rpx;\n  padding: 32rpx 30rpx 24rpx;\n  background: #FFFFF0;\n  border-radius: 22rpx;\n  box-shadow:\n    0 1rpx 0 rgba(255, 255, 255, 0.9) inset,\n    0 -1rpx 0 rgba(15, 23, 42, 0.06) inset,\n    0 18rpx 40rpx rgba(15, 23, 42, 0.14);\n}\n\n.page-header-inner {\n  width: 100%;\n  display: flex;\n  justify-content: center;\n}\n\n.page-title {\n  font-size: 40rpx;\n  font-weight: 600;\n  color: #0f172a;\n}\n\n.filter-card {\n  max-width: 702rpx;\n  margin: 0 auto 8rpx;\n  padding: 24rpx 24rpx 20rpx;\n  background: #FFFFF0;\n  border-radius: 24rpx;\n  box-shadow: 0 8rpx 20rpx rgba(15, 23, 42, 0.12);\n}\n\n.filter-row {\n  display: flex;\n  gap: 16rpx;\n  margin-bottom: 16rpx;\n}\n\n.filter-item {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 8rpx;\n}\n\n.label {\n  font-size: 24rpx;\n  color: #6b7280;\n}\n\n.picker-text {\n  padding: 18rpx 20rpx;\n  border-radius: 12rpx;\n  border: 2rpx solid #e5e7eb;\n  background: #f9fafb;\n  font-size: 28rpx;\n  color: #111827;\n}\n\n.input {\n  padding: 18rpx 20rpx;\n  border-radius: 12rpx;\n  border: 2rpx solid #e5e7eb;\n  background: #f9fafb;\n  font-size: 28rpx;\n  color: #111827;\n}\n\n.filter-actions {\n  margin-top: 8rpx;\n  display: flex;\n  justify-content: flex-end;\n  gap: 16rpx;\n}\n\n.btn {\n  min-width: 150rpx;\n  padding: 16rpx 24rpx;\n  border-radius: 999rpx;\n  font-size: 26rpx;\n}\n\n.btn.ghost {\n  background: #fff;\n  color: #4f46e5;\n  border: 1rpx solid #c7d2fe;\n}\n\n.btn.primary {\n  background: linear-gradient(135deg, #4f46e5, #7c3aed);\n  color: #fff;\n  border: none;\n}\n\n.btn.export {\n  background: #fff7ed;\n  color: #ea580c;\n  border: 1rpx solid #fed7aa;\n}\n\n.table-section {\n  margin: 0 30rpx 20rpx;\n}\n\n.table-wrapper {\n  background: #fff;\n  border-radius: 20rpx;\n  box-shadow: 0 12rpx 30rpx rgba(15, 23, 42, 0.06);\n  overflow: hidden;\n}\n\n.table-header {\n  display: flex;\n  padding: 22rpx 12rpx;\n  background: #f8fafc;\n  font-size: 24rpx;\n  font-weight: 600;\n  color: #475569;\n}\n\n.table-body {\n  max-height: 900rpx;\n}\n\n.table-row {\n  display: flex;\n  align-items: center;\n  padding: 18rpx 12rpx;\n  font-size: 24rpx;\n  color: #0f172a;\n  border-bottom: 1rpx solid #f1f5f9;\n}\n\n.table-row:last-child {\n  border-bottom: none;\n}\n\n.col {\n  padding: 0 4rpx;\n}\n\n.w-no {\n  width: 80rpx;\n  text-align: center;\n}\n\n.w-date {\n  width: 220rpx;\n}\n\n.w-name {\n  width: 120rpx;\n}\n\n.w-main {\n  flex: 1;\n}\n\n.w-diag {\n  flex: 1;\n}\n\n.w-drug {\n  flex: 1.2;\n}\n\n.w-doctor {\n  width: 140rpx;\n}\n\n.empty-state {\n  background: #fff;\n  padding: 120rpx 20rpx;\n  border-radius: 20rpx;\n  text-align: center;\n  color: #94a3b8;\n  display: flex;\n  flex-direction: column;\n  gap: 12rpx;\n  box-shadow: 0 10rpx 24rpx rgba(15, 23, 42, 0.06);\n}\n\n.empty-icon {\n  font-size: 90rpx;\n}\n\n.empty-text {\n  font-size: 30rpx;\n}\n\n.empty-hint {\n  font-size: 24rpx;\n}\n\n/* Èó®ËØäÊü•ËØ¢Âç°ÁâáÂàóË°®Ê†∑Âºè */\n.list-section {\n  max-width: 702rpx;\n  margin: 0 auto 8rpx;\n}\n\n.record-list {\n  display: flex;\n  flex-direction: column;\n  gap: 16rpx;\n}\n\n.record-card {\n  background: #ffffff;\n  border-radius: 22rpx;\n  padding: 22rpx 24rpx 20rpx;\n  box-shadow: 0 18rpx 40rpx rgba(15, 23, 42, 0.14);\n  border: none;\n}\n\n.record-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8rpx;\n}\n\n.record-time {\n  font-size: 24rpx;\n  color: #4b5563;\n}\n\n.record-location-wrap {\n  padding: 4rpx 10rpx;\n  border-radius: 999rpx;\n  background: rgba(59, 130, 246, 0.08);\n}\n\n.record-location {\n  font-size: 22rpx;\n  color: #6366f1;\n}\n\n.record-main-row {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 10rpx;\n  margin-bottom: 6rpx;\n}\n\n.record-main-left {\n  flex: 1;\n  min-width: 0;\n}\n\n.record-main-right {\n  display: flex;\n  gap: 8rpx;\n}\n\n.record-name {\n  font-size: 30rpx;\n  font-weight: 600;\n  color: #111827;\n}\n\n.record-sub {\n  margin-top: 2rpx;\n  font-size: 22rpx;\n  color: #6b7280;\n}\n\n.record-tag {\n  font-size: 22rpx;\n  color: #6b7280;\n  padding: 2rpx 10rpx;\n  border-radius: 999rpx;\n  background: #f3f4f6;\n}\n\n.record-tag.type {\n  color: #2563eb;\n  background: #dbeafe;\n}\n\n.record-field {\n  margin-top: 4rpx;\n  display: flex;\n  align-items: flex-start;\n  gap: 8rpx;\n}\n\n.field-label {\n  font-size: 22rpx;\n  color: #9ca3af;\n  min-width: 72rpx;\n}\n\n.field-value {\n  font-size: 24rpx;\n  color: #111827;\n  flex: 1;\n  word-break: break-all;\n  white-space: pre-wrap;\n}\n\n.record-footer {\n  margin-top: 8rpx;\n  display: flex;\n  justify-content: flex-end;\n  gap: 6rpx;\n}\n</style>\n","import mod from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./clinic.vue?vue&type=style&index=0&id=0f40b62d&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./clinic.vue?vue&type=style&index=0&id=0f40b62d&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1766820926602\n      var cssReload = require(\"D:/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}