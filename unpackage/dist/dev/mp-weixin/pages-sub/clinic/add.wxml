<view class="clinic-add data-v-0904e2e0"><scroll-view class="clinic-scroll data-v-0904e2e0" scroll-y="{{true}}" scroll-into-view="{{activeFieldId}}"><view class="page-header data-v-0904e2e0"><view class="title data-v-0904e2e0">北京欢乐谷医务室</view><view class="subtitle data-v-0904e2e0">门诊登记表</view></view><view class="top-actions-card data-v-0904e2e0"><view class="top-buttons data-v-0904e2e0"><button data-event-opts="{{[['tap',[['openLocationSelector',['$event']]]]]}}" class="top-btn primary data-v-0904e2e0" bindtap="__e">{{''+(locationLocked?'选择园区':currentLocationLabel)+''}}</button><button data-event-opts="{{[['tap',[['generateDailyReport',['$event']]]]]}}" class="top-btn ghost data-v-0904e2e0" bindtap="__e">门诊日报</button></view></view><block wx:if="{{showLocationTip}}"><view class="location-modal-overlay data-v-0904e2e0"><view class="location-modal data-v-0904e2e0"><view class="modal-title data-v-0904e2e0">请选择当前所在园区</view><view class="modal-subtitle data-v-0904e2e0">{{"当前："+currentLocationLabel+"，用于统计门诊登记、日报等数据"}}</view><view class="modal-location-buttons data-v-0904e2e0"><button data-event-opts="{{[['tap',[['handleLocationSelect',['land_park']]]]]}}" class="{{['modal-loc-btn','data-v-0904e2e0',(form.location==='land_park')?'active':'']}}" bindtap="__e">陆园</button><button data-event-opts="{{[['tap',[['handleLocationSelect',['water_park']]]]]}}" class="{{['modal-loc-btn','data-v-0904e2e0',(form.location==='water_park')?'active':'']}}" bindtap="__e">水园</button></view><view class="modal-hint-text data-v-0904e2e0">后续可随时通过上方“选择园区”按钮切换，不影响已登记记录。</view><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="modal-row data-v-0904e2e0" bindtap="__e"><checkbox checked="{{noTipNextTime}}" class="data-v-0904e2e0"></checkbox><text class="modal-checkbox-text data-v-0904e2e0">下次不再提醒</text></view><button data-event-opts="{{[['tap',[['closeLocationTip',['$event']]]]]}}" class="modal-close-btn data-v-0904e2e0" bindtap="__e">关闭提示</button></view></view></block><view class="form-section data-v-0904e2e0" id="field-remark"><view class="section-title data-v-0904e2e0">患者基本信息</view><view class="form-row data-v-0904e2e0"><view class="form-item half data-v-0904e2e0" id="field-name"><view class="label required data-v-0904e2e0">就诊日期时间</view><view class="datetime-display data-v-0904e2e0">{{form.visitDateTime}}</view></view><view class="form-item half data-v-0904e2e0"><view class="label required data-v-0904e2e0">身份</view><view class="identity-selector data-v-0904e2e0"><block wx:for="{{identityOptions}}" wx:for-item="idOpt" wx:for-index="__i0__" wx:key="value"><view data-event-opts="{{[['tap',[['setIdentity',['$0'],[[['identityOptions','value',idOpt.value,'value']]]]]]]}}" class="{{['identity-item','data-v-0904e2e0',(form.identity===idOpt.value)?'active':'']}}" bindtap="__e">{{''+idOpt.label+''}}</view></block></view></view></view><view class="form-row data-v-0904e2e0"><view class="form-item half data-v-0904e2e0"><view class="label required data-v-0904e2e0">姓名</view><input type="text" placeholder="选园区后输入姓名" disabled="{{locationLocked}}" cursor-spacing="80" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['form']]]]]}}" value="{{form.name}}" bindinput="__e" class="data-v-0904e2e0"/></view><view class="form-item half data-v-0904e2e0"><view class="label required data-v-0904e2e0">性别 / 年龄</view><view class="gender-age-row data-v-0904e2e0"><view class="gender-selector compact data-v-0904e2e0"><view data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" class="{{['gender-item','data-v-0904e2e0',(form.gender==='男')?'active':'']}}" bindtap="__e"> 男 </view><view data-event-opts="{{[['tap',[['e2',['$event']]]]]}}" class="{{['gender-item','data-v-0904e2e0',(form.gender==='女')?'active':'']}}" bindtap="__e"> 女 </view></view><input class="age-input data-v-0904e2e0" type="number" inputmode="numeric" pattern="[0-9]*" maxlength="{{3}}" focus="{{ageFocus}}" confirm-type="done" placeholder="年龄" data-event-opts="{{[['tap',[['e3',['$event']]]],['blur',[['e4',['$event']],['$forceUpdate']]],['input',[['__set_model',['$0','age','$event',['number']],['form']]]]]}}" value="{{form.age}}" bindtap="__e" bindblur="__e" bindinput="__e"/></view></view></view><view class="form-item data-v-0904e2e0" id="field-chiefComplaint"><view class="label required data-v-0904e2e0">主诉</view><view class="disease-input-wrapper data-v-0904e2e0"><input class="input-uniform data-v-0904e2e0" type="text" placeholder="请输入患者自述症状，例如：头部外伤伴头晕" maxlength="100" data-event-opts="{{[['focus',[['onComplaintFocus'],['onFieldFocus',['field-chiefComplaint']]]],['input',[['__set_model',['$0','chiefComplaint','$event',[]],['form']],['onComplaintInput',['$event']]]],['blur',[['onComplaintBlur',['$event']]]]]}}" value="{{form.chiefComplaint}}" bindfocus="__e" bindinput="__e" bindblur="__e"/><block wx:if="{{$root.g0}}"><view class="disease-dropdown data-v-0904e2e0"><scroll-view class="disease-scroll data-v-0904e2e0" scroll-y="{{true}}"><block wx:for="{{filteredComplaints}}" wx:for-item="opt" wx:for-index="__i1__" wx:key="key"><view data-event-opts="{{[['tap',[['selectComplaint',['$0'],[[['filteredComplaints','key',opt.key]]]]]]]}}" class="disease-item data-v-0904e2e0" bindtap="__e">{{''+opt.label+''}}</view></block></scroll-view></view></block></view></view></view><view class="form-section data-v-0904e2e0"><view class="section-title data-v-0904e2e0">就诊信息</view><view class="form-row data-v-0904e2e0"><view class="form-item half data-v-0904e2e0"><view class="label required data-v-0904e2e0">是否出诊</view><view class="identity-selector visit-type-selector data-v-0904e2e0"><block wx:for="{{visitTypeOptions}}" wx:for-item="vt" wx:for-index="__i2__" wx:key="value"><view data-event-opts="{{[['tap',[['setVisitType',['$0'],[[['visitTypeOptions','value',vt.value,'value']]]]]]]}}" class="{{['identity-item','data-v-0904e2e0',(form.visitType===vt.value)?'active':'']}}" bindtap="__e"><text class="visit-type-text data-v-0904e2e0">{{vt.label}}</text></view></block></view></view><view class="form-item half data-v-0904e2e0"><view class="{{['label','data-v-0904e2e0',(form.visitType==='outcall')?'required':'']}}">受伤地点</view><view class="location-input-wrapper data-v-0904e2e0"><input class="input-uniform data-v-0904e2e0" type="text" placeholder="{{form.visitType==='outcall'?'请输入受伤地点（必填）':'例如：机动游戏区、餐饮区（可选）'}}" data-event-opts="{{[['focus',[['onLocationFocus'],['onFieldFocus',['field-injuryLocation']]]],['input',[['__set_model',['$0','injuryLocation','$event',[]],['form']],['onLocationInput',['$event']]]]]}}" value="{{form.injuryLocation}}" bindfocus="__e" bindinput="__e"/><block wx:if="{{$root.g1}}"><view class="location-dropdown data-v-0904e2e0"><scroll-view class="location-scroll data-v-0904e2e0" scroll-y="{{true}}"><block wx:for="{{filteredLocations}}" wx:for-item="loc" wx:for-index="__i3__" wx:key="*this"><view data-event-opts="{{[['tap',[['selectLocationFromList',['$0'],[[['filteredLocations','',__i3__]]]]]]]}}" class="location-item data-v-0904e2e0" bindtap="__e">{{''+loc+''}}</view></block></scroll-view></view></block></view></view></view><view class="form-item data-v-0904e2e0"><view class="label required data-v-0904e2e0">诊断</view><view class="disease-input-wrapper data-v-0904e2e0"><input class="input-uniform data-v-0904e2e0" type="text" placeholder="请输入初步诊断结果，例如：轻度头部挫伤" maxlength="100" data-event-opts="{{[['focus',[['onDiagnosisFocus'],['onFieldFocus',['field-diagnosis']]]],['input',[['__set_model',['$0','diagnosis','$event',[]],['form']],['onDiagnosisInput',['$event']]]],['blur',[['onDiagnosisBlur',['$event']]]]]}}" value="{{form.diagnosis}}" bindfocus="__e" bindinput="__e" bindblur="__e"/><block wx:if="{{$root.g2}}"><view class="disease-dropdown data-v-0904e2e0"><scroll-view class="disease-scroll data-v-0904e2e0" scroll-y="{{true}}"><block wx:if="{{$root.g3>0}}"><view class="diagnosis-section data-v-0904e2e0"><block wx:for="{{filteredDiagnosis}}" wx:for-item="it" wx:for-index="__i4__" wx:key="*this"><view data-event-opts="{{[['tap',[['selectDiagnosis',['$0'],[[['filteredDiagnosis','',__i4__]]]]]]]}}" class="disease-item data-v-0904e2e0" bindtap="__e">{{''+it+''}}</view></block></view></block></scroll-view></view></block></view></view><view class="form-item data-v-0904e2e0" id="field-symptom"><view class="label data-v-0904e2e0">症状</view><view class="disease-input-wrapper data-v-0904e2e0"><input class="input-uniform data-v-0904e2e0" type="text" placeholder="例如：头晕、恶心、局部红肿等（可选，可从主诉自动提取）" maxlength="150" data-event-opts="{{[['focus',[['onSymptomFocus'],['onFieldFocus',['field-symptom']]]],['input',[['__set_model',['$0','symptom','$event',[]],['form']],['onSymptomInput',['$event']]]],['blur',[['onSymptomBlur',['$event']]]]]}}" value="{{form.symptom}}" bindfocus="__e" bindinput="__e" bindblur="__e"/><block wx:if="{{$root.g4}}"><view class="disease-dropdown data-v-0904e2e0"><scroll-view class="disease-scroll data-v-0904e2e0" scroll-y="{{true}}"><block wx:for="{{filteredSymptoms}}" wx:for-item="symptom" wx:for-index="idx" wx:key="idx"><view data-event-opts="{{[['tap',[['selectSymptom',['$0'],[[['filteredSymptoms','',idx]]]]]]]}}" class="disease-item data-v-0904e2e0" bindtap="__e"><text class="symptom-name data-v-0904e2e0">{{symptom.name||symptom}}</text><block wx:if="{{symptom.category}}"><text class="symptom-category data-v-0904e2e0">{{symptom.category}}</text></block></view></block></scroll-view></view></block></view></view><view class="form-item data-v-0904e2e0"><view class="label required data-v-0904e2e0">疾病名称</view><view class="disease-name-row data-v-0904e2e0"><view class="disease-input-wrapper data-v-0904e2e0" style="flex:1;"><input class="input-uniform data-v-0904e2e0" type="text" placeholder="例如：感冒、外伤、中暑等" data-event-opts="{{[['input',[['__set_model',['$0','diseaseName','$event',[]],['form']],['onDiseaseInput',['$event']]]],['focus',[['onDiseaseFocus'],['onFieldFocus',['field-diseaseName']]]],['blur',[['onDiseaseBlur',['$event']]]]]}}" value="{{form.diseaseName}}" bindinput="__e" bindfocus="__e" bindblur="__e"/><block wx:if="{{$root.g5}}"><view class="disease-dropdown data-v-0904e2e0"><scroll-view class="disease-scroll data-v-0904e2e0" scroll-y="{{true}}"><block wx:for="{{filteredDiseases}}" wx:for-item="disease" wx:for-index="__i5__" wx:key="*this"><view data-event-opts="{{[['tap',[['selectDisease',['$0'],[[['filteredDiseases','',__i5__]]]]]]]}}" class="disease-item data-v-0904e2e0" bindtap="__e">{{''+disease+''}}</view></block></scroll-view></view></block></view></view></view><view class="form-item data-v-0904e2e0"><view class="label required data-v-0904e2e0">处置</view><view class="disease-input-wrapper data-v-0904e2e0"><input class="input-uniform data-v-0904e2e0" type="text" placeholder="请输入处理措施，例如：伤口清洗消毒、冷敷" maxlength="120" data-event-opts="{{[['focus',[['onTreatmentFocus'],['onFieldFocus',['field-treatment']]]],['input',[['__set_model',['$0','treatment','$event',[]],['form']],['onTreatmentInput',['$event']]]]]}}" value="{{form.treatment}}" bindfocus="__e" bindinput="__e"/><block wx:if="{{$root.g6}}"><view class="disease-dropdown data-v-0904e2e0"><scroll-view class="disease-scroll data-v-0904e2e0" scroll-y="{{true}}"><block wx:for="{{filteredTreatments}}" wx:for-item="it" wx:for-index="__i6__" wx:key="*this"><view data-event-opts="{{[['tap',[['selectTreatment',['$0'],[[['filteredTreatments','',__i6__]]]]]]]}}" class="disease-item data-v-0904e2e0" bindtap="__e">{{''+it+''}}</view></block></scroll-view></view></block></view></view></view><view class="form-section data-v-0904e2e0"><view class="section-title data-v-0904e2e0">用药信息（可选）</view><view class="form-item data-v-0904e2e0" id="field-drug"><view class="label data-v-0904e2e0">药材名称</view><view class="drug-input-wrapper data-v-0904e2e0"><input class="input-uniform data-v-0904e2e0" type="text" placeholder="点击查看所有药材或输入搜索" data-event-opts="{{[['input',[['__set_model',['','drugSearchText','$event',[]]],['onDrugSearch',['$event']]]],['focus',[['onDrugInputFocus',['$event']]]]]}}" value="{{drugSearchText}}" bindinput="__e" bindfocus="__e"/><block wx:if="{{$root.g7}}"><view class="drug-dropdown data-v-0904e2e0"><view class="dropdown-header data-v-0904e2e0"><text class="dropdown-title data-v-0904e2e0">{{(form.location==='land_park'?'陆园':'水园')+"库存药材"}}</text><text class="dropdown-count data-v-0904e2e0">{{"("+$root.g8+"种)"}}</text></view><scroll-view class="drug-scroll data-v-0904e2e0" scroll-y="{{true}}"><block wx:for="{{filteredDrugs}}" wx:for-item="drug" wx:for-index="__i7__" wx:key="_id"><view data-event-opts="{{[['tap',[['selectDrugFromList',['$0'],[[['filteredDrugs','_id',drug._id]]]]]]]}}" class="drug-item data-v-0904e2e0" bindtap="__e"><view class="drug-name data-v-0904e2e0">{{drug.name}}</view><view class="drug-spec data-v-0904e2e0">{{drug.specification}}</view></view></block></scroll-view></view></block><block wx:if="{{$root.g9}}"><view class="no-result data-v-0904e2e0"> 未找到匹配的药材 </view></block></view></view><block wx:if="{{selectedDrug}}"><view class="drug-quick-info data-v-0904e2e0"><view class="drug-info-row data-v-0904e2e0"><view class="drug-name-section data-v-0904e2e0"><text class="drug-name-text data-v-0904e2e0">{{selectedDrug.name}}</text><text class="drug-spec-text data-v-0904e2e0">{{selectedDrug.specification}}</text></view><view class="drug-stock-section data-v-0904e2e0"><text class="stock-label data-v-0904e2e0">{{(form.location==='land_park'?'陆园':'水园')+"库存："}}</text><text class="{{['stock-value','data-v-0904e2e0',(availableStock<10)?'stock-warning':'']}}">{{availableStock+" "+selectedDrug.minUnit}}</text></view></view></view></block><block wx:if="{{selectedDrug}}"><view class="drug-usage-section data-v-0904e2e0"><view class="form-row data-v-0904e2e0"><view class="form-item half data-v-0904e2e0"><view class="label required data-v-0904e2e0">用药数量</view><view class="quantity-input-group data-v-0904e2e0"><input class="input-uniform data-v-0904e2e0" type="number" placeholder="数量" data-event-opts="{{[['input',[['__set_model',['$0','quantity','$event',['number']],['form']]]],['blur',[['$forceUpdate']]]]}}" value="{{form.quantity}}" bindinput="__e" bindblur="__e"/><text class="unit-text data-v-0904e2e0">{{$root.m0}}</text></view><block wx:if="{{form.quantity>availableStock}}"><view class="quantity-warning data-v-0904e2e0"><text class="warning-icon data-v-0904e2e0">⚠️</text><text class="warning-text data-v-0904e2e0">{{"库存不足！当前："+availableStock+" "+selectedDrug.minUnit}}</text></view></block></view><view class="form-item half data-v-0904e2e0"><view class="label data-v-0904e2e0">单次剂量</view><view class="dosage-input-group data-v-0904e2e0"><input class="input-uniform data-v-0904e2e0" type="text" placeholder="{{$root.m1}}" data-event-opts="{{[['input',[['__set_model',['$0','dosage','$event',[]],['currentDrug']]]]]}}" value="{{currentDrug.dosage}}" bindinput="__e"/></view></view></view><view class="form-row data-v-0904e2e0"><view class="form-item half data-v-0904e2e0"><view class="label data-v-0904e2e0">用药频次</view><picker mode="selector" range="{{frequencyOptions}}" value="{{frequencyIndex}}" data-event-opts="{{[['change',[['onFrequencyChange',['$event']]]]]}}" bindchange="__e" class="data-v-0904e2e0"><view class="picker-input data-v-0904e2e0">{{currentFrequencyLabel}}</view></picker></view><view class="form-item half data-v-0904e2e0"><view class="label data-v-0904e2e0">给药途径</view><picker mode="selector" range="{{routeOptions}}" value="{{routeIndex}}" data-event-opts="{{[['change',[['onRouteChange',['$event']]]]]}}" bindchange="__e" class="data-v-0904e2e0"><view class="picker-input data-v-0904e2e0">{{currentRouteLabel}}</view></picker></view></view><view class="form-item data-v-0904e2e0"><view class="label data-v-0904e2e0">用法说明</view><input class="input-uniform data-v-0904e2e0" type="text" placeholder="如：饭后服用，多饮水" data-event-opts="{{[['input',[['__set_model',['$0','usage','$event',[]],['currentDrug']]]]]}}" value="{{currentDrug.usage}}" bindinput="__e"/></view><view class="add-prescription-action data-v-0904e2e0"><button data-event-opts="{{[['tap',[['addToPrescription',['$event']]]]]}}" class="add-prescription-btn data-v-0904e2e0" bindtap="__e"><text class="btn-icon data-v-0904e2e0">➕</text><text class="btn-text data-v-0904e2e0">加入处方</text></button></view></view></block><view class="form-item data-v-0904e2e0"><view class="label-row data-v-0904e2e0"><view class="label data-v-0904e2e0">开具处方</view><switch checked="{{enablePrescription}}" color="#1890ff" data-event-opts="{{[['change',[['onPrescriptionSwitch',['$event']]]]]}}" bindchange="__e" class="data-v-0904e2e0"></switch></view></view><block wx:if="{{enablePrescription}}"><view class="prescription-section data-v-0904e2e0"><view class="prescription-hospital-header data-v-0904e2e0"><view class="hospital-logo data-v-0904e2e0">🏥</view><view class="hospital-info data-v-0904e2e0"><text class="hospital-name data-v-0904e2e0">北京欢乐谷医务室</text><text class="hospital-subtitle data-v-0904e2e0">Beijing Happy Valley Medical Office</text></view></view><view class="prescription-title-section data-v-0904e2e0"><text class="prescription-main-title data-v-0904e2e0">门诊处方笺</text><text class="prescription-type-badge data-v-0904e2e0">普通处方</text></view><view class="prescription-meta-info data-v-0904e2e0"><view class="meta-item data-v-0904e2e0"><text class="meta-label data-v-0904e2e0">处方编号：</text><text class="meta-value data-v-0904e2e0">{{prescriptionNo}}</text></view><view class="meta-item data-v-0904e2e0"><text class="meta-label data-v-0904e2e0">开具日期：</text><text class="meta-value data-v-0904e2e0">{{currentDate}}</text></view></view><view class="prescription-patient-card data-v-0904e2e0"><view class="patient-info-row data-v-0904e2e0"><view class="patient-info-item data-v-0904e2e0"><text class="info-label data-v-0904e2e0">姓名</text><text class="info-value data-v-0904e2e0">{{form.name||'___'}}</text></view><view class="patient-info-item data-v-0904e2e0"><text class="info-label data-v-0904e2e0">性别</text><text class="info-value data-v-0904e2e0">{{form.gender||'___'}}</text></view><view class="patient-info-item data-v-0904e2e0"><text class="info-label data-v-0904e2e0">年龄</text><text class="info-value data-v-0904e2e0">{{(form.age||'___')+"岁"}}</text></view><view class="patient-info-item data-v-0904e2e0"><text class="info-label data-v-0904e2e0">身份</text><text class="info-value data-v-0904e2e0">{{form.identity||'___'}}</text></view></view><view class="patient-diagnosis-row data-v-0904e2e0"><text class="diagnosis-label data-v-0904e2e0">临床诊断：</text><text class="diagnosis-value data-v-0904e2e0">{{form.diagnosis||'___'}}</text></view></view><view class="prescription-body data-v-0904e2e0"><view class="prescription-rp-header data-v-0904e2e0"><text class="rp-symbol data-v-0904e2e0">Rp:</text></view><view class="prescription-drugs-list data-v-0904e2e0"><block wx:if="{{$root.g10===0}}"><view class="drugs-empty data-v-0904e2e0"><text class="empty-icon data-v-0904e2e0">💊</text><text class="empty-text data-v-0904e2e0">暂无处方药品</text><text class="empty-hint data-v-0904e2e0">请在上方选择药品并添加到处方</text></view></block><block wx:for="{{$root.l0}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="prescription-drug-item data-v-0904e2e0"><view class="drug-item-header data-v-0904e2e0"><view class="drug-name-spec data-v-0904e2e0"><text class="drug-name data-v-0904e2e0">{{item.$orig.drugName}}</text><block wx:if="{{item.$orig.specification}}"><text class="drug-spec data-v-0904e2e0">{{"（"+item.$orig.specification+"）"}}</text></block><text class="drug-quantity data-v-0904e2e0">{{item.$orig.quantity+item.$orig.unit}}</text></view><view class="drug-actions data-v-0904e2e0"><text data-event-opts="{{[['tap',[['removeFromPrescription',[index]]]]]}}" class="action-btn delete data-v-0904e2e0" bindtap="__e">[删除]</text></view></view><block wx:if="{{item.$orig.dosage||item.$orig.route||item.$orig.frequency}}"><view class="drug-usage-row data-v-0904e2e0"><text class="usage-label data-v-0904e2e0">用法：</text><text class="usage-value data-v-0904e2e0">{{item.m2}}</text></view></block></view></block></view><block wx:if="{{$root.g11>0}}"><view class="prescription-summary data-v-0904e2e0"><text class="summary-text data-v-0904e2e0">{{"共 "+$root.g12+" 种药品"}}</text></view></block><view class="prescription-blank-line data-v-0904e2e0"><text class="blank-text data-v-0904e2e0">————————— 以下空白 —————————</text></view></view><view class="prescription-footer-section data-v-0904e2e0"><view class="footer-row data-v-0904e2e0"><view class="footer-item data-v-0904e2e0"><text class="footer-label data-v-0904e2e0">医师签名：</text><view class="signature-placeholder data-v-0904e2e0"><text class="placeholder-text data-v-0904e2e0">（见下方电子签名）</text></view></view></view></view><view class="prescription-notes data-v-0904e2e0"><view class="note-title data-v-0904e2e0">📌 处方说明</view><view class="note-item data-v-0904e2e0"><text class="note-bullet data-v-0904e2e0">•</text><text class="note-text data-v-0904e2e0">本处方仅供医务室内部使用，请妥善保管</text></view><view class="note-item data-v-0904e2e0"><text class="note-bullet data-v-0904e2e0">•</text><text class="note-text data-v-0904e2e0">药品数量使用最小单位（片、粒、支等）</text></view><view class="note-item data-v-0904e2e0"><text class="note-bullet data-v-0904e2e0">•</text><text class="note-text data-v-0904e2e0">请按医嘱用药，如有不适请及时就诊</text></view></view></view></block><block wx:if="{{selectedBatch}}"><view class="batch-info data-v-0904e2e0"><view class="batch-item data-v-0904e2e0"><text class="label data-v-0904e2e0">批次号：</text><text class="data-v-0904e2e0">{{selectedBatch.batch}}</text></view><view class="batch-item data-v-0904e2e0"><text class="label data-v-0904e2e0">有效期：</text><text class="data-v-0904e2e0">{{$root.m3}}</text><block wx:if="{{selectedBatch.daysToExpiry<=60}}"><text class="warning data-v-0904e2e0">{{'（'+selectedBatch.daysToExpiry+'天后到期）'}}</text></block></view><view class="batch-item data-v-0904e2e0"><text class="label data-v-0904e2e0">剩余库存：</text><text class="data-v-0904e2e0">{{selectedBatch.quantity+" "+selectedDrug.minUnit}}</text></view></view></block></view><view class="form-section data-v-0904e2e0"><view class="section-title data-v-0904e2e0">备注</view><view class="form-item data-v-0904e2e0"><input class="input-uniform data-v-0904e2e0" type="text" placeholder="其他说明或建议（可选）" maxlength="200" data-event-opts="{{[['input',[['__set_model',['$0','remark','$event',[]],['form']]]]]}}" value="{{form.remark}}" bindinput="__e"/></view></view><view class="form-section data-v-0904e2e0"><view class="section-title data-v-0904e2e0">接诊医生签名</view><view class="signature-info data-v-0904e2e0"><view class="signature-tip data-v-0904e2e0"><text class="tip-text data-v-0904e2e0">请医生在下方签名确认本次就诊信息</text></view></view><view class="signature-section data-v-0904e2e0"><view class="signature-label-row data-v-0904e2e0"><view class="signature-label data-v-0904e2e0">医生签名</view><text class="required data-v-0904e2e0">*</text></view><signature vue-id="1797fa26-1" title="医生签名" value="{{form.doctorSign}}" data-event-opts="{{[['^change',[['onDoctorSignChange']]],['^input',[['__set_model',['$0','doctorSign','$event',[]],['form']]]]]}}" bind:change="__e" bind:input="__e" class="data-v-0904e2e0" bind:__l="__l"></signature><block wx:if="{{form.signTime}}"><view class="signature-time data-v-0904e2e0">{{'签名时间：'+form.signTime+''}}</view></block></view></view><view class="continue-option data-v-0904e2e0"><view data-event-opts="{{[['tap',[['toggleContinue',['$event']]]]]}}" class="continue-card data-v-0904e2e0" bindtap="__e"><view class="continue-checkbox data-v-0904e2e0"><checkbox checked="{{continueAfterSubmit}}" class="data-v-0904e2e0"></checkbox></view><view class="continue-text data-v-0904e2e0"><view class="continue-title data-v-0904e2e0">连续登记模式</view><view class="continue-desc data-v-0904e2e0">提交后自动清空表单，继续登记下一位患者</view></view></view></view><block wx:if="{{showDrugSelector}}"><drug-selector bind:select="__e" bind:close="__e" vue-id="1797fa26-2" data-event-opts="{{[['^select',[['onDrugSelect']]],['^close',[['e5']]]]}}" class="data-v-0904e2e0" bind:__l="__l"></drug-selector></block></scroll-view><view class="submit-section data-v-0904e2e0"><button data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="cancel-btn data-v-0904e2e0" bindtap="__e">取消</button><button class="submit-btn data-v-0904e2e0" loading="{{submitting}}" data-event-opts="{{[['tap',[['handleSubmit',['$event']]]]]}}" bindtap="__e"> 保存 </button></view><view class="continue-option data-v-0904e2e0"><view data-event-opts="{{[['tap',[['toggleContinue',['$event']]]]]}}" class="continue-card data-v-0904e2e0" bindtap="__e"><view class="continue-checkbox data-v-0904e2e0"><checkbox checked="{{continueAfterSubmit}}" class="data-v-0904e2e0"></checkbox></view><view class="continue-text data-v-0904e2e0"><view class="continue-title data-v-0904e2e0">连续登记模式</view><view class="continue-desc data-v-0904e2e0">提交后自动清空表单，继续登记下一位患者</view></view></view></view><block wx:if="{{showDrugSelector}}"><drug-selector bind:select="__e" bind:close="__e" vue-id="1797fa26-3" data-event-opts="{{[['^select',[['onDrugSelect']]],['^close',[['e6']]]]}}" class="data-v-0904e2e0" bind:__l="__l"></drug-selector></block></view>