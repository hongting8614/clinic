<view class="page data-v-58f3a51d"><view class="page-header data-v-58f3a51d"><view class="header-content data-v-58f3a51d"><text class="header-title data-v-58f3a51d">è¯æå…¥åº“</text><text class="header-subtitle data-v-58f3a51d">{{"å…¥åº“æ—¥æœŸï¼š"+currentDate}}</text></view></view><view class="info-card data-v-58f3a51d"><view class="info-row data-v-58f3a51d"><view class="info-item data-v-58f3a51d"><text class="label data-v-58f3a51d">å•å·ï¼š</text><text class="value data-v-58f3a51d">{{recordNo}}</text></view><view class="info-item data-v-58f3a51d"><text class="label data-v-58f3a51d">åŒ»ç”Ÿï¼š</text><text class="value data-v-58f3a51d">{{operator}}</text></view></view><view class="info-row data-v-58f3a51d"><view class="info-item full data-v-58f3a51d"><text class="label data-v-58f3a51d">å¤‡æ³¨</text><input class="input-value data-v-58f3a51d" placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰" placeholder-class="placeholder" data-event-opts="{{[['input',[['__set_model',['','remark','$event',[]]]]]]}}" value="{{remark}}" bindinput="__e"/></view></view></view><view class="search-card data-v-58f3a51d"><view class="{{['search-wrapper','data-v-58f3a51d',(searchFocused)?'focused':'']}}"><view class="search-icon-wrapper data-v-58f3a51d"><text class="search-icon data-v-58f3a51d">ğŸ”</text></view><input class="search-input data-v-58f3a51d" placeholder="æ‰«ç /æœç´¢è¯æåç§°" placeholder-class="placeholder" data-event-opts="{{[['focus',[['onSearchFocus',['$event']]]],['blur',[['onSearchBlur',['$event']]]],['input',[['__set_model',['','searchKeyword','$event',[]]],['onSearchInput',['$event']]]],['confirm',[['onSearchConfirm',['$event']]]]]}}" value="{{searchKeyword}}" bindfocus="__e" bindblur="__e" bindinput="__e" bindconfirm="__e"/><block wx:if="{{searchKeyword}}"><view data-event-opts="{{[['tap',[['clearSearch',['$event']]]]]}}" class="clear-icon data-v-58f3a51d" bindtap="__e"><text class="data-v-58f3a51d">âœ•</text></view></block><view data-event-opts="{{[['tap',[['scanBarcode',['$event']]]]]}}" class="scan-btn data-v-58f3a51d" bindtap="__e"><view class="scan-icon-frame data-v-58f3a51d"></view></view></view><view class="{{['search-results','data-v-58f3a51d',($root.g0)?'show':'']}}"><block wx:for="{{$root.l0}}" wx:for-item="drug" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectDrug',['$0'],[[['searchResults','',index]]]]]]]}}" class="result-item data-v-58f3a51d" bindtap="__e"><view class="drug-info data-v-58f3a51d"><view class="drug-name-row data-v-58f3a51d"><text class="drug-name data-v-58f3a51d">{{drug.$orig.name}}</text><block wx:if="{{drug.$orig.completeness}}"><view class="{{['completeness-badge','data-v-58f3a51d',(drug.$orig.completeness.percentage===100)?'complete':'',(drug.$orig.completeness.percentage>=75&&drug.$orig.completeness.percentage<100)?'good':'',(drug.$orig.completeness.percentage>=50&&drug.$orig.completeness.percentage<75)?'medium':'',(drug.$orig.completeness.percentage<50)?'low':'']}}"><text class="badge-text data-v-58f3a51d">{{drug.$orig.completeness.percentage+"%"}}</text></view></block></view><text class="drug-spec data-v-58f3a51d">{{drug.$orig.spec}}</text><block wx:if="{{drug.g1}}"><text class="missing-fields data-v-58f3a51d">{{'ç¼ºå°‘ï¼š'+drug.g2+''}}</text></block></view><text class="select-icon data-v-58f3a51d">â€º</text></view></block></view><block wx:if="{{isSearchingAPI}}"><view class="api-searching data-v-58f3a51d"><view class="loading-wrapper data-v-58f3a51d"><text class="loading-icon data-v-58f3a51d">â³</text><text class="loading-text data-v-58f3a51d">æ­£åœ¨æŸ¥è¯¢è¯ææ¡£æ¡ˆ...</text></view></view></block><block wx:if="{{showCreateForm}}"><view class="create-form-inline data-v-58f3a51d"><view class="create-tip tip-warning data-v-58f3a51d"><text class="tip-icon data-v-58f3a51d">ğŸ’¡</text><view class="tip-content data-v-58f3a51d"><text class="tip-title data-v-58f3a51d">æœªæ‰¾åˆ°ç›¸å…³è¯æ</text><text class="tip-subtitle data-v-58f3a51d">è¯·å®Œå–„ä»¥ä¸‹ä¿¡æ¯</text></view></view><view class="inline-form data-v-58f3a51d"><view class="inline-form-title data-v-58f3a51d">ğŸ“ æ–°å»ºè¯ææ¡£æ¡ˆ</view><view class="inline-form-item data-v-58f3a51d"><text class="inline-label data-v-58f3a51d">è¯æåç§° <text class="required data-v-58f3a51d">*</text></text><view class="input-with-voice data-v-58f3a51d"><input class="inline-input voice-input data-v-58f3a51d" placeholder="è¯·è¾“å…¥è¯æåç§°" placeholder-class="placeholder" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['newDrug']]]]]}}" value="{{newDrug.name}}" bindinput="__e"/><view data-event-opts="{{[['tap',[['startVoiceInput',['name']]]]]}}" class="voice-btn data-v-58f3a51d" bindtap="__e"><text class="voice-icon data-v-58f3a51d">ğŸ¤</text></view></view></view><view class="inline-form-item data-v-58f3a51d"><text class="inline-label data-v-58f3a51d">è§„æ ¼ <text class="required data-v-58f3a51d">*</text></text><view class="input-with-voice data-v-58f3a51d"><input class="inline-input voice-input data-v-58f3a51d" placeholder="å¦‚ï¼š0.25gÃ—24ç²’/ç›’" placeholder-class="placeholder" data-event-opts="{{[['input',[['__set_model',['$0','spec','$event',[]],['newDrug']]]]]}}" value="{{newDrug.spec}}" bindinput="__e"/><view data-event-opts="{{[['tap',[['startVoiceInput',['spec']]]]]}}" class="voice-btn data-v-58f3a51d" bindtap="__e"><text class="voice-icon data-v-58f3a51d">ğŸ¤</text></view></view></view><view class="inline-form-item data-v-58f3a51d"><text class="inline-label data-v-58f3a51d">å•ä½ <text class="required data-v-58f3a51d">*</text></text><view class="quick-units data-v-58f3a51d"><block wx:for="{{['ç›’','ç“¶','è¢‹','æ”¯','æ¿']}}" wx:for-item="unit" wx:for-index="idx" wx:key="idx"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" data-event-params="{{({unit})}}" class="{{['quick-unit-btn','data-v-58f3a51d',(newDrug.unit===unit)?'active':'']}}" bindtap="__e"><text class="data-v-58f3a51d">{{unit}}</text></view></block><picker mode="selector" range="{{unitOptions}}" value="{{unitIndex}}" data-event-opts="{{[['change',[['onUnitChange',['$event']]]]]}}" bindchange="__e" class="data-v-58f3a51d"><view class="quick-unit-btn more-btn data-v-58f3a51d"><text class="data-v-58f3a51d">æ›´å¤š â–¼</text></view></picker></view></view><view class="inline-form-item data-v-58f3a51d"><text class="inline-label data-v-58f3a51d">ç”Ÿäº§å‚å®¶</text><view class="input-with-suggestions data-v-58f3a51d"><input class="inline-input data-v-58f3a51d" placeholder="é€‰å¡«ï¼Œè¾“å…¥2ä¸ªå­—å¯æ™ºèƒ½æç¤º" placeholder-class="placeholder" data-event-opts="{{[['input',[['__set_model',['$0','manufacturer','$event',[]],['newDrug']],['onManufacturerInput',['$event']]]],['focus',[['onManufacturerFocus',['$event']]]],['blur',[['onManufacturerBlur',['$event']]]]]}}" value="{{newDrug.manufacturer}}" bindinput="__e" bindfocus="__e" bindblur="__e"/><block wx:if="{{$root.g3}}"><view class="suggestions-list data-v-58f3a51d"><block wx:for="{{manufacturerSuggestions}}" wx:for-item="mfr" wx:for-index="idx" wx:key="idx"><view data-event-opts="{{[['tap',[['selectManufacturer',['$0'],[[['manufacturerSuggestions','',idx]]]]]]]}}" class="suggestion-item data-v-58f3a51d" bindtap="__e"><text class="data-v-58f3a51d">{{mfr}}</text></view></block></view></block></view></view><view class="inline-form-item data-v-58f3a51d"><text class="inline-label data-v-58f3a51d">æ‰¹å‡†æ–‡å·</text><input class="inline-input data-v-58f3a51d" placeholder="é€‰å¡«" placeholder-class="placeholder" data-event-opts="{{[['input',[['__set_model',['$0','approvalNumber','$event',[]],['newDrug']]]]]}}" value="{{newDrug.approvalNumber}}" bindinput="__e"/></view><view class="inline-form-actions data-v-58f3a51d"><view data-event-opts="{{[['tap',[['cancelCreate',['$event']]]]]}}" class="inline-btn btn-cancel data-v-58f3a51d" bindtap="__e"><text class="data-v-58f3a51d">å–æ¶ˆ</text></view><view data-event-opts="{{[['tap',[['confirmCreate',['$event']]]]]}}" class="inline-btn btn-confirm data-v-58f3a51d" bindtap="__e"><text class="data-v-58f3a51d">ç¡®è®¤åˆ›å»ºå¹¶æ·»åŠ </text></view></view></view></view></block></view><view class="drug-list-section data-v-58f3a51d"><view class="section-header data-v-58f3a51d"><text class="section-title data-v-58f3a51d">å…¥åº“æ˜ç»†</text><text class="section-count data-v-58f3a51d">{{$root.g4+" ç§"}}</text></view><block wx:if="{{$root.g5>0}}"><view class="drug-cards data-v-58f3a51d"><block wx:for="{{$root.l1}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="{{['drug-card','data-v-58f3a51d',(item.$orig.hasError)?'has-error':'']}}"><view class="card-header data-v-58f3a51d"><view class="drug-name-wrapper data-v-58f3a51d"><text class="drug-name data-v-58f3a51d">{{item.$orig.drugName}}</text><text class="drug-spec data-v-58f3a51d">{{item.$orig.specification}}</text></view><view data-event-opts="{{[['tap',[['deleteDrug',[index]]]]]}}" class="delete-btn data-v-58f3a51d" bindtap="__e"><text class="delete-icon data-v-58f3a51d">âœ•</text></view></view><view class="card-form data-v-58f3a51d"><view class="form-row data-v-58f3a51d"><view class="form-item third data-v-58f3a51d"><text class="form-label data-v-58f3a51d">æ‰¹å· <text class="required data-v-58f3a51d">*</text></text><input class="form-input data-v-58f3a51d" placeholder="è¯·è¾“å…¥æ‰¹å·" placeholder-class="placeholder" data-event-opts="{{[['blur',[['validateRow',[index]]]],['input',[['__set_model',['$0','batch','$event',[]],[[['drugList','',index]]]]]]]}}" value="{{item.$orig.batch}}" bindblur="__e" bindinput="__e"/></view><view class="form-item third data-v-58f3a51d"><text class="form-label data-v-58f3a51d">ç”Ÿäº§æ—¥æœŸ <text class="required data-v-58f3a51d">*</text></text><picker mode="date" value="{{item.$orig.productionDate}}" start="{{minDate}}" end="{{maxDate}}" data-event-opts="{{[['change',[['e1',['$event']]]]]}}" data-event-params="{{({index})}}" bindchange="__e" class="data-v-58f3a51d"><view class="{{['picker-input','data-v-58f3a51d',(item.$orig.productionDate)?'has-value':'']}}">{{''+(item.$orig.productionDate||'è¯·é€‰æ‹©')+''}}</view></picker></view><view class="form-item third data-v-58f3a51d"><text class="form-label data-v-58f3a51d">æœ‰æ•ˆæœŸ <text class="required data-v-58f3a51d">*</text></text><picker mode="date" value="{{item.$orig.expireDate}}" start="{{minDate}}" end="{{maxExpDate}}" data-event-opts="{{[['change',[['e2',['$event']]]]]}}" data-event-params="{{({index})}}" bindchange="__e" class="data-v-58f3a51d"><view class="{{['picker-input','data-v-58f3a51d',(item.$orig.expireDate)?'has-value':'']}}">{{''+(item.$orig.expireDate||'è¯·é€‰æ‹©')+''}}</view></picker></view><block wx:if="{{item.$orig.daysToExpiry!==null}}"><view class="{{['expiry-badge-inline','data-v-58f3a51d',item.$orig.daysToExpiry<0?'expired':'',item.$orig.daysToExpiry>=0&&item.$orig.daysToExpiry<30?'danger':'',item.$orig.daysToExpiry>=30&&item.$orig.daysToExpiry<90?'warning':'',item.$orig.daysToExpiry>=90?'safe':'']}}"><text class="data-v-58f3a51d">{{item.$orig.daysToExpiry+"å¤©"}}</text></view></block></view><view class="form-row data-v-58f3a51d"><view class="form-item half data-v-58f3a51d"><text class="form-label data-v-58f3a51d">æ•°é‡ <text class="required data-v-58f3a51d">*</text></text><view class="input-with-unit data-v-58f3a51d"><input class="form-input data-v-58f3a51d" type="number" placeholder="æ•°é‡" placeholder-class="placeholder" data-event-opts="{{[['blur',[['validateRow',[index]]]],['input',[['__set_model',['$0','quantity','$event',[]],[[['drugList','',index]]]],['calculateAmount',[index]]]]]}}" value="{{item.$orig.quantity}}" bindblur="__e" bindinput="__e"/><text class="unit-text data-v-58f3a51d">{{item.$orig.unit}}</text></view></view><view class="form-item half data-v-58f3a51d"><text class="form-label data-v-58f3a51d">å•ä»·</text><view class="input-with-unit data-v-58f3a51d"><input class="form-input data-v-58f3a51d" type="digit" placeholder="é€‰å¡«" placeholder-class="placeholder" data-event-opts="{{[['input',[['__set_model',['$0','price','$event',[]],[[['drugList','',index]]]],['calculateAmount',[index]]]]]}}" value="{{item.$orig.price}}" bindinput="__e"/><text class="unit-text data-v-58f3a51d">å…ƒ</text></view></view></view><block wx:if="{{item.$orig.amount>0}}"><view class="amount-display data-v-58f3a51d"><text class="amount-label data-v-58f3a51d">é‡‘é¢ï¼š</text><text class="amount-value data-v-58f3a51d">{{"Â¥"+item.m0}}</text></view></block></view></view></block></view></block><block wx:if="{{$root.g6}}"><view class="empty-state data-v-58f3a51d"><text class="empty-icon data-v-58f3a51d">ğŸ“¦</text><text class="empty-text data-v-58f3a51d">æš‚æ— è¯æ</text><text class="empty-hint data-v-58f3a51d">è¯·åœ¨ä¸Šæ–¹æœç´¢æ¡†æ‰«ç æˆ–æœç´¢æ·»åŠ è¯æ</text></view></block></view><block wx:if="{{$root.g7>0}}"><view class="signature-section data-v-58f3a51d"><view class="summary-card data-v-58f3a51d"><view class="summary-item data-v-58f3a51d"><text class="summary-label data-v-58f3a51d">å“ç§</text><text class="summary-value data-v-58f3a51d">{{$root.g8+" ç§"}}</text></view><view class="summary-item data-v-58f3a51d"><text class="summary-label data-v-58f3a51d">æ€»æ•°é‡</text><text class="summary-value data-v-58f3a51d">{{totalQuantity}}</text></view><block wx:if="{{totalAmount>0}}"><view class="summary-item highlight data-v-58f3a51d"><text class="summary-label data-v-58f3a51d">æ€»é‡‘é¢</text><text class="summary-value data-v-58f3a51d">{{"Â¥"+$root.m1}}</text></view></block></view><view class="signature-card data-v-58f3a51d"><view class="signature-header data-v-58f3a51d"><text class="signature-title data-v-58f3a51d">æ“ä½œå‘˜ç­¾å</text><text class="required data-v-58f3a51d">*</text></view><signature bind:input="__e" vue-id="74fd00ee-1" title="æ“ä½œå‘˜ç­¾å" value="{{operatorSign}}" data-event-opts="{{[['^input',[['__set_model',['','operatorSign','$event',[]]]]]]}}" class="data-v-58f3a51d" bind:__l="__l"></signature></view><view class="submit-btn-container data-v-58f3a51d"><view data-event-opts="{{[['tap',[['submit',['$event']]]]]}}" class="submit-btn data-v-58f3a51d" bindtap="__e"><view class="submit-icon data-v-58f3a51d">âœ“</view><text class="submit-text data-v-58f3a51d">æäº¤å…¥åº“</text></view></view></view></block></view>