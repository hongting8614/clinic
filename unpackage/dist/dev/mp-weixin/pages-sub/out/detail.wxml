<view class="page"><view class="medical-header"><view class="header-bg"></view><view class="header-content"><text class="clinic-name">çˆ±åº·åŒ»åŠ¡å®¤ç®¡ç†ç³»ç»Ÿ</text><text class="doc-type">åŒ—äº¬æ¬¢ä¹è°·åŒ»åŠ¡å®¤ Â· è¯æå‡ºåº“å•</text></view></view><view class="status-flow"><view class="{{['flow-item',record.status!=='draft'?'completed':'current']}}"><view class="flow-dot"></view><text class="flow-text">åˆ›å»º</text></view><view class="{{['flow-line',record.status!=='draft'?'completed':'']}}"></view><view class="{{['flow-item',record.status==='completed'?'completed':record.status==='pending_review'?'current':'']}}"><view class="flow-dot"></view><text class="flow-text">æ¥æ”¶</text></view><view class="{{['flow-line',record.status==='completed'?'completed':'']}}"></view><view class="{{['flow-item',record.status==='completed'?'completed':'']}}"><view class="flow-dot"></view><text class="flow-text">å®Œæˆ</text></view></view><view class="{{['status-badge-large','badge-'+record.status]}}"><text class="badge-icon">{{$root.m0}}</text><text class="badge-text">{{$root.m1}}</text></view><view class="info-card"><view class="card-title"><text class="title-icon">ğŸ“‹</text><text class="title-text">åŸºæœ¬ä¿¡æ¯</text></view><view class="info-grid"><view class="grid-item"><text class="item-label">å•å·</text><text class="item-value mono">{{record.recordNo}}</text></view><view class="grid-item"><text class="item-label">å‡ºåº“å›­åŒº</text><text class="item-value location">{{record.locationName}}</text></view><view class="grid-item"><text class="item-label">åˆ›å»ºæ—¶é—´</text><text class="item-value">{{record.createTime}}</text></view><view class="grid-item"><text class="item-label">å‘æ”¾äºº</text><text class="item-value">{{record.dispenser}}</text></view><block wx:if="{{record.remark}}"><view class="grid-item"><text class="item-label">å¤‡æ³¨</text><text class="item-value">{{record.remark}}</text></view></block></view></view><view class="info-card"><view class="card-title"><text class="title-icon">ğŸ’Š</text><text class="title-text">è¯ææ˜ç»†</text><text class="title-count">{{(record.items?$root.g0:0)+"ç§"}}</text></view><view class="drug-list"><block wx:for="{{$root.l0}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="drug-item-card"><block wx:if="{{item.$orig.isHighValue}}"><view class="high-value-tag"><text class="tag-icon">ğŸ’</text><text class="tag-text">é«˜å€¼è¯æ</text></view></block><view class="drug-header"><view class="drug-name-wrapper"><text class="drug-name">{{item.$orig.drugName}}</text><text class="drug-spec">{{item.$orig.spec}}</text></view><view class="drug-quantity-badge"><text class="quantity-num">{{item.$orig.quantity}}</text><text class="quantity-unit">{{item.$orig.unit}}</text></view></view><view class="drug-details-grid"><view class="detail-item"><text class="detail-label">æ‰¹å·</text><text class="detail-value mono">{{item.$orig.batch}}</text></view><view class="detail-item"><text class="detail-label">æœ‰æ•ˆæœŸ</text><text class="detail-value">{{item.$orig.expireDate}}</text></view><view class="detail-item"><text class="detail-label">ç”Ÿäº§å‚å®¶</text><text class="detail-value">{{item.$orig.manufacturer}}</text></view><block wx:if="{{item.$orig.price}}"><view class="detail-item"><text class="detail-label">å•ä»·</text><text class="detail-value price">{{"Â¥"+item.$orig.price}}</text></view></block><block wx:if="{{item.$orig.price}}"><view class="detail-item"><text class="detail-label">å°è®¡</text><text class="detail-value price">{{"Â¥"+item.g1}}</text></view></block></view></view></block></view><block wx:if="{{totalAmount>0}}"><view class="total-amount"><text class="total-label">åˆè®¡é‡‘é¢</text><text class="total-value">{{"Â¥"+$root.g2}}</text></view></block></view><view class="signature-section"><view class="signature-card"><view class="signature-header"><text class="sig-icon">âœï¸</text><text class="sig-title">å‘æ”¾äººç­¾å</text><text class="sig-name">{{record.dispenser}}</text></view><view class="signature-content"><block wx:if="{{record.dispenserSign}}"><image class="signature-image" src="{{record.dispenserSign}}" mode="aspectFit"></image></block><text class="signature-time">{{record.dispenserSignTime}}</text></view></view><block wx:if="{{record.status==='completed'}}"><view class="signature-card"><view class="signature-header"><text class="sig-icon">âœ…</text><text class="sig-title">æ¥æ”¶äººç­¾å</text><text class="sig-name">{{record.receiver}}</text></view><view class="signature-content"><block wx:if="{{record.receiverSign}}"><image class="signature-image" src="{{record.receiverSign}}" mode="aspectFit"></image></block><text class="signature-time">{{record.receiverSignTime}}</text></view></view></block></view><block wx:if="{{record.status==='rejected'}}"><view class="reject-card"><view class="reject-header"><text class="reject-icon">âš ï¸</text><text class="reject-title">é©³å›åŸå› </text></view><view class="reject-body"><text class="reject-reason">{{record.rejectReason}}</text><view class="reject-footer"><text class="reject-reviewer">{{"æ¥æ”¶äººï¼š"+record.receiver}}</text><text class="reject-time">{{record.receiverSignTime}}</text></view></view></view></block><block wx:if="{{isReviewAction&&record.status==='pending_review'}}"><view class="review-section"><view class="review-card"><view class="card-title"><text class="title-icon">âœï¸</text><text class="title-text">æ¥æ”¶ç¡®è®¤</text></view><view class="signature-input"><signature bind:input="__e" vue-id="b36c4424-1" title="è¯·ç­¾åç¡®è®¤æ¥æ”¶" value="{{receiverSign}}" data-event-opts="{{[['^input',[['__set_model',['','receiverSign','$event',[]]]]]]}}" bind:__l="__l"></signature></view><view class="reject-input"><text class="input-label">é©³å›åŸå› ï¼ˆé€‰å¡«ï¼‰</text><textarea class="reject-textarea" placeholder="å¦‚éœ€é©³å›ï¼Œè¯·å¡«å†™åŸå› " maxlength="200" data-event-opts="{{[['input',[['__set_model',['','rejectReason','$event',[]]]]]]}}" value="{{rejectReason}}" bindinput="__e"></textarea></view></view></view></block><block wx:if="{{showActions}}"><view class="action-bar"><block wx:if="{{isReviewAction&&record.status==='pending_review'}}"><view data-event-opts="{{[['tap',[['handleReject',['$event']]]]]}}" class="action-btn btn-reject" bindtap="__e"><text class="btn-icon">âœ•</text><text class="btn-text">é©³å›</text></view><view data-event-opts="{{[['tap',[['handleApprove',['$event']]]]]}}" class="action-btn btn-approve" bindtap="__e"><text class="btn-icon">âœ“</text><text class="btn-text">ç¡®è®¤æ¥æ”¶</text></view></block><block wx:else><block wx:if="{{canEdit}}"><view data-event-opts="{{[['tap',[['handleDelete',['$event']]]]]}}" class="action-btn btn-delete" bindtap="__e"><text class="btn-icon">ğŸ—‘ï¸</text><text class="btn-text">åˆ é™¤</text></view><view data-event-opts="{{[['tap',[['handleEdit',['$event']]]]]}}" class="action-btn btn-edit" bindtap="__e"><text class="btn-icon">âœï¸</text><text class="btn-text">ç¼–è¾‘</text></view></block><block wx:else><block wx:if="{{record.status==='completed'}}"><view data-event-opts="{{[['tap',[['handleExportPDF',['$event']]]]]}}" class="action-btn btn-export" bindtap="__e"><text class="btn-icon">ğŸ“¤</text><text class="btn-text">å¯¼å‡ºPDF</text></view></block></block></block></view></block></view>