<view class="container data-v-39914319"><view class="content-column data-v-39914319"><block wx:if="{{!isExpiryMode}}"><view class="search-section data-v-39914319"><view class="search-wrapper data-v-39914319"><text class="search-icon data-v-39914319">ğŸ”</text><input class="search-input data-v-39914319" placeholder="æœç´¢è¯æåç§°" confirm-type="search" data-event-opts="{{[['confirm',[['onSearch',['$event']]]],['input',[['__set_model',['','searchKeyword','$event',['trim']]],['onKeywordInput',['$event']]]],['blur',[['$forceUpdate']]]]}}" value="{{searchKeyword}}" bindconfirm="__e" bindinput="__e" bindblur="__e"/><block wx:if="{{searchKeyword}}"><view data-event-opts="{{[['tap',[['clearKeyword',['$event']]]]]}}" class="clear-icon data-v-39914319" bindtap="__e">âœ•</view></block></view></view></block><block wx:if="{{!isExpiryMode}}"><view class="filter-section data-v-39914319"><view class="filter-row chips-row data-v-39914319"><text class="chips-label data-v-39914319">åº“å­˜</text><view class="chips-group data-v-39914319"><block wx:for="{{stockFilters}}" wx:for-item="item" wx:for-index="__i0__" wx:key="value"><view data-event-opts="{{[['tap',[['setStockFilter',['$0'],[[['stockFilters','value',item.value,'value']]]]]]]}}" class="{{['data-v-39914319','chip',[(selectedStockFilter===item.value)?'active':'']]}}" bindtap="__e">{{''+item.label+''}}</view></block></view></view><view class="filter-row chips-row data-v-39914319"><text class="chips-label data-v-39914319">æ•ˆæœŸ</text><view class="chips-group data-v-39914319"><block wx:for="{{expiryFilters}}" wx:for-item="item" wx:for-index="__i1__" wx:key="value"><view data-event-opts="{{[['tap',[['setExpiryFilter',['$0'],[[['expiryFilters','value',item.value,'value']]]]]]]}}" class="{{['data-v-39914319','chip',[(selectedExpiryFilter===item.value)?'active':'']]}}" bindtap="__e">{{''+item.label+''}}</view></block></view></view></view></block><block wx:if="{{!isExpiryMode}}"><view class="stats-bar data-v-39914319"><view class="stat-item data-v-39914319"><text class="stat-label data-v-39914319">å“ç§æ•°</text><text class="stat-value data-v-39914319">{{stats.totalDrugs}}</text></view><view class="stat-item data-v-39914319"><text class="stat-label data-v-39914319">æ€»åº“å­˜</text><text class="stat-value data-v-39914319">{{stats.totalStock}}</text></view><view class="stat-item data-v-39914319"><text class="stat-label data-v-39914319">é¢„è­¦</text><text class="stat-value warning data-v-39914319">{{stats.warningCount}}</text></view><view class="stat-item data-v-39914319"><text class="stat-label data-v-39914319">è¿‘æ•ˆæœŸ</text><text class="stat-value danger data-v-39914319">{{stats.expiringCount}}</text></view></view></block><block wx:if="{{isExpiryMode}}"><view class="expiry-bar data-v-39914319"><view class="expiry-row data-v-39914319"><view class="left-part data-v-39914319"><text class="expiry-label data-v-39914319">æ•ˆæœŸå°äº</text><input class="expiry-input data-v-39914319" type="number" data-event-opts="{{[['confirm',[['applyExpiryDays',['$event']]]],['input',[['__set_model',['','expiryDays','$event',['number']]]]],['blur',[['$forceUpdate']]]]}}" value="{{expiryDays}}" bindconfirm="__e" bindinput="__e" bindblur="__e"/><text class="expiry-unit data-v-39914319">å¤©</text></view><view data-event-opts="{{[['tap',[['applyExpiryDays',['$event']]]]]}}" class="expiry-apply data-v-39914319" bindtap="__e">ç¡®å®š</view></view><view class="expiry-preset data-v-39914319"><view data-event-opts="{{[['tap',[['setExpiryDays',[30]]]]]}}" class="preset-btn data-v-39914319" bindtap="__e">30å¤©</view><view data-event-opts="{{[['tap',[['setExpiryDays',[60]]]]]}}" class="preset-btn data-v-39914319" bindtap="__e">60å¤©</view><view data-event-opts="{{[['tap',[['setExpiryDays',[90]]]]]}}" class="preset-btn data-v-39914319" bindtap="__e">90å¤©</view></view></view></block><view class="stock-list data-v-39914319"><block wx:if="{{isExpiryMode}}"><view class="expiry-summary data-v-39914319">{{'æœ‰æ•ˆæœŸå°äº '+expiryDays+" å¤©çš„è¯æï¼Œå…±è®¡ "+$root.g0+' ä¸ªå“ç§'}}</view></block><block wx:for="{{$root.l1}}" wx:for-item="item" wx:for-index="__i2__" wx:key="_id"><view data-event-opts="{{[['tap',[['goDetail',['$0'],[[['stockList','_id',item.$orig._id]]]]]]]}}" class="stock-card data-v-39914319" bindtap="__e"><view class="card-header data-v-39914319"><view class="drug-name data-v-39914319">{{item.$orig.drugName}}</view><view class="{{['data-v-39914319','stock-badge',item.m0]}}">{{''+item.m1+''}}</view></view><view class="drug-spec data-v-39914319">{{item.$orig.specification}}</view><view class="stock-info data-v-39914319"><view class="info-row data-v-39914319"><text class="info-label data-v-39914319">åº“å­˜ï¼š</text><text class="info-value data-v-39914319">{{''+((item.$orig.totalQuantity!==undefined?item.$orig.totalQuantity:item.$orig.quantity||0)+(item.$orig.unit||''))+''}}</text></view><block wx:if="{{item.$orig.manufacturer}}"><view class="info-row data-v-39914319"><text class="info-label data-v-39914319">å‚å®¶ï¼š</text><text class="info-value data-v-39914319">{{item.$orig.manufacturer}}</text></view></block></view><block wx:if="{{item.g1}}"><view class="batch-section data-v-39914319"><view class="batch-title data-v-39914319">{{"æ‰¹æ¬¡ä¿¡æ¯ï¼ˆ"+item.g2+"ä¸ªï¼‰"}}</view><block wx:for="{{item.l0}}" wx:for-item="batch" wx:for-index="index" wx:key="index"><view class="batch-item data-v-39914319"><view class="batch-row data-v-39914319"><text class="batch-label data-v-39914319">æ‰¹å·ï¼š</text><text class="batch-value data-v-39914319">{{batch.$orig.batch}}</text></view><view class="batch-row data-v-39914319"><text class="batch-label data-v-39914319">æ•°é‡ï¼š</text><text class="batch-value data-v-39914319">{{batch.$orig.quantity+" "+item.$orig.unit}}</text></view><view class="batch-row data-v-39914319"><text class="batch-label data-v-39914319">æ•ˆæœŸï¼š</text><text class="{{['data-v-39914319','batch-value',batch.m2]}}">{{''+batch.$orig.expireDate+" ("+batch.$orig.daysToExpiry+'å¤©)'}}</text></view></view></block></view></block></view></block><block wx:if="{{$root.g3===0}}"><view class="empty-state data-v-39914319"><text class="empty-icon data-v-39914319">ğŸ“¦</text><text class="empty-text data-v-39914319">æš‚æ— ç¬¦åˆæ¡ä»¶çš„è¯æ</text><text class="empty-hint data-v-39914319">{{searchKeyword?'æ¢ä¸ªå…³é”®è¯è¯•è¯•':'å¯è°ƒæ•´ä¸Šæ–¹ç­›é€‰æ¡ä»¶'}}</text></view></block><block wx:if="{{hasMore}}"><view data-event-opts="{{[['tap',[['loadMore',['$event']]]]]}}" class="load-more data-v-39914319" bindtap="__e"><text class="data-v-39914319">åŠ è½½æ›´å¤š</text></view></block><block wx:else><block wx:if="{{$root.g4>0}}"><view class="no-more data-v-39914319"><text class="data-v-39914319">æ²¡æœ‰æ›´å¤šäº†</text></view></block></block></view></view></view>