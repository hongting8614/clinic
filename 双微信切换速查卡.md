# 📱 双微信切换速查卡

## ⚡ 5秒快速切换

### 方法1：自定义编译模式（推荐）

```
1. 点击"编译"按钮旁的下拉箭头 ▼
2. 选择"管理员模式"或"项目经理模式"
3. ✅ 完成！
```

**首次设置（只需一次）：**
```
"编译" ▼ → "添加编译模式"
→ 输入名称："管理员模式"
→ 确定
```

---

### 方法2：直接切换账号

```
1. 右上角头像 → "退出登录"
2. 用另一个微信扫码
3. 点击"编译"
4. ✅ 完成！
```

---

## 📋 准备工作（一次性）

### 1️⃣ 获取OpenID

**在微信开发者工具控制台输入：**

```javascript
wx.cloud.callFunction({
  name: 'login',
  success: res => {
    console.log('OpenID:', res.result.openid || res.result.userInfo?.openid)
  }
})
```

**复制显示的OpenID，例如：** `oXYZ123abc...`

---

### 2️⃣ 添加到数据库

**打开：** [云开发控制台](https://console.cloud.tencent.com/tcb) → 数据库 → users

**管理员账号：**
```json
{
  "openid": "账号A的OpenID",
  "name": "管理员",
  "realName": "张三",
  "phone": "13800138000",
  "role": "admin",
  "status": "active"
}
```

**项目经理账号：**
```json
{
  "openid": "账号B的OpenID",
  "name": "项目经理",
  "realName": "李四",
  "phone": "13900139000",
  "role": "project_manager",
  "status": "active"
}
```

---

## 🎯 角色权限速查

| 角色 | role | 主要权限 |
|------|------|---------|
| 管理员 | `admin` | ✅ **全部功能**<br>用户管理、入库、复核、出库、报表、系统设置 |
| 项目经理 | `project_manager` | ✅ **用户管理** ✅ **入库** ✅ **复核** ✅ **报表**<br>❌ 出库（只能查看）❌ 系统设置 |
| 医生 | `doctor` | ✅ **门诊登记**<br>❌ 其他功能（可查看记录） |
| 药房 | `pharmacy` | ✅ **入库** ✅ **出库** ✅ **药品管理**<br>❌ 用户管理 ❌ 复核 |
| 查看者 | `viewer` | ✅ **仅查看**所有记录<br>❌ 不能操作 |

---

## 🔧 常用操作

### 查看当前角色
```
进入"我的"页面 → 顶部显示角色
```

### 清除缓存重新登录
```
"我的" → "退出登录" → 重新进入
```

### 查看OpenID
```
云开发控制台 → 数据库 → users → 查找用户
```

---

## ⚠️ 快速排查

**问题：提示"不在白名单"**
```
→ 检查OpenID是否已添加到数据库
→ 检查status是否为"active"
```

**问题：切换后还是之前的角色**
```
→ 点击"退出登录"
→ 重新进入小程序
```

**问题：没有某个功能的权限**
```
→ 检查数据库中的role字段
→ 参考上面的"角色权限速查"
```

---

**最后更新：** 2025年11月10日

